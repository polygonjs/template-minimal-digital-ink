import{a as S,b as n4,c as Fc,d as I1,e as D1}from"./chunk-VDLWCXQU.js";var Be=S((Vwe,iT)=>{var sT=r=>r.reduce((e,t)=>Array.isArray(t)?e.concat(sT(t)):e.concat(t),[]);iT.exports=sT});var aT=S((qwe,oT)=>{var j$=r=>Object.assign({},r);oT.exports=j$});var lT=S((Gwe,cT)=>{var $$=(r,e,t)=>(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r[3]=e[3]+t[3],r[4]=e[4]+t[4],r[5]=e[5]+t[5],r[6]=e[6]+t[6],r[7]=e[7]+t[7],r[8]=e[8]+t[8],r[9]=e[9]+t[9],r[10]=e[10]+t[10],r[11]=e[11]+t[11],r[12]=e[12]+t[12],r[13]=e[13]+t[13],r[14]=e[14]+t[14],r[15]=e[15]+t[15],r);cT.exports=$$});var Zd=S((Hwe,uT)=>{var X$=()=>[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];uT.exports=X$});var dT=S((Wwe,hT)=>{var Y$=Zd(),Z$=r=>{let e=Y$();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e};hT.exports=Z$});var Fg=S((jwe,pT)=>{var J$=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r);pT.exports=J$});var mT=S(($we,fT)=>{var K$=(r,e)=>{let t=e[0],n=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],d=e[10],p=e[11],_=e[12],f=e[13],m=e[14],g=e[15],x=t*a-n*o,b=t*c-s*o,v=t*l-i*o,y=n*c-s*a,E=n*l-i*a,C=s*l-i*c,M=u*f-h*_,R=u*m-d*_,N=u*g-p*_,w=h*m-d*f,T=h*g-p*f,F=d*g-p*m,L=x*F-b*T+v*w+y*N-E*R+C*M;return L?(L=1/L,r[0]=(a*F-c*T+l*w)*L,r[1]=(s*T-n*F-i*w)*L,r[2]=(f*C-m*E+g*y)*L,r[3]=(d*E-h*C-p*y)*L,r[4]=(c*N-o*F-l*R)*L,r[5]=(t*F-s*N+i*R)*L,r[6]=(m*v-_*C-g*b)*L,r[7]=(u*C-d*v+p*b)*L,r[8]=(o*T-a*N+l*M)*L,r[9]=(n*N-t*T-i*M)*L,r[10]=(_*E-f*v+g*x)*L,r[11]=(h*v-u*E-p*x)*L,r[12]=(a*R-o*w-c*M)*L,r[13]=(t*w-n*R+s*M)*L,r[14]=(f*b-_*y-m*x)*L,r[15]=(u*y-h*b+d*x)*L,r):null};fT.exports=K$});var gT=S((Xwe,_T)=>{var Q$=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15];_T.exports=Q$});var Ug=S((Ywe,yT)=>{var eX=r=>(r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r);yT.exports=eX});var vT=S((Zwe,xT)=>{xT.exports={EPSILON:1e-6}});var zg=S((Jwe,bT)=>{var tX=Ug(),{EPSILON:nX}=vT(),rX=(r,e,t)=>{let[n,s,i]=t,o=Math.hypot(n,s,i);if(Math.abs(o)<nX)return tX(r);o=1/o,n*=o,s*=o,i*=o;let a=Math.sin(e),c=Math.cos(e),l=1-c;return r[0]=n*n*l+c,r[1]=s*n*l+i*a,r[2]=i*n*l-s*a,r[3]=0,r[4]=n*s*l-i*a,r[5]=s*s*l+c,r[6]=i*s*l+n*a,r[7]=0,r[8]=n*i*l+s*a,r[9]=s*i*l-n*a,r[10]=i*i*l+c,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};bT.exports=rX});var ET=S((Kwe,wT)=>{var sX=(r,e)=>(r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r);wT.exports=sX});var ST=S((Qwe,CT)=>{var iX=(r,e,t,n)=>{let s=Math.sin(e),i=Math.cos(e),o=Math.sin(t),a=Math.cos(t),c=Math.sin(n),l=Math.cos(n);return r[0]=a*i,r[1]=a*s,r[2]=-o,r[3]=0,r[4]=c*o*i-l*s,r[5]=l*i+c*o*s,r[6]=c*a,r[7]=0,r[8]=c*s+l*o*i,r[9]=l*o*s-c*i,r[10]=l*a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};CT.exports=iX});var TT=S((eEe,AT)=>{var oX=(r,e)=>(r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r);AT.exports=oX});var PT=S((tEe,MT)=>{var aX=Zd(),cX=(r,e,t,n,s,i,o,a,c,l,u,h,d,p,_,f)=>{let m=aX();return m[0]=r,m[1]=e,m[2]=t,m[3]=n,m[4]=s,m[5]=i,m[6]=o,m[7]=a,m[8]=c,m[9]=l,m[10]=u,m[11]=h,m[12]=d,m[13]=p,m[14]=_,m[15]=f,m};MT.exports=cX});var Vg=S((nEe,NT)=>{var lX=(r,e)=>(r[0]=Math.abs(e[0]),r[1]=Math.abs(e[1]),r[2]=Math.abs(e[2]),r);NT.exports=lX});var qg=S((rEe,RT)=>{var uX=(r,e,t)=>(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r);RT.exports=uX});var Qa=S((sEe,OT)=>{var hX=(r,e)=>r[0]*e[0]+r[1]*e[1]+r[2]*e[2];OT.exports=hX});var DT=S((iEe,IT)=>{var dX=Qa(),pX=(r,e)=>{let t=r[0],n=r[1],s=r[2],i=e[0],o=e[1],a=e[2],c=Math.hypot(t,n,s),l=Math.hypot(i,o,a),u=c*l,h=u&&dX(r,e)/u;return Math.acos(Math.min(Math.max(h,-1),1))};IT.exports=pX});var Ol=S((oEe,LT)=>{var fX=()=>[0,0,0];LT.exports=fX});var kT=S((aEe,BT)=>{var mX=Ol(),_X=r=>{let e=mX();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e};BT.exports=_X});var Gg=S((cEe,FT)=>{var gX=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r);FT.exports=gX});var Qi=S((lEe,UT)=>{var yX=(r,e,t)=>{let n=e[0],s=e[1],i=e[2],o=t[0],a=t[1],c=t[2];return r[0]=s*c-i*a,r[1]=i*o-n*c,r[2]=n*a-s*o,r};UT.exports=yX});var Hg=S((uEe,zT)=>{var xX=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1],s=e[2]-r[2];return Math.hypot(t,n,s)};zT.exports=xX});var qT=S((hEe,VT)=>{var vX=(r,e,t)=>(r[0]=e[0]/t[0],r[1]=e[1]/t[1],r[2]=e[2]/t[2],r);VT.exports=vX});var HT=S((dEe,GT)=>{var bX=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2];GT.exports=bX});var jT=S((pEe,WT)=>{var wX=(r,e)=>(r[0]=e,r[1]=e,r[2]=e,r);WT.exports=wX});var Wg=S((fEe,$T)=>{var EX=Ol(),CX=(r,e,t)=>{let n=EX();return n[0]=r,n[1]=e,n[2]=t,n};$T.exports=CX});var YT=S((mEe,XT)=>{var SX=(r,e,t=0)=>(r[0]=e[0],r[1]=e[1],r[2]=t,r);XT.exports=SX});var jg=S((_Ee,ZT)=>{var AX=r=>{let e=r[0],t=r[1],n=r[2];return Math.hypot(e,t,n)};ZT.exports=AX});var KT=S((gEe,JT)=>{var TX=(r,e,t,n)=>(r[0]=e[0]+n*(t[0]-e[0]),r[1]=e[1]+n*(t[1]-e[1]),r[2]=e[2]+n*(t[2]-e[2]),r);JT.exports=TX});var $g=S((yEe,QT)=>{var MX=(r,e,t)=>(r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r);QT.exports=MX});var Xg=S((xEe,eM)=>{var PX=(r,e,t)=>(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.min(e[2],t[2]),r);eM.exports=PX});var nM=S((vEe,tM)=>{var NX=(r,e,t)=>(r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r);tM.exports=NX});var sM=S((bEe,rM)=>{var RX=(r,e)=>(r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r);rM.exports=RX});var Jd=S((wEe,iM)=>{var OX=(r,e)=>{let t=e[0],n=e[1],s=e[2],i=t*t+n*n+s*s;return i>0&&(i=1/Math.sqrt(i)),r[0]=t*i,r[1]=n*i,r[2]=s*i,r};iM.exports=OX});var aM=S((EEe,oM)=>{var IX=Vg(),DX=Ol(),LX=Qi(),BX=(r,e)=>{let t=IX(DX(),e),n=0+(t[0]<t[1]&&t[0]<t[2]),s=0+(t[1]<=t[0]&&t[1]<t[2]),i=0+(t[2]<=t[0]&&t[2]<=t[1]);return LX(r,e,[n,s,i])};oM.exports=BX});var lM=S((CEe,cM)=>{var kX=(r,e,t,n)=>{let s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[0],i[1]=s[1]*Math.cos(n)-s[2]*Math.sin(n),i[2]=s[1]*Math.sin(n)+s[2]*Math.cos(n),r[0]=i[0]+t[0],r[1]=i[1]+t[1],r[2]=i[2]+t[2],r};cM.exports=kX});var hM=S((SEe,uM)=>{var FX=(r,e,t,n)=>{let s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],s[2]=e[2]-t[2],i[0]=s[2]*Math.sin(n)+s[0]*Math.cos(n),i[1]=s[1],i[2]=s[2]*Math.cos(n)-s[0]*Math.sin(n),r[0]=i[0]+t[0],r[1]=i[1]+t[1],r[2]=i[2]+t[2],r};uM.exports=FX});var pM=S((AEe,dM)=>{var UX=(r,e,t,n)=>{let s=[],i=[];return s[0]=e[0]-t[0],s[1]=e[1]-t[1],i[0]=s[0]*Math.cos(n)-s[1]*Math.sin(n),i[1]=s[0]*Math.sin(n)+s[1]*Math.cos(n),r[0]=i[0]+t[0],r[1]=i[1]+t[1],r[2]=e[2],r};dM.exports=UX});var Yg=S((TEe,fM)=>{var zX=(r,e,t)=>(r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r);fM.exports=zX});var _M=S((MEe,mM)=>{var VX=(r,e,t)=>(r[0]=Math.round(e[0]/t)*t+0,r[1]=Math.round(e[1]/t)*t+0,r[2]=Math.round(e[2]/t)*t+0,r);mM.exports=VX});var Zg=S((PEe,gM)=>{var qX=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1],s=e[2]-r[2];return t*t+n*n+s*s};gM.exports=qX});var Jg=S((NEe,yM)=>{var GX=r=>{let e=r[0],t=r[1],n=r[2];return e*e+t*t+n*n};yM.exports=GX});var Il=S((REe,xM)=>{var HX=(r,e,t)=>(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r);xM.exports=HX});var bM=S((OEe,vM)=>{var WX=r=>`[${r[0].toFixed(7)}, ${r[1].toFixed(7)}, ${r[2].toFixed(7)}]`;vM.exports=WX});var EM=S((IEe,wM)=>{var jX=(r,e,t)=>{let n=e[0],s=e[1],i=e[2],o=t[3]*n+t[7]*s+t[11]*i+t[15];return o=o||1,r[0]=(t[0]*n+t[4]*s+t[8]*i+t[12])/o,r[1]=(t[1]*n+t[5]*s+t[9]*i+t[13])/o,r[2]=(t[2]*n+t[6]*s+t[10]*i+t[14])/o,r};wM.exports=jX});var Te=S((DEe,CM)=>{CM.exports={abs:Vg(),add:qg(),angle:DT(),clone:kT(),copy:Gg(),create:Ol(),cross:Qi(),distance:Hg(),divide:qT(),dot:Qa(),equals:HT(),fromScalar:jT(),fromValues:Wg(),fromVec2:YT(),length:jg(),lerp:KT(),max:$g(),min:Xg(),multiply:nM(),negate:sM(),normalize:Jd(),orthogonal:aM(),rotateX:lM(),rotateY:hM(),rotateZ:pM(),scale:Yg(),snap:_M(),squaredDistance:Zg(),squaredLength:Jg(),subtract:Il(),toString:bM(),transform:EM()}});var AM=S((LEe,SM)=>{var li=Te(),$X=zg(),XX=(r,e,t)=>{let n=li.normalize(li.create(),e),s=li.normalize(li.create(),t),i=li.cross(li.create(),s,n),o=li.dot(s,n);if(o===-1)return $X(r,Math.PI,li.orthogonal(i,n));let a=1/(1+o);return r[0]=i[0]*i[0]*a+o,r[1]=i[1]*i[0]*a-i[2],r[2]=i[2]*i[0]*a+i[1],r[3]=0,r[4]=i[0]*i[1]*a+i[2],r[5]=i[1]*i[1]*a+o,r[6]=i[2]*i[1]*a-i[0],r[7]=0,r[8]=i[0]*i[2]*a-i[1],r[9]=i[1]*i[2]*a+i[0],r[10]=i[2]*i[2]*a+o,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};SM.exports=XX});var MM=S((BEe,TM)=>{var YX=(r,e)=>{let t=Math.sin(e),n=Math.cos(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=n,r[6]=t,r[7]=0,r[8]=0,r[9]=-t,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};TM.exports=YX});var NM=S((kEe,PM)=>{var ZX=(r,e)=>{let t=Math.sin(e),n=Math.cos(e);return r[0]=n,r[1]=0,r[2]=-t,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=t,r[9]=0,r[10]=n,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};PM.exports=ZX});var OM=S((FEe,RM)=>{var JX=(r,e)=>{let t=Math.sin(e),n=Math.cos(e);return r[0]=n,r[1]=t,r[2]=0,r[3]=0,r[4]=-t,r[5]=n,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r};RM.exports=JX});var DM=S((UEe,IM)=>{var KX=r=>r[0]===1&&r[1]===0&&r[2]===0&&r[3]===0&&r[4]===0&&r[5]===1&&r[6]===0&&r[7]===0&&r[8]===0&&r[9]===0&&r[10]===1&&r[11]===0&&r[12]===0&&r[13]===0&&r[14]===0&&r[15]===1;IM.exports=KX});var BM=S((zEe,LM)=>{var QX=r=>Ts(r[1])&&Ts(r[2])&&Ts(r[3])&&Ts(r[4])&&Ts(r[6])&&Ts(r[7])&&Ts(r[8])&&Ts(r[9])&&Ts(r[11])&&r[15]===1,Ts=r=>Math.abs(r)<Number.EPSILON;LM.exports=QX});var FM=S((VEe,kM)=>{var eY=Qi(),tY=Qa(),Kg=Wg(),nY=r=>{let e=Kg(r[0],r[4],r[8]),t=Kg(r[1],r[5],r[9]),n=Kg(r[2],r[6],r[10]);return tY(eY(e,e,t),n)<0};kM.exports=nY});var zM=S((qEe,UM)=>{var rY=(r,e)=>{let[t,n,s,i]=e;return r[0]=1-2*t*t,r[1]=-2*n*t,r[2]=-2*s*t,r[3]=0,r[4]=-2*t*n,r[5]=1-2*n*n,r[6]=-2*s*n,r[7]=0,r[8]=-2*t*s,r[9]=-2*n*s,r[10]=1-2*s*s,r[11]=0,r[12]=2*t*i,r[13]=2*n*i,r[14]=2*s*i,r[15]=1,r};UM.exports=rY});var qM=S((GEe,VM)=>{var sY=(r,e,t)=>{let n=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=e[9],p=e[10],_=e[11],f=e[12],m=e[13],g=e[14],x=e[15],b=t[0],v=t[1],y=t[2],E=t[3];return r[0]=b*n+v*a+y*h+E*f,r[1]=b*s+v*c+y*d+E*m,r[2]=b*i+v*l+y*p+E*g,r[3]=b*o+v*u+y*_+E*x,b=t[4],v=t[5],y=t[6],E=t[7],r[4]=b*n+v*a+y*h+E*f,r[5]=b*s+v*c+y*d+E*m,r[6]=b*i+v*l+y*p+E*g,r[7]=b*o+v*u+y*_+E*x,b=t[8],v=t[9],y=t[10],E=t[11],r[8]=b*n+v*a+y*h+E*f,r[9]=b*s+v*c+y*d+E*m,r[10]=b*i+v*l+y*p+E*g,r[11]=b*o+v*u+y*_+E*x,b=t[12],v=t[13],y=t[14],E=t[15],r[12]=b*n+v*a+y*h+E*f,r[13]=b*s+v*c+y*d+E*m,r[14]=b*i+v*l+y*p+E*g,r[15]=b*o+v*u+y*_+E*x,r};VM.exports=sY});var HM=S((HEe,GM)=>{var iY=Fg(),oY=(r,e,t,n)=>{let[s,i,o]=n,a=Math.hypot(s,i,o);if(Math.abs(a)<1e-6)return iY(r,e);a=1/a,s*=a,i*=a,o*=a;let c=Math.sin(t),l=Math.cos(t),u=1-l,h=e[0],d=e[1],p=e[2],_=e[3],f=e[4],m=e[5],g=e[6],x=e[7],b=e[8],v=e[9],y=e[10],E=e[11],C=s*s*u+l,M=i*s*u+o*c,R=o*s*u-i*c,N=s*i*u-o*c,w=i*i*u+l,T=o*i*u+s*c,F=s*o*u+i*c,L=i*o*u-s*c,V=o*o*u+l;return r[0]=h*C+f*M+b*R,r[1]=d*C+m*M+v*R,r[2]=p*C+g*M+y*R,r[3]=_*C+x*M+E*R,r[4]=h*N+f*w+b*T,r[5]=d*N+m*w+v*T,r[6]=p*N+g*w+y*T,r[7]=_*N+x*w+E*T,r[8]=h*F+f*L+b*V,r[9]=d*F+m*L+v*V,r[10]=p*F+g*L+y*V,r[11]=_*F+x*L+E*V,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r};GM.exports=oY});var jM=S((WEe,WM)=>{var aY=(r,e,t)=>{let n=Math.sin(t),s=Math.cos(t),i=e[4],o=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],d=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=i*s+l*n,r[5]=o*s+u*n,r[6]=a*s+h*n,r[7]=c*s+d*n,r[8]=l*s-i*n,r[9]=u*s-o*n,r[10]=h*s-a*n,r[11]=d*s-c*n,r};WM.exports=aY});var XM=S((jEe,$M)=>{var cY=(r,e,t)=>{let n=Math.sin(t),s=Math.cos(t),i=e[0],o=e[1],a=e[2],c=e[3],l=e[8],u=e[9],h=e[10],d=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=i*s-l*n,r[1]=o*s-u*n,r[2]=a*s-h*n,r[3]=c*s-d*n,r[8]=i*n+l*s,r[9]=o*n+u*s,r[10]=a*n+h*s,r[11]=c*n+d*s,r};$M.exports=cY});var ZM=S(($Ee,YM)=>{var lY=(r,e,t)=>{let n=Math.sin(t),s=Math.cos(t),i=e[0],o=e[1],a=e[2],c=e[3],l=e[4],u=e[5],h=e[6],d=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=i*s+l*n,r[1]=o*s+u*n,r[2]=a*s+h*n,r[3]=c*s+d*n,r[4]=l*s-i*n,r[5]=u*s-o*n,r[6]=h*s-a*n,r[7]=d*s-c*n,r};YM.exports=lY});var KM=S((XEe,JM)=>{var uY=(r,e,t)=>{let n=t[0],s=t[1],i=t[2];return r[0]=e[0]*n,r[1]=e[1]*n,r[2]=e[2]*n,r[3]=e[3]*n,r[4]=e[4]*s,r[5]=e[5]*s,r[6]=e[6]*s,r[7]=e[7]*s,r[8]=e[8]*i,r[9]=e[9]*i,r[10]=e[10]*i,r[11]=e[11]*i,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r};JM.exports=uY});var eP=S((YEe,QM)=>{var hY=(r,e,t)=>(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r[3]=e[3]-t[3],r[4]=e[4]-t[4],r[5]=e[5]-t[5],r[6]=e[6]-t[6],r[7]=e[7]-t[7],r[8]=e[8]-t[8],r[9]=e[9]-t[9],r[10]=e[10]-t[10],r[11]=e[11]-t[11],r[12]=e[12]-t[12],r[13]=e[13]-t[13],r[14]=e[14]-t[14],r[15]=e[15]-t[15],r);QM.exports=hY});var nP=S((ZEe,tP)=>{var dY=r=>r.map(e=>e.toFixed(7)).toString();tP.exports=dY});var sP=S((JEe,rP)=>{var pY=(r,e,t)=>{let n=t[0],s=t[1],i=t[2],o,a,c,l,u,h,d,p,_,f,m,g;return e===r?(r[12]=e[0]*n+e[4]*s+e[8]*i+e[12],r[13]=e[1]*n+e[5]*s+e[9]*i+e[13],r[14]=e[2]*n+e[6]*s+e[10]*i+e[14],r[15]=e[3]*n+e[7]*s+e[11]*i+e[15]):(o=e[0],a=e[1],c=e[2],l=e[3],u=e[4],h=e[5],d=e[6],p=e[7],_=e[8],f=e[9],m=e[10],g=e[11],r[0]=o,r[1]=a,r[2]=c,r[3]=l,r[4]=u,r[5]=h,r[6]=d,r[7]=p,r[8]=_,r[9]=f,r[10]=m,r[11]=g,r[12]=o*n+u*s+_*i+e[12],r[13]=a*n+h*s+f*i+e[13],r[14]=c*n+d*s+m*i+e[14],r[15]=l*n+p*s+g*i+e[15]),r};rP.exports=pY});var At=S((KEe,iP)=>{iP.exports={add:lT(),clone:dT(),copy:Fg(),create:Zd(),invert:mT(),equals:gT(),fromRotation:zg(),fromScaling:ET(),fromTaitBryanRotation:ST(),fromTranslation:TT(),fromValues:PT(),fromVectorRotation:AM(),fromXRotation:MM(),fromYRotation:NM(),fromZRotation:OM(),identity:Ug(),isIdentity:DM(),isOnlyTransformScale:BM(),isMirroring:FM(),mirrorByPlane:zM(),multiply:qM(),rotate:HM(),rotateX:jM(),rotateY:XM(),rotateZ:ZM(),scale:KM(),subtract:eP(),toString:nP(),translate:sP()}});var Dl=S((QEe,oP)=>{var fY=At(),mY=r=>(r===void 0&&(r=[]),{sides:r,transforms:fY.create()});oP.exports=mY});var cP=S((eCe,aP)=>{var _Y=(r,e)=>(r[0]=Math.abs(e[0]),r[1]=Math.abs(e[1]),r);aP.exports=_Y});var uP=S((tCe,lP)=>{var gY=(r,e,t)=>(r[0]=e[0]+t[0],r[1]=e[1]+t[1],r);lP.exports=gY});var Kd=S((nCe,hP)=>{var yY=r=>Math.atan2(r[1],r[0]);hP.exports=yY});var pP=S((rCe,dP)=>{dP.exports=Kd()});var mP=S((sCe,fP)=>{var xY=Kd(),vY=r=>xY(r)*57.29577951308232;fP.exports=vY});var Ll=S((iCe,_P)=>{var bY=()=>[0,0];_P.exports=bY});var yP=S((oCe,gP)=>{var wY=Ll(),EY=r=>{let e=wY();return e[0]=r[0],e[1]=r[1],e};gP.exports=EY});var vP=S((aCe,xP)=>{var CY=(r,e)=>(r[0]=e[0],r[1]=e[1],r);xP.exports=CY});var wP=S((cCe,bP)=>{var SY=(r,e,t)=>(r[0]=0,r[1]=0,r[2]=e[0]*t[1]-e[1]*t[0],r);bP.exports=SY});var CP=S((lCe,EP)=>{var AY=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1];return Math.hypot(t,n)};EP.exports=AY});var AP=S((uCe,SP)=>{var TY=(r,e,t)=>(r[0]=e[0]/t[0],r[1]=e[1]/t[1],r);SP.exports=TY});var MP=S((hCe,TP)=>{var MY=(r,e)=>r[0]*e[0]+r[1]*e[1];TP.exports=MY});var NP=S((dCe,PP)=>{var PY=(r,e)=>r[0]===e[0]&&r[1]===e[1];PP.exports=PY});var Qg=S((pCe,RP)=>{var NY=(r,e)=>(r[0]=Math.cos(e),r[1]=Math.sin(e),r);RP.exports=NY});var IP=S((fCe,OP)=>{var RY=Qg(),OY=(r,e)=>RY(r,Math.PI*e/180);OP.exports=OY});var LP=S((mCe,DP)=>{var IY=(r,e)=>(r[0]=e,r[1]=e,r);DP.exports=IY});var kP=S((_Ce,BP)=>{var DY=Ll(),LY=(r,e)=>{let t=DY();return t[0]=r,t[1]=e,t};BP.exports=LY});var UP=S((gCe,FP)=>{var BY=r=>Math.hypot(r[0],r[1]);FP.exports=BY});var VP=S((yCe,zP)=>{var kY=(r,e,t,n)=>{let s=e[0],i=e[1];return r[0]=s+n*(t[0]-s),r[1]=i+n*(t[1]-i),r};zP.exports=kY});var GP=S((xCe,qP)=>{var FY=(r,e,t)=>(r[0]=Math.max(e[0],t[0]),r[1]=Math.max(e[1],t[1]),r);qP.exports=FY});var WP=S((vCe,HP)=>{var UY=(r,e,t)=>(r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r);HP.exports=UY});var $P=S((bCe,jP)=>{var zY=(r,e,t)=>(r[0]=e[0]*t[0],r[1]=e[1]*t[1],r);jP.exports=zY});var YP=S((wCe,XP)=>{var VY=(r,e)=>(r[0]=-e[0],r[1]=-e[1],r);XP.exports=VY});var ey=S((ECe,ZP)=>{var qY=(r,e,t,n)=>{let s=e[0]-t[0],i=e[1]-t[1],o=Math.cos(n),a=Math.sin(n);return r[0]=s*o-i*a+t[0],r[1]=s*a+i*o+t[1],r};ZP.exports=qY});var KP=S((CCe,JP)=>{var GY=Ll(),HY=ey(),WY=(r,e)=>HY(r,e,GY(),Math.PI/2);JP.exports=WY});var e2=S((SCe,QP)=>{var jY=(r,e)=>{let t=e[0],n=e[1],s=t*t+n*n;return s>0&&(s=1/Math.sqrt(s)),r[0]=t*s,r[1]=n*s,r};QP.exports=jY});var n2=S((ACe,t2)=>{var $Y=(r,e,t)=>(r[0]=e[0]*t,r[1]=e[1]*t,r);t2.exports=$Y});var s2=S((TCe,r2)=>{var XY=(r,e,t)=>(r[0]=Math.round(e[0]/t)*t+0,r[1]=Math.round(e[1]/t)*t+0,r);r2.exports=XY});var o2=S((MCe,i2)=>{var YY=(r,e)=>{let t=e[0]-r[0],n=e[1]-r[1];return t*t+n*n};i2.exports=YY});var c2=S((PCe,a2)=>{var ZY=r=>{let e=r[0],t=r[1];return e*e+t*t};a2.exports=ZY});var u2=S((NCe,l2)=>{var JY=(r,e,t)=>(r[0]=e[0]-t[0],r[1]=e[1]-t[1],r);l2.exports=JY});var d2=S((RCe,h2)=>{var KY=r=>`[${r[0].toFixed(7)}, ${r[1].toFixed(7)}]`;h2.exports=KY});var f2=S((OCe,p2)=>{var QY=(r,e,t)=>{let n=e[0],s=e[1];return r[0]=t[0]*n+t[4]*s+t[12],r[1]=t[1]*n+t[5]*s+t[13],r};p2.exports=QY});var $e=S((ICe,m2)=>{m2.exports={abs:cP(),add:uP(),angle:pP(),angleDegrees:mP(),angleRadians:Kd(),clone:yP(),copy:vP(),create:Ll(),cross:wP(),distance:CP(),divide:AP(),dot:MP(),equals:NP(),fromAngleDegrees:IP(),fromAngleRadians:Qg(),fromScalar:LP(),fromValues:kP(),length:UP(),lerp:VP(),max:GP(),min:WP(),multiply:$P(),negate:YP(),normal:KP(),normalize:e2(),rotate:ey(),scale:n2(),snap:s2(),squaredDistance:o2(),squaredLength:c2(),subtract:u2(),toString:d2(),transform:f2()}});var g2=S((DCe,_2)=>{var ty=$e(),eZ=Dl(),tZ=r=>{if(!Array.isArray(r))throw new Error("the given points must be an array");let e=r.length;if(e<3)throw new Error("the given points must define a closed geometry with three or more points");ty.equals(r[0],r[e-1])&&--e;let t=[],n=r[e-1];for(let s=0;s<e;s++){let i=r[s];t.push([ty.clone(n),ty.clone(i)]),n=i}return eZ(t)};_2.exports=tZ});var v2=S((LCe,x2)=>{var nZ=At(),y2=$e(),rZ=Dl(),sZ=r=>{if(r[0]!==0)throw new Error("invalid compact binary data");let e=rZ();e.transforms=nZ.clone(r.slice(1,17));for(let t=21;t<r.length;t+=4){let n=y2.fromValues(r[t+0],r[t+1]),s=y2.fromValues(r[t+2],r[t+3]);e.sides.push([n,s])}return r[17]>=0&&(e.color=[r[17],r[18],r[19],r[20]]),e};x2.exports=sZ});var ny=S((BCe,b2)=>{var iZ=r=>!!(r&&typeof r=="object"&&"sides"in r&&"transforms"in r&&Array.isArray(r.sides)&&"length"in r.transforms);b2.exports=iZ});var C2=S((kCe,E2)=>{var w2=At(),Qd=$e(),oZ=r=>(w2.isIdentity(r.transforms)||(r.sides=r.sides.map(e=>{let t=Qd.transform(Qd.create(),e[0],r.transforms),n=Qd.transform(Qd.create(),e[1],r.transforms);return[t,n]}),r.transforms=w2.create()),r);E2.exports=oZ});var ec=S((FCe,S2)=>{var aZ=C2(),cZ=r=>aZ(r).sides;S2.exports=cZ});var T2=S((UCe,A2)=>{var lZ=Dl(),uZ=ec(),hZ=r=>{let t=uZ(r).map(n=>[n[1],n[0]]);return t.reverse(),lZ(t)};A2.exports=hZ});var ry=S((zCe,M2)=>{var Bl=$e(),dZ=ec(),pZ=r=>{let e=new Map,t=n=>{let s=n.toString();return e.has(s)?e.get(s):(e.set(s,n),n)};return r.map(n=>n.map(t))},fZ=r=>{let e=new Map;return pZ(r).forEach(n=>{e.has(n[0])?e.get(n[0]).push(n):e.set(n[0],[n])}),e},mZ=r=>{let e=fZ(dZ(r)),t=[];for(;;){let n;for(let[o,a]of e){if(n=a.shift(),!n){e.delete(o);continue}break}if(n===void 0)break;let s=[],i=n[0];for(;;){s.push(n[0]);let o=n[1];if(o===i)break;let a=e.get(o);if(!a)throw new Error(`geometry is not closed at vertex ${o}`);let c=_Z(n,a);a.length===0&&e.delete(o),n=c}s.length>0&&s.push(s.shift()),t.push(s)}return e.clear(),t},_Z=(r,e)=>{if(e.length===1)return e.pop();let t=Bl.create(),n=Bl.angleDegrees(Bl.subtract(t,r[1],r[0])),s,i;e.forEach((a,c)=>{let u=Bl.angleDegrees(Bl.subtract(t,a[1],a[0]))-n;u<-180&&(u+=360),u>=180&&(u-=360),(i===void 0||u>s)&&(i=c,s=u)});let o=e[i];return e.splice(i,1),o};M2.exports=mZ});var N2=S((VCe,P2)=>{var gZ=ec(),yZ=r=>{let t=gZ(r).map(n=>n[0]);return t.length>0&&t.push(t.shift()),t};P2.exports=yZ});var I2=S((qCe,O2)=>{var R2=$e(),xZ=ec(),vZ=r=>{let e=xZ(r),t="geom2 ("+e.length+` sides):
[
`;return e.forEach(n=>{t+="  ["+R2.toString(n[0])+", "+R2.toString(n[1])+`]
`}),t+=`]
`,t};O2.exports=vZ});var L2=S((GCe,D2)=>{var bZ=r=>{let e=r.sides,t=r.transforms,n=[-1,-1,-1,-1];r.color&&(n=r.color);let s=new Float32Array(1+16+4+e.length*4);s[0]=0,s[1]=t[0],s[2]=t[1],s[3]=t[2],s[4]=t[3],s[5]=t[4],s[6]=t[5],s[7]=t[6],s[8]=t[7],s[9]=t[8],s[10]=t[9],s[11]=t[10],s[12]=t[11],s[13]=t[12],s[14]=t[13],s[15]=t[14],s[16]=t[15],s[17]=n[0],s[18]=n[1],s[19]=n[2],s[20]=n[3];for(let i=0;i<e.length;i++){let o=i*4+21,a=e[i][0],c=e[i][1];s[o+0]=a[0],s[o+1]=a[1],s[o+2]=c[0],s[o+3]=c[1]}return s};D2.exports=bZ});var F2=S((HCe,k2)=>{var B2=At(),wZ=(r,e)=>{let t=B2.multiply(B2.create(),r,e.transforms);return Object.assign({},e,{transforms:t})};k2.exports=wZ});var z2=S((WCe,U2)=>{var EZ=$e(),CZ=ny(),SZ=ry(),AZ=r=>{if(!CZ(r))throw new Error("invalid geom2 structure");if(SZ(r),r.sides.forEach(e=>{if(EZ.equals(e[0],e[1]))throw new Error(`geom2 self-edge ${e[0]}`)}),!r.transforms.every(Number.isFinite))throw new Error(`geom2 invalid transforms ${r.transforms}`)};U2.exports=AZ});var ze=S((jCe,V2)=>{V2.exports={clone:aT(),create:Dl(),fromPoints:g2(),fromCompactBinary:v2(),isA:ny(),reverse:T2(),toOutlines:ry(),toPoints:N2(),toSides:ec(),toString:I2(),toCompactBinary:L2(),transform:F2(),validate:z2()}});var G2=S(($Ce,q2)=>{var TZ=r=>Object.assign({},r);q2.exports=TZ});var kl=S((XCe,H2)=>{var MZ=At(),PZ=r=>(r===void 0&&(r=[]),{polygons:r,transforms:MZ.create()});H2.exports=PZ});var eo=S((YCe,W2)=>{var NZ=r=>((r===void 0||r.length<3)&&(r=[]),{vertices:r});W2.exports=NZ});var $2=S((ZCe,j2)=>{var RZ=eo(),OZ=Te(),IZ=(...r)=>{let e,t;return r.length===1?(e=RZ(),t=r[0]):(e=r[0],t=r[1]),e.vertices=t.vertices.map(n=>OZ.clone(n)),e};j2.exports=IZ});var Y2=S((JCe,X2)=>{var DZ=Te(),LZ=eo(),BZ=r=>{let e=r.map(t=>DZ.clone(t));return LZ(e)};X2.exports=BZ});var J2=S((KCe,Z2)=>{var kZ=eo(),FZ=(r,e)=>{let t=kZ(r);return t.plane=e,t};Z2.exports=FZ});var Fl=S((QCe,K2)=>{var UZ=()=>[0,0,0,0];K2.exports=UZ});var sy=S((eSe,Q2)=>{var zZ=Fl(),VZ=r=>{let e=zZ();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e};Q2.exports=VZ});var iy=S((tSe,eN)=>{var qZ=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r);eN.exports=qZ});var oy=S((nSe,tN)=>{var GZ=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3];tN.exports=GZ});var ay=S((rSe,nN)=>{var HZ=(r,e)=>(r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r);nN.exports=HZ});var sN=S((sSe,rN)=>{var cy=Te(),WZ=(r,e,t)=>{let n=cy.normalize(cy.create(),e),s=cy.dot(t,n);return r[0]=n[0],r[1]=n[1],r[2]=n[2],r[3]=s,r};rN.exports=WZ});var ly=S((iSe,iN)=>{var jZ=Fl(),$Z=(r,e,t,n)=>{let s=jZ();return s[0]=r,s[1]=e,s[2]=t,s[3]=n,s};iN.exports=$Z});var uy=S((oSe,oN)=>{var Yr=Te(),XZ=(r,...e)=>{let t=e.length,n=Yr.create(),s=Yr.create(),i=o=>{let a=e[o],c=e[(o+1)%t],l=e[(o+2)%t];return Yr.subtract(n,c,a),Yr.subtract(s,l,a),Yr.cross(n,n,s),Yr.normalize(n,n),n};return r[0]=0,r[1]=0,r[2]=0,t===3?Yr.copy(r,i(0)):(e.forEach((o,a)=>{Yr.add(r,r,i(a))}),Yr.normalize(r,r)),r[3]=Yr.dot(r,e[0]),r};oN.exports=XZ});var Lt=S((aSe,aN)=>{aN.exports={EPS:1e-5,NEPS:1e-13,spatialResolution:1e5}});var lN=S((cSe,cN)=>{var{EPS:hy}=Lt(),Fn=Te(),YZ=(r,e,t,n)=>{let s=Fn.subtract(Fn.create(),t,e),i=Fn.subtract(Fn.create(),n,e);Fn.length(s)<hy&&(s=Fn.orthogonal(s,i)),Fn.length(i)<hy&&(i=Fn.orthogonal(i,s));let o=Fn.cross(Fn.create(),s,i);Fn.length(o)<hy&&(i=Fn.orthogonal(i,s),o=Fn.cross(o,s,i)),o=Fn.normalize(o,o);let a=Fn.dot(o,e);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=a,r};cN.exports=YZ});var hN=S((lSe,uN)=>{var ZZ=Te(),JZ=(r,e)=>{let t=e[0]*r[0]+e[1]*r[1]+e[2]*r[2]-r[3],n=e[0]-t*r[0],s=e[1]-t*r[1],i=e[2]-t*r[2];return ZZ.fromValues(n,s,i)};uN.exports=JZ});var dy=S((uSe,dN)=>{var KZ=Te(),QZ=(r,e)=>KZ.dot(r,e)-r[3];dN.exports=QZ});var py=S((hSe,pN)=>{var eJ=r=>`(${r[0].toFixed(9)}, ${r[1].toFixed(9)}, ${r[2].toFixed(9)}, ${r[3].toFixed(9)})`;pN.exports=eJ});var mN=S((dSe,fN)=>{var tJ=At(),Un=Te(),nJ=uy(),rJ=ay(),sJ=(r,e,t)=>{let n=tJ.isMirroring(t),s=Un.orthogonal(Un.create(),e),i=Un.cross(s,e,s),o=Un.cross(Un.create(),e,i),a=Un.fromScalar(Un.create(),e[3]);Un.multiply(a,a,e);let c=Un.add(Un.create(),a,i),l=Un.add(Un.create(),a,o);return a=Un.transform(a,a,t),c=Un.transform(c,c,t),l=Un.transform(l,l,t),nJ(r,a,c,l),n&&rJ(r,r),r};fN.exports=sJ});var Dr=S((pSe,_N)=>{_N.exports={clone:sy(),copy:iy(),create:Fl(),equals:oy(),flip:ay(),fromNormalAndPoint:sN(),fromValues:ly(),fromPoints:uy(),fromPointsRandom:lN(),projectionOfPoint:hN(),signedDistanceToPoint:dy(),toString:py(),transform:mN()}});var xN=S((fSe,yN)=>{var gN=Dr(),iJ=eo(),oJ=r=>{let e=r.vertices.slice().reverse(),t=iJ(e);return r.plane&&(t.plane=gN.flip(gN.create(),r.plane)),t};yN.exports=oJ});var fy=S((mSe,vN)=>{var aJ=r=>!!(r&&typeof r=="object"&&"vertices"in r&&Array.isArray(r.vertices));vN.exports=aJ});var my=S((_Se,wN)=>{var bN=Dr(),to=Te(),cJ=r=>lJ(r.vertices),lJ=r=>{let e=r.length;if(e>2){let t=bN.fromPoints(bN.create(),...r),n=r[e-2],s=r[e-1];for(let i=0;i<e;i++){let o=r[i];if(!uJ(n,s,o,t))return!1;n=s,s=o}}return!0},uJ=(r,e,t,n)=>{let s=to.cross(to.create(),to.subtract(to.create(),e,r),to.subtract(to.create(),t,e));return to.dot(s,n)>=0};wN.exports=cJ});var ep=S((gSe,CN)=>{var EN=Dr(),hJ=r=>(r.plane||(r.plane=EN.fromPoints(EN.create(),...r.vertices)),r.plane);CN.exports=hJ});var _y=S((ySe,SN)=>{var dJ=ep(),pJ=r=>{let e=r.vertices.length;if(e<3)return 0;let t=r.vertices,n=dJ(r),s=Math.abs(n[0]),i=Math.abs(n[1]),o=Math.abs(n[2]);if(s+i+o===0)return 0;let a=3;s>i&&s>o?a=1:i>o&&(a=2);let c=0,l=0,u=1,h=2;switch(a){case 1:for(u=1;u<e;u++)l=u-1,h=(u+1)%e,c+=t[u][1]*(t[h][2]-t[l][2]);c+=t[0][1]*(t[1][2]-t[e-1][2]),c/=2*n[0];break;case 2:for(u=1;u<e;u++)l=u-1,h=(u+1)%e,c+=t[u][2]*(t[h][0]-t[l][0]);c+=t[0][2]*(t[1][0]-t[e-1][0]),c/=2*n[1];break;case 3:default:for(u=1;u<e;u++)l=u-1,h=(u+1)%e,c+=t[u][0]*(t[h][1]-t[l][1]);c+=t[0][0]*(t[1][1]-t[e-1][1]),c/=2*n[2];break}return c};SN.exports=pJ});var gy=S((xSe,AN)=>{var Ul=Te(),fJ=r=>{let e=r.vertices,t=e.length,n=t===0?Ul.create():Ul.clone(e[0]),s=Ul.clone(n);for(let i=1;i<t;i++)Ul.min(n,n,e[i]),Ul.max(s,s,e[i]);return[n,s]};AN.exports=fJ});var MN=S((vSe,TN)=>{var yy=Te(),mJ=gy(),_J=r=>{let e=mJ(r),t=e[0];yy.add(t,e[0],e[1]),yy.scale(t,t,.5);let n=yy.distance(t,e[1]);return[t,n]};TN.exports=_J});var NN=S((bSe,PN)=>{var xy=Te(),gJ=r=>{let e=0,t=r.vertices,n=xy.create();for(let s=0;s<t.length-2;s++)xy.cross(n,t[s+1],t[s+2]),e+=xy.dot(t[0],n);return e/=6,e};PN.exports=gJ});var ON=S((wSe,RN)=>{var yJ=r=>r.vertices;RN.exports=yJ});var DN=S((ESe,IN)=>{var xJ=Te(),vJ=r=>{let e="poly3: vertices: [";return r.vertices.forEach(t=>{e+=`${xJ.toString(t)}, `}),e+="]",e};IN.exports=vJ});var kN=S((CSe,BN)=>{var bJ=At(),LN=Te(),wJ=eo(),EJ=(r,e)=>{let t=e.vertices.map(n=>LN.transform(LN.create(),n,r));return bJ.isMirroring(r)&&t.reverse(),wJ(t)};BN.exports=EJ});var UN=S((SSe,FN)=>{var CJ=dy(),{NEPS:SJ}=Lt(),AJ=Te(),TJ=fy(),MJ=my(),PJ=_y(),NJ=ep(),RJ=r=>{if(!TJ(r))throw new Error("invalid poly3 structure");if(r.vertices.length<3)throw new Error(`poly3 not enough vertices ${r.vertices.length}`);if(PJ(r)<=0)throw new Error("poly3 area must be greater than zero");for(let e=0;e<r.vertices.length;e++)if(AJ.equals(r.vertices[e],r.vertices[(e+1)%r.vertices.length]))throw new Error(`poly3 duplicate vertex ${r.vertices[e]}`);if(!MJ(r))throw new Error("poly3 must be convex");if(r.vertices.forEach(e=>{if(!e.every(Number.isFinite))throw new Error(`poly3 invalid vertex ${e}`)}),r.vertices.length>3){let e=NJ(r);r.vertices.forEach(t=>{let n=Math.abs(CJ(e,t));if(n>SJ)throw new Error(`poly3 must be coplanar: vertex ${t} distance ${n}`)})}};FN.exports=RJ});var it=S((ASe,zN)=>{zN.exports={clone:$2(),create:eo(),fromPoints:Y2(),fromPointsAndPlane:J2(),invert:xN(),isA:fy(),isConvex:my(),measureArea:_y(),measureBoundingBox:gy(),measureBoundingSphere:MN(),measureSignedVolume:NN(),plane:ep(),toPoints:ON(),toString:DN(),transform:kN(),validate:UN()}});var qN=S((TSe,VN)=>{var OJ=it(),IJ=kl(),DJ=r=>{if(!Array.isArray(r))throw new Error("the given points must be an array");let e=r.map((n,s)=>OJ.create(n));return IJ(e)};VN.exports=DJ});var HN=S((MSe,GN)=>{var LJ=Te(),BJ=At(),kJ=it(),FJ=kl(),UJ=r=>{if(r[0]!==1)throw new Error("invalid compact binary data");let e=FJ();e.transforms=BJ.clone(r.slice(1,17));let t=r[21],n=22,s=r.length-t*3;for(;s<r.length;){let i=r[n];n++;let o=[];for(let a=0;a<i;a++)o.push(LJ.fromValues(r[s],r[s+1],r[s+2])),s+=3;e.polygons.push(kJ.create(o))}return r[17]>=0&&(e.color=[r[17],r[18],r[19],r[20]]),e};GN.exports=UJ});var $N=S((PSe,jN)=>{var WN=At(),zJ=it(),VJ=r=>(WN.isIdentity(r.transforms)||(r.polygons=r.polygons.map(e=>zJ.transform(r.transforms,e)),r.transforms=WN.create()),r);jN.exports=VJ});var zl=S((NSe,XN)=>{var qJ=$N(),GJ=r=>qJ(r).polygons;XN.exports=GJ});var ZN=S((RSe,YN)=>{var HJ=it(),WJ=kl(),jJ=zl(),$J=r=>{let t=jJ(r).map(n=>HJ.invert(n));return WJ(t)};YN.exports=$J});var vy=S((OSe,JN)=>{var XJ=r=>!!(r&&typeof r=="object"&&"polygons"in r&&"transforms"in r&&Array.isArray(r.polygons)&&"length"in r.transforms);JN.exports=XJ});var QN=S((ISe,KN)=>{var YJ=it(),ZJ=zl(),JJ=r=>ZJ(r).map(n=>YJ.toPoints(n));KN.exports=JJ});var tR=S((DSe,eR)=>{var KJ=it(),QJ=zl(),eK=r=>{let e=QJ(r),t="geom3 ("+e.length+` polygons):
`;return e.forEach(n=>{t+="  "+KJ.toString(n)+`
`}),t};eR.exports=eK});var rR=S((LSe,nR)=>{var tK=it(),nK=r=>{let e=r.polygons,t=r.transforms,n=e.length,s=e.reduce((l,u)=>l+u.vertices.length,0),i=[-1,-1,-1,-1];r.color&&(i=r.color);let o=new Float32Array(1+16+4+1+n+s*3);o[0]=1,o[1]=t[0],o[2]=t[1],o[3]=t[2],o[4]=t[3],o[5]=t[4],o[6]=t[5],o[7]=t[6],o[8]=t[7],o[9]=t[8],o[10]=t[9],o[11]=t[10],o[12]=t[11],o[13]=t[12],o[14]=t[13],o[15]=t[14],o[16]=t[15],o[17]=i[0],o[18]=i[1],o[19]=i[2],o[20]=i[3],o[21]=s;let a=22,c=a+n;return e.forEach(l=>{let u=tK.toPoints(l);o[a]=u.length,a++;for(let h=0;h<u.length;h++){let d=u[h];o[c+0]=d[0],o[c+1]=d[1],o[c+2]=d[2],c+=3}}),o};nR.exports=nK});var oR=S((BSe,iR)=>{var sR=At(),rK=(r,e)=>{let t=sR.multiply(sR.create(),r,e.transforms);return Object.assign({},e,{transforms:t})};iR.exports=rK});var cR=S((kSe,aR)=>{var sK=it(),iK=vy(),oK=r=>{if(!iK(r))throw new Error("invalid geom3 structure");if(r.polygons.forEach(sK.validate),aK(r),!r.transforms.every(Number.isFinite))throw new Error(`geom3 invalid transforms ${r.transforms}`)},aK=r=>{let e=new Map;r.polygons.forEach(({vertices:n})=>{n.forEach((s,i)=>{let o=`${s}`,a=`${n[(i+1)%n.length]}`,c=`${o}/${a}`,l=e.has(c)?e.get(c):0;e.set(c,l+1)})});let t=[];if(e.forEach((n,s)=>{let i=s.split("/").reverse().join("/"),o=e.get(i);n!==o&&t.push(s.replace("/"," -> "))}),t.length>0)throw new Error(`non-manifold edges ${t.length}
${t.join(`
`)}`)};aR.exports=oK});var Ve=S((FSe,lR)=>{lR.exports={clone:G2(),create:kl(),fromPoints:qN(),fromCompactBinary:HN(),invert:ZN(),isA:vy(),toPoints:QN(),toPolygons:zl(),toString:tR(),toCompactBinary:rR(),transform:oR(),validate:cR()}});var tp=S((USe,uR)=>{var cK=r=>Object.assign({},r);uR.exports=cK});var by=S((zSe,dR)=>{var{EPS:hR}=Lt(),lK=$e(),uK=tp(),hK=r=>{if(r.isClosed)return r;let e=uK(r);if(e.isClosed=!0,e.points.length>1){let t=e.points,n=t[0],s=t[t.length-1];for(;lK.distance(n,s)<hR*hR&&(t.pop(),t.length!==1);)s=t[t.length-1]}return e};dR.exports=hK});var np=S((VSe,pR)=>{var dK=At(),pK=r=>(r===void 0&&(r=[]),{points:r,isClosed:!1,transforms:dK.create()});pR.exports=pK});var Vl=S((qSe,_R)=>{var{EPS:fR}=Lt(),mR=$e(),fK=by(),mK=np(),_K=(r,e)=>{let t={closed:!1},{closed:n}=Object.assign({},t,r),s=mK();if(s.points=e.map(i=>mR.clone(i)),s.points.length>1){let i=s.points[0],o=s.points[s.points.length-1];mR.distance(i,o)<fR*fR&&(n=!0)}return n===!0&&(s=fK(s)),s};_R.exports=_K});var vR=S((GSe,xR)=>{var gR=At(),yR=$e(),gK=r=>(gR.isIdentity(r.transforms)||(r.points=r.points.map(e=>yR.transform(yR.create(),e,r.transforms)),r.transforms=gR.create()),r);xR.exports=gK});var ui=S((HSe,bR)=>{var yK=vR(),xK=r=>yK(r).points;bR.exports=xK});var ER=S((WSe,wR)=>{var sn=$e(),vK=Vl(),bK=ui(),wK=(r,e)=>{let t={radius:[0,0],xaxisrotation:0,clockwise:!1,large:!1,segments:16},{endpoint:n,radius:s,xaxisrotation:i,clockwise:o,large:a,segments:c}=Object.assign({},t,r);if(!Array.isArray(n))throw new Error("endpoint must be an array of X and Y values");if(n.length<2)throw new Error("endpoint must contain X and Y values");if(n=sn.clone(n),!Array.isArray(s))throw new Error("radius must be an array of X and Y values");if(s.length<2)throw new Error("radius must contain X and Y values");if(c<4)throw new Error("segments must be four or more");let l=1e5;if(e.isClosed)throw new Error("the given path cannot be closed");let u=bK(e);if(u.length<1)throw new Error("the given path must contain one or more points (as the starting point for the arc)");let h=s[0],d=s[1],p=u[u.length-1];h=Math.round(h*l)/l,d=Math.round(d*l)/l,n=sn.fromValues(Math.round(n[0]*l)/l,Math.round(n[1]*l)/l);let _=!o,f=[];if(h===0||d===0)f.push(n);else{h=Math.abs(h),d=Math.abs(d);let g=i,x=Math.cos(g),b=Math.sin(g),v=sn.subtract(sn.create(),p,n);sn.scale(v,v,.5);let y=Math.round((x*v[0]+b*v[1])*l)/l,E=Math.round((-b*v[0]+x*v[1])*l)/l,C=sn.fromValues(y,E),M=C[0]*C[0]/(h*h)+C[1]*C[1]/(d*d);if(M>1){let z=Math.sqrt(M);h*=z,d*=z,h=Math.round(h*l)/l,d=Math.round(d*l)/l}let R=Math.sqrt((h*h*d*d-h*h*C[1]*C[1]-d*d*C[0]*C[0])/(h*h*C[1]*C[1]+d*d*C[0]*C[0]));_===a&&(R=-R);let N=sn.fromValues(h*C[1]/d,-d*C[0]/h);sn.scale(N,N,R);let w=sn.fromValues(x*N[0]-b*N[1],b*N[0]+x*N[1]);w=sn.add(w,w,sn.scale(sn.create(),sn.add(sn.create(),p,n),.5));let T=sn.fromValues((C[0]-N[0])/h,(C[1]-N[1])/d),F=sn.fromValues((-C[0]-N[0])/h,(-C[1]-N[1])/d),L=sn.angleRadians(T),B=sn.angleRadians(F)-L;B=B%(2*Math.PI),!_&&B>0?B-=2*Math.PI:_&&B<0&&(B+=2*Math.PI);let H=Math.ceil(Math.abs(B)/(2*Math.PI)*c)+1;H<1&&(H=1);for(let z=1;z<H;z++){let X=L+z/H*B,ee=Math.cos(X),le=Math.sin(X),re=sn.fromValues(x*h*ee-b*d*le,b*h*ee+x*d*le);sn.add(re,re,w),f.push(re)}H&&f.push(r.endpoint)}return f=u.concat(f),vK({},f)};wR.exports=wK});var wy=S((jSe,CR)=>{var EK=Vl(),CK=ui(),SK=(r,e)=>{if(e.isClosed)throw new Error("cannot append points to a closed path");let t=CK(e);return t=t.concat(r),EK({},t)};CR.exports=SK});var AR=S(($Se,SR)=>{var ar=$e(),AK=$e(),TK=wy(),MK=ui(),PK=(r,e)=>{let t={segments:16},{controlPoints:n,segments:s}=Object.assign({},t,r);if(!Array.isArray(n))throw new Error("controlPoints must be an array of one or more points");if(n.length<1)throw new Error("controlPoints must be an array of one or more points");if(s<4)throw new Error("segments must be four or more");if(e.isClosed)throw new Error("the given geometry cannot be closed");let i=MK(e);if(i.length<1)throw new Error("the given path must contain one or more points (as the starting point for the bezier curve)");if(n=n.slice(),n[0]===null){if(n.length<2)throw new Error("a null control point must be passed with one more control points");let E=i[i.length-2];if("lastBezierControlPoint"in e&&(E=e.lastBezierControlPoint),!Array.isArray(E))throw new Error("the given path must contain TWO or more points if given a null control point");let C=ar.scale(ar.create(),i[i.length-1],2);ar.subtract(C,C,E),n[0]=C}n.unshift(i[i.length-1]);let a=n.length-1,c=[],l=1;for(let E=0;E<=a;++E)E>0&&(l*=E),c.push(l);let u=[];for(let E=0;E<=a;++E){let C=c[a]/(c[E]*c[a-E]);u.push(C)}let h=ar.create(),d=ar.create(),p=AK.create(),_=E=>{let C=1,M=Math.pow(1-E,a),R=E!==1?1/(1-E):1,N=ar.create();for(let w=0;w<=a;++w){w===a&&(M=1);let T=u[w]*C*M,F=ar.scale(h,n[w],T);ar.add(N,N,F),C*=E,M*=R}return N},f=[],m=[],g=a+1;for(let E=0;E<g;++E){let C=E/(g-1),M=_(C);f.push(M),m.push(C)}let x=1,b=Math.PI*2/s,v=Math.sin(b);for(;x<f.length-1;){let E=ar.subtract(h,f[x],f[x-1]);ar.normalize(E,E);let C=ar.subtract(d,f[x+1],f[x]);ar.normalize(C,C);let M=ar.cross(p,E,C);if(Math.abs(M[2])>v){let R=m[x-1],N=m[x+1],w=R+(N-R)*1/3,T=R+(N-R)*2/3,F=_(w),L=_(T);f.splice(x,1,F,L),m.splice(x,1,w,T),x--,x<1&&(x=1)}else++x}f.shift();let y=TK(f,e);return y.lastBezierControlPoint=n[n.length-2],y};SR.exports=PK});var MR=S((XSe,TR)=>{var NK=Vl(),RK=ui(),{equals:OK}=$e(),IK=(...r)=>{let e=!1;for(let n of r){if(e)throw new Error("Cannot concatenate to a closed path");e=n.isClosed}let t=[];return r.forEach(n=>{let s=RK(n);t.length>0&&s.length>0&&OK(s[0],t[t.length-1])&&s.shift(),t=t.concat(s)}),NK({closed:e},t)};TR.exports=IK});var RR=S((YSe,NR)=>{var DK=$e(),PR=ui(),LK=(r,e)=>{if(r.isClosed!==e.isClosed||r.points.length!==e.points.length)return!1;let t=PR(r),n=PR(e),s=t.length,i=0;do{let o=!1;for(let a=0;a<s;a++)if(!DK.equals(t[a],n[(a+i)%s])){o=!0;break}if(o===!1)return!0;if(!r.isClosed)return!1}while(++i<s);return!1};NR.exports=LK});var IR=S((ZSe,OR)=>{var BK=At(),kK=$e(),FK=np(),UK=r=>{if(r[0]!==2)throw new Error("invalid compact binary data");let e=FK();e.transforms=BK.clone(r.slice(1,17)),e.isClosed=!!r[17];for(let t=22;t<r.length;t+=2){let n=kK.fromValues(r[t],r[t+1]);e.points.push(n)}return r[18]>=0&&(e.color=[r[18],r[19],r[20],r[21]]),e};OR.exports=UK});var Ey=S((JSe,DR)=>{var zK=r=>!!(r&&typeof r=="object"&&"points"in r&&"transforms"in r&&"isClosed"in r&&Array.isArray(r.points)&&"length"in r.transforms);DR.exports=zK});var BR=S((KSe,LR)=>{var VK=tp(),qK=r=>{let e=VK(r);return e.points=r.points.slice().reverse(),e};LR.exports=qK});var FR=S((QSe,kR)=>{var GK=$e(),HK=ui(),WK=r=>{let e=HK(r),t="path ("+e.length+" points, "+r.isClosed+`):
[
`;return e.forEach(n=>{t+="  "+GK.toString(n)+`,
`}),t+=`]
`,t};kR.exports=WK});var zR=S((eAe,UR)=>{var jK=r=>{let e=r.points,t=r.transforms,n=[-1,-1,-1,-1];r.color&&(n=r.color);let s=new Float32Array(1+16+1+4+e.length*2);s[0]=2,s[1]=t[0],s[2]=t[1],s[3]=t[2],s[4]=t[3],s[5]=t[4],s[6]=t[5],s[7]=t[6],s[8]=t[7],s[9]=t[8],s[10]=t[9],s[11]=t[10],s[12]=t[11],s[13]=t[12],s[14]=t[13],s[15]=t[14],s[16]=t[15],s[17]=r.isClosed?1:0,s[18]=n[0],s[19]=n[1],s[20]=n[2],s[21]=n[3];for(let i=0;i<e.length;i++){let o=i*2+22,a=e[i];s[o]=a[0],s[o+1]=a[1]}return s};UR.exports=jK});var GR=S((tAe,qR)=>{var VR=At(),$K=(r,e)=>{let t=VR.multiply(VR.create(),r,e.transforms);return Object.assign({},e,{transforms:t})};qR.exports=$K});var WR=S((nAe,HR)=>{var XK=$e(),YK=Ey(),ZK=r=>{if(!YK(r))throw new Error("invalid path2 structure");if(r.points.length>1){for(let e=0;e<r.points.length;e++)if(XK.equals(r.points[e],r.points[(e+1)%r.points.length]))throw new Error(`path2 duplicate points ${r.points[e]}`)}if(r.points.forEach(e=>{if(!e.every(Number.isFinite))throw new Error(`path2 invalid point ${e}`)}),!r.transforms.every(Number.isFinite))throw new Error(`path2 invalid transforms ${r.transforms}`)};HR.exports=ZK});var gt=S((rAe,jR)=>{jR.exports={appendArc:ER(),appendBezier:AR(),appendPoints:wy(),clone:tp(),close:by(),concat:MR(),create:np(),equals:RR(),fromPoints:Vl(),fromCompactBinary:IR(),isA:Ey(),reverse:BR(),toPoints:ui(),toString:FR(),toCompactBinary:zR(),transform:GR(),validate:WR()}});var KR=S((sAe,JR)=>{var JK=Be(),$R=ze(),XR=Ve(),YR=gt(),ZR=it(),KK=(r,e)=>{let t=$R.clone(e);return t.color=r,t},QK=(r,e)=>{let t=XR.clone(e);return t.color=r,t},eQ=(r,e)=>{let t=YR.clone(e);return t.color=r,t},tQ=(r,e)=>{let t=ZR.clone(e);return t.color=r,t},nQ=(r,...e)=>{if(!Array.isArray(r))throw new Error("color must be an array");if(r.length<3)throw new Error("color must contain R, G and B values");if(r.length===3&&(r=[r[0],r[1],r[2],1]),e=JK(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>$R.isA(n)?KK(r,n):XR.isA(n)?QK(r,n):YR.isA(n)?eQ(r,n):ZR.isA(n)?tQ(r,n):(n.color=r,n));return t.length===1?t[0]:t};JR.exports=nQ});var Cy=S((iAe,QR)=>{var rQ={black:[0,0,0],silver:[.7529411764705882,.7529411764705882,.7529411764705882],gray:[.5019607843137255,.5019607843137255,.5019607843137255],white:[1,1,1],maroon:[.5019607843137255,0,0],red:[1,0,0],purple:[.5019607843137255,0,.5019607843137255],fuchsia:[1,0,1],green:[0,.5019607843137255,0],lime:[0,1,0],olive:[.5019607843137255,.5019607843137255,0],yellow:[1,1,0],navy:[0,0,.5019607843137255],blue:[0,0,1],teal:[0,.5019607843137255,.5019607843137255],aqua:[0,1,1],aliceblue:[.9411764705882353,.9725490196078431,1],antiquewhite:[.9803921568627451,.9215686274509803,.8431372549019608],aquamarine:[.4980392156862745,1,.8313725490196079],azure:[.9411764705882353,1,1],beige:[.9607843137254902,.9607843137254902,.8627450980392157],bisque:[1,.8941176470588236,.7686274509803922],blanchedalmond:[1,.9215686274509803,.803921568627451],blueviolet:[.5411764705882353,.16862745098039217,.8862745098039215],brown:[.6470588235294118,.16470588235294117,.16470588235294117],burlywood:[.8705882352941177,.7215686274509804,.5294117647058824],cadetblue:[.37254901960784315,.6196078431372549,.6274509803921569],chartreuse:[.4980392156862745,1,0],chocolate:[.8235294117647058,.4117647058823529,.11764705882352941],coral:[1,.4980392156862745,.3137254901960784],cornflowerblue:[.39215686274509803,.5843137254901961,.9294117647058824],cornsilk:[1,.9725490196078431,.8627450980392157],crimson:[.8627450980392157,.0784313725490196,.23529411764705882],cyan:[0,1,1],darkblue:[0,0,.5450980392156862],darkcyan:[0,.5450980392156862,.5450980392156862],darkgoldenrod:[.7215686274509804,.5254901960784314,.043137254901960784],darkgray:[.6627450980392157,.6627450980392157,.6627450980392157],darkgreen:[0,.39215686274509803,0],darkgrey:[.6627450980392157,.6627450980392157,.6627450980392157],darkkhaki:[.7411764705882353,.7176470588235294,.4196078431372549],darkmagenta:[.5450980392156862,0,.5450980392156862],darkolivegreen:[.3333333333333333,.4196078431372549,.1843137254901961],darkorange:[1,.5490196078431373,0],darkorchid:[.6,.19607843137254902,.8],darkred:[.5450980392156862,0,0],darksalmon:[.9137254901960784,.5882352941176471,.47843137254901963],darkseagreen:[.5607843137254902,.7372549019607844,.5607843137254902],darkslateblue:[.2823529411764706,.23921568627450981,.5450980392156862],darkslategray:[.1843137254901961,.30980392156862746,.30980392156862746],darkslategrey:[.1843137254901961,.30980392156862746,.30980392156862746],darkturquoise:[0,.807843137254902,.8196078431372549],darkviolet:[.5803921568627451,0,.8274509803921568],deeppink:[1,.0784313725490196,.5764705882352941],deepskyblue:[0,.7490196078431373,1],dimgray:[.4117647058823529,.4117647058823529,.4117647058823529],dimgrey:[.4117647058823529,.4117647058823529,.4117647058823529],dodgerblue:[.11764705882352941,.5647058823529412,1],firebrick:[.6980392156862745,.13333333333333333,.13333333333333333],floralwhite:[1,.9803921568627451,.9411764705882353],forestgreen:[.13333333333333333,.5450980392156862,.13333333333333333],gainsboro:[.8627450980392157,.8627450980392157,.8627450980392157],ghostwhite:[.9725490196078431,.9725490196078431,1],gold:[1,.8431372549019608,0],goldenrod:[.8549019607843137,.6470588235294118,.12549019607843137],greenyellow:[.6784313725490196,1,.1843137254901961],grey:[.5019607843137255,.5019607843137255,.5019607843137255],honeydew:[.9411764705882353,1,.9411764705882353],hotpink:[1,.4117647058823529,.7058823529411765],indianred:[.803921568627451,.3607843137254902,.3607843137254902],indigo:[.29411764705882354,0,.5098039215686274],ivory:[1,1,.9411764705882353],khaki:[.9411764705882353,.9019607843137255,.5490196078431373],lavender:[.9019607843137255,.9019607843137255,.9803921568627451],lavenderblush:[1,.9411764705882353,.9607843137254902],lawngreen:[.48627450980392156,.9882352941176471,0],lemonchiffon:[1,.9803921568627451,.803921568627451],lightblue:[.6784313725490196,.8470588235294118,.9019607843137255],lightcoral:[.9411764705882353,.5019607843137255,.5019607843137255],lightcyan:[.8784313725490196,1,1],lightgoldenrodyellow:[.9803921568627451,.9803921568627451,.8235294117647058],lightgray:[.8274509803921568,.8274509803921568,.8274509803921568],lightgreen:[.5647058823529412,.9333333333333333,.5647058823529412],lightgrey:[.8274509803921568,.8274509803921568,.8274509803921568],lightpink:[1,.7137254901960784,.7568627450980392],lightsalmon:[1,.6274509803921569,.47843137254901963],lightseagreen:[.12549019607843137,.6980392156862745,.6666666666666666],lightskyblue:[.5294117647058824,.807843137254902,.9803921568627451],lightslategray:[.4666666666666667,.5333333333333333,.6],lightslategrey:[.4666666666666667,.5333333333333333,.6],lightsteelblue:[.6901960784313725,.7686274509803922,.8705882352941177],lightyellow:[1,1,.8784313725490196],limegreen:[.19607843137254902,.803921568627451,.19607843137254902],linen:[.9803921568627451,.9411764705882353,.9019607843137255],magenta:[1,0,1],mediumaquamarine:[.4,.803921568627451,.6666666666666666],mediumblue:[0,0,.803921568627451],mediumorchid:[.7294117647058823,.3333333333333333,.8274509803921568],mediumpurple:[.5764705882352941,.4392156862745098,.8588235294117647],mediumseagreen:[.23529411764705882,.7019607843137254,.44313725490196076],mediumslateblue:[.4823529411764706,.40784313725490196,.9333333333333333],mediumspringgreen:[0,.9803921568627451,.6039215686274509],mediumturquoise:[.2823529411764706,.8196078431372549,.8],mediumvioletred:[.7803921568627451,.08235294117647059,.5215686274509804],midnightblue:[.09803921568627451,.09803921568627451,.4392156862745098],mintcream:[.9607843137254902,1,.9803921568627451],mistyrose:[1,.8941176470588236,.8823529411764706],moccasin:[1,.8941176470588236,.7098039215686275],navajowhite:[1,.8705882352941177,.6784313725490196],oldlace:[.9921568627450981,.9607843137254902,.9019607843137255],olivedrab:[.4196078431372549,.5568627450980392,.13725490196078433],orange:[1,.6470588235294118,0],orangered:[1,.27058823529411763,0],orchid:[.8549019607843137,.4392156862745098,.8392156862745098],palegoldenrod:[.9333333333333333,.9098039215686274,.6666666666666666],palegreen:[.596078431372549,.984313725490196,.596078431372549],paleturquoise:[.6862745098039216,.9333333333333333,.9333333333333333],palevioletred:[.8588235294117647,.4392156862745098,.5764705882352941],papayawhip:[1,.9372549019607843,.8352941176470589],peachpuff:[1,.8549019607843137,.7254901960784313],peru:[.803921568627451,.5215686274509804,.24705882352941178],pink:[1,.7529411764705882,.796078431372549],plum:[.8666666666666667,.6274509803921569,.8666666666666667],powderblue:[.6901960784313725,.8784313725490196,.9019607843137255],rosybrown:[.7372549019607844,.5607843137254902,.5607843137254902],royalblue:[.2549019607843137,.4117647058823529,.8823529411764706],saddlebrown:[.5450980392156862,.27058823529411763,.07450980392156863],salmon:[.9803921568627451,.5019607843137255,.4470588235294118],sandybrown:[.9568627450980393,.6431372549019608,.3764705882352941],seagreen:[.1803921568627451,.5450980392156862,.3411764705882353],seashell:[1,.9607843137254902,.9333333333333333],sienna:[.6274509803921569,.3215686274509804,.17647058823529413],skyblue:[.5294117647058824,.807843137254902,.9215686274509803],slateblue:[.41568627450980394,.35294117647058826,.803921568627451],slategray:[.4392156862745098,.5019607843137255,.5647058823529412],slategrey:[.4392156862745098,.5019607843137255,.5647058823529412],snow:[1,.9803921568627451,.9803921568627451],springgreen:[0,1,.4980392156862745],steelblue:[.27450980392156865,.5098039215686274,.7058823529411765],tan:[.8235294117647058,.7058823529411765,.5490196078431373],thistle:[.8470588235294118,.7490196078431373,.8470588235294118],tomato:[1,.38823529411764707,.2784313725490196],turquoise:[.25098039215686274,.8784313725490196,.8156862745098039],violet:[.9333333333333333,.5098039215686274,.9333333333333333],wheat:[.9607843137254902,.8705882352941177,.7019607843137254],whitesmoke:[.9607843137254902,.9607843137254902,.9607843137254902],yellowgreen:[.6039215686274509,.803921568627451,.19607843137254902]};QR.exports=rQ});var tO=S((oAe,eO)=>{var sQ=Cy(),iQ=r=>sQ[r.toLowerCase()];eO.exports=iQ});var rO=S((aAe,nO)=>{var oQ=r=>{if(r=r.replace("#",""),r.length<6)throw new Error("the given notation must contain 3 or more hex values");let e=parseInt(r.substring(0,2),16)/255,t=parseInt(r.substring(2,4),16)/255,n=parseInt(r.substring(4,6),16)/255;if(r.length>=8){let s=parseInt(r.substring(6,8),16)/255;return[e,t,n,s]}return[e,t,n]};nO.exports=oQ});var Sy=S((cAe,sO)=>{var aQ=(r,e,t)=>(t<0&&(t+=1),t>1&&(t-=1),t<.16666666666666666?r+(e-r)*6*t:t<.5?e:t<.6666666666666666?r+(e-r)*(.6666666666666666-t)*6:r);sO.exports=aQ});var oO=S((lAe,iO)=>{var cQ=Be(),Ay=Sy(),lQ=(...r)=>{if(r=cQ(r),r.length<3)throw new Error("values must contain H, S and L values");let e=r[0],t=r[1],n=r[2],s=n,i=n,o=n;if(t!==0){let a=n<.5?n*(1+t):n+t-n*t,c=2*n-a;s=Ay(c,a,e+1/3),i=Ay(c,a,e),o=Ay(c,a,e-1/3)}if(r.length>3){let a=r[3];return[s,i,o,a]}return[s,i,o]};iO.exports=lQ});var cO=S((uAe,aO)=>{var uQ=Be(),hQ=(...r)=>{if(r=uQ(r),r.length<3)throw new Error("values must contain H, S and V values");let e=r[0],t=r[1],n=r[2],s=0,i=0,o=0,a=Math.floor(e*6),c=e*6-a,l=n*(1-t),u=n*(1-c*t),h=n*(1-(1-c)*t);switch(a%6){case 0:s=n,i=h,o=l;break;case 1:s=u,i=n,o=l;break;case 2:s=l,i=n,o=h;break;case 3:s=l,i=u,o=n;break;case 4:s=h,i=l,o=n;break;case 5:s=n,i=l,o=u;break}if(r.length>3){let d=r[3];return[s,i,o,d]}return[s,i,o]};aO.exports=hQ});var uO=S((hAe,lO)=>{var dQ=Be(),pQ=(...r)=>{if(r=dQ(r),r.length<3)throw new Error("values must contain R, G and B values");let e=r[0]*255,t=r[1]*255,n=r[2]*255,s=`#${Number(16777216+e*65536+t*256+n).toString(16).substring(1,7)}`;return r.length>3&&(s=s+Number(r[3]*255).toString(16)),s};lO.exports=pQ});var dO=S((dAe,hO)=>{var fQ=Be(),mQ=(...r)=>{if(r=fQ(r),r.length<3)throw new Error("values must contain R, G and B values");let e=r[0],t=r[1],n=r[2],s=Math.max(e,t,n),i=Math.min(e,t,n),o,a,c=(s+i)/2;if(s===i)o=a=0;else{let l=s-i;switch(a=c>.5?l/(2-s-i):l/(s+i),s){case e:o=(t-n)/l+(t<n?6:0);break;case t:o=(n-e)/l+2;break;case n:o=(e-t)/l+4;break}o/=6}if(r.length>3){let l=r[3];return[o,a,c,l]}return[o,a,c]};hO.exports=mQ});var fO=S((pAe,pO)=>{var _Q=Be(),gQ=(...r)=>{if(r=_Q(r),r.length<3)throw new Error("values must contain R, G and B values");let e=r[0],t=r[1],n=r[2],s=Math.max(e,t,n),i=Math.min(e,t,n),o,a=s,c=s-i,l=s===0?0:c/s;if(s===i)o=0;else{switch(s){case e:o=(t-n)/c+(t<n?6:0);break;case t:o=(n-e)/c+2;break;case n:o=(e-t)/c+4;break}o/=6}if(r.length>3){let u=r[3];return[o,l,a,u]}return[o,l,a]};pO.exports=gQ});var _O=S((fAe,mO)=>{mO.exports={colorize:KR(),colorNameToRgb:tO(),cssColors:Cy(),hexToRgb:rO(),hslToRgb:oO(),hsvToRgb:cO(),hueToColorComponent:Sy(),rgbToHex:uO(),rgbToHsl:dO(),rgbToHsv:fO()}});var xO=S((mAe,yO)=>{var yQ=r=>{if(!Array.isArray(r))throw new Error("Bezier points must be a valid array/");if(r.length<2)throw new Error("Bezier points must contain at least 2 values.");let e=xQ(r);return{points:r,pointType:e,dimensions:e==="float_single"?0:r[0].length,permutations:gO(r.length-1),tangentPermutations:gO(r.length-2)}},xQ=function(r){let e=null;return r.forEach(t=>{let n="";if(Number.isFinite(t))n="float_single";else if(Array.isArray(t))t.forEach(s=>{if(!Number.isFinite(s))throw new Error("Bezier point values must all be numbers.")}),n="float_"+t.length;else throw new Error("Bezier points must all be numbers or arrays of number.");if(e==null)e=n;else if(e!==n)throw new Error("Bezier points must be either all numbers or all arrays of numbers of the same size.")}),e},gO=function(r){let e=[];for(let t=0;t<=r;t++)e.push(Ty(r)/(Ty(t)*Ty(r-t)));return e},Ty=function(r){let e=1;for(let t=2;t<=r;t++)e*=t;return e};yO.exports=yQ});var wO=S((_Ae,bO)=>{var vQ=(r,e)=>{if(r<0||r>1)throw new Error("Bezier valueAt() input must be between 0 and 1");if(e.pointType==="float_single")return vO(e,e.points,r);{let t=[];for(let n=0;n<e.dimensions;n++){let s=[];for(let i=0;i<e.points.length;i++)s.push(e.points[i][n]);t.push(vO(e,s,r))}return t}},vO=function(r,e,t){let n=e.length-1,s=0;for(let i=0;i<=n;i++)s+=r.permutations[i]*Math.pow(1-t,n-i)*Math.pow(t,i)*e[i];return s};bO.exports=vQ});var SO=S((gAe,CO)=>{var bQ=(r,e)=>{if(r<0||r>1)throw new Error("Bezier tangentAt() input must be between 0 and 1");if(e.pointType==="float_single")return EO(e,e.points,r);{let t=[];for(let n=0;n<e.dimensions;n++){let s=[];for(let i=0;i<e.points.length;i++)s.push(e.points[i][n]);t.push(EO(e,s,r))}return t}},EO=function(r,e,t){let n=e.length-1,s=0;for(let i=0;i<n;i++){let o=n*(e[i+1]-e[i]);s+=r.tangentPermutations[i]*Math.pow(1-t,n-1-i)*Math.pow(t,i)*o}return s};CO.exports=bQ});var TO=S((yAe,AO)=>{AO.exports={create:xO(),valueAt:wO(),tangentAt:SO()}});var PO=S((xAe,MO)=>{MO.exports={bezier:TO()}});var ql=S((vAe,NO)=>{var wQ=r=>{let e=0;for(let t=0;t<r.length;t++){let n=(t+1)%r.length;e+=r[t][0]*r[n][1],e-=r[n][0]*r[t][1]}return e/2};NO.exports=wQ});var My=S((bAe,RO)=>{var EQ=ql(),CQ=r=>EQ(r.vertices);RO.exports=CQ});var Py=S((wAe,OO)=>{var SQ=r=>((r===void 0||r.length<3)&&(r=[]),{vertices:r});OO.exports=SQ});var Ny=S((EAe,IO)=>{var AQ=Py(),TQ=r=>{let e=r.vertices.slice().reverse();return AQ(e)};IO.exports=TQ});var LO=S((CAe,DO)=>{var MQ=My(),PQ=Ny(),NQ=(r,e)=>{if(r.length===0)return 0;let t=e.vertices;return t.length<3?0:(MQ(e)<0&&(e=PQ(e)),r.reduce((s,i)=>s+RQ(i,t),0)===r.length?1:0)},RQ=(r,e)=>{let t=e.length,n=r[0],s=r[1],i=e[t-1],o=e[0],a=i[1]>s,c=0,l=0;for(let u=t+1;--u;){let h=o[1]>s;if(a!==h){let d=i[0]>n,p=o[0]>n;(d&&p||o[0]-(o[1]-s)*(i[0]-o[0])/(i[1]-o[1])>=n)&&(c=!c)}a=h,i=o,o=e[++l]}return c};DO.exports=NQ});var rp=S((SAe,BO)=>{BO.exports={arePointsInside:LO(),create:Py(),flip:Ny(),measureArea:My()}});var sp=S((AAe,kO)=>{kO.exports={geom2:ze(),geom3:Ve(),path2:gt(),poly2:rp(),poly3:it()}});var ip=S((TAe,FO)=>{var OQ=()=>[0,1,0];FO.exports=OQ});var zO=S((MAe,UO)=>{var IQ=ip(),DQ=r=>{let e=IQ();return e[0]=r[0],e[1]=r[1],e[2]=r[2],e};UO.exports=DQ});var op=S((PAe,VO)=>{var Ry=$e(),LQ=r=>{let e=Ry.normal(Ry.create(),r);return Ry.negate(e,e),e};VO.exports=LQ});var Gl=S((NAe,GO)=>{var qO=$e(),BQ=r=>qO.scale(qO.create(),r,r[2]);GO.exports=BQ});var WO=S((RAe,HO)=>{var kQ=$e(),FQ=op(),UQ=Gl(),zQ=(r,e)=>{let t=UQ(r),n=FQ(r),s=(n[1]-t[1])/(n[0]-t[0]),i=t[1]-s*t[0],o=-1/s,c=(e[1]-o*e[0]-i)/(s-o),l=s*c+i;return kQ.fromValues(c,l)};HO.exports=zQ});var Oy=S((OAe,jO)=>{var VQ=(r,e)=>(r[0]=e[0],r[1]=e[1],r[2]=e[2],r);jO.exports=VQ});var XO=S((IAe,$O)=>{var qQ=$e(),GQ=(r,e)=>{let t=qQ.dot(e,r);return t=Math.abs(t-r[2]),t};$O.exports=GQ});var ZO=S((DAe,YO)=>{var HQ=(r,e)=>r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2];YO.exports=HQ});var Iy=S((LAe,JO)=>{var Hl=$e(),WQ=(r,e,t)=>{let n=Hl.subtract(Hl.create(),t,e);Hl.normal(n,n),Hl.normalize(n,n);let s=Hl.dot(e,n);return r[0]=n[0],r[1]=n[1],r[2]=s,r};JO.exports=WQ});var Dy=S((BAe,KO)=>{var jQ=ip(),$Q=(r,e,t)=>{let n=jQ();return n[0]=r,n[1]=e,n[2]=t,n};KO.exports=$Q});var Wl=S((kAe,QO)=>{var{NEPS:Ly}=Lt(),XQ=(r,e)=>Math.abs(r[0]-e[0])<=Ly&&Math.abs(r[1]-e[1])<=Ly&&Math.abs(r[2]-e[2])<=Ly;QO.exports=XQ});var By=S((FAe,eI)=>{var YQ=(r,e,t)=>{let n=t-r[1],s=e[1]-r[1];s<0&&(n=-n,s=-s);let i;return n<=0?i=0:n>=s?i=1:s<1e-10?i=.5:i=n/s,r[0]+i*(e[0]-r[0])};eI.exports=YQ});var ky=S((UAe,tI)=>{var ZQ=(r,e,t,n)=>{if(r[0]===e[0]&&r[1]===e[1]||t[0]===n[0]&&t[1]===n[1])return;let s=(n[1]-t[1])*(e[0]-r[0])-(n[0]-t[0])*(e[1]-r[1]);if(Math.abs(s)<Number.MIN_VALUE)return;let i=((n[0]-t[0])*(r[1]-t[1])-(n[1]-t[1])*(r[0]-t[0]))/s,o=((e[0]-r[0])*(r[1]-t[1])-(e[1]-r[1])*(r[0]-t[0]))/s;if(i<0||i>1||o<0||o>1)return;let a=r[0]+i*(e[0]-r[0]),c=r[1]+i*(e[1]-r[1]);return[a,c]};tI.exports=ZQ});var rI=S((zAe,nI)=>{var JQ=(r,e,t,n,s,i)=>{let o=r*n-e*t,a=1/o,c=s*n-e*i,l=-s*t+r*i;return c*=a,l*=a,[c,l]};nI.exports=JQ});var tc=S((VAe,sI)=>{sI.exports={aboutEqualNormals:Wl(),area:ql(),interpolateBetween2DPointsForY:By(),intersect:ky(),solve2Linear:rI()}});var oI=S((qAe,iI)=>{var KQ=$e(),{solve2Linear:QQ}=tc(),eee=(r,e)=>{let t=QQ(r[0],r[1],e[0],e[1],r[2],e[2]);return KQ.clone(t)};iI.exports=eee});var lI=S((GAe,cI)=>{var aI=$e(),tee=Oy(),nee=Dy(),ree=(r,e)=>{let t=aI.negate(aI.create(),e),n=-e[2];return tee(r,nee(t[0],t[1],n))};cI.exports=ree});var hI=S((HAe,uI)=>{var see=r=>`line2: (${r[0].toFixed(7)}, ${r[1].toFixed(7)}, ${r[2].toFixed(7)})`;uI.exports=see});var fI=S((WAe,pI)=>{var dI=$e(),iee=Iy(),oee=Gl(),aee=op(),cee=(r,e,t)=>{let n=oee(e),s=aee(e);return dI.transform(n,n,t),dI.transform(s,s,t),iee(r,n,s)};pI.exports=cee});var _I=S((jAe,mI)=>{var lee=Gl(),uee=(r,e)=>{let t=(r[2]-r[1]*e)/r[0];return Number.isNaN(t)&&(t=lee(r)[0]),t};mI.exports=uee});var ap=S(($Ae,gI)=>{gI.exports={clone:zO(),closestPoint:WO(),copy:Oy(),create:ip(),direction:op(),distanceToPoint:XO(),equals:ZO(),fromPoints:Iy(),fromValues:Dy(),intersectPointOfLines:oI(),origin:Gl(),reverse:lI(),toString:hI(),transform:fI(),xAtY:_I()}});var Fy=S((XAe,xI)=>{var yI=Te(),hee=()=>[yI.fromValues(0,0,0),yI.fromValues(0,0,1)];xI.exports=hee});var wI=S((YAe,bI)=>{var vI=Te(),dee=Fy(),pee=r=>{let e=dee();return vI.copy(e[0],r[0]),vI.copy(e[1],r[1]),e};bI.exports=pee});var Uy=S((ZAe,EI)=>{var no=Te(),fee=(r,e)=>{let t=r[0],n=r[1],s=no.dot(no.subtract(no.create(),e,t),n),i=no.dot(n,n),o=s/i,a=no.scale(no.create(),n,o);return no.add(a,a,t),a};EI.exports=fee});var AI=S((JAe,SI)=>{var CI=Te(),mee=(r,e)=>(CI.copy(r[0],e[0]),CI.copy(r[1],e[1]),r);SI.exports=mee});var MI=S((KAe,TI)=>{var _ee=r=>r[1];TI.exports=_ee});var NI=S((QAe,PI)=>{var zy=Te(),gee=Uy(),yee=(r,e)=>{let t=gee(r,e),n=zy.subtract(zy.create(),e,t);return zy.length(n)};PI.exports=yee});var II=S((eTe,OI)=>{var RI=Te(),xee=(r,e)=>!(!RI.equals(r[1],e[1])||!RI.equals(r[0],e[0]));OI.exports=xee});var nc=S((tTe,DI)=>{var cp=Te(),vee=(r,e,t)=>{let n=cp.normalize(cp.create(),t);return cp.copy(r[0],e),cp.copy(r[1],n),r};DI.exports=vee});var BI=S((nTe,LI)=>{var ro=Te(),{solve2Linear:Vy}=tc(),{EPS:bee}=Lt(),wee=nc(),Eee=(r,e,t)=>{let n=ro.cross(ro.create(),e,t),s=ro.length(n);if(s<bee)throw new Error("parallel planes do not intersect");s=1/s,n=ro.scale(n,n,s);let i=Math.abs(n[0]),o=Math.abs(n[1]),a=Math.abs(n[2]),c,l;return i>=o&&i>=a?(l=Vy(e[1],e[2],t[1],t[2],e[3],t[3]),c=ro.fromValues(0,l[0],l[1])):o>=i&&o>=a?(l=Vy(e[0],e[2],t[0],t[2],e[3],t[3]),c=ro.fromValues(l[0],0,l[1])):(l=Vy(e[0],e[1],t[0],t[1],e[3],t[3]),c=ro.fromValues(l[0],l[1],0)),wee(r,c,n)};LI.exports=Eee});var UI=S((rTe,FI)=>{var kI=Te(),Cee=nc(),See=(r,e,t)=>{let n=kI.subtract(kI.create(),t,e);return Cee(r,e,n)};FI.exports=See});var VI=S((sTe,zI)=>{var rc=Te(),Aee=(r,e)=>{let t=e,n=e[3],s=r[0],i=r[1],o=(n-rc.dot(t,s))/rc.dot(t,i);return rc.add(rc.create(),s,rc.scale(rc.create(),i,o))};zI.exports=Aee});var GI=S((iTe,qI)=>{var Tee=r=>r[0];qI.exports=Tee});var WI=S((oTe,HI)=>{var qy=Te(),Mee=nc(),Pee=(r,e)=>{let t=qy.clone(e[0]),n=qy.negate(qy.create(),e[1]);return Mee(r,t,n)};HI.exports=Pee});var $I=S((aTe,jI)=>{var Nee=r=>{let e=r[0],t=r[1];return`line3: point: (${e[0].toFixed(7)}, ${e[1].toFixed(7)}, ${e[2].toFixed(7)}) direction: (${t[0].toFixed(7)}, ${t[1].toFixed(7)}, ${t[2].toFixed(7)})`};jI.exports=Nee});var YI=S((cTe,XI)=>{var sc=Te(),Ree=nc(),Oee=(r,e,t)=>{let n=e[0],s=e[1],i=sc.add(sc.create(),n,s),o=sc.transform(sc.create(),n,t),a=sc.transform(i,i,t),c=sc.subtract(a,a,o);return Ree(r,o,c)};XI.exports=Oee});var JI=S((lTe,ZI)=>{ZI.exports={clone:wI(),closestPoint:Uy(),copy:AI(),create:Fy(),direction:MI(),distanceToPoint:NI(),equals:II(),fromPlanes:BI(),fromPointAndDirection:nc(),fromPoints:UI(),intersectPointOfLineAndPlane:VI(),origin:GI(),reverse:WI(),toString:$I(),transform:YI()}});var QI=S((uTe,KI)=>{var Iee=(r,e)=>r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3];KI.exports=Iee});var t3=S((hTe,e3)=>{var Dee=(r,e)=>(r[0]=e,r[1]=e,r[2]=e,r[3]=e,r);e3.exports=Dee});var r3=S((dTe,n3)=>{var Lee=(r,e,t)=>{let[n,s,i,o]=e;return r[0]=t[0]*n+t[4]*s+t[8]*i+t[12]*o,r[1]=t[1]*n+t[5]*s+t[9]*i+t[13]*o,r[2]=t[2]*n+t[6]*s+t[10]*i+t[14]*o,r[3]=t[3]*n+t[7]*s+t[11]*i+t[15]*o,r};n3.exports=Lee});var i3=S((pTe,s3)=>{s3.exports={clone:sy(),copy:iy(),create:Fl(),dot:QI(),equals:oy(),fromScalar:t3(),fromValues:ly(),toString:py(),transform:r3()}});var a3=S((fTe,o3)=>{o3.exports={constants:Lt(),line2:ap(),line3:JI(),mat4:At(),plane:Dr(),utils:tc(),vec2:$e(),vec3:Te(),vec4:i3()}});var Gy=S((mTe,u3)=>{var Bee=Be(),c3=ze(),l3=Ve(),kee=gt(),Fee=it(),lp=new WeakMap,Uee=()=>0,zee=r=>{let e=lp.get(r);return e||(e=c3.toSides(r).reduce((n,s)=>n+(s[0][0]*s[1][1]-s[0][1]*s[1][0]),0),e*=.5,lp.set(r,e),e)},Vee=r=>{let e=lp.get(r);return e||(e=l3.toPolygons(r).reduce((n,s)=>n+Fee.measureArea(s),0),lp.set(r,e),e)},qee=(...r)=>{if(r=Bee(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>kee.isA(t)?Uee(t):c3.isA(t)?zee(t):l3.isA(t)?Vee(t):0);return e.length===1?e[0]:e};u3.exports=qee});var d3=S((_Te,h3)=>{var Gee=Be(),Hee=Gy(),Wee=(...r)=>{if(r=Gee(r),r.length===0)throw new Error("measureAggregateArea: no geometries supplied");let e=Hee(r);if(r.length===1)return e;let t=0;return e.reduce((n,s)=>n+s,t)};h3.exports=Wee});var hi=S((gTe,g3)=>{var jee=Be(),Zr=$e(),jl=Te(),f3=ze(),m3=Ve(),_3=gt(),p3=it(),ic=new WeakMap,$ee=r=>{let e=ic.get(r);if(e)return e;let t=_3.toPoints(r),n;t.length===0?n=Zr.create():n=Zr.clone(t[0]);let s=Zr.clone(n);return t.forEach(i=>{Zr.min(n,n,i),Zr.max(s,s,i)}),n=[n[0],n[1],0],s=[s[0],s[1],0],e=[n,s],ic.set(r,e),e},Xee=r=>{let e=ic.get(r);if(e)return e;let t=f3.toPoints(r),n;t.length===0?n=Zr.create():n=Zr.clone(t[0]);let s=Zr.clone(n);return t.forEach(i=>{Zr.min(n,n,i),Zr.max(s,s,i)}),n=[n[0],n[1],0],s=[s[0],s[1],0],e=[n,s],ic.set(r,e),e},Yee=r=>{let e=ic.get(r);if(e)return e;let t=m3.toPolygons(r),n=jl.create();if(t.length>0){let i=p3.toPoints(t[0]);jl.copy(n,i[0])}let s=jl.clone(n);return t.forEach(i=>{p3.toPoints(i).forEach(o=>{jl.min(n,n,o),jl.max(s,s,o)})}),n=[n[0],n[1],n[2]],s=[s[0],s[1],s[2]],e=[n,s],ic.set(r,e),e},Zee=(...r)=>{if(r=jee(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>_3.isA(t)?$ee(t):f3.isA(t)?Xee(t):m3.isA(t)?Yee(t):[[0,0,0],[0,0,0]]);return e.length===1?e[0]:e};g3.exports=Zee});var up=S((yTe,y3)=>{var Jee=Be(),Kee=Xg(),Qee=$g(),ete=hi(),tte=(...r)=>{if(r=Jee(r),r.length===0)throw new Error("measureAggregateBoundingBox: no geometries supplied");let e=ete(r);if(r.length===1)return e;let t=[[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],[-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE]];return e.reduce((n,s)=>(n=[Kee(n[0],n[0],s[0]),Qee(n[1],n[1],s[1])],n),t)};y3.exports=tte});var Hy=S((xTe,x3)=>{var{EPS:nte}=Lt(),rte=(r,e)=>{let t=0;for(let n=0;n<e;n++)t+=r[1][n]-r[0][n];return nte*t/e};x3.exports=rte});var b3=S((vTe,v3)=>{var ste=Be(),ite=up(),ote=Hy(),{geom2:ate,geom3:cte,path2:lte}=sp(),ute=(...r)=>{if(r=ste(r),r.length===0)throw new Error("measureAggregateEpsilon: no geometries supplied");let e=ite(r),t=0;return t=r.reduce((n,s)=>lte.isA(s)||ate.isA(s)?Math.max(n,2):cte.isA(s)?Math.max(n,3):0,t),ote(e,t)};v3.exports=ute});var Wy=S((bTe,C3)=>{var hte=Be(),dte=ze(),E3=Ve(),pte=gt(),fte=it(),w3=new WeakMap,mte=()=>0,_te=()=>0,gte=r=>{let e=w3.get(r);return e||(e=E3.toPolygons(r).reduce((n,s)=>n+fte.measureSignedVolume(s),0),w3.set(r,e),e)},yte=(...r)=>{if(r=hte(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>pte.isA(t)?mte(t):dte.isA(t)?_te(t):E3.isA(t)?gte(t):0);return e.length===1?e[0]:e};C3.exports=yte});var A3=S((wTe,S3)=>{var xte=Be(),vte=Wy(),bte=(...r)=>{if(r=xte(r),r.length===0)throw new Error("measureAggregateVolume: no geometries supplied");let e=vte(r);if(r.length===1)return e;let t=0;return e.reduce((n,s)=>n+s,t)};S3.exports=bte});var I3=S((ETe,O3)=>{var wte=Be(),M3=$e(),Xn=Te(),P3=ze(),N3=Ve(),R3=gt(),T3=it(),oc=new WeakMap,Ete=r=>{let e=oc.get(r);if(e!==void 0)return e;let t=Xn.create(),n=0,s=R3.toPoints(r);if(s.length>0){let i=0,o=Xn.create();s.forEach(a=>{Xn.add(t,t,Xn.fromVec2(o,a,0)),i++}),Xn.scale(t,t,1/i),s.forEach(a=>{n=Math.max(n,M3.squaredDistance(t,a))}),n=Math.sqrt(n)}return e=[t,n],oc.set(r,e),e},Cte=r=>{let e=oc.get(r);if(e!==void 0)return e;let t=Xn.create(),n=0,s=P3.toSides(r);if(s.length>0){let i=0,o=Xn.create();s.forEach(a=>{Xn.add(t,t,Xn.fromVec2(o,a[0],0)),i++}),Xn.scale(t,t,1/i),s.forEach(a=>{n=Math.max(n,M3.squaredDistance(t,a[0]))}),n=Math.sqrt(n)}return e=[t,n],oc.set(r,e),e},Ste=r=>{let e=oc.get(r);if(e!==void 0)return e;let t=Xn.create(),n=0,s=N3.toPolygons(r);if(s.length>0){let i=0;s.forEach(o=>{T3.toPoints(o).forEach(a=>{Xn.add(t,t,a),i++})}),Xn.scale(t,t,1/i),s.forEach(o=>{T3.toPoints(o).forEach(a=>{n=Math.max(n,Xn.squaredDistance(t,a))})}),n=Math.sqrt(n)}return e=[t,n],oc.set(r,e),e},Ate=(...r)=>{r=wte(r);let e=r.map(t=>R3.isA(t)?Ete(t):P3.isA(t)?Cte(t):N3.isA(t)?Ste(t):[[0,0,0],0]);return e.length===1?e[0]:e};O3.exports=Ate});var L3=S((CTe,D3)=>{var Tte=Be(),Mte=hi(),Pte=(...r)=>{r=Tte(r);let e=r.map(t=>{let n=Mte(t);return[n[0][0]+(n[1][0]-n[0][0])/2,n[0][1]+(n[1][1]-n[0][1])/2,n[0][2]+(n[1][2]-n[0][2])/2]});return e.length===1?e[0]:e};D3.exports=Pte});var U3=S((STe,F3)=>{var Nte=Be(),Jr=Te(),B3=ze(),k3=Ve(),hp=new WeakMap,Rte=r=>{let e=hp.get(r);if(e!==void 0)return e;let t=B3.toSides(r),n=0,s=0,i=0;if(t.length>0){for(let a=0;a<t.length;a++){let c=t[a][0],l=t[a][1],u=c[0]*l[1]-c[1]*l[0];n+=u,s+=(c[0]+l[0])*u,i+=(c[1]+l[1])*u}n/=2;let o=1/(n*6);s*=o,i*=o}return e=Jr.fromValues(s,i,0),hp.set(r,e),e},Ote=r=>{let e=hp.get(r);if(e!==void 0)return e;e=Jr.create();let t=k3.toPolygons(r);if(t.length===0)return e;let n=0,s=Jr.create();return t.forEach(i=>{let o=i.vertices;for(let a=0;a<o.length-2;a++){Jr.cross(s,o[a+1],o[a+2]);let c=Jr.dot(o[0],s)/6;n+=c,Jr.add(s,o[0],o[a+1]),Jr.add(s,s,o[a+2]);let l=Jr.scale(s,s,1/4*c);Jr.add(e,e,l)}}),Jr.scale(e,e,1/n),hp.set(r,e),e},Ite=(...r)=>{r=Nte(r);let e=r.map(t=>B3.isA(t)?Rte(t):k3.isA(t)?Ote(t):[0,0,0]);return e.length===1?e[0]:e};F3.exports=Ite});var V3=S((ATe,z3)=>{var Dte=Be(),Lte=hi(),Bte=(...r)=>{r=Dte(r);let e=r.map(t=>{let n=Lte(t);return[n[1][0]-n[0][0],n[1][1]-n[0][1],n[1][2]-n[0][2]]});return e.length===1?e[0]:e};z3.exports=Bte});var Ms=S((TTe,q3)=>{var kte=Be(),{geom2:Fte,geom3:Ute,path2:zte}=sp(),jy=Hy(),$y=hi(),Vte=r=>jy($y(r),2),qte=r=>jy($y(r),2),Gte=r=>jy($y(r),3),Hte=(...r)=>{if(r=kte(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>zte.isA(t)?Vte(t):Fte.isA(t)?qte(t):Ute.isA(t)?Gte(t):0);return e.length===1?e[0]:e};q3.exports=Hte});var H3=S((MTe,G3)=>{G3.exports={measureAggregateArea:d3(),measureAggregateBoundingBox:up(),measureAggregateEpsilon:b3(),measureAggregateVolume:A3(),measureArea:Gy(),measureBoundingBox:hi(),measureBoundingSphere:I3(),measureCenter:L3(),measureCenterOfMass:U3(),measureDimensions:V3(),measureEpsilon:Ms(),measureVolume:Wy()}});var on=S((PTe,W3)=>{var Wte=(r,e)=>Array.isArray(r)&&r.length>=e?r.every(t=>Number.isFinite(t)):!1,jte=(r,e)=>Number.isFinite(r)&&r>e,$te=(r,e)=>Number.isFinite(r)&&r>=e;W3.exports={isNumberArray:Wte,isGT:jte,isGTE:$te}});var X3=S((NTe,$3)=>{var{EPS:j3}=Lt(),Ps=$e(),Xte=gt(),{isGT:Yte,isGTE:Xy,isNumberArray:Zte}=on(),Jte=r=>{let e={center:[0,0],radius:1,startAngle:0,endAngle:Math.PI*2,makeTangent:!1,segments:32},{center:t,radius:n,startAngle:s,endAngle:i,makeTangent:o,segments:a}=Object.assign({},e,r);if(!Zte(t,2))throw new Error("center must be an array of X and Y values");if(!Yte(n,0))throw new Error("radius must be greater than zero");if(!Xy(s,0))throw new Error("startAngle must be positive");if(!Xy(i,0))throw new Error("endAngle must be positive");if(!Xy(a,4))throw new Error("segments must be four or more");s=s%(Math.PI*2),i=i%(Math.PI*2);let c=Math.PI*2;s<i&&(c=i-s),s>i&&(c=i+(Math.PI*2-s));let l=Math.acos((n*n+n*n-j3*j3)/(2*n*n)),u=Ps.clone(t),h,d=[];if(c<l)h=Ps.fromAngleRadians(Ps.create(),s),Ps.scale(h,h,n),Ps.add(h,h,u),d.push(h);else{let p=Math.max(1,Math.floor(a*(c/(Math.PI*2))))+1,_=p*.5/c;_>.25&&(_=.25);let f=o?p+2:p;for(let m=0;m<=f;m++){let g=m;o&&(g=(m-1)*(p-2*_)/p+_,g<0&&(g=0),g>p&&(g=p));let x=s+g*(c/p);h=Ps.fromAngleRadians(Ps.create(),x),Ps.scale(h,h,n),Ps.add(h,h,u),d.push(h)}}return Xte.fromPoints({closed:!1},d)};$3.exports=Jte});var so=S((RTe,Z3)=>{var{NEPS:Kte}=Lt(),Y3=r=>Math.abs(r)<Kte?0:r,Qte=r=>Y3(Math.sin(r)),ene=r=>Y3(Math.cos(r));Z3.exports={sin:Qte,cos:ene}});var Jy=S((OTe,Q3)=>{var{EPS:J3}=Lt(),Yy=$e(),tne=ze(),{sin:nne,cos:rne}=so(),{isGTE:Zy,isNumberArray:K3}=on(),sne=r=>{let e={center:[0,0],radius:[1,1],startAngle:0,endAngle:Math.PI*2,segments:32},{center:t,radius:n,startAngle:s,endAngle:i,segments:o}=Object.assign({},e,r);if(!K3(t,2))throw new Error("center must be an array of X and Y values");if(!K3(n,2))throw new Error("radius must be an array of X and Y values");if(!n.every(p=>p>0))throw new Error("radius values must be greater than zero");if(!Zy(s,0))throw new Error("startAngle must be positive");if(!Zy(i,0))throw new Error("endAngle must be positive");if(!Zy(o,3))throw new Error("segments must be three or more");s=s%(Math.PI*2),i=i%(Math.PI*2);let a=Math.PI*2;s<i&&(a=i-s),s>i&&(a=i+(Math.PI*2-s));let c=Math.min(n[0],n[1]),l=Math.acos((c*c+c*c-J3*J3)/(2*c*c));if(a<l)throw new Error("startAngle and endAngle do not define a significant rotation");o=Math.floor(o*(a/(Math.PI*2)));let u=Yy.clone(t),h=a/o,d=[];o=a<Math.PI*2?o+1:o;for(let p=0;p<o;p++){let _=h*p+s,f=Yy.fromValues(n[0]*rne(_),n[1]*nne(_));Yy.add(f,u,f),d.push(f)}return a<Math.PI*2&&d.push(u),tne.fromPoints(d)};Q3.exports=sne});var Ky=S((ITe,eD)=>{var ine=Jy(),{isGT:one}=on(),ane=r=>{let e={center:[0,0],radius:1,startAngle:0,endAngle:Math.PI*2,segments:32},{center:t,radius:n,startAngle:s,endAngle:i,segments:o}=Object.assign({},e,r);if(!one(n,0))throw new Error("radius must be greater than zero");return n=[n,n],ine({center:t,radius:n,startAngle:s,endAngle:i,segments:o})};eD.exports=ane});var Qy=S((DTe,nD)=>{var cne=Ve(),lne=it(),{isNumberArray:tD}=on(),une=r=>{let e={center:[0,0,0],size:[2,2,2]},{center:t,size:n}=Object.assign({},e,r);if(!tD(t,3))throw new Error("center must be an array of X, Y and Z values");if(!tD(n,3))throw new Error("size must be an array of width, depth and height values");if(!n.every(i=>i>0))throw new Error("size values must be greater than zero");return cne.create([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(i=>{let o=i[0].map(a=>[t[0]+n[0]/2*(2*!!(a&1)-1),t[1]+n[1]/2*(2*!!(a&2)-1),t[2]+n[2]/2*(2*!!(a&4)-1)]);return lne.create(o)}))};nD.exports=une});var sD=S((LTe,rD)=>{var hne=Qy(),{isGT:dne}=on(),pne=r=>{let e={center:[0,0,0],size:2},{center:t,size:n}=Object.assign({},e,r);if(!dne(n,0))throw new Error("size must be greater than zero");return n=[n,n,n],hne({center:t,size:n})};rD.exports=pne});var n0=S((BTe,oD)=>{var{EPS:iD}=Lt(),vn=Te(),fne=Ve(),mne=it(),{sin:_ne,cos:gne}=so(),{isGT:yne,isGTE:e0,isNumberArray:t0}=on(),xne=r=>{let e={center:[0,0,0],height:2,startRadius:[1,1],startAngle:0,endRadius:[1,1],endAngle:Math.PI*2,segments:32},{center:t,height:n,startRadius:s,startAngle:i,endRadius:o,endAngle:a,segments:c}=Object.assign({},e,r);if(!t0(t,3))throw new Error("center must be an array of X, Y and Z values");if(!yne(n,0))throw new Error("height must be greater then zero");if(!t0(s,2))throw new Error("startRadius must be an array of X and Y values");if(!s.every(R=>R>=0))throw new Error("startRadius values must be positive");if(!t0(o,2))throw new Error("endRadius must be an array of X and Y values");if(!o.every(R=>R>=0))throw new Error("endRadius values must be positive");if(o.every(R=>R===0)&&s.every(R=>R===0))throw new Error("at least one radius must be positive");if(!e0(i,0))throw new Error("startAngle must be positive");if(!e0(a,0))throw new Error("endAngle must be positive");if(!e0(c,4))throw new Error("segments must be four or more");i=i%(Math.PI*2),a=a%(Math.PI*2);let l=Math.PI*2;i<a&&(l=a-i),i>a&&(l=a+(Math.PI*2-i));let u=Math.min(s[0],s[1],o[0],o[1]),h=Math.acos((u*u+u*u-iD*iD)/(2*u*u));if(l<h)throw new Error("startAngle and endAngle do not define a significant rotation");let d=Math.floor(c*(l/(Math.PI*2))),p=vn.fromValues(0,0,-(n/2)),_=vn.fromValues(0,0,n/2),f=vn.subtract(vn.create(),_,p),m=vn.fromValues(1,0,0),g=vn.fromValues(0,1,0),x=vn.create(),b=vn.create(),v=vn.create(),y=(R,N,w)=>{let T=N*l+i;return vn.scale(x,m,w[0]*gne(T)),vn.scale(b,g,w[1]*_ne(T)),vn.add(x,x,b),vn.scale(v,f,R),vn.add(v,v,p),vn.add(vn.create(),x,v)},E=(...R)=>{let N=R.map(w=>vn.add(vn.create(),w,t));return mne.create(N)},C=[];for(let R=0;R<d;R++){let N=R/d,w=(R+1)/d;o[0]===s[0]&&o[1]===s[1]?(C.push(E(p,y(0,w,o),y(0,N,o))),C.push(E(y(0,w,o),y(1,w,o),y(1,N,o),y(0,N,o))),C.push(E(_,y(1,N,o),y(1,w,o)))):(s[0]>0&&s[1]>0&&C.push(E(p,y(0,w,s),y(0,N,s))),(s[0]>0||s[1]>0)&&C.push(E(y(0,N,s),y(0,w,s),y(1,N,o))),o[0]>0&&o[1]>0&&C.push(E(_,y(1,N,o),y(1,w,o))),(o[0]>0||o[1]>0)&&C.push(E(y(1,N,o),y(0,w,s),y(1,w,o))))}return l<Math.PI*2&&(C.push(E(p,y(0,0,s),_)),C.push(E(y(0,0,s),y(1,0,o),_)),C.push(E(p,_,y(0,1,s))),C.push(E(y(0,1,s),_,y(1,1,o)))),fne.create(C)};oD.exports=xne});var cD=S((kTe,aD)=>{var vne=n0(),{isGT:bne}=on(),wne=r=>{let e={center:[0,0,0],height:2,radius:1,segments:32},{center:t,height:n,radius:s,segments:i}=Object.assign({},e,r);if(!bne(s,0))throw new Error("radius must be greater than zero");return vne({center:t,height:n,startRadius:[s,s],endRadius:[s,s],segments:i})};aD.exports=wne});var r0=S((FTe,pD)=>{var Me=Te(),Ene=Ve(),lD=it(),{sin:uD,cos:hD}=so(),{isGTE:Cne,isNumberArray:dD}=on(),Sne=r=>{let e={center:[0,0,0],radius:[1,1,1],segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]},{center:t,radius:n,segments:s,axes:i}=Object.assign({},e,r);if(!dD(t,3))throw new Error("center must be an array of X, Y and Z values");if(!dD(n,3))throw new Error("radius must be an array of X, Y and Z values");if(!n.every(_=>_>0))throw new Error("radius values must be greater than zero");if(!Cne(s,4))throw new Error("segments must be four or more");let o=Me.scale(Me.create(),Me.normalize(Me.create(),i[0]),n[0]),a=Me.scale(Me.create(),Me.normalize(Me.create(),i[1]),n[1]),c=Me.scale(Me.create(),Me.normalize(Me.create(),i[2]),n[2]),l=Math.round(s/4),u,h=[],d=Me.create(),p=Me.create();for(let _=0;_<=s;_++){let f=2*Math.PI*_/s,m=Me.add(Me.create(),Me.scale(d,o,hD(f)),Me.scale(p,a,uD(f)));if(_>0){let g,x;for(let b=0;b<=l;b++){let v=.5*Math.PI*b/l,y=hD(v),E=uD(v);if(b>0){let C=[],M;M=Me.subtract(Me.create(),Me.scale(d,u,g),Me.scale(p,c,x)),C.push(Me.add(M,M,t)),M=Me.subtract(Me.create(),Me.scale(d,m,g),Me.scale(p,c,x)),C.push(Me.add(M,M,t)),b<l&&(M=Me.subtract(Me.create(),Me.scale(d,m,y),Me.scale(p,c,E)),C.push(Me.add(M,M,t))),M=Me.subtract(Me.create(),Me.scale(d,u,y),Me.scale(p,c,E)),C.push(Me.add(M,M,t)),h.push(lD.create(C)),C=[],M=Me.add(Me.create(),Me.scale(d,u,g),Me.scale(p,c,x)),C.push(Me.add(Me.create(),t,M)),M=Me.add(M,Me.scale(d,m,g),Me.scale(p,c,x)),C.push(Me.add(Me.create(),t,M)),b<l&&(M=Me.add(M,Me.scale(d,m,y),Me.scale(p,c,E)),C.push(Me.add(Me.create(),t,M))),M=Me.add(M,Me.scale(d,u,y),Me.scale(p,c,E)),C.push(Me.add(Me.create(),t,M)),C.reverse(),h.push(lD.create(C))}g=y,x=E}}u=m}return Ene.create(h)};pD.exports=Sne});var s0=S((UTe,mD)=>{var Ane=Ve(),Tne=it(),{isNumberArray:fD}=on(),Mne=r=>{let e={points:[],faces:[],colors:void 0,orientation:"outward"},{points:t,faces:n,colors:s,orientation:i}=Object.assign({},e,r);if(!(Array.isArray(t)&&Array.isArray(n)))throw new Error("points and faces must be arrays");if(t.length<3)throw new Error("three or more points are required");if(n.length<1)throw new Error("one or more faces are required");if(s){if(!Array.isArray(s))throw new Error("colors must be an array");if(s.length!==n.length)throw new Error("faces and colors must have the same length")}t.forEach((a,c)=>{if(!fD(a,3))throw new Error(`point ${c} must be an array of X, Y, Z values`)}),n.forEach((a,c)=>{if(a.length<3)throw new Error(`face ${c} must contain 3 or more indexes`);if(!fD(a,a.length))throw new Error(`face ${c} must be an array of numbers`)}),i!=="outward"&&n.forEach(a=>a.reverse());let o=n.map((a,c)=>{let l=Tne.create(a.map(u=>t[u]));return s&&s[c]&&(l.color=s[c]),l});return Ane.create(o)};mD.exports=Mne});var yD=S((zTe,gD)=>{var _D=At(),Pne=Ve(),Nne=s0(),{isGT:Rne,isGTE:One}=on(),Ine=r=>{let e={radius:1,frequency:6},{radius:t,frequency:n}=Object.assign({},e,r);if(!Rne(t,0))throw new Error("radius must be greater than zero");if(!One(n,6))throw new Error("frequency must be six or more");n=Math.floor(n/6);let s=[[.850651,0,-.525731],[.850651,-0,.525731],[-.850651,-0,.525731],[-.850651,0,-.525731],[0,-.525731,.850651],[0,.525731,.850651],[0,.525731,-.850651],[0,-.525731,-.850651],[-.525731,-.850651,-0],[.525731,-.850651,-0],[.525731,.850651,0],[-.525731,.850651,0]],i=[[0,9,1],[1,10,0],[6,7,0],[10,6,0],[7,9,0],[5,1,4],[4,1,9],[5,10,1],[2,8,3],[3,11,2],[2,5,4],[4,8,2],[2,11,5],[3,7,6],[6,11,3],[8,7,3],[9,8,4],[11,10,5],[10,11,6],[8,9,7]],o=(d,p,_)=>{let f=d[0],m=d[1],g=d[2],x=_,b=[],v=[];for(let y=0;y<p;y++)for(let E=0;E<p-y;E++){let C=y/p,M=(y+1)/p,R=E/(p-y),N=(E+1)/(p-y),w=p-y-1?E/(p-y-1):1,T=[];T[0]=a(a(f,m,R),g,C),T[1]=a(a(f,m,N),g,C),T[2]=a(a(f,m,w),g,M);for(let F=0;F<3;F++){let L=Math.hypot(T[F][0],T[F][1],T[F][2]);for(let V=0;V<3;V++)T[F][V]/=L}if(b.push(T[0],T[1],T[2]),v.push([x,x+1,x+2]),x+=3,E<p-y-1){let F=p-y-1?(E+1)/(p-y-1):1;T[0]=a(a(f,m,N),g,C),T[1]=a(a(f,m,F),g,M),T[2]=a(a(f,m,w),g,M);for(let L=0;L<3;L++){let V=Math.hypot(T[L][0],T[L][1],T[L][2]);for(let B=0;B<3;B++)T[L][B]/=V}b.push(T[0],T[1],T[2]),v.push([x,x+1,x+2]),x+=3}}return{points:b,triangles:v,offset:x}},a=(d,p,_)=>{let f=1-_,m=[];for(let g=0;g<3;g++)m[g]=d[g]*f+p[g]*_;return m},c=[],l=[],u=0;for(let d=0;d<i.length;d++){let p=o([s[i[d][0]],s[i[d][1]],s[i[d][2]]],n,u);c=c.concat(p.points),l=l.concat(p.triangles),u=p.offset}let h=Nne({points:c,faces:l,orientation:"inward"});return t!==1&&(h=Pne.transform(_D.fromScaling(_D.create(),[t,t,t]),h)),h};gD.exports=Ine});var vD=S((VTe,xD)=>{var Dne=gt(),Lne=r=>{if(!Array.isArray(r))throw new Error("points must be an array");return Dne.fromPoints({},r)};xD.exports=Lne});var wD=S((qTe,bD)=>{var i0=ze(),Bne=r=>{let e={points:[],paths:[]},{points:t,paths:n}=Object.assign({},e,r);if(!(Array.isArray(t)&&Array.isArray(n)))throw new Error("points and paths must be arrays");let s=t;Array.isArray(t[0])&&(Array.isArray(t[0][0])||(s=[t])),s.forEach((c,l)=>{if(!Array.isArray(c))throw new Error("list of points "+l+" must be an array");if(c.length<3)throw new Error("list of points "+l+" must contain three or more points");c.forEach((u,h)=>{if(!Array.isArray(u))throw new Error("list of points "+l+", point "+h+" must be an array");if(u.length<2)throw new Error("list of points "+l+", point "+h+" must contain by X and Y values")})});let i=n;if(n.length===0){let c=0;i=s.map(l=>l.map(u=>c++))}let o=[];s.forEach(c=>c.forEach(l=>o.push(l)));let a=[];return i.forEach(c=>{let l=c.map(h=>o[h]),u=i0.fromPoints(l);a=a.concat(i0.toSides(u))}),i0.create(a)};bD.exports=Bne});var o0=S((GTe,CD)=>{var di=$e(),kne=ze(),{isNumberArray:ED}=on(),Fne=r=>{let e={center:[0,0],size:[2,2]},{center:t,size:n}=Object.assign({},e,r);if(!ED(t,2))throw new Error("center must be an array of X and Y values");if(!ED(n,2))throw new Error("size must be an array of X and Y values");if(!n.every(a=>a>0))throw new Error("size values must be greater than zero");let s=[n[0]/2,n[1]/2],i=[s[0],-s[1]],o=[di.subtract(di.create(),t,s),di.add(di.create(),t,i),di.add(di.create(),t,s),di.subtract(di.create(),t,i)];return kne.fromPoints(o)};CD.exports=Fne});var ND=S((HTe,PD)=>{var{EPS:dp}=Lt(),a0=$e(),Jt=Te(),Une=Ve(),ac=it(),{isGT:zne,isGTE:Vne,isNumberArray:SD}=on(),AD=(r,e,t,n,s,i)=>{let o=Math.PI/2*s/n,a=Math.cos(o),c=Math.sin(o),l=n-s,u=t*a,h=e[2]-(t-t*c);i||(h=t-t*c-e[2]),u=u>dp?u:0;let d=Jt.add(Jt.create(),r,[e[0]-t,e[1]-t,h]),p=Jt.add(Jt.create(),r,[t-e[0],e[1]-t,h]),_=Jt.add(Jt.create(),r,[t-e[0],t-e[1],h]),f=Jt.add(Jt.create(),r,[e[0]-t,t-e[1],h]),m=[],g=[],x=[],b=[];for(let v=0;v<=l;v++){let y=l>0?Math.PI/2*v/l:0,E=a0.fromAngleRadians(a0.create(),y);a0.scale(E,E,u);let C=Jt.fromVec2(Jt.create(),E);m.push(Jt.add(Jt.create(),d,C)),Jt.rotateZ(C,C,[0,0,0],Math.PI/2),g.push(Jt.add(Jt.create(),p,C)),Jt.rotateZ(C,C,[0,0,0],Math.PI/2),x.push(Jt.add(Jt.create(),_,C)),Jt.rotateZ(C,C,[0,0,0],Math.PI/2),b.push(Jt.add(Jt.create(),f,C))}return i?[m,g,x,b]:(m.reverse(),g.reverse(),x.reverse(),b.reverse(),[b,x,g,m])},TD=(r,e)=>{let t=[];for(let n=0;n<r.length;n++){let s=r[n],i=e[n];for(let o=0;o<s.length-1;o++)t.push(ac.create([s[o],s[o+1],i[o]])),o<i.length-1&&t.push(ac.create([i[o],s[o+1],i[o+1]]))}return t},MD=(r,e)=>{let t=[];for(let n=0;n<r.length;n++){let s=r[n],i=e[n],o=s[s.length-1],a=i[i.length-1],c=(n+1)%r.length;s=r[c],i=e[c];let l=s[0],u=i[0];t.push(ac.create([o,l,u,a]))}return t},qne=(r,e)=>{r=[r[3],r[2],r[1],r[0]],r=r.map(i=>i.slice().reverse());let t=[];r.forEach(i=>{i.forEach(o=>t.push(o))});let n=[];e.forEach(i=>{i.forEach(o=>n.push(o))});let s=[];for(let i=0;i<n.length;i++){let o=(i+1)%n.length;s.push(ac.create([t[i],t[o],n[o],n[i]]))}return s},Gne=r=>{let e={center:[0,0,0],size:[2,2,2],roundRadius:.2,segments:32},{center:t,size:n,roundRadius:s,segments:i}=Object.assign({},e,r);if(!SD(t,3))throw new Error("center must be an array of X, Y and Z values");if(!SD(n,3))throw new Error("size must be an array of X, Y and Z values");if(!n.every(l=>l>0))throw new Error("size values must be greater than zero");if(!zne(s,0))throw new Error("roundRadius must be greater than zero");if(!Vne(i,4))throw new Error("segments must be four or more");if(n=n.map(l=>l/2),s>n[0]-dp||s>n[1]-dp||s>n[2]-dp)throw new Error("roundRadius must be smaller then the radius of all dimensions");i=Math.floor(i/4);let o=null,a=null,c=[];for(let l=0;l<=i;l++){let u=AD(t,n,s,i,l,!0),h=AD(t,n,s,i,l,!1);if(l===0&&(c=c.concat(qne(h,u))),o&&(c=c.concat(TD(o,u),MD(o,u))),a&&(c=c.concat(TD(a,h),MD(a,h))),l===i){let d=u.map(p=>p[0]);c.push(ac.create(d)),d=h.map(p=>p[0]),c.push(ac.create(d))}o=u,a=h}return Une.create(c)};PD.exports=Gne});var LD=S((WTe,DD)=>{var{EPS:RD}=Lt(),_e=Te(),Hne=Ve(),Wne=it(),{sin:OD,cos:ID}=so(),{isGT:c0,isGTE:jne,isNumberArray:$ne}=on(),Xne=r=>{let e={center:[0,0,0],height:2,radius:1,roundRadius:.2,segments:32},{center:t,height:n,radius:s,roundRadius:i,segments:o}=Object.assign({},e,r);if(!$ne(t,3))throw new Error("center must be an array of X, Y and Z values");if(!c0(n,0))throw new Error("height must be greater then zero");if(!c0(s,0))throw new Error("radius must be greater then zero");if(!c0(i,0))throw new Error("roundRadius must be greater then zero");if(i>s-RD)throw new Error("roundRadius must be smaller then the radius");if(!jne(o,4))throw new Error("segments must be four or more");let a=[0,0,-(n/2)],c=[0,0,n/2],l=_e.subtract(_e.create(),c,a),u=_e.length(l);if(2*i>u-RD)throw new Error("height must be larger than twice roundRadius");let h;Math.abs(l[0])>Math.abs(l[1])?h=_e.fromValues(0,1,0):h=_e.fromValues(1,0,0);let d=_e.scale(_e.create(),_e.normalize(_e.create(),l),i),p=_e.scale(_e.create(),_e.normalize(_e.create(),_e.cross(_e.create(),d,h)),s),_=_e.scale(_e.create(),_e.normalize(_e.create(),_e.cross(_e.create(),p,d)),s);_e.add(a,a,d),_e.subtract(c,c,d);let f=Math.floor(.25*o),m=E=>{let C=E.map(M=>_e.add(M,M,t));return Wne.create(C)},g=[],x=_e.create(),b=_e.create(),v;for(let E=0;E<=o;E++){let C=2*Math.PI*E/o,M=_e.add(_e.create(),_e.scale(x,p,ID(C)),_e.scale(b,_,OD(C)));if(E>0){let R=[];R.push(_e.add(_e.create(),a,M)),R.push(_e.add(_e.create(),a,v)),R.push(_e.add(_e.create(),c,v)),R.push(_e.add(_e.create(),c,M)),g.push(m(R));let N,w;for(let T=0;T<=f;T++){let F=.5*Math.PI*T/f,L=ID(F),V=OD(F);if(T>0){R=[];let B;B=_e.add(_e.create(),a,_e.subtract(x,_e.scale(x,v,N),_e.scale(b,d,w))),R.push(B),B=_e.add(_e.create(),a,_e.subtract(x,_e.scale(x,M,N),_e.scale(b,d,w))),R.push(B),T<f&&(B=_e.add(_e.create(),a,_e.subtract(x,_e.scale(x,M,L),_e.scale(b,d,V))),R.push(B)),B=_e.add(_e.create(),a,_e.subtract(x,_e.scale(x,v,L),_e.scale(b,d,V))),R.push(B),g.push(m(R)),R=[],B=_e.add(_e.create(),_e.scale(x,v,N),_e.scale(b,d,w)),_e.add(B,B,c),R.push(B),B=_e.add(_e.create(),_e.scale(x,M,N),_e.scale(b,d,w)),_e.add(B,B,c),R.push(B),T<f&&(B=_e.add(_e.create(),_e.scale(x,M,L),_e.scale(b,d,V)),_e.add(B,B,c),R.push(B)),B=_e.add(_e.create(),_e.scale(x,v,L),_e.scale(b,d,V)),_e.add(B,B,c),R.push(B),R.reverse(),g.push(m(R))}N=L,w=V}}v=M}return Hne.create(g)};DD.exports=Xne});var UD=S((jTe,FD)=>{var{EPS:BD}=Lt(),Bt=$e(),Yne=ze(),{isGT:Zne,isGTE:Jne,isNumberArray:kD}=on(),Kne=r=>{let e={center:[0,0],size:[2,2],roundRadius:.2,segments:32},{center:t,size:n,roundRadius:s,segments:i}=Object.assign({},e,r);if(!kD(t,2))throw new Error("center must be an array of X and Y values");if(!kD(n,2))throw new Error("size must be an array of X and Y values");if(!n.every(f=>f>0))throw new Error("size values must be greater than zero");if(!Zne(s,0))throw new Error("roundRadius must be greater than zero");if(!Jne(i,4))throw new Error("segments must be four or more");if(n=n.map(f=>f/2),s>n[0]-BD||s>n[1]-BD)throw new Error("roundRadius must be smaller then the radius of all dimensions");let o=Math.floor(i/4),a=Bt.add(Bt.create(),t,[n[0]-s,n[1]-s]),c=Bt.add(Bt.create(),t,[s-n[0],n[1]-s]),l=Bt.add(Bt.create(),t,[s-n[0],s-n[1]]),u=Bt.add(Bt.create(),t,[n[0]-s,s-n[1]]),h=[],d=[],p=[],_=[];for(let f=0;f<=o;f++){let m=Math.PI/2*f/o,g=Bt.fromAngleRadians(Bt.create(),m);Bt.scale(g,g,s),h.push(Bt.add(Bt.create(),a,g)),Bt.rotate(g,g,Bt.create(),Math.PI/2),d.push(Bt.add(Bt.create(),c,g)),Bt.rotate(g,g,Bt.create(),Math.PI/2),p.push(Bt.add(Bt.create(),l,g)),Bt.rotate(g,g,Bt.create(),Math.PI/2),_.push(Bt.add(Bt.create(),u,g))}return Yne.fromPoints(h.concat(d,p,_))};FD.exports=Kne});var l0=S(($Te,zD)=>{var Qne=r0(),{isGT:ere}=on(),tre=r=>{let e={center:[0,0,0],radius:1,segments:32,axes:[[1,0,0],[0,-1,0],[0,0,1]]},{center:t,radius:n,segments:s,axes:i}=Object.assign({},e,r);if(!ere(n,0))throw new Error("radius must be greater than zero");return n=[n,n,n],Qne({center:t,radius:n,segments:s,axes:i})};zD.exports=tre});var qD=S((XTe,VD)=>{var nre=o0(),{isGT:rre}=on(),sre=r=>{let e={center:[0,0],size:2},{center:t,size:n}=Object.assign({},e,r);if(!rre(n,0))throw new Error("size must be greater than zero");return n=[n,n],nre({center:t,size:n})};VD.exports=sre});var WD=S((YTe,HD)=>{var $l=$e(),ire=ze(),{isGT:ore,isGTE:pp,isNumberArray:are}=on(),cre=(r,e)=>r>0&&e>1&&e<r/2?Math.cos(Math.PI*e/r)/Math.cos(Math.PI*(e-1)/r):0,GD=(r,e,t,n)=>{let s=Math.PI*2/r,i=[];for(let o=0;o<r;o++){let a=$l.fromAngleRadians($l.create(),s*o+t);$l.scale(a,a,e),$l.add(a,n,a),i.push(a)}return i},lre=r=>{let e={center:[0,0],vertices:5,outerRadius:1,innerRadius:0,density:2,startAngle:0},{center:t,vertices:n,outerRadius:s,innerRadius:i,density:o,startAngle:a}=Object.assign({},e,r);if(!are(t,2))throw new Error("center must be an array of X and Y values");if(!pp(n,2))throw new Error("vertices must be two or more");if(!ore(s,0))throw new Error("outerRadius must be greater than zero");if(!pp(i,0))throw new Error("innerRadius must be greater than zero");if(!pp(a,0))throw new Error("startAngle must be greater than zero");if(n=Math.floor(n),o=Math.floor(o),a=a%(Math.PI*2),i===0){if(!pp(o,2))throw new Error("density must be two or more");i=s*cre(n,o)}let c=$l.clone(t),l=GD(n,s,a,c),u=GD(n,i,a+Math.PI/n,c),h=[];for(let d=0;d<n;d++)h.push(l[d]),h.push(u[d]);return ire.fromPoints(h)};HD.exports=lre});var cc=S((ZTe,JD)=>{var ure=Be(),jD=At(),$D=Dr(),XD=ze(),YD=Ve(),ZD=gt(),fp=(r,...e)=>{let t={origin:[0,0,0],normal:[0,0,1]},{origin:n,normal:s}=Object.assign({},t,r);if(e=ure(e),e.length===0)throw new Error("wrong number of arguments");let i=$D.fromNormalAndPoint($D.create(),s,n);if(Number.isNaN(i[0]))throw new Error("the given origin and normal do not define a proper plane");let o=jD.mirrorByPlane(jD.create(),i),a=e.map(c=>ZD.isA(c)?ZD.transform(o,c):XD.isA(c)?XD.transform(o,c):YD.isA(c)?YD.transform(o,c):c);return a.length===1?a[0]:a},hre=(...r)=>fp({normal:[1,0,0]},r),dre=(...r)=>fp({normal:[0,1,0]},r),pre=(...r)=>fp({normal:[0,0,1]},r);JD.exports={mirror:fp,mirrorX:hre,mirrorY:dre,mirrorZ:pre}});var u0=S((JTe,QD)=>{var KD=Dr(),io=Te(),fre=r=>{let e=r.edges;if(e.length<3)throw new Error("slices must have 3 or more edges to calculate a plane");let t=e.reduce((o,a)=>io.add(io.create(),o,a[0]),io.create());io.scale(t,t,1/e.length);let n,s=0;e.forEach(o=>{if(!io.equals(o[0],o[1])){let a=io.squaredDistance(t,o[0]);a>s&&(n=o,s=a)}});let i=e.find(o=>io.equals(o[1],n[0]));return KD.fromPoints(KD.create(),i[0],n[0],n[1])};QD.exports=fre});var oo=S((KTe,eL)=>{var mre=r=>(r||(r=[]),{edges:r});eL.exports=mre});var rL=S((QTe,nL)=>{var _re=oo(),tL=Te(),gre=(...r)=>{let e,t;return r.length===1?(e=_re(),t=r[0]):(e=r[0],t=r[1]),e.edges=t.edges.map(n=>[tL.clone(n[0]),tL.clone(n[1])]),e};nL.exports=gre});var iL=S((eMe,sL)=>{var yre=Te(),xre=(r,e)=>{let t=r.edges,n=e.edges;return t.length!==n.length?!1:t.reduce((i,o,a)=>{let c=n[a],l=yre.squaredDistance(o[0],c[0]);return i&&l<Number.EPSILON},!0)};sL.exports=xre});var aL=S((tMe,oL)=>{var mp=Te(),vre=oo(),bre=r=>{if(!Array.isArray(r))throw new Error("the given points must be an array");if(r.length<3)throw new Error("the given points must contain THREE or more points");let e=[],t=r[r.length-1];return r.forEach(n=>{n.length===2&&e.push([mp.fromVec2(mp.create(),t),mp.fromVec2(mp.create(),n)]),n.length===3&&e.push([t,n]),t=n}),vre(e)};oL.exports=bre});var lL=S((nMe,cL)=>{var _p=Te(),wre=oo(),Ere=r=>{if(!Array.isArray(r))throw new Error("the given sides must be an array");let e=[];return r.forEach(t=>{e.push([_p.fromVec2(_p.create(),t[0]),_p.fromVec2(_p.create(),t[1])])}),wre(e)};cL.exports=Ere});var hL=S((rMe,uL)=>{var Cre=r=>!!(r&&typeof r=="object"&&"edges"in r&&Array.isArray(r.edges));uL.exports=Cre});var pL=S((sMe,dL)=>{var Sre=oo(),Are=(...r)=>{let e,t;return r.length===1?(e=Sre(),t=r[0]):(e=r[0],t=r[1]),e.edges=t.edges.map(n=>[n[1],n[0]]),e};dL.exports=Are});var mL=S((iMe,fL)=>{var Tre=r=>r.edges;fL.exports=Tre});var gL=S((oMe,_L)=>{var Mre=(r,e)=>{let t,n,s,i,o,a=1;do{n=r,r=null;let c=null;for(o=0;n;){o++,s=n;let l=0;for(t=0;t<a&&(l++,s=s.nextZ,!!s);t++);let u=a;for(;l>0||u>0&&s;)l!==0&&(u===0||!s||e(n)<=e(s))?(i=n,n=n.nextZ,l--):(i=s,s=s.nextZ,u--),c?c.nextZ=i:r=i,i.prevZ=c,c=i;n=s}c.nextZ=null,a*=2}while(o>1);return r};_L.exports=Mre});var d0=S((aMe,yL)=>{var Pre=gL(),h0=class{constructor(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}},Nre=(r,e,t,n)=>{let s=new h0(r,e,t);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s},Rre=r=>{r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)};yL.exports={Node:h0,insertNode:Nre,removeNode:Rre,sortLinked:Pre}});var gp=S((cMe,xL)=>{var Ore=(r,e,t,n,s,i,o,a)=>(s-o)*(e-a)-(r-o)*(i-a)>=0&&(r-o)*(n-a)-(t-o)*(e-a)>=0&&(t-o)*(i-a)-(s-o)*(n-a)>=0,Ire=(r,e,t)=>(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y);xL.exports={area:Ire,pointInTriangle:Ore}});var p0=S((lMe,CL)=>{var{Node:vL,insertNode:bL,removeNode:xp}=d0(),{area:Yn}=gp(),Dre=(r,e,t,n,s)=>{let i;if(s===zre(r,e,t,n)>0)for(let o=e;o<t;o+=n)i=bL(o,r[o],r[o+1],i);else for(let o=t-n;o>=e;o-=n)i=bL(o,r[o],r[o+1],i);return i&&vp(i,i.next)&&(xp(i),i=i.next),i},wL=(r,e)=>{if(!r)return r;e||(e=r);let t=r,n;do if(n=!1,!t.steiner&&(vp(t,t.next)||Yn(t.prev,t,t.next)===0)){if(xp(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e},Lre=(r,e,t)=>{let n=r;do{let s=n.prev,i=n.next.next;!vp(s,i)&&EL(s,n,n.next,i)&&Xl(s,i)&&Xl(i,s)&&(e.push(s.i/t),e.push(n.i/t),e.push(i.i/t),xp(n),xp(n.next),n=r=i),n=n.next}while(n!==r);return wL(n)},Bre=(r,e)=>{let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&EL(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1},Xl=(r,e)=>Yn(r.prev,r,r.next)<0?Yn(r,e,r.next)>=0&&Yn(r,r.prev,e)>=0:Yn(r,e,r.prev)<0||Yn(r,r.next,e)<0,kre=(r,e)=>{let t=r,n=!1,s=(r.x+e.x)/2,i=(r.y+e.y)/2;do t.y>i!=t.next.y>i&&t.next.y!==t.y&&s<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n},Fre=(r,e)=>{let t=new vL(r.i,r.x,r.y),n=new vL(e.i,e.x,e.y),s=r.next,i=e.prev;return r.next=e,e.prev=r,t.next=s,s.prev=t,n.next=t,t.prev=n,i.next=n,n.prev=i,n},Ure=(r,e)=>r.next.i!==e.i&&r.prev.i!==e.i&&!Bre(r,e)&&(Xl(r,e)&&Xl(e,r)&&kre(r,e)&&(Yn(r.prev,r,e.prev)||Yn(r,e.prev,e))||vp(r,e)&&Yn(r.prev,r,r.next)>0&&Yn(e.prev,e,e.next)>0),EL=(r,e,t,n)=>{let s=Math.sign(Yn(r,e,t)),i=Math.sign(Yn(r,e,n)),o=Math.sign(Yn(t,n,r)),a=Math.sign(Yn(t,n,e));return!!(s!==i&&o!==a||s===0&&yp(r,t,e)||i===0&&yp(r,n,e)||o===0&&yp(t,r,n)||a===0&&yp(t,e,n))},yp=(r,e,t)=>e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y),zre=(r,e,t,n)=>{let s=0;for(let i=e,o=t-n;i<t;i+=n)s+=(r[o]-r[i])*(r[i+1]+r[o+1]),o=i;return s},vp=(r,e)=>r.x===e.x&&r.y===e.y;CL.exports={cureLocalIntersections:Lre,filterPoints:wL,isValidDiagonal:Ure,linkedPolygon:Dre,locallyInside:Xl,splitPolygon:Fre}});var TL=S((uMe,AL)=>{var{filterPoints:f0,linkedPolygon:Vre,locallyInside:qre,splitPolygon:Gre}=p0(),{area:SL,pointInTriangle:Hre}=gp(),Wre=(r,e,t,n)=>{let s=[];for(let i=0,o=e.length;i<o;i++){let a=e[i]*n,c=i<o-1?e[i+1]*n:r.length,l=Vre(r,a,c,n,!1);l===l.next&&(l.steiner=!0),s.push(Yre(l))}s.sort((i,o)=>i.x-o.x);for(let i=0;i<s.length;i++)t=jre(s[i],t),t=f0(t,t.next);return t},jre=(r,e)=>{let t=$re(r,e);if(!t)return e;let n=Gre(t,r),s=f0(t,t.next);return f0(n,n.next),e===t?s:e},$re=(r,e)=>{let t=e,n=r.x,s=r.y,i=-1/0,o;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){let h=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(h<=n&&h>i){if(i=h,h===n){if(s===t.y)return t;if(s===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(n===i)return o;let a=o,c=o.x,l=o.y,u=1/0;t=o;do{if(n>=t.x&&t.x>=c&&n!==t.x&&Hre(s<l?n:i,s,c,l,s<l?i:n,s,t.x,t.y)){let h=Math.abs(s-t.y)/(n-t.x);qre(t,r)&&(h<u||h===u&&(t.x>o.x||t.x===o.x&&Xre(o,t)))&&(o=t,u=h)}t=t.next}while(t!==a);return o},Xre=(r,e)=>SL(r.prev,r,e.prev)<0&&SL(e.next,r,r.next)<0,Yre=r=>{let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t};AL.exports=Wre});var PL=S((hMe,ML)=>{var Zre=TL(),{removeNode:Jre,sortLinked:Kre}=d0(),{cureLocalIntersections:Qre,filterPoints:bp,isValidDiagonal:ese,linkedPolygon:tse,splitPolygon:nse}=p0(),{area:ao,pointInTriangle:Yl}=gp(),rse=(r,e,t=2)=>{let n=e&&e.length,s=n?e[0]*t:r.length,i=tse(r,0,s,t,!0),o=[];if(!i||i.next===i.prev)return o;let a,c,l,u,h;if(n&&(i=Zre(r,e,i,t)),r.length>80*t){a=l=r[0],c=u=r[1];for(let d=t;d<s;d+=t){let p=r[d],_=r[d+1];p<a&&(a=p),_<c&&(c=_),p>l&&(l=p),_>u&&(u=_)}h=Math.max(l-a,u-c),h=h!==0?1/h:0}return Zl(i,o,t,a,c,h),o},Zl=(r,e,t,n,s,i,o)=>{if(!r)return;!o&&i&&ase(r,n,s,i);let a=r,c,l;for(;r.prev!==r.next;){if(c=r.prev,l=r.next,i?ise(r,n,s,i):sse(r)){e.push(c.i/t),e.push(r.i/t),e.push(l.i/t),Jre(r),r=l.next,a=l.next;continue}if(r=l,r===a){o?o===1?(r=Qre(bp(r),e,t),Zl(r,e,t,n,s,i,2)):o===2&&ose(r,e,t,n,s,i):Zl(bp(r),e,t,n,s,i,1);break}}},sse=r=>{let e=r.prev,t=r,n=r.next;if(ao(e,t,n)>=0)return!1;let s=r.next.next;for(;s!==r.prev;){if(Yl(e.x,e.y,t.x,t.y,n.x,n.y,s.x,s.y)&&ao(s.prev,s,s.next)>=0)return!1;s=s.next}return!0},ise=(r,e,t,n)=>{let s=r.prev,i=r,o=r.next;if(ao(s,i,o)>=0)return!1;let a=s.x<i.x?s.x<o.x?s.x:o.x:i.x<o.x?i.x:o.x,c=s.y<i.y?s.y<o.y?s.y:o.y:i.y<o.y?i.y:o.y,l=s.x>i.x?s.x>o.x?s.x:o.x:i.x>o.x?i.x:o.x,u=s.y>i.y?s.y>o.y?s.y:o.y:i.y>o.y?i.y:o.y,h=m0(a,c,e,t,n),d=m0(l,u,e,t,n),p=r.prevZ,_=r.nextZ;for(;p&&p.z>=h&&_&&_.z<=d;){if(p!==r.prev&&p!==r.next&&Yl(s.x,s.y,i.x,i.y,o.x,o.y,p.x,p.y)&&ao(p.prev,p,p.next)>=0||(p=p.prevZ,_!==r.prev&&_!==r.next&&Yl(s.x,s.y,i.x,i.y,o.x,o.y,_.x,_.y)&&ao(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;p&&p.z>=h;){if(p!==r.prev&&p!==r.next&&Yl(s.x,s.y,i.x,i.y,o.x,o.y,p.x,p.y)&&ao(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;_&&_.z<=d;){if(_!==r.prev&&_!==r.next&&Yl(s.x,s.y,i.x,i.y,o.x,o.y,_.x,_.y)&&ao(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0},ose=(r,e,t,n,s,i)=>{let o=r;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&ese(o,a)){let c=nse(o,a);o=bp(o,o.next),c=bp(c,c.next),Zl(o,e,t,n,s,i),Zl(c,e,t,n,s,i);return}a=a.next}o=o.next}while(o!==r)},ase=(r,e,t,n)=>{let s=r;do s.z===null&&(s.z=m0(s.x,s.y,e,t,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,Kre(s,i=>i.z)},m0=(r,e,t,n,s)=>(r=32767*(r-t)*s,e=32767*(e-n)*s,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1);ML.exports=rse});var RL=S((dMe,NL)=>{var{area:cse}=tc(),{toOutlines:lse}=ze(),{arePointsInside:use}=rp(),hse=r=>{let e=lse(r),t=[],n=[];e.forEach((o,a)=>{let c=cse(o);c<0?n.push(a):c>0&&t.push(a)});let s=[],i=[];return t.forEach((o,a)=>{let c=e[o];s[a]=[],n.forEach((l,u)=>{let h=e[l];use([h[0]],{vertices:c})&&(s[a].push(l),i[u]||(i[u]=[]),i[u].push(a))})}),n.forEach((o,a)=>{if(i[a]&&i[a].length>1){let c=dse(i[a],l=>s[l].length);i[a].forEach((l,u)=>{u!==c&&(s[l]=s[l].filter(h=>h!==o))})}}),s.map((o,a)=>({solid:e[t[a]],holes:o.map(c=>e[c])}))},dse=(r,e)=>{let t,n;return r.forEach((s,i)=>{let o=e(s);(n===void 0||o<n)&&(t=i,n=o)}),t};NL.exports=hse});var LL=S((pMe,DL)=>{var pse=ze(),OL=Dr(),fse=$e(),Cn=Te(),mse=u0(),_se=RL(),IL=class{constructor(e){this.plane=mse(e);let t=Cn.orthogonal(Cn.create(),this.plane),n=Cn.cross(Cn.create(),this.plane,t);this.v=Cn.normalize(n,n),this.u=Cn.cross(Cn.create(),this.v,this.plane),this.basisMap=new Map;let s=e.edges.map(o=>o.map(a=>this.to2D(a))),i=pse.create(s);this.roots=_se(i)}to2D(e){let t=fse.fromValues(Cn.dot(e,this.u),Cn.dot(e,this.v));return this.basisMap.set(t,e),t}to3D(e){let t=this.basisMap.get(e);if(t)return t;{console.log("Warning: point not in original slice");let n=Cn.scale(Cn.create(),this.u,e[0]),s=Cn.scale(Cn.create(),this.v,e[1]),i=Cn.scale(Cn.create(),OL,OL[3]),o=Cn.add(n,n,i);return Cn.add(s,s,o)}}};DL.exports=IL});var kL=S((fMe,BL)=>{var gse=it(),yse=PL(),xse=LL(),vse=r=>{let e=new xse(r),t=[];return e.roots.forEach(({solid:n,holes:s})=>{let i=n.length,o=[];s.forEach((h,d)=>{o.push(i),i+=h.length});let a=[n,...s].flat(),c=a.flat(),l=h=>e.to3D(a[h]),u=yse(c,o);for(let h=0;h<u.length;h+=3){let d=u.slice(h,h+3).map(l);t.push(gse.fromPointsAndPlane(d,e.plane))}}),t};BL.exports=vse});var zL=S((mMe,UL)=>{var FL=Te(),bse=r=>r.reduce((e,t)=>e+=`[${FL.toString(t[0])}, ${FL.toString(t[1])}], `,""),wse=r=>`[${bse(r.edges)}]`;UL.exports=wse});var qL=S((_Me,VL)=>{var wp=Te(),Ese=oo(),Cse=(r,e)=>{let t=e.edges.map(n=>[wp.transform(wp.create(),n[0],r),wp.transform(wp.create(),n[1],r)]);return Ese(t)};VL.exports=Cse});var lc=S((gMe,GL)=>{GL.exports={calculatePlane:u0(),clone:rL(),create:oo(),equals:iL(),fromPoints:aL(),fromSides:lL(),isA:hL(),reverse:pL(),toEdges:mL(),toPolygons:kL(),toString:zL(),transform:qL()}});var WL=S((yMe,HL)=>{var Sse=Te(),Ase=r=>{if(!r.edges)return r;let e={},t={};r.edges.forEach(i=>{let o=i[0].toString(),a=i[1].toString();e[o]=i[0],e[a]=i[1],t[o]=(t[o]||0)+1,t[a]=(t[a]||0)-1});let n=Object.keys(t).filter(i=>t[i]<0),s=Object.keys(t).filter(i=>t[i]>0);return n.forEach(i=>{let o=e[i],a=1/0,c;s.forEach(l=>{let u=e[l],h=Math.hypot(o[0]-u[0],o[1]-u[1]);h<a&&(a=h,c=u)}),console.warn(`repairSlice: repairing vertex gap ${o} to ${c} distance ${a}`),r.edges.forEach(l=>{l[0].toString()===i&&(l[0]=c),l[1].toString()===i&&(l[1]=c)})}),r.edges=r.edges.filter(i=>!Sse.equals(i[0],i[1])),r};HL.exports=Ase});var JL=S((xMe,ZL)=>{var{EPS:jL}=Lt(),uc=Te(),Ep=it(),$L=lc(),_0=(r,e)=>r===e?r:r<e?_0(e,r):e===1?1:e===0?r:_0(e,r%e),Tse=(r,e)=>r*e/_0(r,e),XL=(r,e)=>{let t=r/e.length;if(t===1)return e;let n=uc.fromValues(t,t,t),s=[];return e.forEach(i=>{let o=uc.subtract(uc.create(),i[1],i[0]);uc.divide(o,o,n);let a=i[0];for(let c=1;c<=t;++c){let l=uc.add(uc.create(),a,o);s.push([a,l]),a=l}}),s},YL=jL*jL/2*Math.sin(Math.PI/3),Mse=(r,e)=>{let t=$L.toEdges(r),n=$L.toEdges(e);if(t.length!==n.length){let i=Tse(t.length,n.length);i!==t.length&&(t=XL(i,t)),i!==n.length&&(n=XL(i,n))}let s=[];return t.forEach((i,o)=>{let a=n[o],c=Ep.create([i[0],i[1],a[1]]),l=Ep.measureArea(c);Number.isFinite(l)&&l>YL&&s.push(c);let u=Ep.create([i[0],a[1],a[0]]),h=Ep.measureArea(u);Number.isFinite(h)&&h>YL&&s.push(u)}),s};ZL.exports=Mse});var Cp=S((vMe,tB)=>{var KL=At(),QL=ze(),Pse=Ve(),g0=it(),pi=lc(),Nse=WL(),eB=JL(),Rse=(r,e,t)=>{let n=null;return QL.isA(t)&&(n=pi.fromSides(QL.toSides(t))),g0.isA(t)&&(n=pi.fromPoints(g0.toPoints(t))),r===0||r===1?pi.transform(KL.fromTranslation(KL.create(),[0,0,r]),n):null},Ose=(r,e)=>{let t={numberOfSlices:2,capStart:!0,capEnd:!0,close:!1,repair:!0,callback:Rse},{numberOfSlices:n,capStart:s,capEnd:i,close:o,repair:a,callback:c}=Object.assign({},t,r);if(n<2)throw new Error("numberOfSlices must be 2 or more");a&&Nse(e);let l=n-1,u=null,h=null,d=null,p=[];for(let _=0;_<n;_++){let f=c(_/l,_,e);if(f){if(!pi.isA(f))throw new Error("the callback function must return slice objects");if(pi.toEdges(f).length===0)throw new Error("the callback function must return slices with one or more edges");d&&(p=p.concat(eB(d,f))),_===0&&(u=f),_===n-1&&(h=f),d=f}}if(i){let _=pi.toPolygons(h);p=p.concat(_)}if(s){let _=pi.toPolygons(u).map(g0.invert);p=p.concat(_)}return!s&&!i&&o&&!pi.equals(h,u)&&(p=p.concat(eB(h,u))),Pse.create(p)};tB.exports=Ose});var x0=S((bMe,nB)=>{var Jl=At(),{mirrorX:Ise}=cc(),Kl=ze(),y0=lc(),Dse=Cp(),Lse=(r,e)=>{let t={segments:12,startAngle:0,angle:Math.PI*2,overflow:"cap"},{segments:n,startAngle:s,angle:i,overflow:o}=Object.assign({},t,r);if(n<3)throw new Error("segments must be greater then 3");s=Math.abs(s)>Math.PI*2?s%(Math.PI*2):s,i=Math.abs(i)>Math.PI*2?i%(Math.PI*2):i;let a=s+i;if(a=Math.abs(a)>Math.PI*2?a%(Math.PI*2):a,a<s){let x=s;s=a,a=x}let c=a-s;if(c<=0&&(c=Math.PI*2),Math.abs(c)<Math.PI*2){let x=Math.PI*2/n;n=Math.floor(Math.abs(c)/x),Math.abs(c)>n*x&&n++}let l=Kl.toSides(e);if(l.length===0)throw new Error("the given geometry cannot be empty");let u=l.filter(x=>x[0][0]<0),h=l.filter(x=>x[0][0]>=0);u.length>0&&h.length>0&&o==="cap"&&(u.length>h.length?(l=l.map(x=>{let b=x[0],v=x[1];return b=[Math.min(b[0],0),b[1]],v=[Math.min(v[0],0),v[1]],[b,v]}),e=Kl.reverse(Kl.create(l)),e=Ise(e)):h.length>=u.length&&(l=l.map(x=>{let b=x[0],v=x[1];return b=[Math.max(b[0],0),b[1]],v=[Math.max(v[0],0),v[1]],[b,v]}),e=Kl.create(l)));let p=c/n,_=Math.abs(c)<Math.PI*2,f=y0.fromSides(Kl.toSides(e));y0.reverse(f,f);let m=Jl.create(),g=(x,b,v)=>{let y=p*b+s;return c===Math.PI*2&&b===n&&(y=s),Jl.multiply(m,Jl.fromZRotation(m,y),Jl.fromXRotation(Jl.create(),Math.PI/2)),y0.transform(m,v)};return r={numberOfSlices:n+1,capStart:_,capEnd:_,close:!_,callback:g},Dse(r,f)};nB.exports=Lse});var hc=S((wMe,aB)=>{var Bse=Be(),rB=At(),sB=ze(),iB=Ve(),oB=gt(),Sp=(r,...e)=>{if(!Array.isArray(r))throw new Error("angles must be an array");if(e=Bse(e),e.length===0)throw new Error("wrong number of arguments");for(r=r.slice();r.length<3;)r.push(0);let t=r[2],n=r[1],s=r[0],i=rB.fromTaitBryanRotation(rB.create(),t,n,s),o=e.map(a=>oB.isA(a)?oB.transform(i,a):sB.isA(a)?sB.transform(i,a):iB.isA(a)?iB.transform(i,a):a);return o.length===1?o[0]:o},kse=(r,...e)=>Sp([r,0,0],e),Fse=(r,...e)=>Sp([0,r,0],e),Use=(r,...e)=>Sp([0,0,r],e);aB.exports={rotate:Sp,rotateX:kse,rotateY:Fse,rotateZ:Use}});var fi=S((EMe,dB)=>{var zse=Be(),cB=At(),lB=ze(),uB=Ve(),hB=gt(),Ap=(r,...e)=>{if(!Array.isArray(r))throw new Error("offset must be an array");if(e=zse(e),e.length===0)throw new Error("wrong number of arguments");for(r=r.slice();r.length<3;)r.push(0);let t=cB.fromTranslation(cB.create(),r),n=e.map(s=>hB.isA(s)?hB.transform(t,s):lB.isA(s)?lB.transform(t,s):uB.isA(s)?uB.transform(t,s):s);return n.length===1?n[0]:n},Vse=(r,...e)=>Ap([r,0,0],e),qse=(r,...e)=>Ap([0,r,0],e),Gse=(r,...e)=>Ap([0,0,r],e);dB.exports={translate:Ap,translateX:Vse,translateY:qse,translateZ:Gse}});var fB=S((CMe,pB)=>{var Hse=x0(),{rotate:Wse}=hc(),{translate:jse}=fi(),$se=Ky(),{isGT:v0,isGTE:b0}=on(),Xse=r=>{let e={innerRadius:1,innerSegments:32,outerRadius:4,outerSegments:32,innerRotation:0,startAngle:0,outerRotation:Math.PI*2},{innerRadius:t,innerSegments:n,outerRadius:s,outerSegments:i,innerRotation:o,startAngle:a,outerRotation:c}=Object.assign({},e,r);if(!v0(t,0))throw new Error("innerRadius must be greater than zero");if(!b0(n,3))throw new Error("innerSegments must be three or more");if(!v0(s,0))throw new Error("outerRadius must be greater than zero");if(!b0(i,3))throw new Error("outerSegments must be three or more");if(!b0(a,0))throw new Error("startAngle must be positive");if(!v0(c,0))throw new Error("outerRotation must be greater than zero");if(t>=s)throw new Error("inner circle is two large to rotate about the outer circle");let l=$se({radius:t,segments:n});return o!==0&&(l=Wse([0,0,o],l)),l=jse([s,0],l),Hse({startAngle:a,angle:c,segments:i},l)};pB.exports=Xse});var _B=S((SMe,mB)=>{var{NEPS:dc}=Lt(),Ql=$e(),Yse=ze(),{isNumberArray:Zse}=on(),w0=(r,e,t)=>Math.acos((r*r+e*e-t*t)/(2*r*e)),Jse=(r,e,t)=>e>dc?Math.sqrt(r*r+t*t-2*r*t*Math.cos(e)):Math.sqrt((r-t)*(r-t)+r*t*e*e*(1-e*e/12)),Kse=r=>{if(Math.abs(r[0]+r[1]+r[2]-Math.PI)>dc)throw new Error("AAA triangles require angles that sum to PI");let t=r[0],n=r[1],s=Math.PI-t-n,i=1,o=i/Math.sin(s)*Math.sin(t),a=i/Math.sin(s)*Math.sin(n);return pc(t,n,s,o,a,i)},Qse=r=>{let e=r[0],t=r[1],n=Math.PI+dc-e-t;if(n<dc)throw new Error("AAS triangles require angles that sum to PI");let s=r[2],i=s/Math.sin(e)*Math.sin(t),o=s/Math.sin(e)*Math.sin(n);return pc(e,t,n,s,i,o)},eie=r=>{let e=r[0],t=r[2],n=Math.PI+dc-e-t;if(n<dc)throw new Error("ASA triangles require angles that sum to PI");let s=r[1],i=s/Math.sin(n)*Math.sin(e),o=s/Math.sin(n)*Math.sin(t);return pc(e,t,n,i,o,s)},tie=r=>{let e=r[0],t=r[1],n=r[2],s=Jse(e,t,n),i=w0(s,e,n),o=Math.PI-i-t;return pc(i,t,o,n,s,e)},nie=r=>{let e=r[0],t=r[1],n=r[2],s=Math.asin(t*Math.sin(n)/e),i=Math.PI-s-n,o=e/Math.sin(n)*Math.sin(i);return pc(s,i,n,t,o,e)},rie=r=>{let e=r[1],t=r[2],n=r[0];if(e+t<=n||t+n<=e||n+e<=t)throw new Error("SSS triangle is incorrect, as the longest side is longer than the sum of the other sides");let s=w0(t,n,e),i=w0(n,e,t),o=Math.PI-s-i;return pc(s,i,o,e,t,n)},pc=(r,e,t,n,s,i)=>{let o=Ql.fromValues(0,0),a=Ql.fromValues(i,0),c=Ql.fromValues(n,0);return Ql.add(c,Ql.rotate(c,c,[0,0],Math.PI-e),a),Yse.fromPoints([o,a,c])},sie=r=>{let e={type:"SSS",values:[1,1,1]},{type:t,values:n}=Object.assign({},e,r);if(typeof t!="string")throw new Error("triangle type must be a string");if(t=t.toUpperCase(),!((t[0]==="A"||t[0]==="S")&&(t[1]==="A"||t[1]==="S")&&(t[2]==="A"||t[2]==="S")))throw new Error("triangle type must contain three letters; A or S");if(!Zse(n,3))throw new Error("triangle values must contain three values");if(!n.every(s=>s>0))throw new Error("triangle values must be greater than zero");switch(t){case"AAA":return Kse(n);case"AAS":return Qse(n);case"ASA":return eie(n);case"SAS":return tie(n);case"SSA":return nie(n);case"SSS":return rie(n);default:throw new Error("invalid triangle type, try again")}};mB.exports=sie});var yB=S((AMe,gB)=>{gB.exports={arc:X3(),circle:Ky(),cube:sD(),cuboid:Qy(),cylinder:cD(),cylinderElliptic:n0(),ellipse:Jy(),ellipsoid:r0(),geodesicSphere:yD(),line:vD(),polygon:wD(),polyhedron:s0(),rectangle:o0(),roundedCuboid:ND(),roundedCylinder:LD(),roundedRectangle:UD(),sphere:l0(),square:qD(),star:WD(),torus:fB(),triangle:_B()}});var vB=S((TMe,xB)=>{xB.exports={height:14,32:[16],33:[10,5,21,5,7,void 0,5,2,4,1,5,0,6,1,5,2],34:[16,4,21,4,14,void 0,12,21,12,14],35:[21,11,25,4,-7,void 0,17,25,10,-7,void 0,4,12,18,12,void 0,3,6,17,6],36:[20,8,25,8,-4,void 0,12,25,12,-4,void 0,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],37:[24,21,21,3,0,void 0,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,void 0,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7],38:[26,23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2],39:[10,5,19,4,20,5,21,6,20,6,18,5,16,4,15],40:[14,11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7],41:[14,3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7],42:[16,8,21,8,9,void 0,3,18,13,12,void 0,13,18,3,12],43:[26,13,18,13,0,void 0,4,9,22,9],44:[10,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],45:[26,4,9,22,9],46:[10,5,2,4,1,5,0,6,1,5,2],47:[22,20,25,2,-7],48:[20,9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21],49:[20,6,17,8,18,11,21,11,0],50:[20,4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0],51:[20,5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],52:[20,13,21,3,7,18,7,void 0,13,21,13,0],53:[20,15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4],54:[20,16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7],55:[20,17,21,7,0,void 0,3,21,17,21],56:[20,8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21],57:[20,16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3],58:[10,5,14,4,13,5,12,6,13,5,14,void 0,5,2,4,1,5,0,6,1,5,2],59:[10,5,14,4,13,5,12,6,13,5,14,void 0,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4],60:[24,20,18,4,9,20,0],61:[26,4,12,22,12,void 0,4,6,22,6],62:[24,4,18,20,9,4,0],63:[18,3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,void 0,9,2,8,1,9,0,10,1,9,2],64:[27,18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,void 0,12,16,10,14,9,11,9,8,10,6,11,5,void 0,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,void 0,19,16,18,8,18,6,19,5],65:[18,9,21,1,0,void 0,9,21,17,0,void 0,4,7,14,7],66:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,void 0,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0],67:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5],68:[21,4,21,4,0,void 0,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0],69:[19,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11,void 0,4,0,17,0],70:[18,4,21,4,0,void 0,4,21,17,21,void 0,4,11,12,11],71:[21,18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,void 0,13,8,18,8],72:[22,4,21,4,0,void 0,18,21,18,0,void 0,4,11,18,11],73:[8,4,21,4,0],74:[16,12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7],75:[21,4,21,4,0,void 0,18,21,4,7,void 0,9,12,18,0],76:[17,4,21,4,0,void 0,4,0,16,0],77:[24,4,21,4,0,void 0,4,21,12,0,void 0,20,21,12,0,void 0,20,21,20,0],78:[22,4,21,4,0,void 0,4,21,18,0,void 0,18,21,18,0],79:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21],80:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10],81:[22,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,void 0,12,4,18,-2],82:[21,4,21,4,0,void 0,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,void 0,11,11,18,0],83:[20,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3],84:[16,8,21,8,0,void 0,1,21,15,21],85:[22,4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21],86:[18,1,21,9,0,void 0,17,21,9,0],87:[24,2,21,7,0,void 0,12,21,7,0,void 0,12,21,17,0,void 0,22,21,17,0],88:[20,3,21,17,0,void 0,17,21,3,0],89:[18,1,21,9,11,9,0,void 0,17,21,9,11],90:[20,17,21,3,0,void 0,3,21,17,21,void 0,3,0,17,0],91:[14,4,25,4,-7,void 0,5,25,5,-7,void 0,4,25,11,25,void 0,4,-7,11,-7],92:[14,0,21,14,-3],93:[14,9,25,9,-7,void 0,10,25,10,-7,void 0,3,25,10,25,void 0,3,-7,10,-7],94:[16,6,15,8,18,10,15,void 0,3,12,8,17,13,12,void 0,8,17,8,0],95:[16,0,-2,16,-2],96:[10,6,21,5,20,4,18,4,16,5,15,6,16,5,17],97:[19,15,14,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],98:[19,4,21,4,0,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],99:[18,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],100:[19,15,21,15,0,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],101:[18,3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],102:[12,10,21,8,21,6,20,5,17,5,0,void 0,2,14,9,14],103:[19,15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],104:[19,4,21,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],105:[8,3,21,4,20,5,21,4,22,3,21,void 0,4,14,4,0],106:[10,5,21,6,20,7,21,6,22,5,21,void 0,6,14,6,-3,5,-6,3,-7,1,-7],107:[17,4,21,4,0,void 0,14,14,4,4,void 0,8,8,15,0],108:[8,4,21,4,0],109:[30,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0,void 0,15,10,18,13,20,14,23,14,25,13,26,10,26,0],110:[19,4,14,4,0,void 0,4,10,7,13,9,14,12,14,14,13,15,10,15,0],111:[19,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14],112:[19,4,14,4,-7,void 0,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3],113:[19,15,14,15,-7,void 0,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3],114:[13,4,14,4,0,void 0,4,8,5,11,7,13,9,14,12,14],115:[17,14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3],116:[12,5,21,5,4,6,1,8,0,10,0,void 0,2,14,9,14],117:[19,4,14,4,4,5,1,7,0,10,0,12,1,15,4,void 0,15,14,15,0],118:[16,2,14,8,0,void 0,14,14,8,0],119:[22,3,14,7,0,void 0,11,14,7,0,void 0,11,14,15,0,void 0,19,14,15,0],120:[17,3,14,14,0,void 0,14,14,3,0],121:[16,2,14,8,0,void 0,14,14,8,0,6,-4,4,-6,2,-7,1,-7],122:[17,14,14,3,0,void 0,3,14,14,14,void 0,3,0,14,0],123:[14,9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,void 0,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,void 0,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7],124:[8,4,25,4,-7],125:[14,5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,void 0,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,void 0,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7],126:[24,3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,void 0,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]}});var E0=S((MMe,bB)=>{var iie=vB(),oie={xOffset:0,yOffset:0,input:"?",align:"left",font:iie,height:14,lineSpacing:2.142857142857143,letterSpacing:1,extrudeOffset:0},aie=(r,e)=>{!e&&typeof r=="string"&&(r={input:r}),r=r||{};let t=Object.assign({},oie,r);return t.input=e||t.input,t};bB.exports=aie});var C0=S((PMe,wB)=>{var cie=E0(),lie=(r,e)=>{let{xOffset:t,yOffset:n,input:s,font:i,height:o,extrudeOffset:a}=cie(r,e),c=s.charCodeAt(0);(!c||!i[c])&&(c=63);let l=[].concat(i[c]),u=(o-a)/i.height,h=a/2,d=l.shift()*u,p=[],_=[];for(let f=0,m=l.length;f<m;f+=2){let g=u*l[f]+t,x=u*l[f+1]+n+h;if(l[f]!==void 0){_.push([g,x]);continue}p.push(_),_=[],f--}return _.length&&p.push(_),{width:d,height:o,segments:p}};wB.exports=lie});var SB=S((NMe,CB)=>{var uie=C0(),hie=E0(),EB=(r,e)=>{let{x:t,y:n}=Object.assign({x:0,y:0},r||{}),s=e.segments,i=null,o=null;for(let a=0,c=s.length;a<c;a++){i=s[a];for(let l=0,u=i.length;l<u;l++)o=i[l],i[l]=[o[0]+t,o[1]+n]}return e},die=(r,e)=>{let{xOffset:t,yOffset:n,input:s,font:i,height:o,align:a,extrudeOffset:c,lineSpacing:l,letterSpacing:u}=hie(r,e),[h,d]=[t,n],p,_,f,m,g,x,b={width:0,segments:[]},v=[],y=[],E=0,C=h,M=()=>{v.push(b),E=Math.max(E,b.width),b={width:0,segments:[]}};for(p=0,_=s.length;p<_;p++){if(f=s[p],m=uie({xOffset:h,yOffset:d,font:i,height:o,extrudeOffset:c},f),f===`
`){h=C,d-=m.height*l,M();continue}g=m.width*u,b.width+=g,h+=g,f!==" "&&(b.segments=b.segments.concat(m.segments))}for(b.segments.length&&M(),p=0,_=v.length;p<_;p++)b=v[p],E>b.width&&(x=E-b.width,a==="right"?b=EB({x},b):a==="center"&&(b=EB({x:x/2},b))),y=y.concat(b.segments);return y};CB.exports=die});var TB=S((RMe,AB)=>{AB.exports={vectorChar:C0(),vectorText:SB()}});var fc=S((OMe,MB)=>{var pie=ze(),fie=Ve(),mie=gt(),_ie=r=>{let e;for(let t of r){let n=0;if(pie.isA(t)&&(n=1),fie.isA(t)&&(n=2),mie.isA(t)&&(n=3),e&&n!==e)return!1;e=n}return!0};MB.exports=_ie});var NB=S((IMe,PB)=>{var gie=r=>r*.017453292519943295;PB.exports=gie});var S0=S((DMe,RB)=>{var yie=(r,e)=>r-e;RB.exports=yie});var IB=S((LMe,OB)=>{var xie=(r,e,t)=>{let n=0,s=r.length;for(;s>n;){let i=Math.floor((n+s)/2),o=r[i];t(e,o)>0?n=i+1:s=i}r.splice(n,0,e)};OB.exports=xie});var LB=S((BMe,DB)=>{var vie=(r,e,t)=>{let n=e>0?r*2*Math.PI/e:0,s=t>0?Math.PI*2/t:0;return Math.ceil(Math.max(n,s,4))};DB.exports=vie});var kB=S((kMe,BB)=>{var bie=r=>r*57.29577951308232;BB.exports=bie});var A0=S((FMe,FB)=>{FB.exports={areAllShapesTheSameType:fc(),cos:so().cos,degToRad:NB(),flatten:Be(),fnNumberSort:S0(),insertSorted:IB(),radiusToSegments:LB(),radToDeg:kB(),sin:so().sin}});var Tp=S((UMe,zB)=>{var UB=$e(),wie=ze(),Eie=(r,e)=>{if(e.vertices.length<4)return null;let t=[],n=e.vertices.filter((o,a)=>o[2]>0?(t.push(a),!0):!1);if(n.length!==2)throw new Error("Assertion failed: fromFakePolygon: not enough points found");let s=n.map(o=>{let a=Math.round(o[0]/r)*r+0,c=Math.round(o[1]/r)*r+0;return UB.fromValues(a,c)});if(UB.equals(s[0],s[1]))return null;let i=t[1]-t[0];if(i===1||i===3)i===1&&s.reverse();else throw new Error("Assertion failed: fromFakePolygon: unknown index ordering");return s},Cie=(r,e)=>{let t=e.map(n=>Eie(r,n)).filter(n=>n!==null);return wie.create(t)};zB.exports=Cie});var Mp=S((zMe,VB)=>{var mi=Te(),Sie=ze(),Aie=Ve(),Tie=it(),Mie=(r,e,t)=>{let n=[mi.fromVec2(mi.create(),t[0],r),mi.fromVec2(mi.create(),t[1],r),mi.fromVec2(mi.create(),t[1],e),mi.fromVec2(mi.create(),t[0],e)];return Tie.create(n)},Pie=(r,e)=>{let n=Sie.toSides(e).map(i=>Mie(r.z0,r.z1,i));return Aie.create(n)};VB.exports=Pie});var HB=S((VMe,GB)=>{var qB=At(),Nie=$e(),an=Te(),co=function(r,e){arguments.length<2&&(e=an.orthogonal(an.create(),r)),this.v=an.normalize(an.create(),an.cross(an.create(),r,e)),this.u=an.cross(an.create(),this.v,r),this.plane=r,this.planeorigin=an.scale(an.create(),r,r[3])};co.GetCartesian=function(r,e){let t=r+"/"+e,n,s;if(t==="X/Y")n=[0,0,1],s=[1,0,0];else if(t==="Y/-X")n=[0,0,1],s=[0,1,0];else if(t==="-X/-Y")n=[0,0,1],s=[-1,0,0];else if(t==="-Y/X")n=[0,0,1],s=[0,-1,0];else if(t==="-X/Y")n=[0,0,-1],s=[-1,0,0];else if(t==="-Y/-X")n=[0,0,-1],s=[0,-1,0];else if(t==="X/-Y")n=[0,0,-1],s=[1,0,0];else if(t==="Y/X")n=[0,0,-1],s=[0,1,0];else if(t==="X/Z")n=[0,-1,0],s=[1,0,0];else if(t==="Z/-X")n=[0,-1,0],s=[0,0,1];else if(t==="-X/-Z")n=[0,-1,0],s=[-1,0,0];else if(t==="-Z/X")n=[0,-1,0],s=[0,0,-1];else if(t==="-X/Z")n=[0,1,0],s=[-1,0,0];else if(t==="-Z/-X")n=[0,1,0],s=[0,0,-1];else if(t==="X/-Z")n=[0,1,0],s=[1,0,0];else if(t==="Z/X")n=[0,1,0],s=[0,0,1];else if(t==="Y/Z")n=[1,0,0],s=[0,1,0];else if(t==="Z/-Y")n=[1,0,0],s=[0,0,1];else if(t==="-Y/-Z")n=[1,0,0],s=[0,-1,0];else if(t==="-Z/Y")n=[1,0,0],s=[0,0,-1];else if(t==="-Y/Z")n=[-1,0,0],s=[0,-1,0];else if(t==="-Z/-Y")n=[-1,0,0],s=[0,0,-1];else if(t==="Y/-Z")n=[-1,0,0],s=[0,1,0];else if(t==="Z/Y")n=[-1,0,0],s=[0,0,1];else throw new Error("OrthoNormalBasis.GetCartesian: invalid combination of axis identifiers. Should pass two string arguments from [X,Y,Z,-X,-Y,-Z], being two different axes.");return new co(new Plane(new Vector3D(n),0),new Vector3D(s))};co.Z0Plane=function(){let r=new Plane(new Vector3D([0,0,1]),0);return new co(r,new Vector3D([1,0,0]))};co.prototype={getProjectionMatrix:function(){return qB.fromValues(this.u[0],this.v[0],this.plane[0],0,this.u[1],this.v[1],this.plane[1],0,this.u[2],this.v[2],this.plane[2],0,0,0,-this.plane[3],1)},getInverseProjectionMatrix:function(){let r=an.scale(an.create(),this.plane,this.plane[3]);return qB.fromValues(this.u[0],this.u[1],this.u[2],0,this.v[0],this.v[1],this.v[2],0,this.plane[0],this.plane[1],this.plane[2],0,r[0],r[1],r[2],1)},to2D:function(r){return Nie.fromValues(an.dot(r,this.u),an.dot(r,this.v))},to3D:function(r){let e=an.scale(an.create(),this.u,r[0]),t=an.scale(an.create(),this.v,r[1]),n=an.add(e,e,this.planeorigin);return an.add(t,t,n)},line3Dto2D:function(r){let e=r.point,t=r.direction.plus(e),n=this.to2D(e),s=this.to2D(t);return Line2D.fromPoints(n,s)},line2Dto3D:function(r){let e=r.origin(),t=r.direction().plus(e),n=this.to3D(e),s=this.to3D(t);return Line3D.fromPoints(n,s)},transform:function(r){let e=this.plane.transform(r),t=this.u.transform(r),n=new Vector3D(0,0,0).transform(r),s=t.minus(n);return new co(e,s)}};GB.exports=co});var $B=S((qMe,jB)=>{var{EPS:Ns}=Lt(),_i=ap(),Lr=$e(),Rie=HB(),mc=By(),{insertSorted:Oie,fnNumberSort:Iie}=A0(),WB=it(),Die=r=>{if(r.length<2)return r;let e=[],t=r.length,n=WB.plane(r[0]),s=new Rie(n),i=[],o=[],a={},c={},l={},u=10/Ns;for(let _=0;_<t;_++){let f=r[_],m=[],g=f.vertices.length,x=-1;if(g>0){let b,v;for(let y=0;y<g;y++){let E=s.to2D(f.vertices[y]),C=Math.floor(E[1]*u),M;C in l?M=l[C]:C+1 in l?M=l[C+1]:C-1 in l?M=l[C-1]:(M=E[1],l[C]=E[1]),E=Lr.fromValues(E[0],M),m.push(E);let R=E[1];(y===0||R<b)&&(b=R,x=y),(y===0||R>v)&&(v=R),R in c||(c[R]={}),c[R][_]=!0}b>=v?(m=[],g=0,x=-1):(b in a||(a[b]=[]),a[b].push(_))}m.reverse(),x=g-x-1,i.push(m),o.push(x)}let h=[];for(let _ in c)h.push(_);h.sort(Iie);let d=[],p=[];for(let _=0;_<h.length;_++){let f=[],m=h[_],g=Number(m),x=c[m];for(let v=0;v<d.length;++v){let y=d[v],E=y.polygonindex;if(x[E]){let C=i[E],M=C.length,R=y.leftvertexindex,N=y.rightvertexindex;for(;;){let T=R+1;if(T>=M&&(T=0),C[T][1]!==g)break;R=T}let w=N-1;if(w<0&&(w=M-1),C[w][1]===g&&(N=w),R!==y.leftvertexindex&&R===N)d.splice(v,1),--v;else{y.leftvertexindex=R,y.rightvertexindex=N,y.topleft=C[R],y.topright=C[N];let T=R+1;T>=M&&(T=0),y.bottomleft=C[T];let F=N-1;F<0&&(F=M-1),y.bottomright=C[F]}}}let b;if(_>=h.length-1)d=[],b=null;else{b=Number(h[_+1]);let v=.5*(g+b),y=a[m];for(let E in y){let C=y[E],M=i[C],R=M.length,N=o[C],w=N;for(;;){let B=w+1;if(B>=R&&(B=0),M[B][1]!==g||B===N)break;w=B}let T=N;for(;;){let B=T-1;if(B<0&&(B=R-1),M[B][1]!==g||B===w)break;T=B}let F=w+1;F>=R&&(F=0);let L=T-1;L<0&&(L=R-1);let V={polygonindex:C,leftvertexindex:w,rightvertexindex:T,topleft:M[w],topright:M[T],bottomleft:M[F],bottomright:M[L]};Oie(d,V,(B,H)=>{let z=mc(B.topleft,B.bottomleft,v),X=mc(H.topleft,H.bottomleft,v);return z>X?1:z<X?-1:0})}}for(let v in d){let y=d[v],E=mc(y.topleft,y.bottomleft,g),C=Lr.fromValues(E,g);E=mc(y.topright,y.bottomright,g);let M=Lr.fromValues(E,g);E=mc(y.topleft,y.bottomleft,b);let R=Lr.fromValues(E,b);E=mc(y.topright,y.bottomright,b);let N=Lr.fromValues(E,b),w={topleft:C,topright:M,bottomleft:R,bottomright:N,leftline:_i.fromPoints(_i.create(),C,R),rightline:_i.fromPoints(_i.create(),N,M)};if(f.length>0){let T=f[f.length-1],F=Lr.distance(w.topleft,T.topright),L=Lr.distance(w.bottomleft,T.bottomright);F<Ns&&L<Ns&&(w.topleft=T.topleft,w.leftline=T.leftline,w.bottomleft=T.bottomleft,f.splice(f.length-1,1))}f.push(w)}if(_>0){let v={},y={};for(let E=0;E<f.length;E++){let C=f[E];for(let M=0;M<p.length;M++)if(!y[M]){let R=p[M];if(Lr.distance(R.bottomleft,C.topleft)<Ns&&Lr.distance(R.bottomright,C.topright)<Ns){y[M]=!0;let N=_i.direction(C.leftline),w=_i.direction(R.leftline),T=N[0]-w[0],F=_i.direction(C.rightline),L=_i.direction(R.rightline),V=F[0]-L[0],B=Math.abs(T)<Ns,H=Math.abs(V)<Ns,z=B||T>=0,X=H||V>=0;z&&X&&(C.outpolygon=R.outpolygon,C.leftlinecontinues=B,C.rightlinecontinues=H,v[M]=!0);break}}}for(let E=0;E<p.length;E++)if(!v[E]){let C=p[E];C.outpolygon.rightpoints.push(C.bottomright),Lr.distance(C.bottomright,C.bottomleft)>Ns&&C.outpolygon.leftpoints.push(C.bottomleft),C.outpolygon.leftpoints.reverse();let R=C.outpolygon.rightpoints.concat(C.outpolygon.leftpoints).map(w=>s.to3D(w)),N=WB.fromPointsAndPlane(R,n);N.vertices.length&&e.push(N)}}for(let v=0;v<f.length;v++){let y=f[v];y.outpolygon?(y.leftlinecontinues||y.outpolygon.leftpoints.push(y.topleft),y.rightlinecontinues||y.outpolygon.rightpoints.push(y.topright)):(y.outpolygon={leftpoints:[],rightpoints:[]},y.outpolygon.leftpoints.push(y.topleft),Lr.distance(y.topleft,y.topright)>Ns&&y.outpolygon.rightpoints.push(y.topright))}p=f}return e};jB.exports=Die});var eu=S((GMe,ZB)=>{var XB=Ve(),YB=it(),Lie=Wl(),Bie=$B(),kie=(r,e)=>Math.abs(r[3]-e[3])<15e-8?Lie(r,e):!1,Fie=r=>{if(r.isRetesselated)return r;let e=XB.toPolygons(r),t=[];e.forEach(i=>{let o=t.find(a=>kie(a[0],YB.plane(i)));o?o[1].push(i):t.push([YB.plane(i),[i]])});let n=[];t.forEach(i=>{let o=i[1],a=Bie(o);n=n.concat(a)});let s=XB.create(n);return s.isRetesselated=!0,s};ZB.exports=Fie});var Pp=S((HMe,KB)=>{var{EPS:_c}=Lt(),JB=hi(),Uie=(r,e)=>{if(r.polygons.length===0||e.polygons.length===0)return!1;let t=JB(r),n=t[0],s=t[1],i=JB(e),o=i[0],a=i[1];return!(o[0]-s[0]>_c||n[0]-a[0]>_c||o[1]-s[1]>_c||n[1]-a[1]>_c||o[2]-s[2]>_c||n[2]-a[2]>_c)};KB.exports=Uie});var tk=S((WMe,ek)=>{var QB=Dr(),zie=it(),tu=class{constructor(e){this.plane=null,this.front=null,this.back=null,this.polygontreenodes=[],this.parent=e}invert(){let e=[this],t;for(let n=0;n<e.length;n++){t=e[n],t.plane&&(t.plane=QB.flip(QB.create(),t.plane)),t.front&&e.push(t.front),t.back&&e.push(t.back);let s=t.front;t.front=t.back,t.back=s}}clipPolygons(e,t){let n={node:this,polygontreenodes:e},s,i=[];do{if(s=n.node,e=n.polygontreenodes,s.plane){let o=s.plane,a=[],c=[],l=t?a:c,u=e.length;for(let d=0;d<u;d++){let p=e[d];p.isRemoved()||p.splitByPlane(o,l,a,c,a)}s.front&&c.length>0&&i.push({node:s.front,polygontreenodes:c});let h=a.length;if(s.back&&h>0)i.push({node:s.back,polygontreenodes:a});else for(let d=0;d<h;d++)a[d].remove()}n=i.pop()}while(n!==void 0)}clipTo(e,t){let n=this,s=[];do n.polygontreenodes.length>0&&e.rootnode.clipPolygons(n.polygontreenodes,t),n.front&&s.push(n.front),n.back&&s.push(n.back),n=s.pop();while(n!==void 0)}addPolygonTreeNodes(e){let t={node:this,polygontreenodes:e},n=[];do{let s=t.node,i=t.polygontreenodes;if(i.length===0){t=n.pop();continue}if(!s.plane){let l=0;l=Math.floor(i.length/2);let u=i[l].getPolygon();s.plane=zie.plane(u)}let o=[],a=[],c=i.length;for(let l=0;l<c;++l)i[l].splitByPlane(s.plane,s.polygontreenodes,a,o,a);o.length>0&&(s.front||(s.front=new tu(s)),c===o.length&&a.length===0?s.front.polygontreenodes=o:n.push({node:s.front,polygontreenodes:o})),a.length>0&&(s.back||(s.back=new tu(s)),c===a.length&&o.length===0?s.back.polygontreenodes=a:n.push({node:s.back,polygontreenodes:a})),t=n.pop()}while(t!==void 0)}};ek.exports=tu});var rk=S((jMe,nk)=>{var gc=Te(),Vie=(r,e,t)=>{let n=gc.subtract(gc.create(),t,e),s=(r[3]-gc.dot(r,e))/gc.dot(r,n);return Number.isNaN(s)&&(s=0),s>1&&(s=1),s<0&&(s=0),gc.scale(n,n,s),gc.add(n,e,n),n};nk.exports=Vie});var ik=S(($Me,sk)=>{var{EPS:Np}=Lt(),qie=Dr(),Rp=Te(),T0=it(),Gie=rk(),Hie=(r,e)=>{let t={type:null,front:null,back:null},n=e.vertices,s=n.length,i=T0.plane(e);if(qie.equals(i,r))t.type=0;else{let o=!1,a=!1,c=[],l=-Np;for(let u=0;u<s;u++){let h=Rp.dot(r,n[u])-r[3],d=h<l;c.push(d),h>Np&&(o=!0),h<l&&(a=!0)}if(!o&&!a){let u=Rp.dot(r,i);t.type=u>=0?0:1}else if(!a)t.type=2;else if(!o)t.type=3;else{t.type=4;let u=[],h=[],d=c[0];for(let _=0;_<s;_++){let f=n[_],m=_+1;m>=s&&(m=0);let g=c[m];if(d===g)d?h.push(f):u.push(f);else{let x=n[m],b=Gie(r,f,x);d?(h.push(f),h.push(b),u.push(b)):(u.push(f),u.push(b),h.push(b))}d=g}let p=Np*Np;if(h.length>=3){let _=h[h.length-1];for(let f=0;f<h.length;f++){let m=h[f];Rp.squaredDistance(m,_)<p&&(h.splice(f,1),f--),_=m}}if(u.length>=3){let _=u[u.length-1];for(let f=0;f<u.length;f++){let m=u[f];Rp.squaredDistance(m,_)<p&&(u.splice(f,1),f--),_=m}}u.length>=3&&(t.front=T0.fromPointsAndPlane(u,i)),h.length>=3&&(t.back=T0.fromPointsAndPlane(h,i))}}return t};sk.exports=Hie});var ck=S((XMe,ak)=>{var{EPS:Wie}=Lt(),jie=Te(),ok=it(),$ie=ik(),Op=class{constructor(e,t){this.parent=e,this.children=[],this.polygon=t,this.removed=!1}addPolygons(e){if(!this.isRootNode())throw new Error("Assertion failed");let t=this;e.forEach(n=>{t.addChild(n)})}remove(){if(!this.removed){this.removed=!0,this.polygon=null;let e=this.parent.children,t=e.indexOf(this);if(t<0)throw new Error("Assertion failed");e.splice(t,1),this.parent.recursivelyInvalidatePolygon()}}isRemoved(){return this.removed}isRootNode(){return!this.parent}invert(){if(!this.isRootNode())throw new Error("Assertion failed");this.invertSub()}getPolygon(){if(!this.polygon)throw new Error("Assertion failed");return this.polygon}getPolygons(e){let t=[this],n=[t],s,i,o,a;for(s=0;s<n.length;++s)for(t=n[s],i=0,o=t.length;i<o;i++)a=t[i],a.polygon?e.push(a.polygon):a.children.length>0&&n.push(a.children)}splitByPlane(e,t,n,s,i){if(this.children.length){let o=[this.children],a,c,l,u,h;for(a=0;a<o.length;a++)for(h=o[a],c=0,l=h.length;c<l;c++)u=h[c],u.children.length>0?o.push(u.children):u._splitByPlane(e,t,n,s,i)}else this._splitByPlane(e,t,n,s,i)}_splitByPlane(e,t,n,s,i){let o=this.polygon;if(o){let a=ok.measureBoundingSphere(o),c=a[1]+Wie,l=a[0],u=jie.dot(e,l)-e[3];if(u>c)s.push(this);else if(u<-c)i.push(this);else{let h=$ie(e,o);switch(h.type){case 0:t.push(this);break;case 1:n.push(this);break;case 2:s.push(this);break;case 3:i.push(this);break;case 4:if(h.front){let d=this.addChild(h.front);s.push(d)}if(h.back){let d=this.addChild(h.back);i.push(d)}break}}}}addChild(e){let t=new Op(this,e);return this.children.push(t),t}invertSub(){let e=[this],t=[e],n,s,i,o;for(n=0;n<t.length;n++)for(e=t[n],s=0,i=e.length;s<i;s++)o=e[s],o.polygon&&(o.polygon=ok.invert(o.polygon)),o.children.length>0&&t.push(o.children)}recursivelyInvalidatePolygon(){this.polygon=null,this.parent&&this.parent.recursivelyInvalidatePolygon()}clear(){let e=[this],t=[e];for(let n=0;n<t.length;++n){e=t[n];let s=e.length;for(let i=0;i<s;i++){let o=e[i];o.polygon&&(o.polygon=null),o.parent&&(o.parent=null),o.children.length>0&&t.push(o.children),o.children=[]}}}toString(){let e="",t=[this],n=[t],s,i,o,a;for(s=0;s<n.length;++s){t=n[s];let c=" ".repeat(s);for(i=0,o=t.length;i<o;i++)a=t[i],e+=`${c}PolygonTreeNode (${a.isRootNode()}): ${a.children.length}`,a.polygon?e+=`
 ${c}polygon: ${a.polygon.vertices}
`:e+=`
`,a.children.length>0&&n.push(a.children)}return e}};ak.exports=Op});var hk=S((YMe,uk)=>{var Xie=tk(),Yie=ck(),lk=class{constructor(e){this.polygonTree=new Yie,this.rootnode=new Xie(null),e&&this.addPolygons(e)}invert(){this.polygonTree.invert(),this.rootnode.invert()}clipTo(e,t=!1){this.rootnode.clipTo(e,t)}allPolygons(){let e=[];return this.polygonTree.getPolygons(e),e}addPolygons(e){let t=new Array(e.length);for(let n=0;n<e.length;n++)t[n]=this.polygonTree.addChild(e[n]);this.rootnode.addPolygonTreeNodes(t)}clear(){this.polygonTree.clear()}toString(){return"Tree: "+this.polygonTree.toString("")}};uk.exports=lk});var Ip=S((ZMe,dk)=>{dk.exports={Tree:hk()}});var mk=S((JMe,fk)=>{var Dp=Ve(),Zie=Pp(),{Tree:pk}=Ip(),Jie=(r,e)=>{if(!Zie(r,e))return Dp.create();let t=new pk(Dp.toPolygons(r)),n=new pk(Dp.toPolygons(e));t.invert(),n.clipTo(t),n.invert(),t.clipTo(n),n.clipTo(t),t.addPolygons(n.allPolygons()),t.invert();let s=t.allPolygons();return Dp.create(s)};fk.exports=Jie});var M0=S((KMe,_k)=>{var Kie=Be(),Qie=eu(),eoe=mk(),toe=(...r)=>{r=Kie(r);let e=r.shift();return r.forEach(t=>{e=eoe(e,t)}),e=Qie(e),e};_k.exports=toe});var yk=S((QMe,gk)=>{var noe=Be(),roe=Ve(),soe=Ms(),ioe=Tp(),ooe=Mp(),aoe=M0(),coe=(...r)=>{r=noe(r);let e=r.map(s=>ooe({z0:-1,z1:1},s)),t=aoe(e),n=soe(t);return ioe(n,roe.toPolygons(t))};gk.exports=coe});var vk=S((ePe,xk)=>{var loe=Be(),uoe=fc(),hoe=ze(),doe=Ve(),poe=yk(),foe=M0(),moe=(...r)=>{if(r=loe(r),r.length===0)throw new Error("wrong number of arguments");if(!uoe(r))throw new Error("only intersect of the types are supported");let e=r[0];return hoe.isA(e)?poe(r):doe.isA(e)?foe(r):e};xk.exports=moe});var Ek=S((tPe,wk)=>{var P0=Te(),_oe=Ms(),bk=Ve(),goe=r=>r.sort((e,t)=>e-t).filter((e,t,n)=>!t||e!==n[t-1]),yoe=(r,e,t)=>{let n=`${e}`,s=r.get(n);s===void 0?r.set(n,[t]):s.push(t)},xoe=(r,e)=>{let t=`${e}`;return r.get(t)},voe=r=>{let e=_oe(r),t=bk.toPolygons(r),n=t.length,s=new Map,i=P0.create();t.forEach((u,h)=>{u.vertices.forEach(d=>{yoe(s,P0.snap(i,d,e),h)})});let o=t.map(u=>{let h=[];return u.vertices.forEach(d=>{h=h.concat(xoe(s,P0.snap(i,d,e)))}),{e:1,d:goe(h)}});s.clear();let a=0,c=o.length;for(let u=0;u<c;u++){let h=o[u];if(h.e>0){let d=new Array(n);d[u]=!0;do a=0,d.forEach((p,_)=>{let f=o[_];if(f.e>0){f.e=-1;for(let m=0;m<f.d.length;m++)d[f.d[m]]=!0;a++}});while(a>0);h.indexes=d}}let l=[];for(let u=0;u<c;u++)if(o[u].indexes){let h=[];o[u].indexes.forEach((d,p)=>h.push(t[p])),l.push(bk.create(h))}return l};wk.exports=voe});var Sk=S((nPe,Ck)=>{var boe=Be(),woe=Ve(),Eoe=Ek(),Coe=(...r)=>{if(r=boe(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>woe.isA(t)?Eoe(t):t);return e.length===1?e[0]:e};Ck.exports=Coe});var Mk=S((rPe,Tk)=>{var Lp=Ve(),Soe=Pp(),{Tree:Ak}=Ip(),Aoe=(r,e)=>{if(!Soe(r,e))return Lp.clone(r);let t=new Ak(Lp.toPolygons(r)),n=new Ak(Lp.toPolygons(e));t.invert(),t.clipTo(n),n.clipTo(t,!0),t.addPolygons(n.allPolygons()),t.invert();let s=t.allPolygons();return Lp.create(s)};Tk.exports=Aoe});var N0=S((sPe,Pk)=>{var Toe=Be(),Moe=eu(),Poe=Mk(),Noe=(...r)=>{r=Toe(r);let e=r.shift();return r.forEach(t=>{e=Poe(e,t)}),e=Moe(e),e};Pk.exports=Noe});var Rk=S((iPe,Nk)=>{var Roe=Be(),Ooe=Ve(),Ioe=Ms(),Doe=Tp(),Loe=Mp(),Boe=N0(),koe=(...r)=>{r=Roe(r);let e=r.map(s=>Loe({z0:-1,z1:1},s)),t=Boe(e),n=Ioe(t);return Doe(n,Ooe.toPolygons(t))};Nk.exports=koe});var Ik=S((oPe,Ok)=>{var Foe=Be(),Uoe=fc(),zoe=ze(),Voe=Ve(),qoe=Rk(),Goe=N0(),Hoe=(...r)=>{if(r=Foe(r),r.length===0)throw new Error("wrong number of arguments");if(!Uoe(r))throw new Error("only subtract of the types are supported");let e=r[0];return zoe.isA(e)?qoe(r):Voe.isA(e)?Goe(r):e};Ok.exports=Hoe});var R0=S((aPe,Lk)=>{var yc=Ve(),Woe=Pp(),{Tree:Dk}=Ip(),joe=(r,e)=>{if(!Woe(r,e))return $oe(r,e);let t=new Dk(yc.toPolygons(r)),n=new Dk(yc.toPolygons(e));t.clipTo(n,!1),n.clipTo(t),n.invert(),n.clipTo(t),n.invert();let s=t.allPolygons().concat(n.allPolygons());return yc.create(s)},$oe=(r,e)=>{let t=yc.toPolygons(r);return t=t.concat(yc.toPolygons(e)),yc.create(t)};Lk.exports=joe});var O0=S((cPe,Bk)=>{var Xoe=Be(),Yoe=eu(),Zoe=R0(),Joe=(...r)=>{r=Xoe(r);let e;for(e=1;e<r.length;e+=2)r.push(Zoe(r[e-1],r[e]));let t=r[e-1];return t=Yoe(t),t};Bk.exports=Joe});var I0=S((lPe,kk)=>{var Koe=Be(),Qoe=Ve(),eae=Ms(),tae=Tp(),nae=Mp(),rae=O0(),sae=(...r)=>{r=Koe(r);let e=r.map(s=>nae({z0:-1,z1:1},s)),t=rae(e),n=eae(t);return tae(n,Qoe.toPolygons(t))};kk.exports=sae});var Bp=S((uPe,Fk)=>{var iae=Be(),oae=fc(),aae=ze(),cae=Ve(),lae=I0(),uae=O0(),hae=(...r)=>{if(r=iae(r),r.length===0)throw new Error("wrong number of arguments");if(!oae(r))throw new Error("only unions of the same type are supported");let e=r[0];return aae.isA(e)?lae(r):cae.isA(e)?uae(r):e};Fk.exports=hae});var zk=S((hPe,Uk)=>{Uk.exports={intersect:vk(),scission:Sk(),subtract:Ik(),union:Bp()}});var ru=S((dPe,qk)=>{var{EPS:dae}=Lt(),Vk=ky(),nu=ap(),qt=$e(),pae=ql(),fae=(r,e)=>{let t={delta:1,corners:"edge",closed:!1,segments:16},{delta:n,corners:s,closed:i,segments:o}=Object.assign({},t,r);if(Math.abs(n)<dae)return e;let a=r.closed?pae(e):1;a===0&&(a=1);let c=a>0&&n>=0||a<0&&n<0;n=Math.abs(n);let l=null,u=[],h=[],d=qt.create(),p=e.length;for(let _=0;_<p;_++){let f=(_+1)%p,m=e[_],g=e[f];c?qt.subtract(d,m,g):qt.subtract(d,g,m),qt.normal(d,d),qt.normalize(d,d),qt.scale(d,d,n);let x=qt.add(qt.create(),m,d),b=qt.add(qt.create(),g,d),v=[x,b];if(l!=null&&(i||!i&&f!==0)){let y=Vk(l[0],l[1],v[0],v[1]);y?(u.pop(),v[0]=y):h.push({c:m,s0:l,s1:v})}l=[x,b],!(f===0&&!i)&&(u.push(v[0]),u.push(v[1]))}if(i&&l!=null){let _=u[0],f=u[1],m=Vk(l[0],l[1],_,f);if(m)u[0]=m,u.pop();else{let g=e[0],x=[_,f];h.push({c:g,s0:l,s1:x})}}if(s==="edge"){let _=new Map;u.forEach((g,x)=>_.set(g,x));let f=nu.create(),m=nu.create();h.forEach(g=>{nu.fromPoints(f,g.s0[0],g.s0[1]),nu.fromPoints(m,g.s1[0],g.s1[1]);let x=nu.intersectPointOfLines(f,m);if(Number.isFinite(x[0])&&Number.isFinite(x[1])){let b=g.s0[1],v=_.get(b);u[v]=x,u[(v+1)%u.length]=void 0}else{let b=g.s1[0],v=_.get(b);u[v]=void 0}}),u=u.filter(g=>g!==void 0)}if(s==="round"){let _=Math.floor(o/4),f=qt.create();h.forEach(m=>{let g=qt.angle(qt.subtract(f,m.s1[0],m.c));if(g-=qt.angle(qt.subtract(f,m.s0[1],m.c)),c&&g<0&&(g=g+Math.PI,g<0&&(g=g+Math.PI)),!c&&g>0&&(g=g-Math.PI,g>0&&(g=g-Math.PI)),g!==0){_=Math.floor(o*(Math.abs(g)/(2*Math.PI)));let x=g/_,b=qt.angle(qt.subtract(f,m.s0[1],m.c)),v=[];for(let y=1;y<_;y++){let E=b+x*y,C=qt.fromAngleRadians(qt.create(),E);qt.scale(C,C,n),qt.add(C,C,m.c),v.push(C)}if(v.length>0){let y=m.s0[1],E=u.findIndex(C=>qt.equals(y,C));E=(E+1)%u.length,u.splice(E,0,...v)}}else{let x=m.s1[0],b=u.findIndex(v=>qt.equals(x,v));u.splice(b,1)}})}return u};qk.exports=fae});var Hk=S((pPe,Gk)=>{var kp=ze(),mae=ru(),_ae=(r,e)=>{let t={delta:1,corners:"edge",segments:16},{delta:n,corners:s,segments:i}=Object.assign({},t,r);if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');let c=kp.toOutlines(e).map(l=>(r={delta:n,corners:s,closed:!0,segments:i},mae(r,l))).reduce((l,u)=>l.concat(kp.toSides(kp.fromPoints(u))),[]);return kp.create(c)};Gk.exports=_ae});var $k=S((fPe,jk)=>{var Wk=At(),gae=Te(),yae=Ve(),su=it(),xae=(r,e)=>{gae.dot(su.plane(e),r)>0&&(e=su.invert(e));let n=[e],s=su.transform(Wk.fromTranslation(Wk.create(),r),e),i=e.vertices.length;for(let o=0;o<i;o++){let a=o<i-1?o+1:0,c=su.create([e.vertices[o],s.vertices[o],s.vertices[a],e.vertices[a]]);n.push(c)}return n.push(su.invert(s)),yae.create(n)};jk.exports=xae});var Zk=S((mPe,Yk)=>{var{EPS:vae}=Lt(),Xk=At(),Pt=Te(),bae=S0(),D0=Ve(),lo=it(),wae=l0(),Eae=eu(),L0=R0(),Cae=$k(),Sae=(r,e,t)=>{let n=e.toString();if(r.has(n))r.get(n)[1].push(t);else{let s=[e,[t]];r.set(n,s)}},Aae=(r,e,t)=>{let n=e[0].toString(),s=e[1].toString(),i=n<s?`${n},${s}`:`${s},${n}`;if(r.has(i))r.get(i)[1].push(t);else{let o=[e,[t]];r.set(i,o)}},B0=(r,e)=>{r.findIndex(n=>n===e)<0&&r.push(e)},Tae=(r,e)=>{let t={delta:1,segments:12},{delta:n,segments:s}=Object.assign({},t,r),i=D0.create(),o=new Map,a=new Map,c=Pt.create(),l=Pt.create();return D0.toPolygons(e).forEach((h,d)=>{let p=Pt.scale(Pt.create(),lo.plane(h),2*n),_=lo.transform(Xk.fromTranslation(Xk.create(),Pt.scale(Pt.create(),p,-.5)),h),f=Cae(p,_);i=L0(i,f);let m=h.vertices;for(let g=0;g<m.length;g++){Sae(o,m[g],lo.plane(h));let x=(g+1)%m.length,b=[m[g],m[x]];Aae(a,b,lo.plane(h))}}),a.forEach(h=>{let d=h[0],p=h[1],_=d[0],f=d[1],m=Pt.subtract(Pt.create(),f,_);Pt.normalize(m,m);let g=p[0],x=Pt.cross(Pt.create(),g,m),b=[];for(let w=0;w<s;w++)B0(b,w*Math.PI*2/s);for(let w=0,T=p.length;w<T;w++){let F=p[w],L=Pt.dot(x,F),V=Pt.dot(g,F),B=Math.atan2(L,V);B<0&&(B+=Math.PI*2),B0(b,B),B=Math.atan2(-L,-V),B<0&&(B+=Math.PI*2),B0(b,B)}b=b.sort(bae);let v=b.length,y,E,C=[],M=[],R=[];for(let w=-1;w<v;w++){let T=b[w<0?w+v:w],F=Math.sin(T),L=Math.cos(T);Pt.scale(c,g,L*n),Pt.scale(l,x,F*n),Pt.add(c,c,l);let V=Pt.add(Pt.create(),_,c),B=Pt.add(Pt.create(),f,c),H=!1;if(w>=0&&Pt.distance(V,y)<vae&&(H=!0),!H){if(w>=0){C.push(V),M.push(B);let z=[E,B,V,y],X=lo.create(z);R.push(X)}y=V,E=B}}M.reverse(),R.push(lo.create(C)),R.push(lo.create(M));let N=D0.create(R);i=L0(i,N)}),o.forEach(h=>{let d=h[0],p=h[1],_=p[0],f=null,m=0;for(let v=1;v<p.length;v++){let y=p[v],E=Pt.cross(c,_,y),C=Pt.length(E);C>.05&&C>m&&(m=C,f=y)}f||(f=Pt.orthogonal(c,_));let g=Pt.cross(c,_,f);Pt.normalize(g,g);let x=Pt.cross(l,g,_),b=wae({center:[d[0],d[1],d[2]],radius:n,segments:s,axes:[_,g,x]});i=L0(i,b)}),Eae(i)};Yk.exports=Tae});var Kk=S((_Pe,Jk)=>{var Mae=Ve(),Pae=Bp(),Nae=Zk(),Rae=(r,e)=>{let t={delta:1,corners:"round",segments:12},{delta:n,corners:s,segments:i}=Object.assign({},t,r);if(s!=="round")throw new Error('corners must be "round" for 3D geometries');if(Mae.toPolygons(e).length===0)throw new Error("the given geometry cannot be empty");r={delta:n,corners:s,segments:i};let a=Nae(r,e);return Pae(e,a)};Jk.exports=Rae});var t5=S((gPe,e5)=>{var Oae=ql(),Zn=$e(),xc=ze(),iu=gt(),Qk=ru(),Iae=r=>{let{external:e,internal:t}=r;Oae(e)<0?e=e.reverse():t=t.reverse();let n=iu.fromPoints({closed:!0},e),s=iu.fromPoints({closed:!0},t),i=xc.toSides(xc.fromPoints(iu.toPoints(n))),o=xc.toSides(xc.fromPoints(iu.toPoints(s)));return i.push(...o),xc.create(i)},Dae=(r,e,t,n)=>{let{points:s,external:i,internal:o}=r,a=Math.floor(e/2),c=[],l=[];if(t==="round"&&a>0){let h=Math.PI/a,d=s[s.length-1],p=Zn.angle(Zn.subtract(Zn.create(),i[i.length-1],d)),_=s[0],f=Zn.angle(Zn.subtract(Zn.create(),o[0],_));for(let m=1;m<a;m++){let g=p+h*m,x=Zn.fromAngleRadians(Zn.create(),g);Zn.scale(x,x,n),Zn.add(x,x,d),c.push(x),g=f+h*m,x=Zn.fromAngleRadians(Zn.create(),g),Zn.scale(x,x,n),Zn.add(x,x,_),l.push(x)}}let u=[];return u.push(...i,...c,...o.reverse(),...l),xc.fromPoints(u)},Lae=(r,e)=>{r=Object.assign({},{delta:1,corners:"edge",segments:16},r);let{delta:n,corners:s,segments:i}=r;if(n<=0)throw new Error("the given delta must be positive for paths");if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');let o=e.isClosed,a=iu.toPoints(e);if(a.length===0)throw new Error("the given geometry cannot be empty");let c={points:a,external:Qk({delta:n,corners:s,segments:i,closed:o},a),internal:Qk({delta:-n,corners:s,segments:i,closed:o},a)};return e.isClosed?Iae(c):Dae(c,i,s,n)};e5.exports=Lae});var Fp=S((yPe,n5)=>{var Bae=Be(),kae=ze(),Fae=Ve(),Uae=gt(),zae=Hk(),Vae=Kk(),qae=t5(),Gae=(r,...e)=>{if(e=Bae(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>Uae.isA(n)?qae(r,n):kae.isA(n)?zae(r,n):Fae.isA(n)?Vae(r,n):n);return t.length===1?t[0]:t};n5.exports=Gae});var i5=S((xPe,s5)=>{var Up=ze(),r5=rp(),Hae=ru(),Wae=(r,e)=>{let t={delta:1,corners:"edge",segments:0},{delta:n,corners:s,segments:i}=Object.assign({},t,r);if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');let o=Up.toOutlines(e),c=o.map(l=>(r={delta:o.reduce((d,p)=>d+r5.arePointsInside(l,r5.create(p)),0)%2===0?n:-n,corners:s,closed:!0,segments:i},Hae(r,l))).reduce((l,u)=>l.concat(Up.toSides(Up.fromPoints(u))),[]);return Up.create(c)};s5.exports=Wae});var c5=S((vPe,a5)=>{var o5=gt(),jae=ru(),$ae=(r,e)=>{let t={delta:1,corners:"edge",closed:e.isClosed,segments:16},{delta:n,corners:s,closed:i,segments:o}=Object.assign({},t,r);if(!(s==="edge"||s==="chamfer"||s==="round"))throw new Error('corners must be "edge", "chamfer", or "round"');r={delta:n,corners:s,closed:i,segments:o};let a=jae(r,o5.toPoints(e));return o5.fromPoints({closed:i},a)};a5.exports=$ae});var u5=S((bPe,l5)=>{var Xae=Be(),Yae=ze(),Zae=gt(),Jae=i5(),Kae=c5(),Qae=(r,...e)=>{if(e=Xae(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>Zae.isA(n)?Kae(r,n):Yae.isA(n)?Jae(r,n):n);return t.length===1?t[0]:t};l5.exports=Qae});var d5=S((wPe,h5)=>{h5.exports={expand:Fp(),offset:u5()}});var au=S((EPe,p5)=>{var ou=At(),k0=Te(),ece=ze(),F0=lc(),tce=Cp(),nce=(r,e)=>{let t={offset:[0,0,1],twistAngle:0,twistSteps:12,repair:!0},{offset:n,twistAngle:s,twistSteps:i,repair:o}=Object.assign({},t,r);if(i<1)throw new Error("twistSteps must be 1 or more");s===0&&(i=1);let a=k0.clone(n),c=ece.toSides(e);if(c.length===0)throw new Error("the given geometry cannot be empty");let l=F0.fromSides(c);a[2]<0&&F0.reverse(l,l);let u=ou.create(),h=(d,p,_)=>{let f=p/i*s,m=k0.scale(k0.create(),a,p/i);return ou.multiply(u,ou.fromZRotation(u,f),ou.fromTranslation(ou.create(),m)),F0.transform(u,_)};return r={numberOfSlices:i+1,capStart:!0,capEnd:!0,repair:o,callback:h},tce(r,l)};p5.exports=nce});var m5=S((CPe,f5)=>{var rce=ze(),sce=gt(),ice=au(),oce=(r,e)=>{if(!e.isClosed)throw new Error("extruded path must be closed");let t=sce.toPoints(e),n=rce.fromPoints(t);return ice(r,n)};f5.exports=oce});var g5=S((SPe,_5)=>{var ace=Be(),cce=ze(),lce=gt(),uce=au(),hce=m5(),dce=(r,...e)=>{let t={height:1,twistAngle:0,twistSteps:1,repair:!0},{height:n,twistAngle:s,twistSteps:i,repair:o}=Object.assign({},t,r);if(e=ace(e),e.length===0)throw new Error("wrong number of arguments");r={offset:[0,0,n],twistAngle:s,twistSteps:i,repair:o};let a=e.map(c=>lce.isA(c)?hce(r,c):cce.isA(c)?uce(r,c):c);return a.length===1?a[0]:a};_5.exports=dce});var x5=S((APe,y5)=>{var pce=gt(),fce=Fp(),mce=au(),_ce=(r,e)=>{let t={size:1,height:1},{size:n,height:s}=Object.assign({},t,r);if(r.delta=n,r.offset=[0,0,s],pce.toPoints(e).length===0)throw new Error("the given geometry cannot be empty");let o=fce(r,e);return mce(r,o)};y5.exports=_ce});var b5=S((TPe,v5)=>{var{area:gce}=tc(),U0=ze(),yce=gt(),xce=Fp(),vce=au(),bce=(r,e)=>{let t={size:1,height:1},{size:n,height:s}=Object.assign({},t,r);r.delta=n,r.offset=[0,0,s];let i=U0.toOutlines(e);if(i.length===0)throw new Error("the given geometry cannot be empty");let a=i.map(l=>(gce(l)<0&&l.reverse(),xce(r,yce.fromPoints({closed:!0},l)))).reduce((l,u)=>l.concat(U0.toSides(u)),[]),c=U0.create(a);return vce(r,c)};v5.exports=bce});var E5=S((MPe,w5)=>{var wce=Be(),Ece=ze(),Cce=gt(),Sce=x5(),Ace=b5(),Tce=(r,...e)=>{let t={size:1,height:1},{size:n,height:s}=Object.assign({},t,r);if(e=wce(e),e.length===0)throw new Error("wrong number of arguments");if(n<=0)throw new Error("size must be positive");if(s<=0)throw new Error("height must be positive");let i=e.map(o=>Cce.isA(o)?Sce(r,o):Ece.isA(o)?Ace(r,o):o);return i.length===1?i[0]:i};w5.exports=Tce});var P5=S((PPe,M5)=>{var Mce=Be(),C5=Wl(),z0=Dr(),S5=At(),A5=ze(),T5=Ve(),vc=it(),Pce=Ms(),Nce=I0(),Rce=(r,e)=>{let t=z0.fromNormalAndPoint(z0.create(),r.axis,r.origin);if(Number.isNaN(t[0])||Number.isNaN(t[1])||Number.isNaN(t[2])||Number.isNaN(t[3]))throw new Error("project: invalid axis or origin");let n=Pce(e),s=n*n*Math.sqrt(3)/4;if(n===0)return A5.create();let i=T5.toPolygons(e),o=[];for(let c=0;c<i.length;c++){let l=i[c].vertices.map(d=>z0.projectionOfPoint(t,d)),u=vc.create(l),h=vc.plane(u);!C5(t,h)||vc.measureArea(u)<s||o.push(u)}if(!C5(t,[0,0,1])){let c=S5.fromVectorRotation(S5.create(),t,[0,0,1]);o=o.map(l=>vc.transform(c,l))}o=o.sort((c,l)=>vc.measureArea(l)-vc.measureArea(c));let a=o.map(c=>A5.fromPoints(c.vertices));return Nce(a)},Oce=(r,...e)=>{let t={axis:[0,0,1],origin:[0,0,0]},{axis:n,origin:s}=Object.assign({},t,r);if(e=Mce(e),e.length===0)throw new Error("wrong number of arguments");r={axis:n,origin:s};let i=e.map(o=>T5.isA(o)?Rce(r,o):o);return i.length===1?i[0]:i};M5.exports=Oce});var R5=S((NPe,N5)=>{N5.exports={extrudeFromSlices:Cp(),extrudeLinear:g5(),extrudeRectangular:E5(),extrudeRotate:x0(),project:P5(),slice:lc()}});var V0=S((RPe,I5)=>{var O5=$e(),Ice=r=>{let e=O5.fromValues(1/0,1/0);r.forEach(s=>{(s[1]<e[1]||s[1]===e[1]&&s[0]<e[0])&&(e=s)});let t=[];r.forEach(s=>{let i=Lce(s[1]-e[1],s[0]-e[0]),o=O5.squaredDistance(s,e);t.push({point:s,angle:i,distSq:o})}),t.sort((s,i)=>s.angle<i.angle?-1:s.angle>i.angle?1:s.distSq<i.distSq?-1:s.distSq>i.distSq?1:0);let n=[];return t.forEach(s=>{let i=n.length;for(;i>1&&Dce(n[i-2],n[i-1],s.point)<=Number.EPSILON;)n.pop(),i=n.length;n.push(s.point)}),n},Dce=(r,e,t)=>(e[0]-r[0])*(t[1]-r[1])-(e[1]-r[1])*(t[0]-r[0]),Lce=(r,e)=>r===0&&e===0?-1/0:-e/r;I5.exports=Ice});var zp=S((OPe,k5)=>{var D5=ze(),L5=Ve(),B5=gt(),Bce=r=>{let e=new Set,t=[],n=s=>{let i=s.toString();e.has(i)||(t.push(s),e.add(i))};return r.forEach(s=>{D5.isA(s)?D5.toPoints(s).forEach(n):L5.isA(s)?L5.toPoints(s).forEach(i=>i.forEach(n)):B5.isA(s)&&B5.toPoints(s).forEach(n)}),t};k5.exports=Bce});var U5=S((IPe,F5)=>{var kce=Be(),Fce=gt(),Uce=V0(),zce=zp(),Vce=(...r)=>{r=kce(r);let e=zce(r),t=Uce(e);return Fce.fromPoints({closed:!0},t)};F5.exports=Vce});var q5=S((DPe,V5)=>{var qce=Be(),z5=ze(),Gce=V0(),Hce=zp(),Wce=(...r)=>{r=qce(r);let e=Hce(r),t=Gce(e);return t.length<3?z5.create():z5.fromPoints(t)};V5.exports=Wce});var j5=S((LPe,W5)=>{var jce=Qi(),G5=Il(),H5=Jg(),$ce=(r,e,t)=>{let n=[],s=[],i=[];G5(n,t,e),G5(s,r,e);let o=H5(jce(i,s,n)),a=H5(n);if(a===0)throw Error("a and b are the same point");return o/a},Xce=(r,e,t)=>Math.sqrt($ce(r,e,t));W5.exports=Xce});var Y5=S((BPe,X5)=>{var Yce=Qi(),Zce=Jd(),$5=Il(),Jce=(r,e,t,n)=>{let s=[0,0,0];return $5(r,e,t),$5(s,t,n),Yce(r,r,s),Zce(r,r)};X5.exports=Jce});var K5=S((kPe,J5)=>{var Z5=class{constructor(){this.head=null,this.tail=null}clear(){this.head=this.tail=null}insertBefore(e,t){t.prev=e.prev,t.next=e,t.prev?t.prev.next=t:this.head=t,e.prev=t}insertAfter(e,t){t.prev=e,t.next=e.next,t.next?t.next.prev=t:this.tail=t,e.next=t}add(e){this.head?this.tail.next=e:this.head=e,e.prev=this.tail,e.next=null,this.tail=e}addAll(e){for(this.head?this.tail.next=e:this.head=e,e.prev=this.tail;e.next;)e=e.next;this.tail=e}remove(e){e.prev?e.prev.next=e.next:this.head=e.next,e.next?e.next.prev=e.prev:this.tail=e.prev}removeChain(e,t){e.prev?e.prev.next=t.next:this.head=t.next,t.next?t.next.prev=e.prev:this.tail=e.prev}first(){return this.head}isEmpty(){return!this.head}};J5.exports=Z5});var tF=S((FPe,eF)=>{var Q5=class{constructor(e,t){this.point=e,this.index=t,this.next=null,this.prev=null,this.face=null}};eF.exports=Q5});var sF=S((UPe,rF)=>{var Kce=Hg(),Qce=Zg(),nF=class{constructor(e,t){this.vertex=e,this.face=t,this.next=null,this.prev=null,this.opposite=null}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){return this.tail()?Kce(this.tail().point,this.head().point):-1}lengthSquared(){return this.tail()?Qce(this.tail().point,this.head().point):-1}setOpposite(e){this.opposite=e,e.opposite=this}};rF.exports=nF});var aF=S((zPe,oF)=>{var q0=qg(),ele=Gg(),tle=Qi(),G0=Qa(),nle=jg(),rle=Jd(),Vp=Yg(),H0=Il(),W0=sF(),iF=0,sle=1,j0=2,qp=class{constructor(){this.normal=[],this.centroid=[],this.offset=0,this.outside=null,this.mark=iF,this.edge=null,this.nVertices=0}getEdge(e){if(typeof e!="number")throw Error("requires a number");let t=this.edge;for(;e>0;)t=t.next,e-=1;for(;e<0;)t=t.prev,e+=1;return t}computeNormal(){let e=this.edge,t=e.next,n=t.next,s=H0([],t.head().point,e.head().point),i=[],o=[];for(this.nVertices=2,this.normal=[0,0,0];n!==e;)ele(o,s),H0(s,n.head().point,e.head().point),q0(this.normal,this.normal,tle(i,o,s)),n=n.next,this.nVertices+=1;this.area=nle(this.normal),this.normal=Vp(this.normal,this.normal,1/this.area)}computeNormalMinArea(e){if(this.computeNormal(),this.area<e){let t,n=0,s=this.edge;do{let u=s.lengthSquared();u>n&&(t=s,n=u),s=s.next}while(s!==this.edge);let i=t.tail().point,o=t.head().point,a=H0([],o,i),c=Math.sqrt(n);Vp(a,a,1/c);let l=G0(this.normal,a);Vp(a,a,-l),q0(this.normal,this.normal,a),rle(this.normal,this.normal)}}computeCentroid(){this.centroid=[0,0,0];let e=this.edge;do q0(this.centroid,this.centroid,e.head().point),e=e.next;while(e!==this.edge);Vp(this.centroid,this.centroid,1/this.nVertices)}computeNormalAndCentroid(e){typeof e<"u"?this.computeNormalMinArea(e):this.computeNormal(),this.computeCentroid(),this.offset=G0(this.normal,this.centroid)}distanceToPlane(e){return G0(this.normal,e)-this.offset}connectHalfEdges(e,t){let n;if(e.opposite.face===t.opposite.face){let s=t.opposite.face,i;e===this.edge&&(this.edge=t),s.nVertices===3?(i=t.opposite.prev.opposite,s.mark=j0,n=s):(i=t.opposite.next,s.edge===i.prev&&(s.edge=i),i.prev=i.prev.prev,i.prev.next=i),t.prev=e.prev,t.prev.next=t,t.setOpposite(i),s.computeNormalAndCentroid()}else e.next=t,t.prev=e;return n}mergeAdjacentFaces(e,t){let n=e.opposite,s=n.face;t.push(s),s.mark=j0;let i=e.prev,o=e.next,a=n.prev,c=n.next;for(;i.opposite.face===s;)i=i.prev,c=c.next;for(;o.opposite.face===s;)o=o.next,a=a.prev;let l;for(l=c;l!==a.next;l=l.next)l.face=this;this.edge=o;let u;return u=this.connectHalfEdges(a,o),u&&t.push(u),u=this.connectHalfEdges(i,c),u&&t.push(u),this.computeNormalAndCentroid(),t}collectIndices(){let e=[],t=this.edge;do e.push(t.head().index),t=t.next;while(t!==this.edge);return e}static createTriangle(e,t,n,s=0){let i=new qp,o=new W0(e,i),a=new W0(t,i),c=new W0(n,i);return o.next=c.prev=a,a.next=o.prev=c,c.next=a.prev=o,i.edge=o,i.computeNormalAndCentroid(s),i}};oF.exports={VISIBLE:iF,NON_CONVEX:sle,DELETED:j0,Face:qp}});var pF=S((VPe,dF)=>{var $0=Qa(),ile=j5(),ole=Y5(),cF=K5(),ale=tF(),{Face:Rs,VISIBLE:bc,NON_CONVEX:lF,DELETED:cle}=aF(),lle=1,uF=2,hF=class{constructor(e){if(!Array.isArray(e))throw TypeError("input is not a valid array");if(e.length<4)throw Error("cannot build a simplex out of <4 points");this.tolerance=-1,this.nFaces=0,this.nPoints=e.length,this.faces=[],this.newFaces=[],this.claimed=new cF,this.unclaimed=new cF,this.vertices=[];for(let t=0;t<e.length;t+=1)this.vertices.push(new ale(e[t],t));this.discardedFaces=[],this.vertexPointIndices=[]}addVertexToFace(e,t){e.face=t,t.outside?this.claimed.insertBefore(t.outside,e):this.claimed.add(e),t.outside=e}removeVertexFromFace(e,t){e===t.outside&&(e.next&&e.next.face===t?t.outside=e.next:t.outside=null),this.claimed.remove(e)}removeAllVerticesFromFace(e){if(e.outside){let t=e.outside;for(;t.next&&t.next.face===e;)t=t.next;return this.claimed.removeChain(e.outside,t),t.next=null,e.outside}}deleteFaceVertices(e,t){let n=this.removeAllVerticesFromFace(e);if(n)if(!t)this.unclaimed.addAll(n);else{let s;for(let i=n;i;i=s)s=i.next,t.distanceToPlane(i.point)>this.tolerance?this.addVertexToFace(i,t):this.unclaimed.add(i)}}resolveUnclaimedPoints(e){let t=this.unclaimed.first();for(let n=t;n;n=t){t=n.next;let s=this.tolerance,i;for(let o=0;o<e.length;o+=1){let a=e[o];if(a.mark===bc){let c=a.distanceToPlane(n.point);if(c>s&&(s=c,i=a),s>1e3*this.tolerance)break}}i&&this.addVertexToFace(n,i)}}computeExtremes(){let e=[],t=[],n=[],s=[],i,o;for(i=0;i<3;i+=1)n[i]=s[i]=this.vertices[0];for(i=0;i<3;i+=1)e[i]=t[i]=this.vertices[0].point[i];for(i=1;i<this.vertices.length;i+=1){let a=this.vertices[i],c=a.point;for(o=0;o<3;o+=1)c[o]<e[o]&&(e[o]=c[o],n[o]=a);for(o=0;o<3;o+=1)c[o]>t[o]&&(t[o]=c[o],s[o]=a)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(e[0]),Math.abs(t[0]))+Math.max(Math.abs(e[1]),Math.abs(t[1]))+Math.max(Math.abs(e[2]),Math.abs(t[2]))),[n,s]}createInitialSimplex(){let e=this.vertices,[t,n]=this.computeExtremes(),s,i,o,a,c=0,l=0;for(o=0;o<3;o+=1){let f=n[o].point[o]-t[o].point[o];f>c&&(c=f,l=o)}let u=t[l],h=n[l];for(c=0,o=0;o<this.vertices.length;o+=1){let f=this.vertices[o];if(f!==u&&f!==h){let m=ile(f.point,u.point,h.point);m>c&&(c=m,s=f)}}let d=ole([],u.point,h.point,s.point),p=$0(u.point,d);for(c=-1,o=0;o<this.vertices.length;o+=1){let f=this.vertices[o];if(f!==u&&f!==h&&f!==s){let m=Math.abs($0(d,f.point)-p);m>c&&(c=m,i=f)}}let _=[];if($0(i.point,d)-p<0)for(_.push(Rs.createTriangle(u,h,s),Rs.createTriangle(i,h,u),Rs.createTriangle(i,s,h),Rs.createTriangle(i,u,s)),o=0;o<3;o+=1){let f=(o+1)%3;_[o+1].getEdge(2).setOpposite(_[0].getEdge(f)),_[o+1].getEdge(1).setOpposite(_[f+1].getEdge(0))}else for(_.push(Rs.createTriangle(u,s,h),Rs.createTriangle(i,u,h),Rs.createTriangle(i,h,s),Rs.createTriangle(i,s,u)),o=0;o<3;o+=1){let f=(o+1)%3;_[o+1].getEdge(2).setOpposite(_[0].getEdge((3-o)%3)),_[o+1].getEdge(0).setOpposite(_[f+1].getEdge(1))}for(o=0;o<4;o+=1)this.faces.push(_[o]);for(o=0;o<e.length;o+=1){let f=e[o];if(f!==u&&f!==h&&f!==s&&f!==i){c=this.tolerance;let m;for(a=0;a<4;a+=1){let g=_[a].distanceToPlane(f.point);g>c&&(c=g,m=_[a])}m&&this.addVertexToFace(f,m)}}}reindexFaceAndVertices(){let e=[];for(let t=0;t<this.faces.length;t+=1){let n=this.faces[t];n.mark===bc&&e.push(n)}this.faces=e}collectFaces(e){let t=[];for(let n=0;n<this.faces.length;n+=1){if(this.faces[n].mark!==bc)throw Error("attempt to include a destroyed face in the hull");let s=this.faces[n].collectIndices();if(e)t.push(s);else for(let i=0;i<s.length-2;i+=1)t.push([s[0],s[i+1],s[i+2]])}return t}nextVertexToAdd(){if(!this.claimed.isEmpty()){let e,t,n=0,s=this.claimed.first().face;for(t=s.outside;t&&t.face===s;t=t.next){let i=s.distanceToPlane(t.point);i>n&&(n=i,e=t)}return e}}computeHorizon(e,t,n,s){this.deleteFaceVertices(n),n.mark=cle;let i;t?i=t.next:i=t=n.getEdge(0);do{let o=i.opposite,a=o.face;a.mark===bc&&(a.distanceToPlane(e)>this.tolerance?this.computeHorizon(e,o,a,s):s.push(i)),i=i.next}while(i!==t)}addAdjoiningFace(e,t){let n=Rs.createTriangle(e,t.tail(),t.head());return this.faces.push(n),n.getEdge(-1).setOpposite(t.opposite),n.getEdge(0)}addNewFaces(e,t){this.newFaces=[];let n,s;for(let i=0;i<t.length;i+=1){let o=t[i],a=this.addAdjoiningFace(e,o);n?a.next.setOpposite(s):n=a,this.newFaces.push(a.face),s=a}n.next.setOpposite(s)}oppositeFaceDistance(e){return e.face.distanceToPlane(e.opposite.face.centroid)}doAdjacentMerge(e,t){let n=e.edge,s=!0,i=0;do{if(i>=e.nVertices)throw Error("merge recursion limit exceeded");let o=n.opposite.face,a=!1;if(t===uF?(this.oppositeFaceDistance(n)>-this.tolerance||this.oppositeFaceDistance(n.opposite)>-this.tolerance)&&(a=!0):e.area>o.area?this.oppositeFaceDistance(n)>-this.tolerance?a=!0:this.oppositeFaceDistance(n.opposite)>-this.tolerance&&(s=!1):this.oppositeFaceDistance(n.opposite)>-this.tolerance?a=!0:this.oppositeFaceDistance(n)>-this.tolerance&&(s=!1),a){let c=e.mergeAdjacentFaces(n,[]);for(let l=0;l<c.length;l+=1)this.deleteFaceVertices(c[l],e);return!0}n=n.next,i+=1}while(n!==e.edge);return s||(e.mark=lF),!1}addVertexToHull(e){let t=[];this.unclaimed.clear(),this.removeVertexFromFace(e,e.face),this.computeHorizon(e.point,null,e.face,t),this.addNewFaces(e,t);for(let n=0;n<this.newFaces.length;n+=1){let s=this.newFaces[n];if(s.mark===bc)for(;this.doAdjacentMerge(s,lle););}for(let n=0;n<this.newFaces.length;n+=1){let s=this.newFaces[n];if(s.mark===lF)for(s.mark=bc;this.doAdjacentMerge(s,uF););}this.resolveUnclaimedPoints(this.newFaces)}build(){let e;for(this.createInitialSimplex();e=this.nextVertexToAdd();)this.addVertexToHull(e);this.reindexFaceAndVertices()}};dF.exports=hF});var mF=S((qPe,fF)=>{var ule=pF(),hle=(r,e={})=>{let t=new ule(r);return t.build(),t.collectFaces(e.skipTriangulation)};fF.exports=hle});var gF=S((GPe,_F)=>{var dle=Be(),ple=Ve(),fle=it(),mle=mF(),_le=zp(),gle=(...r)=>{if(r=dle(r),r.length===1)return r[0];let e=_le(r),n=mle(e,{skipTriangulation:!0}).map(s=>{let i=s.map(o=>e[o]);return fle.create(i)});return ple.create(n)};_F.exports=gle});var X0=S((HPe,yF)=>{var yle=Be(),xle=fc(),vle=ze(),ble=Ve(),wle=gt(),Ele=U5(),Cle=q5(),Sle=gF(),Ale=(...r)=>{if(r=yle(r),r.length===0)throw new Error("wrong number of arguments");if(!xle(r))throw new Error("only hulls of the same type are supported");let e=r[0];return wle.isA(e)?Ele(r):vle.isA(e)?Cle(r):ble.isA(e)?Sle(r):e};yF.exports=Ale});var vF=S((WPe,xF)=>{var Tle=Be(),Mle=Bp(),Ple=X0(),Nle=(...r)=>{if(r=Tle(r),r.length<2)throw new Error("wrong number of arguments");let e=[];for(let t=1;t<r.length;t++)e.push(Ple(r[t-1],r[t]));return Mle(e)};xF.exports=Nle});var wF=S((jPe,bF)=>{bF.exports={hull:X0(),hullChain:vF()}});var Z0=S(($Pe,CF)=>{var Y0=Te(),EF=it(),Rle=(r,e)=>{let t=Math.abs(EF.measureArea(e));return Number.isFinite(t)&&t>r},Ole=(r,e)=>{let t=e.map(s=>{let i=s.vertices.map(c=>Y0.snap(Y0.create(),c,r)),o=[];for(let c=0;c<i.length;c++){let l=(c+1)%i.length;Y0.equals(i[c],i[l])||o.push(i[c])}let a=EF.create(o);return s.color&&(a.color=s.color),a}),n=r*r*Math.sqrt(3)/4;return t=t.filter(s=>Rle(n,s)),t};CF.exports=Ole});var TF=S((XPe,AF)=>{var Ile=Wl(),wc=Te(),Gp=it(),Dle=r=>{let e=Gp.toPoints(r),t=[];for(let n=0;n<e.length;n++){let s=(n+1)%e.length,i={v1:e[n],v2:e[s]};t.push(i)}for(let n=0;n<t.length;n++){let s=(n+1)%e.length;t[n].next=t[s],t[s].prev=t[n]}return t},Lle=(r,e)=>{let t=`${e.v1}:${e.v2}`;r.set(t,e)},J0=(r,e)=>{let t=`${e.v1}:${e.v2}`;r.delete(t)},Ble=(r,e)=>{let t=`${e.v2}:${e.v1}`;return r.get(t)},kle=(r,e,t)=>{let n=r.prev.v1,s=r.prev.v2,i=e.next.v2,o=SF(n,s,i,t);n=e.prev.v1,s=e.prev.v2,i=r.next.v2;let a=SF(n,s,i,t);return[o,a]},Fle=wc.create(),Ule=wc.create(),SF=(r,e,t,n)=>{let s=wc.subtract(Fle,e,r),i=wc.subtract(Ule,t,e);return wc.cross(s,s,i),wc.dot(s,n)},zle=r=>{let e,t=[];for(;r.next;){let n=r.next;t.push(r.v1),r.v1=null,r.v2=null,r.next=null,r.prev=null,r=n}return t.length>0&&(e=Gp.create(t)),e},Vle=r=>{if(r.length<2)return r;let e=r[0].plane,t=r.slice(),n=new Map;for(;t.length>0;){let i=t.shift(),o=Dle(i);for(let a=0;a<o.length;a++){let c=o[a],l=Ble(n,c);if(l){let u=kle(c,l,e);if(u[0]>=0&&u[1]>=0){let h=l.next,d=c.next;c.prev.next=l.next,c.next.prev=l.prev,l.prev.next=c.next,l.next.prev=c.prev,c.v1=null,c.v2=null,c.next=null,c.prev=null,J0(n,l),l.v1=null,l.v2=null,l.next=null,l.prev=null;let p=(_,f,m)=>{let g={v1:m.v1,v2:f.v2,next:f.next,prev:m.prev};m.prev.next=g,f.next.prev=g,J0(_,f),f.v1=null,f.v2=null,f.next=null,f.prev=null,J0(_,m),m.v1=null,m.v2=null,m.next=null,m.prev=null};u[0]===0&&p(n,h,h.prev),u[1]===0&&p(n,d,d.prev)}}else c.next&&Lle(n,c)}}let s=[];return n.forEach(i=>{let o=zle(i);o&&s.push(o)}),n.clear(),s},qle=(r,e)=>Math.abs(r[3]-e[3])<15e-8?Ile(r,e):!1,Gle=(r,e)=>{let t=[];e.forEach(s=>{let i=t.find(o=>qle(o[0],Gp.plane(s)));i?i[1].push(s):t.push([Gp.plane(s),[s]])});let n=[];return t.forEach(s=>{let i=s[1],o=Vle(i);n=n.concat(o)}),n};AF.exports=Gle});var RF=S((YPe,NF)=>{var MF=Lt(),Kr=Te(),Hle=it(),gi=!1,Rn=r=>`${r}`,PF=(r,e,t,n,s,i)=>{let o=Rn(n),a=Rn(s);if(gi&&o===a)throw new Error("assert failed");let c=`${o}/${a}`,l=`${a}/${o}`;if(r.has(l))return Hp(r,e,t,s,n,null),null;let u={vertex0:n,vertex1:s,polygonindex:i};return r.has(c)?r.get(c).push(u):r.set(c,[u]),o in e?e[o].push(c):e[o]=[c],a in t?t[a].push(c):t[a]=[c],c},Hp=(r,e,t,n,s,i)=>{let o=Rn(n),a=Rn(s),c=`${o}/${a}`;if(gi&&!r.has(c))throw new Error("assert failed");let l=-1,u=r.get(c);for(let h=0;h<u.length;h++){let d=u[h],p=Rn(d.vertex0);if(p===o&&(p=Rn(d.vertex1),p===a&&!(i!==null&&d.polygonindex!==i))){l=h;break}}if(gi&&l<0)throw new Error("assert failed");if(u.splice(l,1),u.length===0&&r.delete(c),l=e[o].indexOf(c),gi&&l<0)throw new Error("assert failed");if(e[o].splice(l,1),e[o].length===0&&delete e[o],l=t[a].indexOf(c),gi&&l<0)throw new Error("assert failed");t[a].splice(l,1),t[a].length===0&&delete t[a]},Wle=r=>{let e=new Map;for(let t=0;t<r.length;t++){let n=r[t],s=n.vertices.length;if(s>=3){let i=n.vertices[0],o=Rn(i);for(let a=0;a<s;a++){let c=a+1;c===s&&(c=0);let l=n.vertices[c],u=Rn(l),h=`${o}/${u}`,d=`${u}/${o}`;if(e.has(d)){let p=e.get(d);p.splice(-1,1),p.length===0&&e.delete(d)}else{let p={vertex0:i,vertex1:l,polygonindex:t};e.has(h)?e.get(h).push(p):e.set(h,[p])}i=l,o=u}}else console.warn("warning: invalid polygon found during insertTjunctions")}if(e.size>0){let t={},n={},s={};for(let[o,a]of e)s[o]=!0,a.forEach(c=>{let l=Rn(c.vertex0),u=Rn(c.vertex1);l in t?t[l].push(o):t[l]=[o],u in n?n[u].push(o):n[u]=[o]});let i=r.slice(0);for(;e.size!==0;){for(let a of e.keys())s[a]=!0;let o=!1;for(;;){let a=Object.keys(s);if(a.length===0)break;let c=a[0],l=!0;if(e.has(c)){let u=e.get(c);if(gi&&u.length===0)throw new Error("assert failed");let h=u[0];for(let d=0;d<2;d++){let p=d===0?h.vertex0:h.vertex1,_=d===0?h.vertex1:h.vertex0,f=Rn(p),m=Rn(_),g=[];d===0?f in n&&(g=n[f]):f in t&&(g=t[f]);for(let x=0;x<g.length;x++){let b=g[x],v=e.get(b)[0],y=d===0?v.vertex0:v.vertex1,E=d===0?v.vertex1:v.vertex0,C=Rn(y),M=Rn(E);if(gi&&M!==f)throw new Error("assert failed");if(C===m){Hp(e,t,n,p,_,null),Hp(e,t,n,_,p,null),l=!1,d=2,o=!0;break}else{let R=p,N=_,w=y,T=Kr.subtract(Kr.create(),w,R),F=Kr.dot(Kr.subtract(Kr.create(),N,R),T)/Kr.dot(T,T);if(F>0&&F<1){let L=Kr.scale(Kr.create(),T,F);if(Kr.add(L,L,R),Kr.squaredDistance(L,N)<MF.EPS*MF.EPS){let B=v.polygonindex,H=i[B],z=Rn(v.vertex1),X=-1;for(let He=0;He<H.vertices.length;He++)if(Rn(H.vertices[He])===z){X=He;break}if(gi&&X<0)throw new Error("assert failed");let ee=H.vertices.slice(0);ee.splice(X,0,_);let le=Hle.create(ee);i[B]=le,Hp(e,t,n,v.vertex0,v.vertex1,B);let re=PF(e,t,n,v.vertex0,_,B),Pe=PF(e,t,n,_,v.vertex1,B);re!==null&&(s[re]=!0),Pe!==null&&(s[Pe]=!0),l=!1,d=2,o=!0;break}}}}}}l&&delete s[c]}if(!o)break}r=i}return e.clear(),r};NF.exports=Wle});var IF=S((ZPe,OF)=>{var K0=Te(),Q0=it(),jle=(r,e,t)=>{let n=e.vertices.length;if(n>3){if(n>4){let o=[0,0,0];e.vertices.forEach(a=>K0.add(o,o,a)),K0.snap(o,K0.divide(o,o,[n,n,n]),r);for(let a=0;a<n;a++){let c=Q0.create([o,e.vertices[a],e.vertices[(a+1)%n]]);e.color&&(c.color=e.color),t.push(c)}return}let s=Q0.create([e.vertices[0],e.vertices[1],e.vertices[2]]),i=Q0.create([e.vertices[0],e.vertices[2],e.vertices[3]]);e.color&&(s.color=e.color,i.color=e.color),t.push(s,i);return}t.push(e)},$le=(r,e)=>{let t=[];return e.forEach(n=>{jle(r,n,t)}),t};OF.exports=$le});var BF=S((JPe,LF)=>{var Xle=Be(),Yle=Ms(),Zle=ze(),DF=Ve(),Jle=gt(),Kle=Z0(),Qle=TF(),eue=RF(),tue=IF(),nue=(r,e)=>e,rue=(r,e)=>e,sue=(r,e)=>{let t={snap:!1,simplify:!1,triangulate:!1},{snap:n,simplify:s,triangulate:i}=Object.assign({},t,r),o=Yle(e),a=DF.toPolygons(e);n&&(a=Kle(o,a)),s&&(a=Qle(o,a)),i&&(a=eue(a),a=tue(o,a));let c=Object.assign({},e);return c.polygons=a,c},iue=(r,...e)=>{if(e=Xle(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>{if(Jle.isA(n))return nue(r,n);if(Zle.isA(n))return rue(r,n);if(DF.isA(n))return sue(r,n);throw new Error("invalid geometry")});return t.length===1?t[0]:t};LF.exports=iue});var FF=S((KPe,kF)=>{var oue=Be(),uo=$e(),ex=ze(),tx=Ve(),nx=gt(),rx=Ms(),aue=Z0(),cue=r=>{let e=rx(r),n=nx.toPoints(r).map(s=>uo.snap(uo.create(),s,e));return nx.create(n)},lue=r=>{let e=rx(r),n=ex.toSides(r).map(s=>[uo.snap(uo.create(),s[0],e),uo.snap(uo.create(),s[1],e)]);return n=n.filter(s=>!uo.equals(s[0],s[1])),ex.create(n)},uue=r=>{let e=rx(r),t=tx.toPolygons(r),n=aue(e,t);return tx.create(n)},hue=(...r)=>{if(r=oue(r),r.length===0)throw new Error("wrong number of arguments");let e=r.map(t=>nx.isA(t)?cue(t):ex.isA(t)?lue(t):tx.isA(t)?uue(t):t);return e.length===1?e[0]:e};kF.exports=hue});var zF=S((QPe,UF)=>{UF.exports={generalize:BF(),snap:FF()}});var qF=S((e2e,VF)=>{var due=(r,e,t)=>{for(r=r.slice();r.length<t;)r.push(e);return r};VF.exports=due});var $F=S((t2e,jF)=>{var pue=Be(),GF=qF(),WF=up(),{translate:fue}=fi(),mue=r=>{if(!Array.isArray(r.modes)||r.modes.length>3)throw new Error("align(): modes must be an array of length <= 3");if(r.modes=GF(r.modes,"none",3),r.modes.filter(e=>["center","max","min","none"].includes(e)).length!==3)throw new Error('align(): all modes must be one of "center", "max" or "min"');if(!Array.isArray(r.relativeTo)||r.relativeTo.length>3)throw new Error("align(): relativeTo must be an array of length <= 3");if(r.relativeTo=GF(r.relativeTo,0,3),r.relativeTo.filter(e=>Number.isFinite(e)||e==null).length!==3)throw new Error("align(): all relativeTo values must be a number, or null.");if(typeof r.grouped!="boolean")throw new Error("align(): grouped must be a boolean value.");return r},_ue=(r,e,t)=>{for(let n=0;n<3;n++)r[n]==null&&(e[n]==="center"?r[n]=(t[0][n]+t[1][n])/2:e[n]==="max"?r[n]=t[1][n]:e[n]==="min"&&(r[n]=t[0][n]));return r},HF=(r,e,t)=>{let n=WF(r),s=[0,0,0];for(let i=0;i<3;i++)e[i]==="center"?s[i]=t[i]-(n[0][i]+n[1][i])/2:e[i]==="max"?s[i]=t[i]-n[1][i]:e[i]==="min"&&(s[i]=t[i]-n[0][i]);return fue(s,r)},gue=(r,...e)=>{r=Object.assign({},{modes:["center","center","min"],relativeTo:[0,0,0],grouped:!1},r),r=mue(r);let{modes:n,relativeTo:s,grouped:i}=r;if(e=pue(e),e.length===0)throw new Error("align(): No geometries were provided to act upon");if(s.filter(o=>o==null).length){let o=WF(e);s=_ue(s,n,o)}return i?e=HF(e,n,s):e=e.map(o=>HF(o,n,s)),e.length===1?e[0]:e};jF.exports=gue});var cu=S((n2e,XF)=>{var yue=Be(),xue=ze(),vue=Ve(),bue=gt(),wue=hi(),{translate:Eue}=fi(),sx=(r,e)=>{let t={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:n,relativeTo:s}=Object.assign({},t,r),i=wue(e),o=[0,0,0];return n[0]&&(o[0]=s[0]-(i[0][0]+(i[1][0]-i[0][0])/2)),n[1]&&(o[1]=s[1]-(i[0][1]+(i[1][1]-i[0][1])/2)),n[2]&&(o[2]=s[2]-(i[0][2]+(i[1][2]-i[0][2])/2)),Eue(o,e)},Wp=(r,...e)=>{let t={axes:[!0,!0,!0],relativeTo:[0,0,0]},{axes:n,relativeTo:s}=Object.assign({},t,r);if(e=yue(e),e.length===0)throw new Error("wrong number of arguments");if(s.length!==3)throw new Error("relativeTo must be an array of length 3");r={axes:n,relativeTo:s};let i=e.map(o=>bue.isA(o)||xue.isA(o)||vue.isA(o)?sx(r,o):o);return i.length===1?i[0]:i},Cue=(...r)=>Wp({axes:[!0,!1,!1]},r),Sue=(...r)=>Wp({axes:[!1,!0,!1]},r),Aue=(...r)=>Wp({axes:[!1,!1,!0]},r);XF.exports={center:Wp,centerX:Cue,centerY:Sue,centerZ:Aue}});var lu=S((r2e,QF)=>{var Tue=Be(),YF=At(),ZF=ze(),JF=Ve(),KF=gt(),jp=(r,...e)=>{if(!Array.isArray(r))throw new Error("factors must be an array");if(e=Tue(e),e.length===0)throw new Error("wrong number of arguments");for(r=r.slice();r.length<3;)r.push(1);if(r[0]<=0||r[1]<=0||r[2]<=0)throw new Error("factors must be positive");let t=YF.fromScaling(YF.create(),r),n=e.map(s=>KF.isA(s)?KF.transform(t,s):ZF.isA(s)?ZF.transform(t,s):JF.isA(s)?JF.transform(t,s):s);return n.length===1?n[0]:n},Mue=(r,...e)=>jp([r,1,1],e),Pue=(r,...e)=>jp([1,r,1],e),Nue=(r,...e)=>jp([1,1,r],e);QF.exports={scale:jp,scaleX:Mue,scaleY:Pue,scaleZ:Nue}});var sU=S((s2e,rU)=>{var Rue=Be(),eU=ze(),tU=Ve(),nU=gt(),Oue=(r,...e)=>{if(e=Rue(e),e.length===0)throw new Error("wrong number of arguments");let t=e.map(n=>nU.isA(n)?nU.transform(r,n):eU.isA(n)?eU.transform(r,n):tU.isA(n)?tU.transform(r,n):n);return t.length===1?t[0]:t};rU.exports=Oue});var oU=S((i2e,iU)=>{iU.exports={align:$F(),center:cu().center,centerX:cu().centerX,centerY:cu().centerY,centerZ:cu().centerZ,mirror:cc().mirror,mirrorX:cc().mirrorX,mirrorY:cc().mirrorY,mirrorZ:cc().mirrorZ,rotate:hc().rotate,rotateX:hc().rotateX,rotateY:hc().rotateY,rotateZ:hc().rotateZ,scale:lu().scale,scaleX:lu().scaleX,scaleY:lu().scaleY,scaleZ:lu().scaleZ,transform:sU(),translate:fi().translate,translateX:fi().translateX,translateY:fi().translateY,translateZ:fi().translateZ}});var cU=S((o2e,aU)=>{aU.exports={colors:_O(),curves:PO(),geometries:sp(),maths:a3(),measurements:H3(),primitives:yB(),text:TB(),utils:A0(),booleans:zk(),expansions:d5(),extrusions:R5(),hulls:wF(),modifiers:zF(),transforms:oU()}});var Im="139",Di={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Li={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},r4=0,L1=1,s4=2;var yE=0,Oh=1,Dm=2,Mi=3,tr=0,er=1,Zs=2,xE=1;var Xs=0,ia=1,B1=2,k1=3,F1=4,i4=5,ea=100,o4=101,a4=102,U1=103,z1=104,c4=200,l4=201,u4=202,h4=203,vE=204,bE=205,d4=206,p4=207,f4=208,m4=209,_4=210,g4=0,y4=1,x4=2,vm=3,v4=4,b4=5,w4=6,E4=7,Ih=0,C4=1,S4=2,Ar=0,Lm=1,Bm=2,km=3,Fm=4,A4=5,wE=300,ca=301,la=302,bm=303,wm=304,Dh=306,ua=1e3,Sr=1001,Em=1002,yn=1003,V1=1004;var q1=1005;var Vn=1006,T4=1007;var Lh=1008;var Oi=1009,M4=1010,P4=1011,Kc=1012,N4=1013,wh=1014,hs=1015,oa=1016,R4=1017,O4=1018,aa=1020,I4=1021,D4=1022,Qn=1023,L4=1024,B4=1025,Ni=1026,ha=1027,k4=1028,F4=1029,U4=1030,z4=1031,V4=1033,Bf=33776,kf=33777,Ff=33778,Uf=33779,G1=35840,H1=35841,W1=35842,j1=35843,q4=36196,$1=37492,X1=37496,Y1=37808,Z1=37809,J1=37810,K1=37811,Q1=37812,ew=37813,tw=37814,nw=37815,rw=37816,sw=37817,iw=37818,ow=37819,aw=37820,cw=37821,lw=36492,G4=2200,H4=2201,W4=2202,Sh=2300,Ah=2301,zf=2302,ta=2400,na=2401,Th=2402,Um=2500,EE=2501,CE=0;var Tr=3e3,Et=3001,j4=3200,$4=3201,fa=0,X4=1;var us="srgb",Pi="srgb-linear";var Vf=7680;var Y4=519,Qc=35044,Mh=35048;var uw="300 es",Cm=1035,pr=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});let n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;let n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;let s=this._listeners[e];if(s!==void 0){let i=s.indexOf(t);i!==-1&&s.splice(i,1)}}dispatchEvent(e){if(this._listeners===void 0)return;let n=this._listeners[e.type];if(n!==void 0){e.target=this;let s=n.slice(0);for(let i=0,o=s.length;i<o;i++)s[i].call(this,e);e.target=null}}},wn=[];for(let r=0;r<256;r++)wn[r]=(r<16?"0":"")+r.toString(16);var hw=1234567,Xc=Math.PI/180,el=180/Math.PI;function dr(){let r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(wn[r&255]+wn[r>>8&255]+wn[r>>16&255]+wn[r>>24&255]+"-"+wn[e&255]+wn[e>>8&255]+"-"+wn[e>>16&15|64]+wn[e>>24&255]+"-"+wn[t&63|128]+wn[t>>8&255]+"-"+wn[t>>16&255]+wn[t>>24&255]+wn[n&255]+wn[n>>8&255]+wn[n>>16&255]+wn[n>>24&255]).toLowerCase()}function un(r,e,t){return Math.max(e,Math.min(t,r))}function zm(r,e){return(r%e+e)%e}function Z4(r,e,t,n,s){return n+(r-e)*(s-n)/(t-e)}function J4(r,e,t){return r!==e?(t-r)/(e-r):0}function Yc(r,e,t){return(1-t)*r+t*e}function K4(r,e,t,n){return Yc(r,e,1-Math.exp(-t*n))}function Q4(r,e=1){return e-Math.abs(zm(r,e*2)-e)}function eV(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*(3-2*r))}function tV(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*r*(r*(r*6-15)+10))}function nV(r,e){return r+Math.floor(Math.random()*(e-r+1))}function rV(r,e){return r+Math.random()*(e-r)}function sV(r){return r*(.5-Math.random())}function iV(r){r!==void 0&&(hw=r);let e=hw+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function oV(r){return r*Xc}function aV(r){return r*el}function Sm(r){return(r&r-1)===0&&r!==0}function cV(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Ph(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function lV(r,e,t,n,s){let i=Math.cos,o=Math.sin,a=i(t/2),c=o(t/2),l=i((e+n)/2),u=o((e+n)/2),h=i((e-n)/2),d=o((e-n)/2),p=i((n-e)/2),_=o((n-e)/2);switch(s){case"XYX":r.set(a*u,c*h,c*d,a*l);break;case"YZY":r.set(c*d,a*u,c*h,a*l);break;case"ZXZ":r.set(c*h,c*d,a*u,a*l);break;case"XZX":r.set(a*u,c*_,c*p,a*l);break;case"YXY":r.set(c*p,a*u,c*_,a*l);break;case"ZYZ":r.set(c*_,c*p,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function uV(r,e){switch(e.constructor){case Float32Array:return r;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function hV(r,e){switch(e.constructor){case Float32Array:return r;case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}var dn=Object.freeze({__proto__:null,DEG2RAD:Xc,RAD2DEG:el,generateUUID:dr,clamp:un,euclideanModulo:zm,mapLinear:Z4,inverseLerp:J4,lerp:Yc,damp:K4,pingpong:Q4,smoothstep:eV,smootherstep:tV,randInt:nV,randFloat:rV,randFloatSpread:sV,seededRandom:iV,degToRad:oV,radToDeg:aV,isPowerOfTwo:Sm,ceilPowerOfTwo:cV,floorPowerOfTwo:Ph,setQuaternionFromProperEuler:lV,normalize:hV,denormalize:uV}),G=class{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){let t=this.x,n=this.y,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6],this.y=s[1]*t+s[4]*n+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){let n=Math.cos(t),s=Math.sin(t),i=this.x-e.x,o=this.y-e.y;return this.x=i*n-o*s+e.x,this.y=i*s+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}};G.prototype.isVector2=!0;var xn=class{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,s,i,o,a,c,l){let u=this.elements;return u[0]=e,u[1]=s,u[2]=a,u[3]=t,u[4]=i,u[5]=c,u[6]=n,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){let t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,s=t.elements,i=this.elements,o=n[0],a=n[3],c=n[6],l=n[1],u=n[4],h=n[7],d=n[2],p=n[5],_=n[8],f=s[0],m=s[3],g=s[6],x=s[1],b=s[4],v=s[7],y=s[2],E=s[5],C=s[8];return i[0]=o*f+a*x+c*y,i[3]=o*m+a*b+c*E,i[6]=o*g+a*v+c*C,i[1]=l*f+u*x+h*y,i[4]=l*m+u*b+h*E,i[7]=l*g+u*v+h*C,i[2]=d*f+p*x+_*y,i[5]=d*m+p*b+_*E,i[8]=d*g+p*v+_*C,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return t*o*u-t*a*l-n*i*u+n*a*c+s*i*l-s*o*c}invert(){let e=this.elements,t=e[0],n=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=u*o-a*l,d=a*c-u*i,p=l*i-o*c,_=t*h+n*d+s*p;if(_===0)return this.set(0,0,0,0,0,0,0,0,0);let f=1/_;return e[0]=h*f,e[1]=(s*l-u*n)*f,e[2]=(a*n-s*o)*f,e[3]=d*f,e[4]=(u*t-s*c)*f,e[5]=(s*i-a*t)*f,e[6]=p*f,e[7]=(n*c-l*t)*f,e[8]=(o*t-n*i)*f,this}transpose(){let e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){let t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,s,i,o,a){let c=Math.cos(i),l=Math.sin(i);return this.set(n*c,n*l,-n*(c*o+l*a)+o+e,-s*l,s*c,-s*(-l*o+c*a)+a+t,0,0,1),this}scale(e,t){let n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}rotate(e){let t=Math.cos(e),n=Math.sin(e),s=this.elements,i=s[0],o=s[3],a=s[6],c=s[1],l=s[4],u=s[7];return s[0]=t*i+n*c,s[3]=t*o+n*l,s[6]=t*a+n*u,s[1]=-n*i+t*c,s[4]=-n*o+t*l,s[7]=-n*a+t*u,this}translate(e,t){let n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}equals(e){let t=this.elements,n=e.elements;for(let s=0;s<9;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}};xn.prototype.isMatrix3=!0;function SE(r){for(let e=r.length-1;e>=0;--e)if(r[e]>65535)return!0;return!1}function tl(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function Ri(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Eh(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}var qf={[us]:{[Pi]:Ri},[Pi]:{[us]:Eh}},br={legacyMode:!0,get workingColorSpace(){return Pi},set workingColorSpace(r){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(r,e,t){if(this.legacyMode||e===t||!e||!t)return r;if(qf[e]&&qf[e][t]!==void 0){let n=qf[e][t];return r.r=n(r.r),r.g=n(r.g),r.b=n(r.b),r}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(r,e){return this.convert(r,this.workingColorSpace,e)},toWorkingColorSpace:function(r,e){return this.convert(r,e,this.workingColorSpace)}},AE={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ln={r:0,g:0,b:0},wr={h:0,s:0,l:0},qu={h:0,s:0,l:0};function Gf(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}function Gu(r,e){return e.r=r.r,e.g=r.g,e.b=r.b,e}var ae=class{constructor(e,t,n){return t===void 0&&n===void 0?this.set(e):this.setRGB(e,t,n)}set(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=us){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,br.toWorkingColorSpace(this,t),this}setRGB(e,t,n,s=Pi){return this.r=e,this.g=t,this.b=n,br.toWorkingColorSpace(this,s),this}setHSL(e,t,n,s=Pi){if(e=zm(e,1),t=un(t,0,1),n=un(n,0,1),t===0)this.r=this.g=this.b=n;else{let i=n<=.5?n*(1+t):n+t-n*t,o=2*n-i;this.r=Gf(o,i,e+1/3),this.g=Gf(o,i,e),this.b=Gf(o,i,e-1/3)}return br.toWorkingColorSpace(this,s),this}setStyle(e,t=us){function n(i){i!==void 0&&parseFloat(i)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let i,o=s[1],a=s[2];switch(o){case"rgb":case"rgba":if(i=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,br.toWorkingColorSpace(this,t),n(i[4]),this;if(i=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,br.toWorkingColorSpace(this,t),n(i[4]),this;break;case"hsl":case"hsla":if(i=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){let c=parseFloat(i[1])/360,l=parseInt(i[2],10)/100,u=parseInt(i[3],10)/100;return n(i[4]),this.setHSL(c,l,u,t)}break}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){let i=s[1],o=i.length;if(o===3)return this.r=parseInt(i.charAt(0)+i.charAt(0),16)/255,this.g=parseInt(i.charAt(1)+i.charAt(1),16)/255,this.b=parseInt(i.charAt(2)+i.charAt(2),16)/255,br.toWorkingColorSpace(this,t),this;if(o===6)return this.r=parseInt(i.charAt(0)+i.charAt(1),16)/255,this.g=parseInt(i.charAt(2)+i.charAt(3),16)/255,this.b=parseInt(i.charAt(4)+i.charAt(5),16)/255,br.toWorkingColorSpace(this,t),this}return e&&e.length>0?this.setColorName(e,t):this}setColorName(e,t=us){let n=AE[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Ri(e.r),this.g=Ri(e.g),this.b=Ri(e.b),this}copyLinearToSRGB(e){return this.r=Eh(e.r),this.g=Eh(e.g),this.b=Eh(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=us){return br.fromWorkingColorSpace(Gu(this,ln),e),un(ln.r*255,0,255)<<16^un(ln.g*255,0,255)<<8^un(ln.b*255,0,255)<<0}getHexString(e=us){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Pi){br.fromWorkingColorSpace(Gu(this,ln),t);let n=ln.r,s=ln.g,i=ln.b,o=Math.max(n,s,i),a=Math.min(n,s,i),c,l,u=(a+o)/2;if(a===o)c=0,l=0;else{let h=o-a;switch(l=u<=.5?h/(o+a):h/(2-o-a),o){case n:c=(s-i)/h+(s<i?6:0);break;case s:c=(i-n)/h+2;break;case i:c=(n-s)/h+4;break}c/=6}return e.h=c,e.s=l,e.l=u,e}getRGB(e,t=Pi){return br.fromWorkingColorSpace(Gu(this,ln),t),e.r=ln.r,e.g=ln.g,e.b=ln.b,e}getStyle(e=us){return br.fromWorkingColorSpace(Gu(this,ln),e),e!==us?`color(${e} ${ln.r} ${ln.g} ${ln.b})`:`rgb(${ln.r*255|0},${ln.g*255|0},${ln.b*255|0})`}offsetHSL(e,t,n){return this.getHSL(wr),wr.h+=e,wr.s+=t,wr.l+=n,this.setHSL(wr.h,wr.s,wr.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(wr),e.getHSL(qu);let n=Yc(wr.h,qu.h,t),s=Yc(wr.s,qu.s,t),i=Yc(wr.l,qu.l,t);return this.setHSL(n,s,i),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),e.normalized===!0&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}};ae.NAMES=AE;ae.prototype.isColor=!0;ae.prototype.r=1;ae.prototype.g=1;ae.prototype.b=1;var Bo,Ks=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Bo===void 0&&(Bo=tl("canvas")),Bo.width=e.width,Bo.height=e.height;let n=Bo.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Bo}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){let t=tl("canvas");t.width=e.width,t.height=e.height;let n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);let s=n.getImageData(0,0,e.width,e.height),i=s.data;for(let o=0;o<i.length;o++)i[o]=Ri(i[o]/255)*255;return n.putImageData(s,0,0),t}else if(e.data){let t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Ri(t[n]/255)*255):t[n]=Ri(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},Vm=class{constructor(e=null){this.uuid=dr(),this.data=e,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];let n={uuid:this.uuid,url:""},s=this.data;if(s!==null){let i;if(Array.isArray(s)){i=[];for(let o=0,a=s.length;o<a;o++)s[o].isDataTexture?i.push(Hf(s[o].image)):i.push(Hf(s[o]))}else i=Hf(s);n.url=i}return t||(e.images[this.uuid]=n),n}};function Hf(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?Ks.getDataURL(r):r.data?{data:Array.prototype.slice.call(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Vm.prototype.isSource=!0;var dV=0,Xt=class extends pr{constructor(e=Xt.DEFAULT_IMAGE,t=Xt.DEFAULT_MAPPING,n=Sr,s=Sr,i=Vn,o=Lh,a=Qn,c=Oi,l=1,u=Tr){super();Object.defineProperty(this,"id",{value:dV++}),this.uuid=dr(),this.name="",this.source=new Vm(e),this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=s,this.magFilter=i,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new G(0,0),this.repeat=new G(1,1),this.center=new G(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new xn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(e){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){let t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];let n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==wE)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ua:e.x=e.x-Math.floor(e.x);break;case Sr:e.x=e.x<0?0:1;break;case Em:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case ua:e.y=e.y-Math.floor(e.y);break;case Sr:e.y=e.y<0?0:1;break;case Em:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}};Xt.DEFAULT_IMAGE=null;Xt.DEFAULT_MAPPING=wE;Xt.prototype.isTexture=!0;var Se=class{constructor(e=0,t=0,n=0,s=1){this.x=e,this.y=t,this.z=n,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,s){return this.x=e,this.y=t,this.z=n,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){let t=this.x,n=this.y,s=this.z,i=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*s+o[12]*i,this.y=o[1]*t+o[5]*n+o[9]*s+o[13]*i,this.z=o[2]*t+o[6]*n+o[10]*s+o[14]*i,this.w=o[3]*t+o[7]*n+o[11]*s+o[15]*i,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);let t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,s,i,c=e.elements,l=c[0],u=c[4],h=c[8],d=c[1],p=c[5],_=c[9],f=c[2],m=c[6],g=c[10];if(Math.abs(u-d)<.01&&Math.abs(h-f)<.01&&Math.abs(_-m)<.01){if(Math.abs(u+d)<.1&&Math.abs(h+f)<.1&&Math.abs(_+m)<.1&&Math.abs(l+p+g-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;let b=(l+1)/2,v=(p+1)/2,y=(g+1)/2,E=(u+d)/4,C=(h+f)/4,M=(_+m)/4;return b>v&&b>y?b<.01?(n=0,s=.707106781,i=.707106781):(n=Math.sqrt(b),s=E/n,i=C/n):v>y?v<.01?(n=.707106781,s=0,i=.707106781):(s=Math.sqrt(v),n=E/s,i=M/s):y<.01?(n=.707106781,s=.707106781,i=0):(i=Math.sqrt(y),n=C/i,s=M/i),this.set(n,s,i,t),this}let x=Math.sqrt((m-_)*(m-_)+(h-f)*(h-f)+(d-u)*(d-u));return Math.abs(x)<.001&&(x=1),this.x=(m-_)/x,this.y=(h-f)/x,this.z=(d-u)/x,this.w=Math.acos((l+p+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}};Se.prototype.isVector4=!0;var En=class extends pr{constructor(e,t,n={}){super();this.width=e,this.height=t,this.depth=1,this.scissor=new Se(0,0,e,t),this.scissorTest=!1,this.viewport=new Se(0,0,e,t);let s={width:e,height:t,depth:1};this.texture=new Xt(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.internalFormat=n.internalFormat!==void 0?n.internalFormat:null,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:Vn,this.depthBuffer=n.depthBuffer!==void 0?n.depthBuffer:!0,this.stencilBuffer=n.stencilBuffer!==void 0?n.stencilBuffer:!1,this.depthTexture=n.depthTexture!==void 0?n.depthTexture:null,this.samples=n.samples!==void 0?n.samples:0}setSize(e,t,n=1){(this.width!==e||this.height!==t||this.depth!==n)&&(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0,this.texture.image=Object.assign({},e.texture.image),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}};En.prototype.isWebGLRenderTarget=!0;var al=class extends Xt{constructor(e=null,t=1,n=1,s=1){super(null);this.image={data:e,width:t,height:n,depth:s},this.magFilter=yn,this.minFilter=yn,this.wrapR=Sr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};al.prototype.isDataArrayTexture=!0;var TE=class extends En{constructor(e,t,n){super(e,t);this.depth=n,this.texture=new al(null,e,t,n),this.texture.isRenderTargetTexture=!0}};TE.prototype.isWebGLArrayRenderTarget=!0;var Bh=class extends Xt{constructor(e=null,t=1,n=1,s=1){super(null);this.image={data:e,width:t,height:n,depth:s},this.magFilter=yn,this.minFilter=yn,this.wrapR=Sr,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};Bh.prototype.isData3DTexture=!0;var ME=class extends En{constructor(e,t,n){super(e,t);this.depth=n,this.texture=new Bh(null,e,t,n),this.texture.isRenderTargetTexture=!0}};ME.prototype.isWebGL3DRenderTarget=!0;var PE=class extends En{constructor(e,t,n,s={}){super(e,t,s);let i=this.texture;this.texture=[];for(let o=0;o<n;o++)this.texture[o]=i.clone(),this.texture[o].isRenderTargetTexture=!0}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let s=0,i=this.texture.length;s<i;s++)this.texture[s].image.width=e,this.texture[s].image.height=t,this.texture[s].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone();return this}};PE.prototype.isWebGLMultipleRenderTargets=!0;var dt=class{constructor(e=0,t=0,n=0,s=1){this._x=e,this._y=t,this._z=n,this._w=s}static slerp(e,t,n,s){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,s)}static slerpFlat(e,t,n,s,i,o,a){let c=n[s+0],l=n[s+1],u=n[s+2],h=n[s+3],d=i[o+0],p=i[o+1],_=i[o+2],f=i[o+3];if(a===0){e[t+0]=c,e[t+1]=l,e[t+2]=u,e[t+3]=h;return}if(a===1){e[t+0]=d,e[t+1]=p,e[t+2]=_,e[t+3]=f;return}if(h!==f||c!==d||l!==p||u!==_){let m=1-a,g=c*d+l*p+u*_+h*f,x=g>=0?1:-1,b=1-g*g;if(b>Number.EPSILON){let y=Math.sqrt(b),E=Math.atan2(y,g*x);m=Math.sin(m*E)/y,a=Math.sin(a*E)/y}let v=a*x;if(c=c*m+d*v,l=l*m+p*v,u=u*m+_*v,h=h*m+f*v,m===1-a){let y=1/Math.sqrt(c*c+l*l+u*u+h*h);c*=y,l*=y,u*=y,h*=y}}e[t]=c,e[t+1]=l,e[t+2]=u,e[t+3]=h}static multiplyQuaternionsFlat(e,t,n,s,i,o){let a=n[s],c=n[s+1],l=n[s+2],u=n[s+3],h=i[o],d=i[o+1],p=i[o+2],_=i[o+3];return e[t]=a*_+u*h+c*p-l*d,e[t+1]=c*_+u*d+l*h-a*p,e[t+2]=l*_+u*p+a*d-c*h,e[t+3]=u*_-a*h-c*d-l*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,s){return this._x=e,this._y=t,this._z=n,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!(e&&e.isEuler))throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");let n=e._x,s=e._y,i=e._z,o=e._order,a=Math.cos,c=Math.sin,l=a(n/2),u=a(s/2),h=a(i/2),d=c(n/2),p=c(s/2),_=c(i/2);switch(o){case"XYZ":this._x=d*u*h+l*p*_,this._y=l*p*h-d*u*_,this._z=l*u*_+d*p*h,this._w=l*u*h-d*p*_;break;case"YXZ":this._x=d*u*h+l*p*_,this._y=l*p*h-d*u*_,this._z=l*u*_-d*p*h,this._w=l*u*h+d*p*_;break;case"ZXY":this._x=d*u*h-l*p*_,this._y=l*p*h+d*u*_,this._z=l*u*_+d*p*h,this._w=l*u*h-d*p*_;break;case"ZYX":this._x=d*u*h-l*p*_,this._y=l*p*h+d*u*_,this._z=l*u*_-d*p*h,this._w=l*u*h+d*p*_;break;case"YZX":this._x=d*u*h+l*p*_,this._y=l*p*h+d*u*_,this._z=l*u*_-d*p*h,this._w=l*u*h-d*p*_;break;case"XZY":this._x=d*u*h-l*p*_,this._y=l*p*h-d*u*_,this._z=l*u*_+d*p*h,this._w=l*u*h+d*p*_;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t!==!1&&this._onChangeCallback(),this}setFromAxisAngle(e,t){let n=t/2,s=Math.sin(n);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){let t=e.elements,n=t[0],s=t[4],i=t[8],o=t[1],a=t[5],c=t[9],l=t[2],u=t[6],h=t[10],d=n+a+h;if(d>0){let p=.5/Math.sqrt(d+1);this._w=.25/p,this._x=(u-c)*p,this._y=(i-l)*p,this._z=(o-s)*p}else if(n>a&&n>h){let p=2*Math.sqrt(1+n-a-h);this._w=(u-c)/p,this._x=.25*p,this._y=(s+o)/p,this._z=(i+l)/p}else if(a>h){let p=2*Math.sqrt(1+a-n-h);this._w=(i-l)/p,this._x=(s+o)/p,this._y=.25*p,this._z=(c+u)/p}else{let p=2*Math.sqrt(1+h-n-a);this._w=(o-s)/p,this._x=(i+l)/p,this._y=(c+u)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(un(this.dot(e),-1,1)))}rotateTowards(e,t){let n=this.angleTo(e);if(n===0)return this;let s=Math.min(1,t/n);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){let n=e._x,s=e._y,i=e._z,o=e._w,a=t._x,c=t._y,l=t._z,u=t._w;return this._x=n*u+o*a+s*l-i*c,this._y=s*u+o*c+i*a-n*l,this._z=i*u+o*l+n*c-s*a,this._w=o*u-n*a-s*c-i*l,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);let n=this._x,s=this._y,i=this._z,o=this._w,a=o*e._w+n*e._x+s*e._y+i*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=n,this._y=s,this._z=i,this;let c=1-a*a;if(c<=Number.EPSILON){let p=1-t;return this._w=p*o+t*this._w,this._x=p*n+t*this._x,this._y=p*s+t*this._y,this._z=p*i+t*this._z,this.normalize(),this._onChangeCallback(),this}let l=Math.sqrt(c),u=Math.atan2(l,a),h=Math.sin((1-t)*u)/l,d=Math.sin(t*u)/l;return this._w=o*h+this._w*d,this._x=n*h+this._x*d,this._y=s*h+this._y*d,this._z=i*h+this._z*d,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){let e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),s=2*Math.PI*Math.random(),i=2*Math.PI*Math.random();return this.set(t*Math.cos(s),n*Math.sin(i),n*Math.cos(i),t*Math.sin(s))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};dt.prototype.isQuaternion=!0;var A=class{constructor(e=0,t=0,n=0){this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(dw.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(dw.setFromAxisAngle(e,t))}applyMatrix3(e){let t=this.x,n=this.y,s=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*s,this.y=i[1]*t+i[4]*n+i[7]*s,this.z=i[2]*t+i[5]*n+i[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){let t=this.x,n=this.y,s=this.z,i=e.elements,o=1/(i[3]*t+i[7]*n+i[11]*s+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*s+i[12])*o,this.y=(i[1]*t+i[5]*n+i[9]*s+i[13])*o,this.z=(i[2]*t+i[6]*n+i[10]*s+i[14])*o,this}applyQuaternion(e){let t=this.x,n=this.y,s=this.z,i=e.x,o=e.y,a=e.z,c=e.w,l=c*t+o*s-a*n,u=c*n+a*t-i*s,h=c*s+i*n-o*t,d=-i*t-o*n-a*s;return this.x=l*c+d*-i+u*-a-h*-o,this.y=u*c+d*-o+h*-i-l*-a,this.z=h*c+d*-a+l*-o-u*-i,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){let t=this.x,n=this.y,s=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*s,this.y=i[1]*t+i[5]*n+i[9]*s,this.z=i[2]*t+i[6]*n+i[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){let n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){let n=e.x,s=e.y,i=e.z,o=t.x,a=t.y,c=t.z;return this.x=s*c-i*a,this.y=i*o-n*c,this.z=n*a-s*o,this}projectOnVector(e){let t=e.lengthSq();if(t===0)return this.set(0,0,0);let n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return Wf.copy(this).projectOnVector(e),this.sub(Wf)}reflect(e){return this.sub(Wf.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){let t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;let n=this.dot(e)/t;return Math.acos(un(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){let t=this.x-e.x,n=this.y-e.y,s=this.z-e.z;return t*t+n*n+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){let s=Math.sin(t)*e;return this.x=s*Math.sin(n),this.y=Math.cos(t)*e,this.z=s*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){let t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){let t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=s,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,n){return n!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){let e=(Math.random()-.5)*2,t=Math.random()*Math.PI*2,n=Math.sqrt(1-e**2);return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};A.prototype.isVector3=!0;var Wf=new A,dw=new dt,Ut=class{constructor(e=new A(1/0,1/0,1/0),t=new A(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,n=1/0,s=1/0,i=-1/0,o=-1/0,a=-1/0;for(let c=0,l=e.length;c<l;c+=3){let u=e[c],h=e[c+1],d=e[c+2];u<t&&(t=u),h<n&&(n=h),d<s&&(s=d),u>i&&(i=u),h>o&&(o=h),d>a&&(a=d)}return this.min.set(t,n,s),this.max.set(i,o,a),this}setFromBufferAttribute(e){let t=1/0,n=1/0,s=1/0,i=-1/0,o=-1/0,a=-1/0;for(let c=0,l=e.count;c<l;c++){let u=e.getX(c),h=e.getY(c),d=e.getZ(c);u<t&&(t=u),h<n&&(n=h),d<s&&(s=d),u>i&&(i=u),h>o&&(o=h),d>a&&(a=d)}return this.min.set(t,n,s),this.max.set(i,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=Ei.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);let n=e.geometry;if(n!==void 0)if(t&&n.attributes!=null&&n.attributes.position!==void 0){let i=n.attributes.position;for(let o=0,a=i.count;o<a;o++)Ei.fromBufferAttribute(i,o).applyMatrix4(e.matrixWorld),this.expandByPoint(Ei)}else n.boundingBox===null&&n.computeBoundingBox(),jf.copy(n.boundingBox),jf.applyMatrix4(e.matrixWorld),this.union(jf);let s=e.children;for(let i=0,o=s.length;i<o;i++)this.expandByObject(s[i],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ei),Ei.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Uc),Hu.subVectors(this.max,Uc),ko.subVectors(e.a,Uc),Fo.subVectors(e.b,Uc),Uo.subVectors(e.c,Uc),zs.subVectors(Fo,ko),Vs.subVectors(Uo,Fo),Ci.subVectors(ko,Uo);let t=[0,-zs.z,zs.y,0,-Vs.z,Vs.y,0,-Ci.z,Ci.y,zs.z,0,-zs.x,Vs.z,0,-Vs.x,Ci.z,0,-Ci.x,-zs.y,zs.x,0,-Vs.y,Vs.x,0,-Ci.y,Ci.x,0];return!$f(t,ko,Fo,Uo,Hu)||(t=[1,0,0,0,1,0,0,0,1],!$f(t,ko,Fo,Uo,Hu))?!1:(Wu.crossVectors(zs,Vs),t=[Wu.x,Wu.y,Wu.z],$f(t,ko,Fo,Uo,Hu))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Ei.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=this.getSize(Ei).length()*.5,e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ss[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ss[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ss[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ss[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ss[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ss[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ss[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ss[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ss),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};Ut.prototype.isBox3=!0;var ss=[new A,new A,new A,new A,new A,new A,new A,new A],Ei=new A,jf=new Ut,ko=new A,Fo=new A,Uo=new A,zs=new A,Vs=new A,Ci=new A,Uc=new A,Hu=new A,Wu=new A,Si=new A;function $f(r,e,t,n,s){for(let i=0,o=r.length-3;i<=o;i+=3){Si.fromArray(r,i);let a=s.x*Math.abs(Si.x)+s.y*Math.abs(Si.y)+s.z*Math.abs(Si.z),c=e.dot(Si),l=t.dot(Si),u=n.dot(Si);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}var pV=new Ut,pw=new A,ju=new A,Xf=new A,fs=class{constructor(e=new A,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){let n=this.center;t!==void 0?n.copy(t):pV.setFromPoints(e).getCenter(n);let s=0;for(let i=0,o=e.length;i<o;i++)s=Math.max(s,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){let t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){let n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Xf.subVectors(e,this.center);let t=Xf.lengthSq();if(t>this.radius*this.radius){let n=Math.sqrt(t),s=(n-this.radius)*.5;this.center.add(Xf.multiplyScalar(s/n)),this.radius+=s}return this}union(e){return this.center.equals(e.center)===!0?ju.set(0,0,1).multiplyScalar(e.radius):ju.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(pw.copy(e.center).add(ju)),this.expandByPoint(pw.copy(e.center).sub(ju)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}},is=new A,Yf=new A,$u=new A,qs=new A,Zf=new A,Xu=new A,Jf=new A,Wr=class{constructor(e=new A,t=new A(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,is)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);let n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){let t=is.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(is.copy(this.direction).multiplyScalar(t).add(this.origin),is.distanceToSquared(e))}distanceSqToSegment(e,t,n,s){Yf.copy(e).add(t).multiplyScalar(.5),$u.copy(t).sub(e).normalize(),qs.copy(this.origin).sub(Yf);let i=e.distanceTo(t)*.5,o=-this.direction.dot($u),a=qs.dot(this.direction),c=-qs.dot($u),l=qs.lengthSq(),u=Math.abs(1-o*o),h,d,p,_;if(u>0)if(h=o*c-a,d=o*a-c,_=i*u,h>=0)if(d>=-_)if(d<=_){let f=1/u;h*=f,d*=f,p=h*(h+o*d+2*a)+d*(o*h+d+2*c)+l}else d=i,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*c)+l;else d=-i,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*c)+l;else d<=-_?(h=Math.max(0,-(-o*i+a)),d=h>0?-i:Math.min(Math.max(-i,-c),i),p=-h*h+d*(d+2*c)+l):d<=_?(h=0,d=Math.min(Math.max(-i,-c),i),p=d*(d+2*c)+l):(h=Math.max(0,-(o*i+a)),d=h>0?i:Math.min(Math.max(-i,-c),i),p=-h*h+d*(d+2*c)+l);else d=o>0?-i:i,h=Math.max(0,-(o*d+a)),p=-h*h+d*(d+2*c)+l;return n&&n.copy(this.direction).multiplyScalar(h).add(this.origin),s&&s.copy($u).multiplyScalar(d).add(Yf),p}intersectSphere(e,t){is.subVectors(e.center,this.origin);let n=is.dot(this.direction),s=is.dot(is)-n*n,i=e.radius*e.radius;if(s>i)return null;let o=Math.sqrt(i-s),a=n-o,c=n+o;return a<0&&c<0?null:a<0?this.at(c,t):this.at(a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){let t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;let n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){let n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){let t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,s,i,o,a,c,l=1/this.direction.x,u=1/this.direction.y,h=1/this.direction.z,d=this.origin;return l>=0?(n=(e.min.x-d.x)*l,s=(e.max.x-d.x)*l):(n=(e.max.x-d.x)*l,s=(e.min.x-d.x)*l),u>=0?(i=(e.min.y-d.y)*u,o=(e.max.y-d.y)*u):(i=(e.max.y-d.y)*u,o=(e.min.y-d.y)*u),n>o||i>s||((i>n||n!==n)&&(n=i),(o<s||s!==s)&&(s=o),h>=0?(a=(e.min.z-d.z)*h,c=(e.max.z-d.z)*h):(a=(e.max.z-d.z)*h,c=(e.min.z-d.z)*h),n>c||a>s)||((a>n||n!==n)&&(n=a),(c<s||s!==s)&&(s=c),s<0)?null:this.at(n>=0?n:s,t)}intersectsBox(e){return this.intersectBox(e,is)!==null}intersectTriangle(e,t,n,s,i){Zf.subVectors(t,e),Xu.subVectors(n,e),Jf.crossVectors(Zf,Xu);let o=this.direction.dot(Jf),a;if(o>0){if(s)return null;a=1}else if(o<0)a=-1,o=-o;else return null;qs.subVectors(this.origin,e);let c=a*this.direction.dot(Xu.crossVectors(qs,Xu));if(c<0)return null;let l=a*this.direction.dot(Zf.cross(qs));if(l<0||c+l>o)return null;let u=-a*qs.dot(Jf);return u<0?null:this.at(u/o,i)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}},pe=class{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,n,s,i,o,a,c,l,u,h,d,p,_,f,m){let g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=s,g[1]=i,g[5]=o,g[9]=a,g[13]=c,g[2]=l,g[6]=u,g[10]=h,g[14]=d,g[3]=p,g[7]=_,g[11]=f,g[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new pe().fromArray(this.elements)}copy(e){let t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){let t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){let t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){let t=this.elements,n=e.elements,s=1/zo.setFromMatrixColumn(e,0).length(),i=1/zo.setFromMatrixColumn(e,1).length(),o=1/zo.setFromMatrixColumn(e,2).length();return t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");let t=this.elements,n=e.x,s=e.y,i=e.z,o=Math.cos(n),a=Math.sin(n),c=Math.cos(s),l=Math.sin(s),u=Math.cos(i),h=Math.sin(i);if(e.order==="XYZ"){let d=o*u,p=o*h,_=a*u,f=a*h;t[0]=c*u,t[4]=-c*h,t[8]=l,t[1]=p+_*l,t[5]=d-f*l,t[9]=-a*c,t[2]=f-d*l,t[6]=_+p*l,t[10]=o*c}else if(e.order==="YXZ"){let d=c*u,p=c*h,_=l*u,f=l*h;t[0]=d+f*a,t[4]=_*a-p,t[8]=o*l,t[1]=o*h,t[5]=o*u,t[9]=-a,t[2]=p*a-_,t[6]=f+d*a,t[10]=o*c}else if(e.order==="ZXY"){let d=c*u,p=c*h,_=l*u,f=l*h;t[0]=d-f*a,t[4]=-o*h,t[8]=_+p*a,t[1]=p+_*a,t[5]=o*u,t[9]=f-d*a,t[2]=-o*l,t[6]=a,t[10]=o*c}else if(e.order==="ZYX"){let d=o*u,p=o*h,_=a*u,f=a*h;t[0]=c*u,t[4]=_*l-p,t[8]=d*l+f,t[1]=c*h,t[5]=f*l+d,t[9]=p*l-_,t[2]=-l,t[6]=a*c,t[10]=o*c}else if(e.order==="YZX"){let d=o*c,p=o*l,_=a*c,f=a*l;t[0]=c*u,t[4]=f-d*h,t[8]=_*h+p,t[1]=h,t[5]=o*u,t[9]=-a*u,t[2]=-l*u,t[6]=p*h+_,t[10]=d-f*h}else if(e.order==="XZY"){let d=o*c,p=o*l,_=a*c,f=a*l;t[0]=c*u,t[4]=-h,t[8]=l*u,t[1]=d*h+f,t[5]=o*u,t[9]=p*h-_,t[2]=_*h-p,t[6]=a*u,t[10]=f*h+d}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(fV,e,mV)}lookAt(e,t,n){let s=this.elements;return Jn.subVectors(e,t),Jn.lengthSq()===0&&(Jn.z=1),Jn.normalize(),Gs.crossVectors(n,Jn),Gs.lengthSq()===0&&(Math.abs(n.z)===1?Jn.x+=1e-4:Jn.z+=1e-4,Jn.normalize(),Gs.crossVectors(n,Jn)),Gs.normalize(),Yu.crossVectors(Jn,Gs),s[0]=Gs.x,s[4]=Yu.x,s[8]=Jn.x,s[1]=Gs.y,s[5]=Yu.y,s[9]=Jn.y,s[2]=Gs.z,s[6]=Yu.z,s[10]=Jn.z,this}multiply(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){let n=e.elements,s=t.elements,i=this.elements,o=n[0],a=n[4],c=n[8],l=n[12],u=n[1],h=n[5],d=n[9],p=n[13],_=n[2],f=n[6],m=n[10],g=n[14],x=n[3],b=n[7],v=n[11],y=n[15],E=s[0],C=s[4],M=s[8],R=s[12],N=s[1],w=s[5],T=s[9],F=s[13],L=s[2],V=s[6],B=s[10],H=s[14],z=s[3],X=s[7],ee=s[11],le=s[15];return i[0]=o*E+a*N+c*L+l*z,i[4]=o*C+a*w+c*V+l*X,i[8]=o*M+a*T+c*B+l*ee,i[12]=o*R+a*F+c*H+l*le,i[1]=u*E+h*N+d*L+p*z,i[5]=u*C+h*w+d*V+p*X,i[9]=u*M+h*T+d*B+p*ee,i[13]=u*R+h*F+d*H+p*le,i[2]=_*E+f*N+m*L+g*z,i[6]=_*C+f*w+m*V+g*X,i[10]=_*M+f*T+m*B+g*ee,i[14]=_*R+f*F+m*H+g*le,i[3]=x*E+b*N+v*L+y*z,i[7]=x*C+b*w+v*V+y*X,i[11]=x*M+b*T+v*B+y*ee,i[15]=x*R+b*F+v*H+y*le,this}multiplyScalar(e){let t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){let e=this.elements,t=e[0],n=e[4],s=e[8],i=e[12],o=e[1],a=e[5],c=e[9],l=e[13],u=e[2],h=e[6],d=e[10],p=e[14],_=e[3],f=e[7],m=e[11],g=e[15];return _*(+i*c*h-s*l*h-i*a*d+n*l*d+s*a*p-n*c*p)+f*(+t*c*p-t*l*d+i*o*d-s*o*p+s*l*u-i*c*u)+m*(+t*l*h-t*a*p-i*o*h+n*o*p+i*a*u-n*l*u)+g*(-s*a*u-t*c*h+t*a*d+s*o*h-n*o*d+n*c*u)}transpose(){let e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){let s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=t,s[14]=n),this}invert(){let e=this.elements,t=e[0],n=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],d=e[10],p=e[11],_=e[12],f=e[13],m=e[14],g=e[15],x=h*m*l-f*d*l+f*c*p-a*m*p-h*c*g+a*d*g,b=_*d*l-u*m*l-_*c*p+o*m*p+u*c*g-o*d*g,v=u*f*l-_*h*l+_*a*p-o*f*p-u*a*g+o*h*g,y=_*h*c-u*f*c-_*a*d+o*f*d+u*a*m-o*h*m,E=t*x+n*b+s*v+i*y;if(E===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);let C=1/E;return e[0]=x*C,e[1]=(f*d*i-h*m*i-f*s*p+n*m*p+h*s*g-n*d*g)*C,e[2]=(a*m*i-f*c*i+f*s*l-n*m*l-a*s*g+n*c*g)*C,e[3]=(h*c*i-a*d*i-h*s*l+n*d*l+a*s*p-n*c*p)*C,e[4]=b*C,e[5]=(u*m*i-_*d*i+_*s*p-t*m*p-u*s*g+t*d*g)*C,e[6]=(_*c*i-o*m*i-_*s*l+t*m*l+o*s*g-t*c*g)*C,e[7]=(o*d*i-u*c*i+u*s*l-t*d*l-o*s*p+t*c*p)*C,e[8]=v*C,e[9]=(_*h*i-u*f*i-_*n*p+t*f*p+u*n*g-t*h*g)*C,e[10]=(o*f*i-_*a*i+_*n*l-t*f*l-o*n*g+t*a*g)*C,e[11]=(u*a*i-o*h*i-u*n*l+t*h*l+o*n*p-t*a*p)*C,e[12]=y*C,e[13]=(u*f*s-_*h*s+_*n*d-t*f*d-u*n*m+t*h*m)*C,e[14]=(_*a*s-o*f*s-_*n*c+t*f*c+o*n*m-t*a*m)*C,e[15]=(o*h*s-u*a*s+u*n*c-t*h*c-o*n*d+t*a*d)*C,this}scale(e){let t=this.elements,n=e.x,s=e.y,i=e.z;return t[0]*=n,t[4]*=s,t[8]*=i,t[1]*=n,t[5]*=s,t[9]*=i,t[2]*=n,t[6]*=s,t[10]*=i,t[3]*=n,t[7]*=s,t[11]*=i,this}getMaxScaleOnAxis(){let e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,s))}makeTranslation(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){let t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){let t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){let n=Math.cos(t),s=Math.sin(t),i=1-n,o=e.x,a=e.y,c=e.z,l=i*o,u=i*a;return this.set(l*o+n,l*a-s*c,l*c+s*a,0,l*a+s*c,u*a+n,u*c-s*o,0,l*c-s*a,u*c+s*o,i*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,s,i,o){return this.set(1,n,i,0,e,1,o,0,t,s,1,0,0,0,0,1),this}compose(e,t,n){let s=this.elements,i=t._x,o=t._y,a=t._z,c=t._w,l=i+i,u=o+o,h=a+a,d=i*l,p=i*u,_=i*h,f=o*u,m=o*h,g=a*h,x=c*l,b=c*u,v=c*h,y=n.x,E=n.y,C=n.z;return s[0]=(1-(f+g))*y,s[1]=(p+v)*y,s[2]=(_-b)*y,s[3]=0,s[4]=(p-v)*E,s[5]=(1-(d+g))*E,s[6]=(m+x)*E,s[7]=0,s[8]=(_+b)*C,s[9]=(m-x)*C,s[10]=(1-(d+f))*C,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,t,n){let s=this.elements,i=zo.set(s[0],s[1],s[2]).length(),o=zo.set(s[4],s[5],s[6]).length(),a=zo.set(s[8],s[9],s[10]).length();this.determinant()<0&&(i=-i),e.x=s[12],e.y=s[13],e.z=s[14],Er.copy(this);let l=1/i,u=1/o,h=1/a;return Er.elements[0]*=l,Er.elements[1]*=l,Er.elements[2]*=l,Er.elements[4]*=u,Er.elements[5]*=u,Er.elements[6]*=u,Er.elements[8]*=h,Er.elements[9]*=h,Er.elements[10]*=h,t.setFromRotationMatrix(Er),n.x=i,n.y=o,n.z=a,this}makePerspective(e,t,n,s,i,o){o===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");let a=this.elements,c=2*i/(t-e),l=2*i/(n-s),u=(t+e)/(t-e),h=(n+s)/(n-s),d=-(o+i)/(o-i),p=-2*o*i/(o-i);return a[0]=c,a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=l,a[9]=h,a[13]=0,a[2]=0,a[6]=0,a[10]=d,a[14]=p,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,n,s,i,o){let a=this.elements,c=1/(t-e),l=1/(n-s),u=1/(o-i),h=(t+e)*c,d=(n+s)*l,p=(o+i)*u;return a[0]=2*c,a[4]=0,a[8]=0,a[12]=-h,a[1]=0,a[5]=2*l,a[9]=0,a[13]=-d,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-p,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){let t=this.elements,n=e.elements;for(let s=0;s<16;s++)if(t[s]!==n[s])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){let n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}};pe.prototype.isMatrix4=!0;var zo=new A,Er=new pe,fV=new A(0,0,0),mV=new A(1,1,1),Gs=new A,Yu=new A,Jn=new A,fw=new pe,mw=new dt,rr=class{constructor(e=0,t=0,n=0,s=rr.DefaultOrder){this._x=e,this._y=t,this._z=n,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,s=this._order){return this._x=e,this._y=t,this._z=n,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){let s=e.elements,i=s[0],o=s[4],a=s[8],c=s[1],l=s[5],u=s[9],h=s[2],d=s[6],p=s[10];switch(t){case"XYZ":this._y=Math.asin(un(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,p),this._z=Math.atan2(-o,i)):(this._x=Math.atan2(d,l),this._z=0);break;case"YXZ":this._x=Math.asin(-un(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,p),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-h,i),this._z=0);break;case"ZXY":this._x=Math.asin(un(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,i));break;case"ZYX":this._y=Math.asin(-un(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(d,p),this._z=Math.atan2(c,i)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(un(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-h,i)):(this._x=0,this._y=Math.atan2(a,p));break;case"XZY":this._z=Math.asin(-un(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(d,l),this._y=Math.atan2(a,i)):(this._x=Math.atan2(-u,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return fw.makeRotationFromQuaternion(e),this.setFromRotationMatrix(fw,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return mw.setFromEuler(this),this.setFromQuaternion(mw,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}};rr.prototype.isEuler=!0;rr.DefaultOrder="XYZ";rr.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var kh=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},_V=0,_w=new A,Vo=new dt,os=new pe,Zu=new A,zc=new A,gV=new A,yV=new dt,gw=new A(1,0,0),yw=new A(0,1,0),xw=new A(0,0,1),xV={type:"added"},vw={type:"removed"},nt=class extends pr{constructor(){super();Object.defineProperty(this,"id",{value:_V++}),this.uuid=dr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=nt.DefaultUp.clone();let e=new A,t=new rr,n=new dt,s=new A(1,1,1);function i(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(i),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new pe},normalMatrix:{value:new xn}}),this.matrix=new pe,this.matrixWorld=new pe,this.matrixAutoUpdate=nt.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new kh,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Vo.setFromAxisAngle(e,t),this.quaternion.multiply(Vo),this}rotateOnWorldAxis(e,t){return Vo.setFromAxisAngle(e,t),this.quaternion.premultiply(Vo),this}rotateX(e){return this.rotateOnAxis(gw,e)}rotateY(e){return this.rotateOnAxis(yw,e)}rotateZ(e){return this.rotateOnAxis(xw,e)}translateOnAxis(e,t){return _w.copy(e).applyQuaternion(this.quaternion),this.position.add(_w.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(gw,e)}translateY(e){return this.translateOnAxis(yw,e)}translateZ(e){return this.translateOnAxis(xw,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(os.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Zu.copy(e):Zu.set(e,t,n);let s=this.parent;this.updateWorldMatrix(!0,!1),zc.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?os.lookAt(zc,Zu,this.up):os.lookAt(Zu,zc,this.up),this.quaternion.setFromRotationMatrix(os),s&&(os.extractRotation(s.matrixWorld),Vo.setFromRotationMatrix(os),this.quaternion.premultiply(Vo.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(xV)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}let t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(vw)),this}removeFromParent(){let e=this.parent;return e!==null&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){let t=this.children[e];t.parent=null,t.dispatchEvent(vw)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),os.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),os.multiply(e.parent.matrixWorld)),e.applyMatrix4(os),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,s=this.children.length;n<s;n++){let o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zc,e,gV),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zc,yV,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);let t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);let t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].traverseVisible(e)}traverseAncestors(e){let t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);let t=this.children;for(let n=0,s=t.length;n<s;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){let n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){let s=this.children;for(let i=0,o=s.length;i<o;i++)s[i].updateWorldMatrix(!1,!0)}}toJSON(e){let t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});let s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON()));function i(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=i(e.geometries,this.geometry);let a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){let c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){let h=c[l];i(e.shapes,h)}else i(e.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(i(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){let a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(i(e.materials,this.material[c]));s.material=a}else s.material=i(e.materials,this.material);if(this.children.length>0){s.children=[];for(let a=0;a<this.children.length;a++)s.children.push(this.children[a].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let a=0;a<this.animations.length;a++){let c=this.animations[a];s.animations.push(i(e.animations,c))}}if(t){let a=o(e.geometries),c=o(e.materials),l=o(e.textures),u=o(e.images),h=o(e.shapes),d=o(e.skeletons),p=o(e.animations),_=o(e.nodes);a.length>0&&(n.geometries=a),c.length>0&&(n.materials=c),l.length>0&&(n.textures=l),u.length>0&&(n.images=u),h.length>0&&(n.shapes=h),d.length>0&&(n.skeletons=d),p.length>0&&(n.animations=p),_.length>0&&(n.nodes=_)}return n.object=s,n;function o(a){let c=[];for(let l in a){let u=a[l];delete u.metadata,c.push(u)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){let s=e.children[n];this.add(s.clone())}return this}};nt.DefaultUp=new A(0,1,0);nt.DefaultMatrixAutoUpdate=!0;nt.prototype.isObject3D=!0;var Cr=new A,as=new A,Kf=new A,cs=new A,qo=new A,Go=new A,bw=new A,Qf=new A,em=new A,tm=new A,Ct=class{constructor(e=new A,t=new A,n=new A){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,s){s.subVectors(n,t),Cr.subVectors(e,t),s.cross(Cr);let i=s.lengthSq();return i>0?s.multiplyScalar(1/Math.sqrt(i)):s.set(0,0,0)}static getBarycoord(e,t,n,s,i){Cr.subVectors(s,t),as.subVectors(n,t),Kf.subVectors(e,t);let o=Cr.dot(Cr),a=Cr.dot(as),c=Cr.dot(Kf),l=as.dot(as),u=as.dot(Kf),h=o*l-a*a;if(h===0)return i.set(-2,-1,-1);let d=1/h,p=(l*c-a*u)*d,_=(o*u-a*c)*d;return i.set(1-p-_,_,p)}static containsPoint(e,t,n,s){return this.getBarycoord(e,t,n,s,cs),cs.x>=0&&cs.y>=0&&cs.x+cs.y<=1}static getUV(e,t,n,s,i,o,a,c){return this.getBarycoord(e,t,n,s,cs),c.set(0,0),c.addScaledVector(i,cs.x),c.addScaledVector(o,cs.y),c.addScaledVector(a,cs.z),c}static isFrontFacing(e,t,n,s){return Cr.subVectors(n,t),as.subVectors(e,t),Cr.cross(as).dot(s)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,s){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,t,n,s){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Cr.subVectors(this.c,this.b),as.subVectors(this.a,this.b),Cr.cross(as).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Ct.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Ct.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,n,s,i){return Ct.getUV(e,this.a,this.b,this.c,t,n,s,i)}containsPoint(e){return Ct.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Ct.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){let n=this.a,s=this.b,i=this.c,o,a;qo.subVectors(s,n),Go.subVectors(i,n),Qf.subVectors(e,n);let c=qo.dot(Qf),l=Go.dot(Qf);if(c<=0&&l<=0)return t.copy(n);em.subVectors(e,s);let u=qo.dot(em),h=Go.dot(em);if(u>=0&&h<=u)return t.copy(s);let d=c*h-u*l;if(d<=0&&c>=0&&u<=0)return o=c/(c-u),t.copy(n).addScaledVector(qo,o);tm.subVectors(e,i);let p=qo.dot(tm),_=Go.dot(tm);if(_>=0&&p<=_)return t.copy(i);let f=p*l-c*_;if(f<=0&&l>=0&&_<=0)return a=l/(l-_),t.copy(n).addScaledVector(Go,a);let m=u*_-p*h;if(m<=0&&h-u>=0&&p-_>=0)return bw.subVectors(i,s),a=(h-u)/(h-u+(p-_)),t.copy(s).addScaledVector(bw,a);let g=1/(m+f+d);return o=f*g,a=d*g,t.copy(n).addScaledVector(qo,o).addScaledVector(Go,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}},vV=0,nn=class extends pr{constructor(){super();Object.defineProperty(this,"id",{value:vV++}),this.uuid=dr(),this.name="",this.type="Material",this.fog=!0,this.blending=ia,this.side=tr,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=vE,this.blendDst=bE,this.blendEquation=ea,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=vm,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Y4,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Vf,this.stencilZFail=Vf,this.stencilZPass=Vf,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(let t in e){let n=e[t];if(n===void 0){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if(t==="shading"){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===xE;continue}let s=this[t];if(s===void 0){console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.");continue}s&&s.isColor?s.set(n):s&&s.isVector3&&n&&n.isVector3?s.copy(n):this[t]=n}}toJSON(e){let t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});let n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==ia&&(n.blending=this.blending),this.side!==tr&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaToCoverage===!0&&(n.alphaToCoverage=this.alphaToCoverage),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=this.flatShading),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(n.userData=this.userData);function s(i){let o=[];for(let a in i){let c=i[a];delete c.metadata,o.push(c)}return o}if(t){let i=s(e.textures),o=s(e.images);i.length>0&&(n.textures=i),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;let t=e.clippingPlanes,n=null;if(t!==null){let s=t.length;n=new Array(s);for(let i=0;i!==s;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}};nn.prototype.isMaterial=!0;nn.fromType=function(){return null};var Bi=class extends nn{constructor(e){super();this.type="MeshBasicMaterial",this.color=new ae(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ih,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}};Bi.prototype.isMeshBasicMaterial=!0;var tn=new A,Ju=new G,xt=class{constructor(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n===!0,this.usage=Qc,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let s=0,i=this.itemSize;s<i;s++)this.array[e+s]=t.array[n+s];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){let t=this.array,n=0;for(let s=0,i=e.length;s<i;s++){let o=e[s];o===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",s),o=new ae),t[n++]=o.r,t[n++]=o.g,t[n++]=o.b}return this}copyVector2sArray(e){let t=this.array,n=0;for(let s=0,i=e.length;s<i;s++){let o=e[s];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",s),o=new G),t[n++]=o.x,t[n++]=o.y}return this}copyVector3sArray(e){let t=this.array,n=0;for(let s=0,i=e.length;s<i;s++){let o=e[s];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",s),o=new A),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z}return this}copyVector4sArray(e){let t=this.array,n=0;for(let s=0,i=e.length;s<i;s++){let o=e[s];o===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",s),o=new Se),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Ju.fromBufferAttribute(this,t),Ju.applyMatrix3(e),this.setXY(t,Ju.x,Ju.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)tn.fromBufferAttribute(this,t),tn.applyMatrix3(e),this.setXYZ(t,tn.x,tn.y,tn.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)tn.fromBufferAttribute(this,t),tn.applyMatrix4(e),this.setXYZ(t,tn.x,tn.y,tn.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)tn.fromBufferAttribute(this,t),tn.applyNormalMatrix(e),this.setXYZ(t,tn.x,tn.y,tn.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)tn.fromBufferAttribute(this,t),tn.transformDirection(e),this.setXYZ(t,tn.x,tn.y,tn.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this}setXYZW(e,t,n,s,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=s,this.array[e+3]=i,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){let e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Qc&&(e.usage=this.usage),(this.updateRange.offset!==0||this.updateRange.count!==-1)&&(e.updateRange=this.updateRange),e}};xt.prototype.isBufferAttribute=!0;var qm=class extends xt{constructor(e,t,n){super(new Uint16Array(e),t,n)}},Gm=class extends xt{constructor(e,t,n){super(new Int32Array(e),t,n)}},Hm=class extends xt{constructor(e,t,n){super(new Uint32Array(e),t,n)}},NE=class extends xt{constructor(e,t,n){super(new Uint16Array(e),t,n)}};NE.prototype.isFloat16BufferAttribute=!0;var Je=class extends xt{constructor(e,t,n){super(new Float32Array(e),t,n)}};var bV=0,hr=new pe,nm=new nt,Ho=new A,Kn=new Ut,Vc=new Ut,gn=new A,st=class extends pr{constructor(){super();Object.defineProperty(this,"id",{value:bV++}),this.uuid=dr(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(SE(e)?Hm:qm)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){let t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);let n=this.attributes.normal;if(n!==void 0){let i=new xn().getNormalMatrix(e);n.applyNormalMatrix(i),n.needsUpdate=!0}let s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return hr.makeRotationFromQuaternion(e),this.applyMatrix4(hr),this}rotateX(e){return hr.makeRotationX(e),this.applyMatrix4(hr),this}rotateY(e){return hr.makeRotationY(e),this.applyMatrix4(hr),this}rotateZ(e){return hr.makeRotationZ(e),this.applyMatrix4(hr),this}translate(e,t,n){return hr.makeTranslation(e,t,n),this.applyMatrix4(hr),this}scale(e,t,n){return hr.makeScale(e,t,n),this.applyMatrix4(hr),this}lookAt(e){return nm.lookAt(e),nm.updateMatrix(),this.applyMatrix4(nm.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ho).negate(),this.translate(Ho.x,Ho.y,Ho.z),this}setFromPoints(e){let t=[];for(let n=0,s=e.length;n<s;n++){let i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new Je(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Ut);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingBox.set(new A(-1/0,-1/0,-1/0),new A(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,s=t.length;n<s;n++){let i=t[n];Kn.setFromBufferAttribute(i),this.morphTargetsRelative?(gn.addVectors(this.boundingBox.min,Kn.min),this.boundingBox.expandByPoint(gn),gn.addVectors(this.boundingBox.max,Kn.max),this.boundingBox.expandByPoint(gn)):(this.boundingBox.expandByPoint(Kn.min),this.boundingBox.expandByPoint(Kn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new fs);let e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),this.boundingSphere.set(new A,1/0);return}if(e){let n=this.boundingSphere.center;if(Kn.setFromBufferAttribute(e),t)for(let i=0,o=t.length;i<o;i++){let a=t[i];Vc.setFromBufferAttribute(a),this.morphTargetsRelative?(gn.addVectors(Kn.min,Vc.min),Kn.expandByPoint(gn),gn.addVectors(Kn.max,Vc.max),Kn.expandByPoint(gn)):(Kn.expandByPoint(Vc.min),Kn.expandByPoint(Vc.max))}Kn.getCenter(n);let s=0;for(let i=0,o=e.count;i<o;i++)gn.fromBufferAttribute(e,i),s=Math.max(s,n.distanceToSquared(gn));if(t)for(let i=0,o=t.length;i<o;i++){let a=t[i],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)gn.fromBufferAttribute(a,l),c&&(Ho.fromBufferAttribute(e,l),gn.add(Ho)),s=Math.max(s,n.distanceToSquared(gn))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){let e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}let n=e.array,s=t.position.array,i=t.normal.array,o=t.uv.array,a=s.length/3;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new xt(new Float32Array(4*a),4));let c=this.getAttribute("tangent").array,l=[],u=[];for(let N=0;N<a;N++)l[N]=new A,u[N]=new A;let h=new A,d=new A,p=new A,_=new G,f=new G,m=new G,g=new A,x=new A;function b(N,w,T){h.fromArray(s,N*3),d.fromArray(s,w*3),p.fromArray(s,T*3),_.fromArray(o,N*2),f.fromArray(o,w*2),m.fromArray(o,T*2),d.sub(h),p.sub(h),f.sub(_),m.sub(_);let F=1/(f.x*m.y-m.x*f.y);!isFinite(F)||(g.copy(d).multiplyScalar(m.y).addScaledVector(p,-f.y).multiplyScalar(F),x.copy(p).multiplyScalar(f.x).addScaledVector(d,-m.x).multiplyScalar(F),l[N].add(g),l[w].add(g),l[T].add(g),u[N].add(x),u[w].add(x),u[T].add(x))}let v=this.groups;v.length===0&&(v=[{start:0,count:n.length}]);for(let N=0,w=v.length;N<w;++N){let T=v[N],F=T.start,L=T.count;for(let V=F,B=F+L;V<B;V+=3)b(n[V+0],n[V+1],n[V+2])}let y=new A,E=new A,C=new A,M=new A;function R(N){C.fromArray(i,N*3),M.copy(C);let w=l[N];y.copy(w),y.sub(C.multiplyScalar(C.dot(w))).normalize(),E.crossVectors(M,w);let F=E.dot(u[N])<0?-1:1;c[N*4]=y.x,c[N*4+1]=y.y,c[N*4+2]=y.z,c[N*4+3]=F}for(let N=0,w=v.length;N<w;++N){let T=v[N],F=T.start,L=T.count;for(let V=F,B=F+L;V<B;V+=3)R(n[V+0]),R(n[V+1]),R(n[V+2])}}computeVertexNormals(){let e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new xt(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let d=0,p=n.count;d<p;d++)n.setXYZ(d,0,0,0);let s=new A,i=new A,o=new A,a=new A,c=new A,l=new A,u=new A,h=new A;if(e)for(let d=0,p=e.count;d<p;d+=3){let _=e.getX(d+0),f=e.getX(d+1),m=e.getX(d+2);s.fromBufferAttribute(t,_),i.fromBufferAttribute(t,f),o.fromBufferAttribute(t,m),u.subVectors(o,i),h.subVectors(s,i),u.cross(h),a.fromBufferAttribute(n,_),c.fromBufferAttribute(n,f),l.fromBufferAttribute(n,m),a.add(u),c.add(u),l.add(u),n.setXYZ(_,a.x,a.y,a.z),n.setXYZ(f,c.x,c.y,c.z),n.setXYZ(m,l.x,l.y,l.z)}else for(let d=0,p=t.count;d<p;d+=3)s.fromBufferAttribute(t,d+0),i.fromBufferAttribute(t,d+1),o.fromBufferAttribute(t,d+2),u.subVectors(o,i),h.subVectors(s,i),u.cross(h),n.setXYZ(d+0,u.x,u.y,u.z),n.setXYZ(d+1,u.x,u.y,u.z),n.setXYZ(d+2,u.x,u.y,u.z);this.normalizeNormals(),n.needsUpdate=!0}}merge(e,t){if(!(e&&e.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);return}t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));let n=this.attributes;for(let s in n){if(e.attributes[s]===void 0)continue;let o=n[s].array,a=e.attributes[s],c=a.array,l=a.itemSize*t,u=Math.min(c.length,o.length-l);for(let h=0,d=l;h<u;h++,d++)o[d]=c[h]}return this}normalizeNormals(){let e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)gn.fromBufferAttribute(e,t),gn.normalize(),e.setXYZ(t,gn.x,gn.y,gn.z)}toNonIndexed(){function e(a,c){let l=a.array,u=a.itemSize,h=a.normalized,d=new l.constructor(c.length*u),p=0,_=0;for(let f=0,m=c.length;f<m;f++){a.isInterleavedBufferAttribute?p=c[f]*a.data.stride+a.offset:p=c[f]*u;for(let g=0;g<u;g++)d[_++]=l[p++]}return new xt(d,u,h)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;let t=new st,n=this.index.array,s=this.attributes;for(let a in s){let c=s[a],l=e(c,n);t.setAttribute(a,l)}let i=this.morphAttributes;for(let a in i){let c=[],l=i[a];for(let u=0,h=l.length;u<h;u++){let d=l[u],p=e(d,n);c.push(p)}t.morphAttributes[a]=c}t.morphTargetsRelative=this.morphTargetsRelative;let o=this.groups;for(let a=0,c=o.length;a<c;a++){let l=o[a];t.addGroup(l.start,l.count,l.materialIndex)}return t}toJSON(){let e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){let c=this.parameters;for(let l in c)c[l]!==void 0&&(e[l]=c[l]);return e}e.data={attributes:{}};let t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});let n=this.attributes;for(let c in n){let l=n[c];e.data.attributes[c]=l.toJSON(e.data)}let s={},i=!1;for(let c in this.morphAttributes){let l=this.morphAttributes[c],u=[];for(let h=0,d=l.length;h<d;h++){let p=l[h];u.push(p.toJSON(e.data))}u.length>0&&(s[c]=u,i=!0)}i&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);let o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));let a=this.boundingSphere;return a!==null&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;let t={};this.name=e.name;let n=e.index;n!==null&&this.setIndex(n.clone(t));let s=e.attributes;for(let l in s){let u=s[l];this.setAttribute(l,u.clone(t))}let i=e.morphAttributes;for(let l in i){let u=[],h=i[l];for(let d=0,p=h.length;d<p;d++)u.push(h[d].clone(t));this.morphAttributes[l]=u}this.morphTargetsRelative=e.morphTargetsRelative;let o=e.groups;for(let l=0,u=o.length;l<u;l++){let h=o[l];this.addGroup(h.start,h.count,h.materialIndex)}let a=e.boundingBox;a!==null&&(this.boundingBox=a.clone());let c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,e.parameters!==void 0&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}};st.prototype.isBufferGeometry=!0;var ww=new pe,Wo=new Wr,rm=new fs,Hs=new A,Ws=new A,js=new A,sm=new A,im=new A,om=new A,Ku=new A,Qu=new A,eh=new A,th=new G,nh=new G,rh=new G,am=new A,sh=new A,St=class extends nt{constructor(e=new st,t=new Bi){super();this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,o=s.length;i<o;i++){let a=s[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){let n=this.geometry,s=this.material,i=this.matrixWorld;if(s===void 0||(n.boundingSphere===null&&n.computeBoundingSphere(),rm.copy(n.boundingSphere),rm.applyMatrix4(i),e.ray.intersectsSphere(rm)===!1)||(ww.copy(i).invert(),Wo.copy(e.ray).applyMatrix4(ww),n.boundingBox!==null&&Wo.intersectsBox(n.boundingBox)===!1))return;let o;if(n.isBufferGeometry){let a=n.index,c=n.attributes.position,l=n.morphAttributes.position,u=n.morphTargetsRelative,h=n.attributes.uv,d=n.attributes.uv2,p=n.groups,_=n.drawRange;if(a!==null)if(Array.isArray(s))for(let f=0,m=p.length;f<m;f++){let g=p[f],x=s[g.materialIndex],b=Math.max(g.start,_.start),v=Math.min(a.count,Math.min(g.start+g.count,_.start+_.count));for(let y=b,E=v;y<E;y+=3){let C=a.getX(y),M=a.getX(y+1),R=a.getX(y+2);o=ih(this,x,e,Wo,c,l,u,h,d,C,M,R),o&&(o.faceIndex=Math.floor(y/3),o.face.materialIndex=g.materialIndex,t.push(o))}}else{let f=Math.max(0,_.start),m=Math.min(a.count,_.start+_.count);for(let g=f,x=m;g<x;g+=3){let b=a.getX(g),v=a.getX(g+1),y=a.getX(g+2);o=ih(this,s,e,Wo,c,l,u,h,d,b,v,y),o&&(o.faceIndex=Math.floor(g/3),t.push(o))}}else if(c!==void 0)if(Array.isArray(s))for(let f=0,m=p.length;f<m;f++){let g=p[f],x=s[g.materialIndex],b=Math.max(g.start,_.start),v=Math.min(c.count,Math.min(g.start+g.count,_.start+_.count));for(let y=b,E=v;y<E;y+=3){let C=y,M=y+1,R=y+2;o=ih(this,x,e,Wo,c,l,u,h,d,C,M,R),o&&(o.faceIndex=Math.floor(y/3),o.face.materialIndex=g.materialIndex,t.push(o))}}else{let f=Math.max(0,_.start),m=Math.min(c.count,_.start+_.count);for(let g=f,x=m;g<x;g+=3){let b=g,v=g+1,y=g+2;o=ih(this,s,e,Wo,c,l,u,h,d,b,v,y),o&&(o.faceIndex=Math.floor(g/3),t.push(o))}}}else n.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}};St.prototype.isMesh=!0;function wV(r,e,t,n,s,i,o,a){let c;if(e.side===er?c=n.intersectTriangle(o,i,s,!0,a):c=n.intersectTriangle(s,i,o,e.side!==Zs,a),c===null)return null;sh.copy(a),sh.applyMatrix4(r.matrixWorld);let l=t.ray.origin.distanceTo(sh);return l<t.near||l>t.far?null:{distance:l,point:sh.clone(),object:r}}function ih(r,e,t,n,s,i,o,a,c,l,u,h){Hs.fromBufferAttribute(s,l),Ws.fromBufferAttribute(s,u),js.fromBufferAttribute(s,h);let d=r.morphTargetInfluences;if(i&&d){Ku.set(0,0,0),Qu.set(0,0,0),eh.set(0,0,0);for(let _=0,f=i.length;_<f;_++){let m=d[_],g=i[_];m!==0&&(sm.fromBufferAttribute(g,l),im.fromBufferAttribute(g,u),om.fromBufferAttribute(g,h),o?(Ku.addScaledVector(sm,m),Qu.addScaledVector(im,m),eh.addScaledVector(om,m)):(Ku.addScaledVector(sm.sub(Hs),m),Qu.addScaledVector(im.sub(Ws),m),eh.addScaledVector(om.sub(js),m)))}Hs.add(Ku),Ws.add(Qu),js.add(eh)}r.isSkinnedMesh&&(r.boneTransform(l,Hs),r.boneTransform(u,Ws),r.boneTransform(h,js));let p=wV(r,e,t,n,Hs,Ws,js,am);if(p){a&&(th.fromBufferAttribute(a,l),nh.fromBufferAttribute(a,u),rh.fromBufferAttribute(a,h),p.uv=Ct.getUV(am,Hs,Ws,js,th,nh,rh,new G)),c&&(th.fromBufferAttribute(c,l),nh.fromBufferAttribute(c,u),rh.fromBufferAttribute(c,h),p.uv2=Ct.getUV(am,Hs,Ws,js,th,nh,rh,new G));let _={a:l,b:u,c:h,normal:new A,materialIndex:0};Ct.getNormal(Hs,Ws,js,_.normal),p.face=_}return p}var ma=class extends st{constructor(e=1,t=1,n=1,s=1,i=1,o=1){super();this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:s,heightSegments:i,depthSegments:o};let a=this;s=Math.floor(s),i=Math.floor(i),o=Math.floor(o);let c=[],l=[],u=[],h=[],d=0,p=0;_("z","y","x",-1,-1,n,t,e,o,i,0),_("z","y","x",1,-1,n,t,-e,o,i,1),_("x","z","y",1,1,e,n,t,s,o,2),_("x","z","y",1,-1,e,n,-t,s,o,3),_("x","y","z",1,-1,e,t,n,s,i,4),_("x","y","z",-1,-1,e,t,-n,s,i,5),this.setIndex(c),this.setAttribute("position",new Je(l,3)),this.setAttribute("normal",new Je(u,3)),this.setAttribute("uv",new Je(h,2));function _(f,m,g,x,b,v,y,E,C,M,R){let N=v/C,w=y/M,T=v/2,F=y/2,L=E/2,V=C+1,B=M+1,H=0,z=0,X=new A;for(let ee=0;ee<B;ee++){let le=ee*w-F;for(let re=0;re<V;re++){let Pe=re*N-T;X[f]=Pe*x,X[m]=le*b,X[g]=L,l.push(X.x,X.y,X.z),X[f]=0,X[m]=0,X[g]=E>0?1:-1,u.push(X.x,X.y,X.z),h.push(re/C),h.push(1-ee/M),H+=1}}for(let ee=0;ee<M;ee++)for(let le=0;le<C;le++){let re=d+le+V*ee,Pe=d+le+V*(ee+1),He=d+(le+1)+V*(ee+1),ke=d+(le+1)+V*ee;c.push(re,Pe,ke),c.push(Pe,He,ke),z+=6}a.addGroup(p,z,R),p+=z,d+=H}}static fromJSON(e){return new ma(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}};function da(r){let e={};for(let t in r){e[t]={};for(let n in r[t]){let s=r[t][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?e[t][n]=s.clone():Array.isArray(s)?e[t][n]=s.slice():e[t][n]=s}}return e}function Mn(r){let e={};for(let t=0;t<r.length;t++){let n=da(r[t]);for(let s in n)e[s]=n[s]}return e}var Wm={clone:da,merge:Mn},EV=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,CV=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`,Gn=class extends nn{constructor(e){super();this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=EV,this.fragmentShader=CV,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=da(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){let t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(let s in this.uniforms){let o=this.uniforms[s].value;o&&o.isTexture?t.uniforms[s]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[s]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[s]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[s]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[s]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[s]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[s]={type:"m4",value:o.toArray()}:t.uniforms[s]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;let n={};for(let s in this.extensions)this.extensions[s]===!0&&(n[s]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}};Gn.prototype.isShaderMaterial=!0;var _a=class extends nt{constructor(){super();this.type="Camera",this.matrixWorldInverse=new pe,this.projectionMatrix=new pe,this.projectionMatrixInverse=new pe}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);let t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}};_a.prototype.isCamera=!0;var hn=class extends _a{constructor(e=50,t=1,n=.1,s=2e3){super();this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=s,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){let t=.5*this.getFilmHeight()/e;this.fov=el*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){let e=Math.tan(Xc*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return el*2*Math.atan(Math.tan(Xc*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,n,s,i,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=this.near,t=e*Math.tan(Xc*.5*this.fov)/this.zoom,n=2*t,s=this.aspect*n,i=-.5*s,o=this.view;if(this.view!==null&&this.view.enabled){let c=o.fullWidth,l=o.fullHeight;i+=o.offsetX*s/c,t-=o.offsetY*n/l,s*=o.width/c,n*=o.height/l}let a=this.filmOffset;a!==0&&(i+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+s,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};hn.prototype.isPerspectiveCamera=!0;var jo=90,$o=1,Fh=class extends nt{constructor(e,t,n){super();if(this.type="CubeCamera",n.isWebGLCubeRenderTarget!==!0){console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");return}this.renderTarget=n;let s=new hn(jo,$o,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new A(1,0,0)),this.add(s);let i=new hn(jo,$o,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new A(-1,0,0)),this.add(i);let o=new hn(jo,$o,e,t);o.layers=this.layers,o.up.set(0,0,1),o.lookAt(new A(0,1,0)),this.add(o);let a=new hn(jo,$o,e,t);a.layers=this.layers,a.up.set(0,0,-1),a.lookAt(new A(0,-1,0)),this.add(a);let c=new hn(jo,$o,e,t);c.layers=this.layers,c.up.set(0,-1,0),c.lookAt(new A(0,0,1)),this.add(c);let l=new hn(jo,$o,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new A(0,0,-1)),this.add(l)}update(e,t){this.parent===null&&this.updateMatrixWorld();let n=this.renderTarget,[s,i,o,a,c,l]=this.children,u=e.getRenderTarget(),h=e.outputEncoding,d=e.toneMapping,p=e.xr.enabled;e.outputEncoding=Tr,e.toneMapping=Ar,e.xr.enabled=!1;let _=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,s),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,a),e.setRenderTarget(n,4),e.render(t,c),n.texture.generateMipmaps=_,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(u),e.outputEncoding=h,e.toneMapping=d,e.xr.enabled=p,n.texture.needsPMREMUpdate=!0}},cl=class extends Xt{constructor(e,t,n,s,i,o,a,c,l,u){e=e!==void 0?e:[],t=t!==void 0?t:ca;super(e,t,n,s,i,o,a,c,l,u);this.flipY=!1}get images(){return this.image}set images(e){this.image=e}};cl.prototype.isCubeTexture=!0;var jm=class extends En{constructor(e,t={}){super(e,e,t);let n={width:e,height:e,depth:1},s=[n,n,n,n,n,n];this.texture=new cl(s,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Vn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;let n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new ma(5,5,5),i=new Gn({name:"CubemapFromEquirect",uniforms:da(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:er,blending:Xs});i.uniforms.tEquirect.value=t;let o=new St(s,i),a=t.minFilter;return t.minFilter===Lh&&(t.minFilter=Vn),new Fh(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,n,s){let i=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,s);e.setRenderTarget(i)}};jm.prototype.isWebGLCubeRenderTarget=!0;var cm=new A,SV=new A,AV=new xn,qn=class{constructor(e=new A(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,s){return this.normal.set(e,t,n),this.constant=s,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){let s=cm.subVectors(n,t).cross(SV.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){let e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){let n=e.delta(cm),s=this.normal.dot(n);if(s===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;let i=-(e.start.dot(this.normal)+this.constant)/s;return i<0||i>1?null:t.copy(n).multiplyScalar(i).add(e.start)}intersectsLine(e){let t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){let n=t||AV.getNormalMatrix(e),s=this.coplanarPoint(cm).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-s.dot(i),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}};qn.prototype.isPlane=!0;var Xo=new fs,oh=new A,ll=class{constructor(e=new qn,t=new qn,n=new qn,s=new qn,i=new qn,o=new qn){this.planes=[e,t,n,s,i,o]}set(e,t,n,s,i,o){let a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(n),a[3].copy(s),a[4].copy(i),a[5].copy(o),this}copy(e){let t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e){let t=this.planes,n=e.elements,s=n[0],i=n[1],o=n[2],a=n[3],c=n[4],l=n[5],u=n[6],h=n[7],d=n[8],p=n[9],_=n[10],f=n[11],m=n[12],g=n[13],x=n[14],b=n[15];return t[0].setComponents(a-s,h-c,f-d,b-m).normalize(),t[1].setComponents(a+s,h+c,f+d,b+m).normalize(),t[2].setComponents(a+i,h+l,f+p,b+g).normalize(),t[3].setComponents(a-i,h-l,f-p,b-g).normalize(),t[4].setComponents(a-o,h-u,f-_,b-x).normalize(),t[5].setComponents(a+o,h+u,f+_,b+x).normalize(),this}intersectsObject(e){let t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Xo.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Xo)}intersectsSprite(e){return Xo.center.set(0,0,0),Xo.radius=.7071067811865476,Xo.applyMatrix4(e.matrixWorld),this.intersectsSphere(Xo)}intersectsSphere(e){let t=this.planes,n=e.center,s=-e.radius;for(let i=0;i<6;i++)if(t[i].distanceToPoint(n)<s)return!1;return!0}intersectsBox(e){let t=this.planes;for(let n=0;n<6;n++){let s=t[n];if(oh.x=s.normal.x>0?e.max.x:e.min.x,oh.y=s.normal.y>0?e.max.y:e.min.y,oh.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(oh)<0)return!1}return!0}containsPoint(e){let t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}};function RE(){let r=null,e=!1,t=null,n=null;function s(i,o){t(i,o),n=r.requestAnimationFrame(s)}return{start:function(){e!==!0&&t!==null&&(n=r.requestAnimationFrame(s),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(i){t=i},setContext:function(i){r=i}}}function TV(r,e){let t=e.isWebGL2,n=new WeakMap;function s(l,u){let h=l.array,d=l.usage,p=r.createBuffer();r.bindBuffer(u,p),r.bufferData(u,h,d),l.onUploadCallback();let _;if(h instanceof Float32Array)_=5126;else if(h instanceof Uint16Array)if(l.isFloat16BufferAttribute)if(t)_=5131;else throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");else _=5123;else if(h instanceof Int16Array)_=5122;else if(h instanceof Uint32Array)_=5125;else if(h instanceof Int32Array)_=5124;else if(h instanceof Int8Array)_=5120;else if(h instanceof Uint8Array)_=5121;else if(h instanceof Uint8ClampedArray)_=5121;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+h);return{buffer:p,type:_,bytesPerElement:h.BYTES_PER_ELEMENT,version:l.version}}function i(l,u,h){let d=u.array,p=u.updateRange;r.bindBuffer(h,l),p.count===-1?r.bufferSubData(h,0,d):(t?r.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d,p.offset,p.count):r.bufferSubData(h,p.offset*d.BYTES_PER_ELEMENT,d.subarray(p.offset,p.offset+p.count)),p.count=-1)}function o(l){return l.isInterleavedBufferAttribute&&(l=l.data),n.get(l)}function a(l){l.isInterleavedBufferAttribute&&(l=l.data);let u=n.get(l);u&&(r.deleteBuffer(u.buffer),n.delete(l))}function c(l,u){if(l.isGLBufferAttribute){let d=n.get(l);(!d||d.version<l.version)&&n.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);let h=n.get(l);h===void 0?n.set(l,s(l,u)):h.version<l.version&&(i(h.buffer,l,u),h.version=l.version)}return{get:o,remove:a,update:c}}var Uh=class extends st{constructor(e=1,t=1,n=1,s=1){super();this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:s};let i=e/2,o=t/2,a=Math.floor(n),c=Math.floor(s),l=a+1,u=c+1,h=e/a,d=t/c,p=[],_=[],f=[],m=[];for(let g=0;g<u;g++){let x=g*d-o;for(let b=0;b<l;b++){let v=b*h-i;_.push(v,-x,0),f.push(0,0,1),m.push(b/a),m.push(1-g/c)}}for(let g=0;g<c;g++)for(let x=0;x<a;x++){let b=x+l*g,v=x+l*(g+1),y=x+1+l*(g+1),E=x+1+l*g;p.push(b,v,E),p.push(v,y,E)}this.setIndex(p),this.setAttribute("position",new Je(_,3)),this.setAttribute("normal",new Je(f,3)),this.setAttribute("uv",new Je(m,2))}static fromJSON(e){return new Uh(e.width,e.height,e.widthSegments,e.heightSegments)}},MV=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,PV=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,NV=`#ifdef USE_ALPHATEST
	if ( diffuseColor.a < alphaTest ) discard;
#endif`,RV=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,OV=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,IV=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,DV="vec3 transformed = vec3( position );",LV=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,BV=`vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif`,kV=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,FV=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop_start
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
	}
	#pragma unroll_loop_end
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop_start
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
		}
		#pragma unroll_loop_end
		if ( clipped ) discard;
	#endif
#endif`,UV=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,zV=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,VV=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,qV=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,GV=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,HV=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,WV=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,jV=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}`,$V=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		vec2 uv = getUV( direction, face ) * ( faceSize - 1.0 ) + 0.5;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define r0 1.0
	#define v0 0.339
	#define m0 - 2.0
	#define r1 0.8
	#define v1 0.276
	#define m1 - 1.0
	#define r4 0.4
	#define v4 0.046
	#define m4 2.0
	#define r5 0.305
	#define v5 0.016
	#define m5 3.0
	#define r6 0.21
	#define v6 0.0038
	#define m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= r1 ) {
			mip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;
		} else if ( roughness >= r4 ) {
			mip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;
		} else if ( roughness >= r5 ) {
			mip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;
		} else if ( roughness >= r6 ) {
			mip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,XV=`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	mat3 m = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );
	transformedNormal = m * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,YV=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,ZV=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,JV=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,KV=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,QV="gl_FragColor = linearToOutputTexel( gl_FragColor );",eq=`vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,tq=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,nq=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,rq=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,sq=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,iq=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,oq=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,aq=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,cq=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,lq=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,uq=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,hq=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vUv2 );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,dq=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,pq=`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
vIndirectFront += getAmbientLightIrradiance( ambientLightColor );
vIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );
#ifdef DOUBLE_SIDED
	vIndirectBack += getAmbientLightIrradiance( ambientLightColor );
	vIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );
#endif
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointLightInfo( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotLightInfo( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalLightInfo( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( - dotNL ) * directLightColor_Diffuse;
		#endif
	}
	#pragma unroll_loop_end
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );
		#endif
	}
	#pragma unroll_loop_end
#endif`,fq=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( PHYSICALLY_CORRECT_LIGHTS )
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#else
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometry.position;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometry.position;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,mq=`#if defined( USE_ENVMAP )
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#if defined( ENVMAP_TYPE_CUBE_UV )
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
#endif`,_q=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,gq=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,yq=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,xq=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,vq=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	#ifdef SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULARINTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;
		#endif
		#ifdef USE_SPECULARCOLORMAP
			specularColorFactor *= texture2D( specularColorMap, vUv ).rgb;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEENCOLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEENROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;
	#endif
#endif`,bq=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
};
vec3 clearcoatSpecular = vec3( 0.0 );
vec3 sheenSpecular = vec3( 0.0 );
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	vec3 FssEss = specularColor * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	computeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,wq=`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef USE_CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Eq=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometry.normal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Cq=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,Sq=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Aq=`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Tq=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,Mq=`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,Pq=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Nq=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Rq=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,Oq=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Iq=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,Dq=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Lq=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Bq=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,kq=`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Fq=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Uq=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * faceDirection;
			bitangent = bitangent * faceDirection;
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,zq=`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Vq=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,qq=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Gq=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,Hq=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );
		return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );
	}
#endif`,Wq=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,jq=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );
	#endif
#endif`,$q=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,Xq=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= transmissionAlpha + 0.1;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Yq=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,Zq=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,Jq=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,Kq=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,Qq=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,eG=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,tG=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,nG=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,rG=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,sG=`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0
		vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		vec4 shadowWorldPosition;
	#endif
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
	#endif
#endif`,iG=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,oG=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,aG=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,cG=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,lG=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,uG=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,hG=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,dG=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,pG=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,fG=`#ifdef USE_TRANSMISSION
	float transmissionAlpha = 1.0;
	float transmissionFactor = transmission;
	float thicknessFactor = thickness;
	#ifdef USE_TRANSMISSIONMAP
		transmissionFactor *= texture2D( transmissionMap, vUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		thicknessFactor *= texture2D( thicknessMap, vUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmission = getIBLVolumeRefraction(
		n, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,
		attenuationColor, attenuationDistance );
	totalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );
	transmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );
#endif`,mG=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		#ifdef texture2DLodEXT
			return texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#else
			return texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );
		#endif
	}
	vec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( attenuationDistance == 0.0 ) {
			return radiance;
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance * radiance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		return vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );
	}
#endif`,_G=`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,gG=`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,yG=`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,xG=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,vG=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,bG=`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,wG=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,EG=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,CG=`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	gl_FragColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		gl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );
	#endif
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,SG=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,AG=`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,TG=`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,MG=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,PG=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,NG=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,RG=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,OG=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,IG=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,DG=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,LG=`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,BG=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kG=`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,FG=`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,UG=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,zG=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,VG=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,qG=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,GG=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,HG=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,WG=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,jG=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULARINTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
	#ifdef USE_SPECULARCOLORMAP
		uniform sampler2D specularColorMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEENCOLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEENROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;
	#endif
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$G=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,XG=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,YG=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,ZG=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,JG=`#include <common>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,KG=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,QG=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,eH=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <output_fragment>
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,ot={alphamap_fragment:MV,alphamap_pars_fragment:PV,alphatest_fragment:NV,alphatest_pars_fragment:RV,aomap_fragment:OV,aomap_pars_fragment:IV,begin_vertex:DV,beginnormal_vertex:LV,bsdfs:BV,bumpmap_pars_fragment:kV,clipping_planes_fragment:FV,clipping_planes_pars_fragment:UV,clipping_planes_pars_vertex:zV,clipping_planes_vertex:VV,color_fragment:qV,color_pars_fragment:GV,color_pars_vertex:HV,color_vertex:WV,common:jV,cube_uv_reflection_fragment:$V,defaultnormal_vertex:XV,displacementmap_pars_vertex:YV,displacementmap_vertex:ZV,emissivemap_fragment:JV,emissivemap_pars_fragment:KV,encodings_fragment:QV,encodings_pars_fragment:eq,envmap_fragment:tq,envmap_common_pars_fragment:nq,envmap_pars_fragment:rq,envmap_pars_vertex:sq,envmap_physical_pars_fragment:mq,envmap_vertex:iq,fog_vertex:oq,fog_pars_vertex:aq,fog_fragment:cq,fog_pars_fragment:lq,gradientmap_pars_fragment:uq,lightmap_fragment:hq,lightmap_pars_fragment:dq,lights_lambert_vertex:pq,lights_pars_begin:fq,lights_toon_fragment:_q,lights_toon_pars_fragment:gq,lights_phong_fragment:yq,lights_phong_pars_fragment:xq,lights_physical_fragment:vq,lights_physical_pars_fragment:bq,lights_fragment_begin:wq,lights_fragment_maps:Eq,lights_fragment_end:Cq,logdepthbuf_fragment:Sq,logdepthbuf_pars_fragment:Aq,logdepthbuf_pars_vertex:Tq,logdepthbuf_vertex:Mq,map_fragment:Pq,map_pars_fragment:Nq,map_particle_fragment:Rq,map_particle_pars_fragment:Oq,metalnessmap_fragment:Iq,metalnessmap_pars_fragment:Dq,morphcolor_vertex:Lq,morphnormal_vertex:Bq,morphtarget_pars_vertex:kq,morphtarget_vertex:Fq,normal_fragment_begin:Uq,normal_fragment_maps:zq,normal_pars_fragment:Vq,normal_pars_vertex:qq,normal_vertex:Gq,normalmap_pars_fragment:Hq,clearcoat_normal_fragment_begin:Wq,clearcoat_normal_fragment_maps:jq,clearcoat_pars_fragment:$q,output_fragment:Xq,packing:Yq,premultiplied_alpha_fragment:Zq,project_vertex:Jq,dithering_fragment:Kq,dithering_pars_fragment:Qq,roughnessmap_fragment:eG,roughnessmap_pars_fragment:tG,shadowmap_pars_fragment:nG,shadowmap_pars_vertex:rG,shadowmap_vertex:sG,shadowmask_pars_fragment:iG,skinbase_vertex:oG,skinning_pars_vertex:aG,skinning_vertex:cG,skinnormal_vertex:lG,specularmap_fragment:uG,specularmap_pars_fragment:hG,tonemapping_fragment:dG,tonemapping_pars_fragment:pG,transmission_fragment:fG,transmission_pars_fragment:mG,uv_pars_fragment:_G,uv_pars_vertex:gG,uv_vertex:yG,uv2_pars_fragment:xG,uv2_pars_vertex:vG,uv2_vertex:bG,worldpos_vertex:wG,background_vert:EG,background_frag:CG,cube_vert:SG,cube_frag:AG,depth_vert:TG,depth_frag:MG,distanceRGBA_vert:PG,distanceRGBA_frag:NG,equirect_vert:RG,equirect_frag:OG,linedashed_vert:IG,linedashed_frag:DG,meshbasic_vert:LG,meshbasic_frag:BG,meshlambert_vert:kG,meshlambert_frag:FG,meshmatcap_vert:UG,meshmatcap_frag:zG,meshnormal_vert:VG,meshnormal_frag:qG,meshphong_vert:GG,meshphong_frag:HG,meshphysical_vert:WG,meshphysical_frag:jG,meshtoon_vert:$G,meshtoon_frag:XG,points_vert:YG,points_frag:ZG,shadow_vert:JG,shadow_frag:KG,sprite_vert:QG,sprite_frag:eH},ye={common:{diffuse:{value:new ae(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new xn},uv2Transform:{value:new xn},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new G(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ae(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ae(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new xn}},sprite:{diffuse:{value:new ae(16777215)},opacity:{value:1},center:{value:new G(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new xn}}},Hr={basic:{uniforms:Mn([ye.common,ye.specularmap,ye.envmap,ye.aomap,ye.lightmap,ye.fog]),vertexShader:ot.meshbasic_vert,fragmentShader:ot.meshbasic_frag},lambert:{uniforms:Mn([ye.common,ye.specularmap,ye.envmap,ye.aomap,ye.lightmap,ye.emissivemap,ye.fog,ye.lights,{emissive:{value:new ae(0)}}]),vertexShader:ot.meshlambert_vert,fragmentShader:ot.meshlambert_frag},phong:{uniforms:Mn([ye.common,ye.specularmap,ye.envmap,ye.aomap,ye.lightmap,ye.emissivemap,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.fog,ye.lights,{emissive:{value:new ae(0)},specular:{value:new ae(1118481)},shininess:{value:30}}]),vertexShader:ot.meshphong_vert,fragmentShader:ot.meshphong_frag},standard:{uniforms:Mn([ye.common,ye.envmap,ye.aomap,ye.lightmap,ye.emissivemap,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.roughnessmap,ye.metalnessmap,ye.fog,ye.lights,{emissive:{value:new ae(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ot.meshphysical_vert,fragmentShader:ot.meshphysical_frag},toon:{uniforms:Mn([ye.common,ye.aomap,ye.lightmap,ye.emissivemap,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.gradientmap,ye.fog,ye.lights,{emissive:{value:new ae(0)}}]),vertexShader:ot.meshtoon_vert,fragmentShader:ot.meshtoon_frag},matcap:{uniforms:Mn([ye.common,ye.bumpmap,ye.normalmap,ye.displacementmap,ye.fog,{matcap:{value:null}}]),vertexShader:ot.meshmatcap_vert,fragmentShader:ot.meshmatcap_frag},points:{uniforms:Mn([ye.points,ye.fog]),vertexShader:ot.points_vert,fragmentShader:ot.points_frag},dashed:{uniforms:Mn([ye.common,ye.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ot.linedashed_vert,fragmentShader:ot.linedashed_frag},depth:{uniforms:Mn([ye.common,ye.displacementmap]),vertexShader:ot.depth_vert,fragmentShader:ot.depth_frag},normal:{uniforms:Mn([ye.common,ye.bumpmap,ye.normalmap,ye.displacementmap,{opacity:{value:1}}]),vertexShader:ot.meshnormal_vert,fragmentShader:ot.meshnormal_frag},sprite:{uniforms:Mn([ye.sprite,ye.fog]),vertexShader:ot.sprite_vert,fragmentShader:ot.sprite_frag},background:{uniforms:{uvTransform:{value:new xn},t2D:{value:null}},vertexShader:ot.background_vert,fragmentShader:ot.background_frag},cube:{uniforms:Mn([ye.envmap,{opacity:{value:1}}]),vertexShader:ot.cube_vert,fragmentShader:ot.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ot.equirect_vert,fragmentShader:ot.equirect_frag},distanceRGBA:{uniforms:Mn([ye.common,ye.displacementmap,{referencePosition:{value:new A},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ot.distanceRGBA_vert,fragmentShader:ot.distanceRGBA_frag},shadow:{uniforms:Mn([ye.lights,ye.fog,{color:{value:new ae(0)},opacity:{value:1}}]),vertexShader:ot.shadow_vert,fragmentShader:ot.shadow_frag}};Hr.physical={uniforms:Mn([Hr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new G(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new ae(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new G},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new ae(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new ae(1,1,1)},specularColorMap:{value:null}}]),vertexShader:ot.meshphysical_vert,fragmentShader:ot.meshphysical_frag};function tH(r,e,t,n,s,i){let o=new ae(0),a=s===!0?0:1,c,l,u=null,h=0,d=null;function p(f,m){let g=!1,x=m.isScene===!0?m.background:null;x&&x.isTexture&&(x=e.get(x));let b=r.xr,v=b.getSession&&b.getSession();v&&v.environmentBlendMode==="additive"&&(x=null),x===null?_(o,a):x&&x.isColor&&(_(x,1),g=!0),(r.autoClear||g)&&r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil),x&&(x.isCubeTexture||x.mapping===Dh)?(l===void 0&&(l=new St(new ma(1,1,1),new Gn({name:"BackgroundCubeMaterial",uniforms:da(Hr.cube.uniforms),vertexShader:Hr.cube.vertexShader,fragmentShader:Hr.cube.fragmentShader,side:er,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),l.geometry.deleteAttribute("uv"),l.onBeforeRender=function(y,E,C){this.matrixWorld.copyPosition(C.matrixWorld)},Object.defineProperty(l.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(l)),l.material.uniforms.envMap.value=x,l.material.uniforms.flipEnvMap.value=x.isCubeTexture&&x.isRenderTargetTexture===!1?-1:1,(u!==x||h!==x.version||d!==r.toneMapping)&&(l.material.needsUpdate=!0,u=x,h=x.version,d=r.toneMapping),f.unshift(l,l.geometry,l.material,0,0,null)):x&&x.isTexture&&(c===void 0&&(c=new St(new Uh(2,2),new Gn({name:"BackgroundMaterial",uniforms:da(Hr.background.uniforms),vertexShader:Hr.background.vertexShader,fragmentShader:Hr.background.fragmentShader,side:tr,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(c)),c.material.uniforms.t2D.value=x,x.matrixAutoUpdate===!0&&x.updateMatrix(),c.material.uniforms.uvTransform.value.copy(x.matrix),(u!==x||h!==x.version||d!==r.toneMapping)&&(c.material.needsUpdate=!0,u=x,h=x.version,d=r.toneMapping),f.unshift(c,c.geometry,c.material,0,0,null))}function _(f,m){t.buffers.color.setClear(f.r,f.g,f.b,m,i)}return{getClearColor:function(){return o},setClearColor:function(f,m=1){o.set(f),a=m,_(o,a)},getClearAlpha:function(){return a},setClearAlpha:function(f){a=f,_(o,a)},render:p}}function nH(r,e,t,n){let s=r.getParameter(34921),i=n.isWebGL2?null:e.get("OES_vertex_array_object"),o=n.isWebGL2||i!==null,a={},c=m(null),l=c,u=!1;function h(L,V,B,H,z){let X=!1;if(o){let ee=f(H,B,V);l!==ee&&(l=ee,p(l.object)),X=g(H,z),X&&x(H,z)}else{let ee=V.wireframe===!0;(l.geometry!==H.id||l.program!==B.id||l.wireframe!==ee)&&(l.geometry=H.id,l.program=B.id,l.wireframe=ee,X=!0)}L.isInstancedMesh===!0&&(X=!0),z!==null&&t.update(z,34963),(X||u)&&(u=!1,M(L,V,B,H),z!==null&&r.bindBuffer(34963,t.get(z).buffer))}function d(){return n.isWebGL2?r.createVertexArray():i.createVertexArrayOES()}function p(L){return n.isWebGL2?r.bindVertexArray(L):i.bindVertexArrayOES(L)}function _(L){return n.isWebGL2?r.deleteVertexArray(L):i.deleteVertexArrayOES(L)}function f(L,V,B){let H=B.wireframe===!0,z=a[L.id];z===void 0&&(z={},a[L.id]=z);let X=z[V.id];X===void 0&&(X={},z[V.id]=X);let ee=X[H];return ee===void 0&&(ee=m(d()),X[H]=ee),ee}function m(L){let V=[],B=[],H=[];for(let z=0;z<s;z++)V[z]=0,B[z]=0,H[z]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:V,enabledAttributes:B,attributeDivisors:H,object:L,attributes:{},index:null}}function g(L,V){let B=l.attributes,H=L.attributes,z=0;for(let X in H){let ee=B[X],le=H[X];if(ee===void 0||ee.attribute!==le||ee.data!==le.data)return!0;z++}return l.attributesNum!==z||l.index!==V}function x(L,V){let B={},H=L.attributes,z=0;for(let X in H){let ee=H[X],le={};le.attribute=ee,ee.data&&(le.data=ee.data),B[X]=le,z++}l.attributes=B,l.attributesNum=z,l.index=V}function b(){let L=l.newAttributes;for(let V=0,B=L.length;V<B;V++)L[V]=0}function v(L){y(L,0)}function y(L,V){let B=l.newAttributes,H=l.enabledAttributes,z=l.attributeDivisors;B[L]=1,H[L]===0&&(r.enableVertexAttribArray(L),H[L]=1),z[L]!==V&&((n.isWebGL2?r:e.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](L,V),z[L]=V)}function E(){let L=l.newAttributes,V=l.enabledAttributes;for(let B=0,H=V.length;B<H;B++)V[B]!==L[B]&&(r.disableVertexAttribArray(B),V[B]=0)}function C(L,V,B,H,z,X){n.isWebGL2===!0&&(B===5124||B===5125)?r.vertexAttribIPointer(L,V,B,z,X):r.vertexAttribPointer(L,V,B,H,z,X)}function M(L,V,B,H){if(n.isWebGL2===!1&&(L.isInstancedMesh||H.isInstancedBufferGeometry)&&e.get("ANGLE_instanced_arrays")===null)return;b();let z=H.attributes,X=B.getAttributes(),ee=V.defaultAttributeValues;for(let le in X){let re=X[le];if(re.location>=0){let Pe=z[le];if(Pe===void 0&&(le==="instanceMatrix"&&L.instanceMatrix&&(Pe=L.instanceMatrix),le==="instanceColor"&&L.instanceColor&&(Pe=L.instanceColor)),Pe!==void 0){let He=Pe.normalized,ke=Pe.itemSize,Q=t.get(Pe);if(Q===void 0)continue;let ut=Q.buffer,Ze=Q.type,Xe=Q.bytesPerElement;if(Pe.isInterleavedBufferAttribute){let fe=Pe.data,et=fe.stride,K=Pe.offset;if(fe.isInstancedInterleavedBuffer){for(let te=0;te<re.locationSize;te++)y(re.location+te,fe.meshPerAttribute);L.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=fe.meshPerAttribute*fe.count)}else for(let te=0;te<re.locationSize;te++)v(re.location+te);r.bindBuffer(34962,ut);for(let te=0;te<re.locationSize;te++)C(re.location+te,ke/re.locationSize,Ze,He,et*Xe,(K+ke/re.locationSize*te)*Xe)}else{if(Pe.isInstancedBufferAttribute){for(let fe=0;fe<re.locationSize;fe++)y(re.location+fe,Pe.meshPerAttribute);L.isInstancedMesh!==!0&&H._maxInstanceCount===void 0&&(H._maxInstanceCount=Pe.meshPerAttribute*Pe.count)}else for(let fe=0;fe<re.locationSize;fe++)v(re.location+fe);r.bindBuffer(34962,ut);for(let fe=0;fe<re.locationSize;fe++)C(re.location+fe,ke/re.locationSize,Ze,He,ke*Xe,ke/re.locationSize*fe*Xe)}}else if(ee!==void 0){let He=ee[le];if(He!==void 0)switch(He.length){case 2:r.vertexAttrib2fv(re.location,He);break;case 3:r.vertexAttrib3fv(re.location,He);break;case 4:r.vertexAttrib4fv(re.location,He);break;default:r.vertexAttrib1fv(re.location,He)}}}}E()}function R(){T();for(let L in a){let V=a[L];for(let B in V){let H=V[B];for(let z in H)_(H[z].object),delete H[z];delete V[B]}delete a[L]}}function N(L){if(a[L.id]===void 0)return;let V=a[L.id];for(let B in V){let H=V[B];for(let z in H)_(H[z].object),delete H[z];delete V[B]}delete a[L.id]}function w(L){for(let V in a){let B=a[V];if(B[L.id]===void 0)continue;let H=B[L.id];for(let z in H)_(H[z].object),delete H[z];delete B[L.id]}}function T(){F(),u=!0,l!==c&&(l=c,p(l.object))}function F(){c.geometry=null,c.program=null,c.wireframe=!1}return{setup:h,reset:T,resetDefaultState:F,dispose:R,releaseStatesOfGeometry:N,releaseStatesOfProgram:w,initAttributes:b,enableAttribute:v,disableUnusedAttributes:E}}function rH(r,e,t,n){let s=n.isWebGL2,i;function o(l){i=l}function a(l,u){r.drawArrays(i,l,u),t.update(u,i,1)}function c(l,u,h){if(h===0)return;let d,p;if(s)d=r,p="drawArraysInstanced";else if(d=e.get("ANGLE_instanced_arrays"),p="drawArraysInstancedANGLE",d===null){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}d[p](i,l,u,h),t.update(u,i,h)}this.setMode=o,this.render=a,this.renderInstances=c}function sH(r,e,t){let n;function s(){if(n!==void 0)return n;if(e.has("EXT_texture_filter_anisotropic")===!0){let C=e.get("EXT_texture_filter_anisotropic");n=r.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n}function i(C){if(C==="highp"){if(r.getShaderPrecisionFormat(35633,36338).precision>0&&r.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";C="mediump"}return C==="mediump"&&r.getShaderPrecisionFormat(35633,36337).precision>0&&r.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}let o=typeof WebGL2RenderingContext<"u"&&r instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&r instanceof WebGL2ComputeRenderingContext,a=t.precision!==void 0?t.precision:"highp",c=i(a);c!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",c,"instead."),a=c);let l=o||e.has("WEBGL_draw_buffers"),u=t.logarithmicDepthBuffer===!0,h=r.getParameter(34930),d=r.getParameter(35660),p=r.getParameter(3379),_=r.getParameter(34076),f=r.getParameter(34921),m=r.getParameter(36347),g=r.getParameter(36348),x=r.getParameter(36349),b=d>0,v=o||e.has("OES_texture_float"),y=b&&v,E=o?r.getParameter(36183):0;return{isWebGL2:o,drawBuffers:l,getMaxAnisotropy:s,getMaxPrecision:i,precision:a,logarithmicDepthBuffer:u,maxTextures:h,maxVertexTextures:d,maxTextureSize:p,maxCubemapSize:_,maxAttributes:f,maxVertexUniforms:m,maxVaryings:g,maxFragmentUniforms:x,vertexTextures:b,floatFragmentTextures:v,floatVertexTextures:y,maxSamples:E}}function iH(r){let e=this,t=null,n=0,s=!1,i=!1,o=new qn,a=new xn,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(h,d,p){let _=h.length!==0||d||n!==0||s;return s=d,t=u(h,p,0),n=h.length,_},this.beginShadows=function(){i=!0,u(null)},this.endShadows=function(){i=!1,l()},this.setState=function(h,d,p){let _=h.clippingPlanes,f=h.clipIntersection,m=h.clipShadows,g=r.get(h);if(!s||_===null||_.length===0||i&&!m)i?u(null):l();else{let x=i?0:n,b=x*4,v=g.clippingState||null;c.value=v,v=u(_,d,b,p);for(let y=0;y!==b;++y)v[y]=t[y];g.clippingState=v,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=x}};function l(){c.value!==t&&(c.value=t,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function u(h,d,p,_){let f=h!==null?h.length:0,m=null;if(f!==0){if(m=c.value,_!==!0||m===null){let g=p+f*4,x=d.matrixWorldInverse;a.getNormalMatrix(x),(m===null||m.length<g)&&(m=new Float32Array(g));for(let b=0,v=p;b!==f;++b,v+=4)o.copy(h[b]).applyMatrix4(x,a),o.normal.toArray(m,v),m[v+3]=o.constant}c.value=m,c.needsUpdate=!0}return e.numPlanes=f,e.numIntersection=0,m}}function oH(r){let e=new WeakMap;function t(o,a){return a===bm?o.mapping=ca:a===wm&&(o.mapping=la),o}function n(o){if(o&&o.isTexture&&o.isRenderTargetTexture===!1){let a=o.mapping;if(a===bm||a===wm)if(e.has(o)){let c=e.get(o).texture;return t(c,o.mapping)}else{let c=o.image;if(c&&c.height>0){let l=new jm(c.height/2);return l.fromEquirectangularTexture(r,o),e.set(o,l),o.addEventListener("dispose",s),t(l.texture,o.mapping)}else return null}}return o}function s(o){let a=o.target;a.removeEventListener("dispose",s);let c=e.get(a);c!==void 0&&(e.delete(a),c.dispose())}function i(){e=new WeakMap}return{get:n,dispose:i}}var ga=class extends _a{constructor(e=-1,t=1,n=1,s=-1,i=.1,o=2e3){super();this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=s,this.near=i,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,s,i,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=s,this.view.width=i,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){let e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,s=(this.top+this.bottom)/2,i=n-e,o=n+e,a=s+t,c=s-t;if(this.view!==null&&this.view.enabled){let l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i+=l*this.view.offsetX,o=i+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(i,o,a,c,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){let t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}};ga.prototype.isOrthographicCamera=!0;var ra=4,Ew=[.125,.215,.35,.446,.526,.582],Ti=20,lm=new ga,Cw=new ae,um=null,Ai=(1+Math.sqrt(5))/2,Yo=1/Ai,Sw=[new A(1,1,1),new A(-1,1,1),new A(1,1,-1),new A(-1,1,-1),new A(0,Ai,Yo),new A(0,Ai,-Yo),new A(Yo,0,Ai),new A(-Yo,0,Ai),new A(Ai,Yo,0),new A(-Ai,Yo,0)],Am=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,s=100){um=this._renderer.getRenderTarget(),this._setSize(256);let i=this._allocateTargets();return i.depthBuffer=!0,this._sceneToCubeUV(e,n,s,i),t>0&&this._blur(i,0,0,t),this._applyPMREM(i),this._cleanup(i),i}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=Mw(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Tw(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(um),e.scissorTest=!1,ah(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===ca||e.mapping===la?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),um=this._renderer.getRenderTarget();let n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){let e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize-32,n={magFilter:Vn,minFilter:Vn,generateMipmaps:!1,type:oa,format:Qn,encoding:Tr,depthBuffer:!1},s=Aw(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Aw(e,t,n);let{_lodMax:i}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=aH(i)),this._blurMaterial=cH(i,e,t)}return s}_compileMaterial(e){let t=new St(this._lodPlanes[0],e);this._renderer.compile(t,lm)}_sceneToCubeUV(e,t,n,s){let a=new hn(90,1,t,n),c=[1,-1,1,1,1,1],l=[1,1,1,-1,-1,-1],u=this._renderer,h=u.autoClear,d=u.toneMapping;u.getClearColor(Cw),u.toneMapping=Ar,u.autoClear=!1;let p=new Bi({name:"PMREM.Background",side:er,depthWrite:!1,depthTest:!1}),_=new St(new ma,p),f=!1,m=e.background;m?m.isColor&&(p.color.copy(m),e.background=null,f=!0):(p.color.copy(Cw),f=!0);for(let g=0;g<6;g++){let x=g%3;x===0?(a.up.set(0,c[g],0),a.lookAt(l[g],0,0)):x===1?(a.up.set(0,0,c[g]),a.lookAt(0,l[g],0)):(a.up.set(0,c[g],0),a.lookAt(0,0,l[g]));let b=this._cubeSize;ah(s,x*b,g>2?b:0,b,b),u.setRenderTarget(s),f&&u.render(_,a),u.render(e,a)}_.geometry.dispose(),_.material.dispose(),u.toneMapping=d,u.autoClear=h,e.background=m}_textureToCubeUV(e,t){let n=this._renderer,s=e.mapping===ca||e.mapping===la;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=Mw()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=Tw());let i=s?this._cubemapMaterial:this._equirectMaterial,o=new St(this._lodPlanes[0],i),a=i.uniforms;a.envMap.value=e;let c=this._cubeSize;ah(t,0,0,3*c,2*c),n.setRenderTarget(t),n.render(o,lm)}_applyPMREM(e){let t=this._renderer,n=t.autoClear;t.autoClear=!1;for(let s=1;s<this._lodPlanes.length;s++){let i=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),o=Sw[(s-1)%Sw.length];this._blur(e,s-1,s,i,o)}t.autoClear=n}_blur(e,t,n,s,i){let o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,s,"latitudinal",i),this._halfBlur(o,e,n,n,s,"longitudinal",i)}_halfBlur(e,t,n,s,i,o,a){let c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");let u=3,h=new St(this._lodPlanes[s],l),d=l.uniforms,p=this._sizeLods[n]-1,_=isFinite(i)?Math.PI/(2*p):2*Math.PI/(2*Ti-1),f=i/_,m=isFinite(i)?1+Math.floor(u*f):Ti;m>Ti&&console.warn(`sigmaRadians, ${i}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${Ti}`);let g=[],x=0;for(let C=0;C<Ti;++C){let M=C/f,R=Math.exp(-M*M/2);g.push(R),C===0?x+=R:C<m&&(x+=2*R)}for(let C=0;C<g.length;C++)g[C]=g[C]/x;d.envMap.value=e.texture,d.samples.value=m,d.weights.value=g,d.latitudinal.value=o==="latitudinal",a&&(d.poleAxis.value=a);let{_lodMax:b}=this;d.dTheta.value=_,d.mipInt.value=b-n;let v=this._sizeLods[s],y=3*v*(s>b-ra?s-b+ra:0),E=4*(this._cubeSize-v);ah(t,y,E,3*v,2*v),c.setRenderTarget(t),c.render(h,lm)}};function aH(r){let e=[],t=[],n=[],s=r,i=r-ra+1+Ew.length;for(let o=0;o<i;o++){let a=Math.pow(2,s);t.push(a);let c=1/a;o>r-ra?c=Ew[o-r+ra-1]:o===0&&(c=0),n.push(c);let l=1/(a-1),u=-l/2,h=1+l/2,d=[u,u,h,u,h,h,u,u,h,h,u,h],p=6,_=6,f=3,m=2,g=1,x=new Float32Array(f*_*p),b=new Float32Array(m*_*p),v=new Float32Array(g*_*p);for(let E=0;E<p;E++){let C=E%3*2/3-1,M=E>2?0:-1,R=[C,M,0,C+2/3,M,0,C+2/3,M+1,0,C,M,0,C+2/3,M+1,0,C,M+1,0];x.set(R,f*_*E),b.set(d,m*_*E);let N=[E,E,E,E,E,E];v.set(N,g*_*E)}let y=new st;y.setAttribute("position",new xt(x,f)),y.setAttribute("uv",new xt(b,m)),y.setAttribute("faceIndex",new xt(v,g)),e.push(y),s>ra&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function Aw(r,e,t){let n=new En(r,e,t);return n.texture.mapping=Dh,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function ah(r,e,t,n,s){r.viewport.set(e,t,n,s),r.scissor.set(e,t,n,s)}function cH(r,e,t){let n=new Float32Array(Ti),s=new A(0,1,0);return new Gn({name:"SphericalGaussianBlur",defines:{n:Ti,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:$m(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Xs,depthTest:!1,depthWrite:!1})}function Tw(){return new Gn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:$m(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Xs,depthTest:!1,depthWrite:!1})}function Mw(){return new Gn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:$m(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Xs,depthTest:!1,depthWrite:!1})}function $m(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function lH(r){let e=new WeakMap,t=null;function n(a){if(a&&a.isTexture){let c=a.mapping,l=c===bm||c===wm,u=c===ca||c===la;if(l||u)if(a.isRenderTargetTexture&&a.needsPMREMUpdate===!0){a.needsPMREMUpdate=!1;let h=e.get(a);return t===null&&(t=new Am(r)),h=l?t.fromEquirectangular(a,h):t.fromCubemap(a,h),e.set(a,h),h.texture}else{if(e.has(a))return e.get(a).texture;{let h=a.image;if(l&&h&&h.height>0||u&&h&&s(h)){t===null&&(t=new Am(r));let d=l?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,d),a.addEventListener("dispose",i),d.texture}else return null}}}return a}function s(a){let c=0,l=6;for(let u=0;u<l;u++)a[u]!==void 0&&c++;return c===l}function i(a){let c=a.target;c.removeEventListener("dispose",i);let l=e.get(c);l!==void 0&&(e.delete(c),l.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function uH(r){let e={};function t(n){if(e[n]!==void 0)return e[n];let s;switch(n){case"WEBGL_depth_texture":s=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=r.getExtension(n)}return e[n]=s,s}return{has:function(n){return t(n)!==null},init:function(n){n.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(n){let s=t(n);return s===null&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),s}}}function hH(r,e,t,n){let s={},i=new WeakMap;function o(h){let d=h.target;d.index!==null&&e.remove(d.index);for(let _ in d.attributes)e.remove(d.attributes[_]);d.removeEventListener("dispose",o),delete s[d.id];let p=i.get(d);p&&(e.remove(p),i.delete(d)),n.releaseStatesOfGeometry(d),d.isInstancedBufferGeometry===!0&&delete d._maxInstanceCount,t.memory.geometries--}function a(h,d){return s[d.id]===!0||(d.addEventListener("dispose",o),s[d.id]=!0,t.memory.geometries++),d}function c(h){let d=h.attributes;for(let _ in d)e.update(d[_],34962);let p=h.morphAttributes;for(let _ in p){let f=p[_];for(let m=0,g=f.length;m<g;m++)e.update(f[m],34962)}}function l(h){let d=[],p=h.index,_=h.attributes.position,f=0;if(p!==null){let x=p.array;f=p.version;for(let b=0,v=x.length;b<v;b+=3){let y=x[b+0],E=x[b+1],C=x[b+2];d.push(y,E,E,C,C,y)}}else{let x=_.array;f=_.version;for(let b=0,v=x.length/3-1;b<v;b+=3){let y=b+0,E=b+1,C=b+2;d.push(y,E,E,C,C,y)}}let m=new(SE(d)?Hm:qm)(d,1);m.version=f;let g=i.get(h);g&&e.remove(g),i.set(h,m)}function u(h){let d=i.get(h);if(d){let p=h.index;p!==null&&d.version<p.version&&l(h)}else l(h);return i.get(h)}return{get:a,update:c,getWireframeAttribute:u}}function dH(r,e,t,n){let s=n.isWebGL2,i;function o(d){i=d}let a,c;function l(d){a=d.type,c=d.bytesPerElement}function u(d,p){r.drawElements(i,p,a,d*c),t.update(p,i,1)}function h(d,p,_){if(_===0)return;let f,m;if(s)f=r,m="drawElementsInstanced";else if(f=e.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",f===null){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}f[m](i,p,a,d*c,_),t.update(p,i,_)}this.setMode=o,this.setIndex=l,this.render=u,this.renderInstances=h}function pH(r){let e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(i,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(i/3);break;case 1:t.lines+=a*(i/2);break;case 3:t.lines+=a*(i-1);break;case 2:t.lines+=a*i;break;case 0:t.points+=a*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o);break}}function s(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:s,update:n}}function fH(r,e){return r[0]-e[0]}function mH(r,e){return Math.abs(e[1])-Math.abs(r[1])}function hm(r,e){let t=1,n=e.isInterleavedBufferAttribute?e.data.array:e.array;n instanceof Int8Array?t=127:n instanceof Int16Array?t=32767:n instanceof Int32Array?t=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),r.divideScalar(t)}function _H(r,e,t){let n={},s=new Float32Array(8),i=new WeakMap,o=new Se,a=[];for(let l=0;l<8;l++)a[l]=[l,0];function c(l,u,h,d){let p=l.morphTargetInfluences;if(e.isWebGL2===!0){let _=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,f=_!==void 0?_.length:0,m=i.get(u);if(m===void 0||m.count!==f){let V=function(){F.dispose(),i.delete(u),u.removeEventListener("dispose",V)};m!==void 0&&m.texture.dispose();let b=u.morphAttributes.position!==void 0,v=u.morphAttributes.normal!==void 0,y=u.morphAttributes.color!==void 0,E=u.morphAttributes.position||[],C=u.morphAttributes.normal||[],M=u.morphAttributes.color||[],R=0;b===!0&&(R=1),v===!0&&(R=2),y===!0&&(R=3);let N=u.attributes.position.count*R,w=1;N>e.maxTextureSize&&(w=Math.ceil(N/e.maxTextureSize),N=e.maxTextureSize);let T=new Float32Array(N*w*4*f),F=new al(T,N,w,f);F.type=hs,F.needsUpdate=!0;let L=R*4;for(let B=0;B<f;B++){let H=E[B],z=C[B],X=M[B],ee=N*w*4*B;for(let le=0;le<H.count;le++){let re=le*L;b===!0&&(o.fromBufferAttribute(H,le),H.normalized===!0&&hm(o,H),T[ee+re+0]=o.x,T[ee+re+1]=o.y,T[ee+re+2]=o.z,T[ee+re+3]=0),v===!0&&(o.fromBufferAttribute(z,le),z.normalized===!0&&hm(o,z),T[ee+re+4]=o.x,T[ee+re+5]=o.y,T[ee+re+6]=o.z,T[ee+re+7]=0),y===!0&&(o.fromBufferAttribute(X,le),X.normalized===!0&&hm(o,X),T[ee+re+8]=o.x,T[ee+re+9]=o.y,T[ee+re+10]=o.z,T[ee+re+11]=X.itemSize===4?o.w:1)}}m={count:f,texture:F,size:new G(N,w)},i.set(u,m),u.addEventListener("dispose",V)}let g=0;for(let b=0;b<p.length;b++)g+=p[b];let x=u.morphTargetsRelative?1:1-g;d.getUniforms().setValue(r,"morphTargetBaseInfluence",x),d.getUniforms().setValue(r,"morphTargetInfluences",p),d.getUniforms().setValue(r,"morphTargetsTexture",m.texture,t),d.getUniforms().setValue(r,"morphTargetsTextureSize",m.size)}else{let _=p===void 0?0:p.length,f=n[u.id];if(f===void 0||f.length!==_){f=[];for(let v=0;v<_;v++)f[v]=[v,0];n[u.id]=f}for(let v=0;v<_;v++){let y=f[v];y[0]=v,y[1]=p[v]}f.sort(mH);for(let v=0;v<8;v++)v<_&&f[v][1]?(a[v][0]=f[v][0],a[v][1]=f[v][1]):(a[v][0]=Number.MAX_SAFE_INTEGER,a[v][1]=0);a.sort(fH);let m=u.morphAttributes.position,g=u.morphAttributes.normal,x=0;for(let v=0;v<8;v++){let y=a[v],E=y[0],C=y[1];E!==Number.MAX_SAFE_INTEGER&&C?(m&&u.getAttribute("morphTarget"+v)!==m[E]&&u.setAttribute("morphTarget"+v,m[E]),g&&u.getAttribute("morphNormal"+v)!==g[E]&&u.setAttribute("morphNormal"+v,g[E]),s[v]=C,x+=C):(m&&u.hasAttribute("morphTarget"+v)===!0&&u.deleteAttribute("morphTarget"+v),g&&u.hasAttribute("morphNormal"+v)===!0&&u.deleteAttribute("morphNormal"+v),s[v]=0)}let b=u.morphTargetsRelative?1:1-x;d.getUniforms().setValue(r,"morphTargetBaseInfluence",b),d.getUniforms().setValue(r,"morphTargetInfluences",s)}}return{update:c}}function gH(r,e,t,n){let s=new WeakMap;function i(c){let l=n.render.frame,u=c.geometry,h=e.get(c,u);return s.get(h)!==l&&(e.update(h),s.set(h,l)),c.isInstancedMesh&&(c.hasEventListener("dispose",a)===!1&&c.addEventListener("dispose",a),t.update(c.instanceMatrix,34962),c.instanceColor!==null&&t.update(c.instanceColor,34962)),h}function o(){s=new WeakMap}function a(c){let l=c.target;l.removeEventListener("dispose",a),t.remove(l.instanceMatrix),l.instanceColor!==null&&t.remove(l.instanceColor)}return{update:i,dispose:o}}var OE=new Xt,IE=new al,DE=new Bh,LE=new cl,Pw=[],Nw=[],Rw=new Float32Array(16),Ow=new Float32Array(9),Iw=new Float32Array(4);function ya(r,e,t){let n=r[0];if(n<=0||n>0)return r;let s=e*t,i=Pw[s];if(i===void 0&&(i=new Float32Array(s),Pw[s]=i),e!==0){n.toArray(i,0);for(let o=1,a=0;o!==e;++o)a+=t,r[o].toArray(i,a)}return i}function Dn(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function Pn(r,e){for(let t=0,n=e.length;t<n;t++)r[t]=e[t]}function zh(r,e){let t=Nw[e];t===void 0&&(t=new Int32Array(e),Nw[e]=t);for(let n=0;n!==e;++n)t[n]=r.allocateTextureUnit();return t}function yH(r,e){let t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function xH(r,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Dn(t,e))return;r.uniform2fv(this.addr,e),Pn(t,e)}}function vH(r,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Dn(t,e))return;r.uniform3fv(this.addr,e),Pn(t,e)}}function bH(r,e){let t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Dn(t,e))return;r.uniform4fv(this.addr,e),Pn(t,e)}}function wH(r,e){let t=this.cache,n=e.elements;if(n===void 0){if(Dn(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),Pn(t,e)}else{if(Dn(t,n))return;Iw.set(n),r.uniformMatrix2fv(this.addr,!1,Iw),Pn(t,n)}}function EH(r,e){let t=this.cache,n=e.elements;if(n===void 0){if(Dn(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),Pn(t,e)}else{if(Dn(t,n))return;Ow.set(n),r.uniformMatrix3fv(this.addr,!1,Ow),Pn(t,n)}}function CH(r,e){let t=this.cache,n=e.elements;if(n===void 0){if(Dn(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),Pn(t,e)}else{if(Dn(t,n))return;Rw.set(n),r.uniformMatrix4fv(this.addr,!1,Rw),Pn(t,n)}}function SH(r,e){let t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function AH(r,e){let t=this.cache;Dn(t,e)||(r.uniform2iv(this.addr,e),Pn(t,e))}function TH(r,e){let t=this.cache;Dn(t,e)||(r.uniform3iv(this.addr,e),Pn(t,e))}function MH(r,e){let t=this.cache;Dn(t,e)||(r.uniform4iv(this.addr,e),Pn(t,e))}function PH(r,e){let t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function NH(r,e){let t=this.cache;Dn(t,e)||(r.uniform2uiv(this.addr,e),Pn(t,e))}function RH(r,e){let t=this.cache;Dn(t,e)||(r.uniform3uiv(this.addr,e),Pn(t,e))}function OH(r,e){let t=this.cache;Dn(t,e)||(r.uniform4uiv(this.addr,e),Pn(t,e))}function IH(r,e,t){let n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),t.setTexture2D(e||OE,s)}function DH(r,e,t){let n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),t.setTexture3D(e||DE,s)}function LH(r,e,t){let n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),t.setTextureCube(e||LE,s)}function BH(r,e,t){let n=this.cache,s=t.allocateTextureUnit();n[0]!==s&&(r.uniform1i(this.addr,s),n[0]=s),t.setTexture2DArray(e||IE,s)}function kH(r){switch(r){case 5126:return yH;case 35664:return xH;case 35665:return vH;case 35666:return bH;case 35674:return wH;case 35675:return EH;case 35676:return CH;case 5124:case 35670:return SH;case 35667:case 35671:return AH;case 35668:case 35672:return TH;case 35669:case 35673:return MH;case 5125:return PH;case 36294:return NH;case 36295:return RH;case 36296:return OH;case 35678:case 36198:case 36298:case 36306:case 35682:return IH;case 35679:case 36299:case 36307:return DH;case 35680:case 36300:case 36308:case 36293:return LH;case 36289:case 36303:case 36311:case 36292:return BH}}function FH(r,e){r.uniform1fv(this.addr,e)}function UH(r,e){let t=ya(e,this.size,2);r.uniform2fv(this.addr,t)}function zH(r,e){let t=ya(e,this.size,3);r.uniform3fv(this.addr,t)}function VH(r,e){let t=ya(e,this.size,4);r.uniform4fv(this.addr,t)}function qH(r,e){let t=ya(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function GH(r,e){let t=ya(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function HH(r,e){let t=ya(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function WH(r,e){r.uniform1iv(this.addr,e)}function jH(r,e){r.uniform2iv(this.addr,e)}function $H(r,e){r.uniform3iv(this.addr,e)}function XH(r,e){r.uniform4iv(this.addr,e)}function YH(r,e){r.uniform1uiv(this.addr,e)}function ZH(r,e){r.uniform2uiv(this.addr,e)}function JH(r,e){r.uniform3uiv(this.addr,e)}function KH(r,e){r.uniform4uiv(this.addr,e)}function QH(r,e,t){let n=e.length,s=zh(t,n);r.uniform1iv(this.addr,s);for(let i=0;i!==n;++i)t.setTexture2D(e[i]||OE,s[i])}function e6(r,e,t){let n=e.length,s=zh(t,n);r.uniform1iv(this.addr,s);for(let i=0;i!==n;++i)t.setTexture3D(e[i]||DE,s[i])}function t6(r,e,t){let n=e.length,s=zh(t,n);r.uniform1iv(this.addr,s);for(let i=0;i!==n;++i)t.setTextureCube(e[i]||LE,s[i])}function n6(r,e,t){let n=e.length,s=zh(t,n);r.uniform1iv(this.addr,s);for(let i=0;i!==n;++i)t.setTexture2DArray(e[i]||IE,s[i])}function r6(r){switch(r){case 5126:return FH;case 35664:return UH;case 35665:return zH;case 35666:return VH;case 35674:return qH;case 35675:return GH;case 35676:return HH;case 5124:case 35670:return WH;case 35667:case 35671:return jH;case 35668:case 35672:return $H;case 35669:case 35673:return XH;case 5125:return YH;case 36294:return ZH;case 36295:return JH;case 36296:return KH;case 35678:case 36198:case 36298:case 36306:case 35682:return QH;case 35679:case 36299:case 36307:return e6;case 35680:case 36300:case 36308:case 36293:return t6;case 36289:case 36303:case 36311:case 36292:return n6}}function s6(r,e,t){this.id=r,this.addr=t,this.cache=[],this.setValue=kH(e.type)}function BE(r,e,t){this.id=r,this.addr=t,this.cache=[],this.size=e.size,this.setValue=r6(e.type)}BE.prototype.updateCache=function(r){let e=this.cache;r instanceof Float32Array&&e.length!==r.length&&(this.cache=new Float32Array(r.length)),Pn(e,r)};function kE(r){this.id=r,this.seq=[],this.map={}}kE.prototype.setValue=function(r,e,t){let n=this.seq;for(let s=0,i=n.length;s!==i;++s){let o=n[s];o.setValue(r,e[o.id],t)}};var dm=/(\w+)(\])?(\[|\.)?/g;function Dw(r,e){r.seq.push(e),r.map[e.id]=e}function i6(r,e,t){let n=r.name,s=n.length;for(dm.lastIndex=0;;){let i=dm.exec(n),o=dm.lastIndex,a=i[1],c=i[2]==="]",l=i[3];if(c&&(a=a|0),l===void 0||l==="["&&o+2===s){Dw(t,l===void 0?new s6(a,r,e):new BE(a,r,e));break}else{let h=t.map[a];h===void 0&&(h=new kE(a),Dw(t,h)),t=h}}}function Ys(r,e){this.seq=[],this.map={};let t=r.getProgramParameter(e,35718);for(let n=0;n<t;++n){let s=r.getActiveUniform(e,n),i=r.getUniformLocation(e,s.name);i6(s,i,this)}}Ys.prototype.setValue=function(r,e,t,n){let s=this.map[e];s!==void 0&&s.setValue(r,t,n)};Ys.prototype.setOptional=function(r,e,t){let n=e[t];n!==void 0&&this.setValue(r,t,n)};Ys.upload=function(r,e,t,n){for(let s=0,i=e.length;s!==i;++s){let o=e[s],a=t[o.id];a.needsUpdate!==!1&&o.setValue(r,a.value,n)}};Ys.seqWithValue=function(r,e){let t=[];for(let n=0,s=r.length;n!==s;++n){let i=r[n];i.id in e&&t.push(i)}return t};function Lw(r,e,t){let n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n}var o6=0;function a6(r,e){let t=r.split(`
`),n=[],s=Math.max(e-6,0),i=Math.min(e+6,t.length);for(let o=s;o<i;o++)n.push(o+1+": "+t[o]);return n.join(`
`)}function c6(r){switch(r){case Tr:return["Linear","( value )"];case Et:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",r),["Linear","( value )"]}}function Bw(r,e,t){let n=r.getShaderParameter(e,35713),s=r.getShaderInfoLog(e).trim();if(n&&s==="")return"";let i=parseInt(/ERROR: 0:(\d+)/.exec(s)[1]);return t.toUpperCase()+`

`+s+`

`+a6(r.getShaderSource(e),i)}function l6(r,e){let t=c6(e);return"vec4 "+r+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function u6(r,e){let t;switch(e){case Lm:t="Linear";break;case Bm:t="Reinhard";break;case km:t="OptimizedCineon";break;case Fm:t="ACESFilmic";break;case A4:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function h6(r){return[r.extensionDerivatives||!!r.envMapCubeUVHeight||r.bumpMap||r.tangentSpaceNormalMap||r.clearcoatNormalMap||r.flatShading||r.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(r.extensionFragDepth||r.logarithmicDepthBuffer)&&r.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",r.extensionDrawBuffers&&r.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(r.extensionShaderTextureLOD||r.envMap||r.transmission)&&r.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter($c).join(`
`)}function d6(r){let e=[];for(let t in r){let n=r[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function p6(r,e){let t={},n=r.getProgramParameter(e,35721);for(let s=0;s<n;s++){let i=r.getActiveAttrib(e,s),o=i.name,a=1;i.type===35674&&(a=2),i.type===35675&&(a=3),i.type===35676&&(a=4),t[o]={type:i.type,location:r.getAttribLocation(e,o),locationSize:a}}return t}function $c(r){return r!==""}function kw(r,e){return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function Fw(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}var f6=/^[ \t]*#include +<([\w\d./]+)>/gm;function Tm(r){return r.replace(f6,m6)}function m6(r,e){let t=ot[e];if(t===void 0)throw new Error("Can not resolve #include <"+e+">");return Tm(t)}var _6=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,g6=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Uw(r){return r.replace(g6,FE).replace(_6,y6)}function y6(r,e,t,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),FE(r,e,t,n)}function FE(r,e,t,n){let s="";for(let i=parseInt(e);i<parseInt(t);i++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return s}function zw(r){let e="precision "+r.precision+` float;
precision `+r.precision+" int;";return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function x6(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===Oh?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===Dm?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===Mi&&(e="SHADOWMAP_TYPE_VSM"),e}function v6(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case ca:case la:e="ENVMAP_TYPE_CUBE";break;case Dh:e="ENVMAP_TYPE_CUBE_UV";break}return e}function b6(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case la:e="ENVMAP_MODE_REFRACTION";break}return e}function w6(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case Ih:e="ENVMAP_BLENDING_MULTIPLY";break;case C4:e="ENVMAP_BLENDING_MIX";break;case S4:e="ENVMAP_BLENDING_ADD";break}return e}function E6(r){let e=r.envMapCubeUVHeight;if(e===null)return null;let t=Math.log2(e/32+1)+3,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function C6(r,e,t,n){let s=r.getContext(),i=t.defines,o=t.vertexShader,a=t.fragmentShader,c=x6(t),l=v6(t),u=b6(t),h=w6(t),d=E6(t),p=t.isWebGL2?"":h6(t),_=d6(i),f=s.createProgram(),m,g,x=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(m=[_].filter($c).join(`
`),m.length>0&&(m+=`
`),g=[p,_].filter($c).join(`
`),g.length>0&&(g+=`
`)):(m=[zw(t),"#define SHADER_NAME "+t.shaderName,_,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define MAX_BONES "+t.maxBones,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.useVertexTexture?"#define BONE_TEXTURE":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter($c).join(`
`),g=[p,zw(t),"#define SHADER_NAME "+t.shaderName,_,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+l:"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",d?"#define CUBEUV_TEXEL_WIDTH "+d.texelWidth:"",d?"#define CUBEUV_TEXEL_HEIGHT "+d.texelHeight:"",d?"#define CUBEUV_MAX_MIP "+d.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Ar?"#define TONE_MAPPING":"",t.toneMapping!==Ar?ot.tonemapping_pars_fragment:"",t.toneMapping!==Ar?u6("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",ot.encodings_pars_fragment,l6("linearToOutputTexel",t.outputEncoding),t.depthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter($c).join(`
`)),o=Tm(o),o=kw(o,t),o=Fw(o,t),a=Tm(a),a=kw(a,t),a=Fw(a,t),o=Uw(o),a=Uw(a),t.isWebGL2&&t.isRawShaderMaterial!==!0&&(x=`#version 300 es
`,m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+m,g=["#define varying in",t.glslVersion===uw?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===uw?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+g);let b=x+m+o,v=x+g+a,y=Lw(s,35633,b),E=Lw(s,35632,v);if(s.attachShader(f,y),s.attachShader(f,E),t.index0AttributeName!==void 0?s.bindAttribLocation(f,0,t.index0AttributeName):t.morphTargets===!0&&s.bindAttribLocation(f,0,"position"),s.linkProgram(f),r.debug.checkShaderErrors){let R=s.getProgramInfoLog(f).trim(),N=s.getShaderInfoLog(y).trim(),w=s.getShaderInfoLog(E).trim(),T=!0,F=!0;if(s.getProgramParameter(f,35714)===!1){T=!1;let L=Bw(s,y,"vertex"),V=Bw(s,E,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(f,35715)+`

Program Info Log: `+R+`
`+L+`
`+V)}else R!==""?console.warn("THREE.WebGLProgram: Program Info Log:",R):(N===""||w==="")&&(F=!1);F&&(this.diagnostics={runnable:T,programLog:R,vertexShader:{log:N,prefix:m},fragmentShader:{log:w,prefix:g}})}s.deleteShader(y),s.deleteShader(E);let C;this.getUniforms=function(){return C===void 0&&(C=new Ys(s,f)),C};let M;return this.getAttributes=function(){return M===void 0&&(M=p6(s,f)),M},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(f),this.program=void 0},this.name=t.shaderName,this.id=o6++,this.cacheKey=e,this.usedTimes=1,this.program=f,this.vertexShader=y,this.fragmentShader=E,this}var S6=0,UE=class{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){let t=e.vertexShader,n=e.fragmentShader,s=this._getShaderStage(t),i=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(s)===!1&&(o.add(s),s.usedTimes++),o.has(i)===!1&&(o.add(i),i.usedTimes++),this}remove(e){let t=this.materialCache.get(e);for(let n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){let t=this.materialCache;return t.has(e)===!1&&t.set(e,new Set),t.get(e)}_getShaderStage(e){let t=this.shaderCache;if(t.has(e)===!1){let n=new zE(e);t.set(e,n)}return t.get(e)}},zE=class{constructor(e){this.id=S6++,this.code=e,this.usedTimes=0}};function A6(r,e,t,n,s,i,o){let a=new kh,c=new UE,l=[],u=s.isWebGL2,h=s.logarithmicDepthBuffer,d=s.floatVertexTextures,p=s.maxVertexUniforms,_=s.vertexTextures,f=s.precision,m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function g(w){let F=w.skeleton.bones;if(d)return 1024;{let V=Math.floor((p-20)/4),B=Math.min(V,F.length);return B<F.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+F.length+" bones. This GPU supports "+B+"."),0):B}}function x(w,T,F,L,V){let B=L.fog,H=V.geometry,z=w.isMeshStandardMaterial?L.environment:null,X=(w.isMeshStandardMaterial?t:e).get(w.envMap||z),ee=!!X&&X.mapping===Dh?X.image.height:null,le=m[w.type],re=V.isSkinnedMesh?g(V):0;w.precision!==null&&(f=s.getMaxPrecision(w.precision),f!==w.precision&&console.warn("THREE.WebGLProgram.getParameters:",w.precision,"not supported, using",f,"instead."));let Pe=H.morphAttributes.position||H.morphAttributes.normal||H.morphAttributes.color,He=Pe!==void 0?Pe.length:0,ke=0;H.morphAttributes.position!==void 0&&(ke=1),H.morphAttributes.normal!==void 0&&(ke=2),H.morphAttributes.color!==void 0&&(ke=3);let Q,ut,Ze,Xe;if(le){let he=Hr[le];Q=he.vertexShader,ut=he.fragmentShader}else Q=w.vertexShader,ut=w.fragmentShader,c.update(w),Ze=c.getVertexShaderID(w),Xe=c.getFragmentShaderID(w);let fe=r.getRenderTarget(),et=w.alphaTest>0,K=w.clearcoat>0;return{isWebGL2:u,shaderID:le,shaderName:w.type,vertexShader:Q,fragmentShader:ut,defines:w.defines,customVertexShaderID:Ze,customFragmentShaderID:Xe,isRawShaderMaterial:w.isRawShaderMaterial===!0,glslVersion:w.glslVersion,precision:f,instancing:V.isInstancedMesh===!0,instancingColor:V.isInstancedMesh===!0&&V.instanceColor!==null,supportsVertexTextures:_,outputEncoding:fe===null?r.outputEncoding:fe.isXRRenderTarget===!0?fe.texture.encoding:Tr,map:!!w.map,matcap:!!w.matcap,envMap:!!X,envMapMode:X&&X.mapping,envMapCubeUVHeight:ee,lightMap:!!w.lightMap,aoMap:!!w.aoMap,emissiveMap:!!w.emissiveMap,bumpMap:!!w.bumpMap,normalMap:!!w.normalMap,objectSpaceNormalMap:w.normalMapType===X4,tangentSpaceNormalMap:w.normalMapType===fa,decodeVideoTexture:!!w.map&&w.map.isVideoTexture===!0&&w.map.encoding===Et,clearcoat:K,clearcoatMap:K&&!!w.clearcoatMap,clearcoatRoughnessMap:K&&!!w.clearcoatRoughnessMap,clearcoatNormalMap:K&&!!w.clearcoatNormalMap,displacementMap:!!w.displacementMap,roughnessMap:!!w.roughnessMap,metalnessMap:!!w.metalnessMap,specularMap:!!w.specularMap,specularIntensityMap:!!w.specularIntensityMap,specularColorMap:!!w.specularColorMap,opaque:w.transparent===!1&&w.blending===ia,alphaMap:!!w.alphaMap,alphaTest:et,gradientMap:!!w.gradientMap,sheen:w.sheen>0,sheenColorMap:!!w.sheenColorMap,sheenRoughnessMap:!!w.sheenRoughnessMap,transmission:w.transmission>0,transmissionMap:!!w.transmissionMap,thicknessMap:!!w.thicknessMap,combine:w.combine,vertexTangents:!!w.normalMap&&!!H.attributes.tangent,vertexColors:w.vertexColors,vertexAlphas:w.vertexColors===!0&&!!H.attributes.color&&H.attributes.color.itemSize===4,vertexUvs:!!w.map||!!w.bumpMap||!!w.normalMap||!!w.specularMap||!!w.alphaMap||!!w.emissiveMap||!!w.roughnessMap||!!w.metalnessMap||!!w.clearcoatMap||!!w.clearcoatRoughnessMap||!!w.clearcoatNormalMap||!!w.displacementMap||!!w.transmissionMap||!!w.thicknessMap||!!w.specularIntensityMap||!!w.specularColorMap||!!w.sheenColorMap||!!w.sheenRoughnessMap,uvsVertexOnly:!(!!w.map||!!w.bumpMap||!!w.normalMap||!!w.specularMap||!!w.alphaMap||!!w.emissiveMap||!!w.roughnessMap||!!w.metalnessMap||!!w.clearcoatNormalMap||w.transmission>0||!!w.transmissionMap||!!w.thicknessMap||!!w.specularIntensityMap||!!w.specularColorMap||w.sheen>0||!!w.sheenColorMap||!!w.sheenRoughnessMap)&&!!w.displacementMap,fog:!!B,useFog:w.fog,fogExp2:B&&B.isFogExp2,flatShading:!!w.flatShading,sizeAttenuation:w.sizeAttenuation,logarithmicDepthBuffer:h,skinning:V.isSkinnedMesh===!0&&re>0,maxBones:re,useVertexTexture:d,morphTargets:H.morphAttributes.position!==void 0,morphNormals:H.morphAttributes.normal!==void 0,morphColors:H.morphAttributes.color!==void 0,morphTargetsCount:He,morphTextureStride:ke,numDirLights:T.directional.length,numPointLights:T.point.length,numSpotLights:T.spot.length,numRectAreaLights:T.rectArea.length,numHemiLights:T.hemi.length,numDirLightShadows:T.directionalShadowMap.length,numPointLightShadows:T.pointShadowMap.length,numSpotLightShadows:T.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:w.dithering,shadowMapEnabled:r.shadowMap.enabled&&F.length>0,shadowMapType:r.shadowMap.type,toneMapping:w.toneMapped?r.toneMapping:Ar,physicallyCorrectLights:r.physicallyCorrectLights,premultipliedAlpha:w.premultipliedAlpha,doubleSided:w.side===Zs,flipSided:w.side===er,depthPacking:w.depthPacking!==void 0?w.depthPacking:!1,index0AttributeName:w.index0AttributeName,extensionDerivatives:w.extensions&&w.extensions.derivatives,extensionFragDepth:w.extensions&&w.extensions.fragDepth,extensionDrawBuffers:w.extensions&&w.extensions.drawBuffers,extensionShaderTextureLOD:w.extensions&&w.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||n.has("EXT_shader_texture_lod"),customProgramCacheKey:w.customProgramCacheKey()}}function b(w){let T=[];if(w.shaderID?T.push(w.shaderID):(T.push(w.customVertexShaderID),T.push(w.customFragmentShaderID)),w.defines!==void 0)for(let F in w.defines)T.push(F),T.push(w.defines[F]);return w.isRawShaderMaterial===!1&&(v(T,w),y(T,w),T.push(r.outputEncoding)),T.push(w.customProgramCacheKey),T.join()}function v(w,T){w.push(T.precision),w.push(T.outputEncoding),w.push(T.envMapMode),w.push(T.envMapCubeUVHeight),w.push(T.combine),w.push(T.vertexUvs),w.push(T.fogExp2),w.push(T.sizeAttenuation),w.push(T.maxBones),w.push(T.morphTargetsCount),w.push(T.morphAttributeCount),w.push(T.numDirLights),w.push(T.numPointLights),w.push(T.numSpotLights),w.push(T.numHemiLights),w.push(T.numRectAreaLights),w.push(T.numDirLightShadows),w.push(T.numPointLightShadows),w.push(T.numSpotLightShadows),w.push(T.shadowMapType),w.push(T.toneMapping),w.push(T.numClippingPlanes),w.push(T.numClipIntersection)}function y(w,T){a.disableAll(),T.isWebGL2&&a.enable(0),T.supportsVertexTextures&&a.enable(1),T.instancing&&a.enable(2),T.instancingColor&&a.enable(3),T.map&&a.enable(4),T.matcap&&a.enable(5),T.envMap&&a.enable(6),T.lightMap&&a.enable(7),T.aoMap&&a.enable(8),T.emissiveMap&&a.enable(9),T.bumpMap&&a.enable(10),T.normalMap&&a.enable(11),T.objectSpaceNormalMap&&a.enable(12),T.tangentSpaceNormalMap&&a.enable(13),T.clearcoat&&a.enable(14),T.clearcoatMap&&a.enable(15),T.clearcoatRoughnessMap&&a.enable(16),T.clearcoatNormalMap&&a.enable(17),T.displacementMap&&a.enable(18),T.specularMap&&a.enable(19),T.roughnessMap&&a.enable(20),T.metalnessMap&&a.enable(21),T.gradientMap&&a.enable(22),T.alphaMap&&a.enable(23),T.alphaTest&&a.enable(24),T.vertexColors&&a.enable(25),T.vertexAlphas&&a.enable(26),T.vertexUvs&&a.enable(27),T.vertexTangents&&a.enable(28),T.uvsVertexOnly&&a.enable(29),T.fog&&a.enable(30),w.push(a.mask),a.disableAll(),T.useFog&&a.enable(0),T.flatShading&&a.enable(1),T.logarithmicDepthBuffer&&a.enable(2),T.skinning&&a.enable(3),T.useVertexTexture&&a.enable(4),T.morphTargets&&a.enable(5),T.morphNormals&&a.enable(6),T.morphColors&&a.enable(7),T.premultipliedAlpha&&a.enable(8),T.shadowMapEnabled&&a.enable(9),T.physicallyCorrectLights&&a.enable(10),T.doubleSided&&a.enable(11),T.flipSided&&a.enable(12),T.depthPacking&&a.enable(13),T.dithering&&a.enable(14),T.specularIntensityMap&&a.enable(15),T.specularColorMap&&a.enable(16),T.transmission&&a.enable(17),T.transmissionMap&&a.enable(18),T.thicknessMap&&a.enable(19),T.sheen&&a.enable(20),T.sheenColorMap&&a.enable(21),T.sheenRoughnessMap&&a.enable(22),T.decodeVideoTexture&&a.enable(23),T.opaque&&a.enable(24),w.push(a.mask)}function E(w){let T=m[w.type],F;if(T){let L=Hr[T];F=Wm.clone(L.uniforms)}else F=w.uniforms;return F}function C(w,T){let F;for(let L=0,V=l.length;L<V;L++){let B=l[L];if(B.cacheKey===T){F=B,++F.usedTimes;break}}return F===void 0&&(F=new C6(r,T,w,i),l.push(F)),F}function M(w){if(--w.usedTimes===0){let T=l.indexOf(w);l[T]=l[l.length-1],l.pop(),w.destroy()}}function R(w){c.remove(w)}function N(){c.dispose()}return{getParameters:x,getProgramCacheKey:b,getUniforms:E,acquireProgram:C,releaseProgram:M,releaseShaderCache:R,programs:l,dispose:N}}function T6(){let r=new WeakMap;function e(i){let o=r.get(i);return o===void 0&&(o={},r.set(i,o)),o}function t(i){r.delete(i)}function n(i,o,a){r.get(i)[o]=a}function s(){r=new WeakMap}return{get:e,remove:t,update:n,dispose:s}}function M6(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function Vw(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function qw(){let r=[],e=0,t=[],n=[],s=[];function i(){e=0,t.length=0,n.length=0,s.length=0}function o(h,d,p,_,f,m){let g=r[e];return g===void 0?(g={id:h.id,object:h,geometry:d,material:p,groupOrder:_,renderOrder:h.renderOrder,z:f,group:m},r[e]=g):(g.id=h.id,g.object=h,g.geometry=d,g.material=p,g.groupOrder=_,g.renderOrder=h.renderOrder,g.z=f,g.group=m),e++,g}function a(h,d,p,_,f,m){let g=o(h,d,p,_,f,m);p.transmission>0?n.push(g):p.transparent===!0?s.push(g):t.push(g)}function c(h,d,p,_,f,m){let g=o(h,d,p,_,f,m);p.transmission>0?n.unshift(g):p.transparent===!0?s.unshift(g):t.unshift(g)}function l(h,d){t.length>1&&t.sort(h||M6),n.length>1&&n.sort(d||Vw),s.length>1&&s.sort(d||Vw)}function u(){for(let h=e,d=r.length;h<d;h++){let p=r[h];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:n,transparent:s,init:i,push:a,unshift:c,finish:u,sort:l}}function P6(){let r=new WeakMap;function e(n,s){let i;return r.has(n)===!1?(i=new qw,r.set(n,[i])):s>=r.get(n).length?(i=new qw,r.get(n).push(i)):i=r.get(n)[s],i}function t(){r=new WeakMap}return{get:e,dispose:t}}function N6(){let r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new A,color:new ae};break;case"SpotLight":t={position:new A,direction:new A,color:new ae,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new A,color:new ae,distance:0,decay:0};break;case"HemisphereLight":t={direction:new A,skyColor:new ae,groundColor:new ae};break;case"RectAreaLight":t={color:new ae,position:new A,halfWidth:new A,halfHeight:new A};break}return r[e.id]=t,t}}}function R6(){let r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new G};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new G};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new G,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}var O6=0;function I6(r,e){return(e.castShadow?1:0)-(r.castShadow?1:0)}function D6(r,e){let t=new N6,n=R6(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let u=0;u<9;u++)s.probe.push(new A);let i=new A,o=new pe,a=new pe;function c(u,h){let d=0,p=0,_=0;for(let R=0;R<9;R++)s.probe[R].set(0,0,0);let f=0,m=0,g=0,x=0,b=0,v=0,y=0,E=0;u.sort(I6);let C=h!==!0?Math.PI:1;for(let R=0,N=u.length;R<N;R++){let w=u[R],T=w.color,F=w.intensity,L=w.distance,V=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)d+=T.r*F*C,p+=T.g*F*C,_+=T.b*F*C;else if(w.isLightProbe)for(let B=0;B<9;B++)s.probe[B].addScaledVector(w.sh.coefficients[B],F);else if(w.isDirectionalLight){let B=t.get(w);if(B.color.copy(w.color).multiplyScalar(w.intensity*C),w.castShadow){let H=w.shadow,z=n.get(w);z.shadowBias=H.bias,z.shadowNormalBias=H.normalBias,z.shadowRadius=H.radius,z.shadowMapSize=H.mapSize,s.directionalShadow[f]=z,s.directionalShadowMap[f]=V,s.directionalShadowMatrix[f]=w.shadow.matrix,v++}s.directional[f]=B,f++}else if(w.isSpotLight){let B=t.get(w);if(B.position.setFromMatrixPosition(w.matrixWorld),B.color.copy(T).multiplyScalar(F*C),B.distance=L,B.coneCos=Math.cos(w.angle),B.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),B.decay=w.decay,w.castShadow){let H=w.shadow,z=n.get(w);z.shadowBias=H.bias,z.shadowNormalBias=H.normalBias,z.shadowRadius=H.radius,z.shadowMapSize=H.mapSize,s.spotShadow[g]=z,s.spotShadowMap[g]=V,s.spotShadowMatrix[g]=w.shadow.matrix,E++}s.spot[g]=B,g++}else if(w.isRectAreaLight){let B=t.get(w);B.color.copy(T).multiplyScalar(F),B.halfWidth.set(w.width*.5,0,0),B.halfHeight.set(0,w.height*.5,0),s.rectArea[x]=B,x++}else if(w.isPointLight){let B=t.get(w);if(B.color.copy(w.color).multiplyScalar(w.intensity*C),B.distance=w.distance,B.decay=w.decay,w.castShadow){let H=w.shadow,z=n.get(w);z.shadowBias=H.bias,z.shadowNormalBias=H.normalBias,z.shadowRadius=H.radius,z.shadowMapSize=H.mapSize,z.shadowCameraNear=H.camera.near,z.shadowCameraFar=H.camera.far,s.pointShadow[m]=z,s.pointShadowMap[m]=V,s.pointShadowMatrix[m]=w.shadow.matrix,y++}s.point[m]=B,m++}else if(w.isHemisphereLight){let B=t.get(w);B.skyColor.copy(w.color).multiplyScalar(F*C),B.groundColor.copy(w.groundColor).multiplyScalar(F*C),s.hemi[b]=B,b++}}x>0&&(e.isWebGL2||r.has("OES_texture_float_linear")===!0?(s.rectAreaLTC1=ye.LTC_FLOAT_1,s.rectAreaLTC2=ye.LTC_FLOAT_2):r.has("OES_texture_half_float_linear")===!0?(s.rectAreaLTC1=ye.LTC_HALF_1,s.rectAreaLTC2=ye.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=d,s.ambient[1]=p,s.ambient[2]=_;let M=s.hash;(M.directionalLength!==f||M.pointLength!==m||M.spotLength!==g||M.rectAreaLength!==x||M.hemiLength!==b||M.numDirectionalShadows!==v||M.numPointShadows!==y||M.numSpotShadows!==E)&&(s.directional.length=f,s.spot.length=g,s.rectArea.length=x,s.point.length=m,s.hemi.length=b,s.directionalShadow.length=v,s.directionalShadowMap.length=v,s.pointShadow.length=y,s.pointShadowMap.length=y,s.spotShadow.length=E,s.spotShadowMap.length=E,s.directionalShadowMatrix.length=v,s.pointShadowMatrix.length=y,s.spotShadowMatrix.length=E,M.directionalLength=f,M.pointLength=m,M.spotLength=g,M.rectAreaLength=x,M.hemiLength=b,M.numDirectionalShadows=v,M.numPointShadows=y,M.numSpotShadows=E,s.version=O6++)}function l(u,h){let d=0,p=0,_=0,f=0,m=0,g=h.matrixWorldInverse;for(let x=0,b=u.length;x<b;x++){let v=u[x];if(v.isDirectionalLight){let y=s.directional[d];y.direction.setFromMatrixPosition(v.matrixWorld),i.setFromMatrixPosition(v.target.matrixWorld),y.direction.sub(i),y.direction.transformDirection(g),d++}else if(v.isSpotLight){let y=s.spot[_];y.position.setFromMatrixPosition(v.matrixWorld),y.position.applyMatrix4(g),y.direction.setFromMatrixPosition(v.matrixWorld),i.setFromMatrixPosition(v.target.matrixWorld),y.direction.sub(i),y.direction.transformDirection(g),_++}else if(v.isRectAreaLight){let y=s.rectArea[f];y.position.setFromMatrixPosition(v.matrixWorld),y.position.applyMatrix4(g),a.identity(),o.copy(v.matrixWorld),o.premultiply(g),a.extractRotation(o),y.halfWidth.set(v.width*.5,0,0),y.halfHeight.set(0,v.height*.5,0),y.halfWidth.applyMatrix4(a),y.halfHeight.applyMatrix4(a),f++}else if(v.isPointLight){let y=s.point[p];y.position.setFromMatrixPosition(v.matrixWorld),y.position.applyMatrix4(g),p++}else if(v.isHemisphereLight){let y=s.hemi[m];y.direction.setFromMatrixPosition(v.matrixWorld),y.direction.transformDirection(g),y.direction.normalize(),m++}}}return{setup:c,setupView:l,state:s}}function Gw(r,e){let t=new D6(r,e),n=[],s=[];function i(){n.length=0,s.length=0}function o(h){n.push(h)}function a(h){s.push(h)}function c(h){t.setup(n,h)}function l(h){t.setupView(n,h)}return{init:i,state:{lightsArray:n,shadowsArray:s,lights:t},setupLights:c,setupLightsView:l,pushLight:o,pushShadow:a}}function L6(r,e){let t=new WeakMap;function n(i,o=0){let a;return t.has(i)===!1?(a=new Gw(r,e),t.set(i,[a])):o>=t.get(i).length?(a=new Gw(r,e),t.get(i).push(a)):a=t.get(i)[o],a}function s(){t=new WeakMap}return{get:n,dispose:s}}var Vh=class extends nn{constructor(e){super();this.type="MeshDepthMaterial",this.depthPacking=j4,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}};Vh.prototype.isMeshDepthMaterial=!0;var qh=class extends nn{constructor(e){super();this.type="MeshDistanceMaterial",this.referencePosition=new A,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}};qh.prototype.isMeshDistanceMaterial=!0;var B6=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,k6=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function VE(r,e,t){let n=new ll,s=new G,i=new G,o=new Se,a=new Vh({depthPacking:$4}),c=new qh,l={},u=t.maxTextureSize,h={0:er,1:tr,2:Zs},d=new Gn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new G},radius:{value:4}},vertexShader:B6,fragmentShader:k6}),p=d.clone();p.defines.HORIZONTAL_PASS=1;let _=new st;_.setAttribute("position",new xt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));let f=new St(_,d),m=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=Oh,this.render=function(v,y,E){if(m.enabled===!1||m.autoUpdate===!1&&m.needsUpdate===!1||v.length===0)return;let C=r.getRenderTarget(),M=r.getActiveCubeFace(),R=r.getActiveMipmapLevel(),N=r.state;N.setBlending(Xs),N.buffers.color.setClear(1,1,1,1),N.buffers.depth.setTest(!0),N.setScissorTest(!1);for(let w=0,T=v.length;w<T;w++){let F=v[w],L=F.shadow;if(L===void 0){console.warn("THREE.WebGLShadowMap:",F,"has no shadow.");continue}if(L.autoUpdate===!1&&L.needsUpdate===!1)continue;s.copy(L.mapSize);let V=L.getFrameExtents();if(s.multiply(V),i.copy(L.mapSize),(s.x>u||s.y>u)&&(s.x>u&&(i.x=Math.floor(u/V.x),s.x=i.x*V.x,L.mapSize.x=i.x),s.y>u&&(i.y=Math.floor(u/V.y),s.y=i.y*V.y,L.mapSize.y=i.y)),L.map===null&&!L.isPointLightShadow&&this.type===Mi&&(L.map=new En(s.x,s.y),L.map.texture.name=F.name+".shadowMap",L.mapPass=new En(s.x,s.y),L.camera.updateProjectionMatrix()),L.map===null){let H={minFilter:yn,magFilter:yn,format:Qn};L.map=new En(s.x,s.y,H),L.map.texture.name=F.name+".shadowMap",L.camera.updateProjectionMatrix()}r.setRenderTarget(L.map),r.clear();let B=L.getViewportCount();for(let H=0;H<B;H++){let z=L.getViewport(H);o.set(i.x*z.x,i.y*z.y,i.x*z.z,i.y*z.w),N.viewport(o),L.updateMatrices(F,H),n=L.getFrustum(),b(y,E,L.camera,F,this.type)}!L.isPointLightShadow&&this.type===Mi&&g(L,E),L.needsUpdate=!1}m.needsUpdate=!1,r.setRenderTarget(C,M,R)};function g(v,y){let E=e.update(f);d.defines.VSM_SAMPLES!==v.blurSamples&&(d.defines.VSM_SAMPLES=v.blurSamples,p.defines.VSM_SAMPLES=v.blurSamples,d.needsUpdate=!0,p.needsUpdate=!0),d.uniforms.shadow_pass.value=v.map.texture,d.uniforms.resolution.value=v.mapSize,d.uniforms.radius.value=v.radius,r.setRenderTarget(v.mapPass),r.clear(),r.renderBufferDirect(y,null,E,d,f,null),p.uniforms.shadow_pass.value=v.mapPass.texture,p.uniforms.resolution.value=v.mapSize,p.uniforms.radius.value=v.radius,r.setRenderTarget(v.map),r.clear(),r.renderBufferDirect(y,null,E,p,f,null)}function x(v,y,E,C,M,R){let N=null,w=E.isPointLight===!0?v.customDistanceMaterial:v.customDepthMaterial;if(w!==void 0?N=w:N=E.isPointLight===!0?c:a,r.localClippingEnabled&&y.clipShadows===!0&&y.clippingPlanes.length!==0||y.displacementMap&&y.displacementScale!==0||y.alphaMap&&y.alphaTest>0){let T=N.uuid,F=y.uuid,L=l[T];L===void 0&&(L={},l[T]=L);let V=L[F];V===void 0&&(V=N.clone(),L[F]=V),N=V}return N.visible=y.visible,N.wireframe=y.wireframe,R===Mi?N.side=y.shadowSide!==null?y.shadowSide:y.side:N.side=y.shadowSide!==null?y.shadowSide:h[y.side],N.alphaMap=y.alphaMap,N.alphaTest=y.alphaTest,N.clipShadows=y.clipShadows,N.clippingPlanes=y.clippingPlanes,N.clipIntersection=y.clipIntersection,N.displacementMap=y.displacementMap,N.displacementScale=y.displacementScale,N.displacementBias=y.displacementBias,N.wireframeLinewidth=y.wireframeLinewidth,N.linewidth=y.linewidth,E.isPointLight===!0&&N.isMeshDistanceMaterial===!0&&(N.referencePosition.setFromMatrixPosition(E.matrixWorld),N.nearDistance=C,N.farDistance=M),N}function b(v,y,E,C,M){if(v.visible===!1)return;if(v.layers.test(y.layers)&&(v.isMesh||v.isLine||v.isPoints)&&(v.castShadow||v.receiveShadow&&M===Mi)&&(!v.frustumCulled||n.intersectsObject(v))){v.modelViewMatrix.multiplyMatrices(E.matrixWorldInverse,v.matrixWorld);let w=e.update(v),T=v.material;if(Array.isArray(T)){let F=w.groups;for(let L=0,V=F.length;L<V;L++){let B=F[L],H=T[B.materialIndex];if(H&&H.visible){let z=x(v,H,C,E.near,E.far,M);r.renderBufferDirect(E,null,w,z,v,B)}}}else if(T.visible){let F=x(v,T,C,E.near,E.far,M);r.renderBufferDirect(E,null,w,F,v,null)}}let N=v.children;for(let w=0,T=N.length;w<T;w++)b(N[w],y,E,C,M)}}function F6(r,e,t){let n=t.isWebGL2;function s(){let k=!1,me=new Se,de=null,Ue=new Se(0,0,0,0);return{setMask:function(we){de!==we&&!k&&(r.colorMask(we,we,we,we),de=we)},setLocked:function(we){k=we},setClear:function(we,Re,ue,qe,wt){wt===!0&&(we*=qe,Re*=qe,ue*=qe),me.set(we,Re,ue,qe),Ue.equals(me)===!1&&(r.clearColor(we,Re,ue,qe),Ue.copy(me))},reset:function(){k=!1,de=null,Ue.set(-1,0,0,0)}}}function i(){let k=!1,me=null,de=null,Ue=null;return{setTest:function(we){we?ke(2929):Q(2929)},setMask:function(we){me!==we&&!k&&(r.depthMask(we),me=we)},setFunc:function(we){if(de!==we){if(we)switch(we){case g4:r.depthFunc(512);break;case y4:r.depthFunc(519);break;case x4:r.depthFunc(513);break;case vm:r.depthFunc(515);break;case v4:r.depthFunc(514);break;case b4:r.depthFunc(518);break;case w4:r.depthFunc(516);break;case E4:r.depthFunc(517);break;default:r.depthFunc(515)}else r.depthFunc(515);de=we}},setLocked:function(we){k=we},setClear:function(we){Ue!==we&&(r.clearDepth(we),Ue=we)},reset:function(){k=!1,me=null,de=null,Ue=null}}}function o(){let k=!1,me=null,de=null,Ue=null,we=null,Re=null,ue=null,qe=null,wt=null;return{setTest:function(at){k||(at?ke(2960):Q(2960))},setMask:function(at){me!==at&&!k&&(r.stencilMask(at),me=at)},setFunc:function(at,Fr,Ur){(de!==at||Ue!==Fr||we!==Ur)&&(r.stencilFunc(at,Fr,Ur),de=at,Ue=Fr,we=Ur)},setOp:function(at,Fr,Ur){(Re!==at||ue!==Fr||qe!==Ur)&&(r.stencilOp(at,Fr,Ur),Re=at,ue=Fr,qe=Ur)},setLocked:function(at){k=at},setClear:function(at){wt!==at&&(r.clearStencil(at),wt=at)},reset:function(){k=!1,me=null,de=null,Ue=null,we=null,Re=null,ue=null,qe=null,wt=null}}}let a=new s,c=new i,l=new o,u={},h={},d=new WeakMap,p=[],_=null,f=!1,m=null,g=null,x=null,b=null,v=null,y=null,E=null,C=!1,M=null,R=null,N=null,w=null,T=null,F=r.getParameter(35661),L=!1,V=0,B=r.getParameter(7938);B.indexOf("WebGL")!==-1?(V=parseFloat(/^WebGL (\d)/.exec(B)[1]),L=V>=1):B.indexOf("OpenGL ES")!==-1&&(V=parseFloat(/^OpenGL ES (\d)/.exec(B)[1]),L=V>=2);let H=null,z={},X=r.getParameter(3088),ee=r.getParameter(2978),le=new Se().fromArray(X),re=new Se().fromArray(ee);function Pe(k,me,de){let Ue=new Uint8Array(4),we=r.createTexture();r.bindTexture(k,we),r.texParameteri(k,10241,9728),r.texParameteri(k,10240,9728);for(let Re=0;Re<de;Re++)r.texImage2D(me+Re,0,6408,1,1,0,6408,5121,Ue);return we}let He={};He[3553]=Pe(3553,3553,1),He[34067]=Pe(34067,34069,6),a.setClear(0,0,0,1),c.setClear(1),l.setClear(0),ke(2929),c.setFunc(vm),he(!1),Ee(L1),ke(2884),K(Xs);function ke(k){u[k]!==!0&&(r.enable(k),u[k]=!0)}function Q(k){u[k]!==!1&&(r.disable(k),u[k]=!1)}function ut(k,me){return h[k]!==me?(r.bindFramebuffer(k,me),h[k]=me,n&&(k===36009&&(h[36160]=me),k===36160&&(h[36009]=me)),!0):!1}function Ze(k,me){let de=p,Ue=!1;if(k)if(de=d.get(me),de===void 0&&(de=[],d.set(me,de)),k.isWebGLMultipleRenderTargets){let we=k.texture;if(de.length!==we.length||de[0]!==36064){for(let Re=0,ue=we.length;Re<ue;Re++)de[Re]=36064+Re;de.length=we.length,Ue=!0}}else de[0]!==36064&&(de[0]=36064,Ue=!0);else de[0]!==1029&&(de[0]=1029,Ue=!0);Ue&&(t.isWebGL2?r.drawBuffers(de):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(de))}function Xe(k){return _!==k?(r.useProgram(k),_=k,!0):!1}let fe={[ea]:32774,[o4]:32778,[a4]:32779};if(n)fe[U1]=32775,fe[z1]=32776;else{let k=e.get("EXT_blend_minmax");k!==null&&(fe[U1]=k.MIN_EXT,fe[z1]=k.MAX_EXT)}let et={[c4]:0,[l4]:1,[u4]:768,[vE]:770,[_4]:776,[f4]:774,[d4]:772,[h4]:769,[bE]:771,[m4]:775,[p4]:773};function K(k,me,de,Ue,we,Re,ue,qe){if(k===Xs){f===!0&&(Q(3042),f=!1);return}if(f===!1&&(ke(3042),f=!0),k!==i4){if(k!==m||qe!==C){if((g!==ea||v!==ea)&&(r.blendEquation(32774),g=ea,v=ea),qe)switch(k){case ia:r.blendFuncSeparate(1,771,1,771);break;case B1:r.blendFunc(1,1);break;case k1:r.blendFuncSeparate(0,769,0,1);break;case F1:r.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",k);break}else switch(k){case ia:r.blendFuncSeparate(770,771,1,771);break;case B1:r.blendFunc(770,1);break;case k1:r.blendFuncSeparate(0,769,0,1);break;case F1:r.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",k);break}x=null,b=null,y=null,E=null,m=k,C=qe}return}we=we||me,Re=Re||de,ue=ue||Ue,(me!==g||we!==v)&&(r.blendEquationSeparate(fe[me],fe[we]),g=me,v=we),(de!==x||Ue!==b||Re!==y||ue!==E)&&(r.blendFuncSeparate(et[de],et[Ue],et[Re],et[ue]),x=de,b=Ue,y=Re,E=ue),m=k,C=null}function te(k,me){k.side===Zs?Q(2884):ke(2884);let de=k.side===er;me&&(de=!de),he(de),k.blending===ia&&k.transparent===!1?K(Xs):K(k.blending,k.blendEquation,k.blendSrc,k.blendDst,k.blendEquationAlpha,k.blendSrcAlpha,k.blendDstAlpha,k.premultipliedAlpha),c.setFunc(k.depthFunc),c.setTest(k.depthTest),c.setMask(k.depthWrite),a.setMask(k.colorWrite);let Ue=k.stencilWrite;l.setTest(Ue),Ue&&(l.setMask(k.stencilWriteMask),l.setFunc(k.stencilFunc,k.stencilRef,k.stencilFuncMask),l.setOp(k.stencilFail,k.stencilZFail,k.stencilZPass)),We(k.polygonOffset,k.polygonOffsetFactor,k.polygonOffsetUnits),k.alphaToCoverage===!0?ke(32926):Q(32926)}function he(k){M!==k&&(k?r.frontFace(2304):r.frontFace(2305),M=k)}function Ee(k){k!==r4?(ke(2884),k!==R&&(k===L1?r.cullFace(1029):k===s4?r.cullFace(1028):r.cullFace(1032))):Q(2884),R=k}function ve(k){k!==N&&(L&&r.lineWidth(k),N=k)}function We(k,me,de){k?(ke(32823),(w!==me||T!==de)&&(r.polygonOffset(me,de),w=me,T=de)):Q(32823)}function Le(k){k?ke(3089):Q(3089)}function Oe(k){k===void 0&&(k=33984+F-1),H!==k&&(r.activeTexture(k),H=k)}function Nt(k,me){H===null&&Oe();let de=z[H];de===void 0&&(de={type:void 0,texture:void 0},z[H]=de),(de.type!==k||de.texture!==me)&&(r.bindTexture(k,me||He[k]),de.type=k,de.texture=me)}function ft(){let k=z[H];k!==void 0&&k.type!==void 0&&(r.bindTexture(k.type,null),k.type=void 0,k.texture=void 0)}function D(){try{r.compressedTexImage2D.apply(r,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function P(){try{r.texSubImage2D.apply(r,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function Y(){try{r.texSubImage3D.apply(r,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function oe(){try{r.compressedTexSubImage2D.apply(r,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function xe(){try{r.texStorage2D.apply(r,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function be(){try{r.texStorage3D.apply(r,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function Ie(){try{r.texImage2D.apply(r,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function O(){try{r.texImage3D.apply(r,arguments)}catch(k){console.error("THREE.WebGLState:",k)}}function ce(k){le.equals(k)===!1&&(r.scissor(k.x,k.y,k.z,k.w),le.copy(k))}function Ne(k){re.equals(k)===!1&&(r.viewport(k.x,k.y,k.z,k.w),re.copy(k))}function ge(){r.disable(3042),r.disable(2884),r.disable(2929),r.disable(32823),r.disable(3089),r.disable(2960),r.disable(32926),r.blendEquation(32774),r.blendFunc(1,0),r.blendFuncSeparate(1,0,1,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(513),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(519,0,4294967295),r.stencilOp(7680,7680,7680),r.clearStencil(0),r.cullFace(1029),r.frontFace(2305),r.polygonOffset(0,0),r.activeTexture(33984),r.bindFramebuffer(36160,null),n===!0&&(r.bindFramebuffer(36009,null),r.bindFramebuffer(36008,null)),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),u={},H=null,z={},h={},d=new WeakMap,p=[],_=null,f=!1,m=null,g=null,x=null,b=null,v=null,y=null,E=null,C=!1,M=null,R=null,N=null,w=null,T=null,le.set(0,0,r.canvas.width,r.canvas.height),re.set(0,0,r.canvas.width,r.canvas.height),a.reset(),c.reset(),l.reset()}return{buffers:{color:a,depth:c,stencil:l},enable:ke,disable:Q,bindFramebuffer:ut,drawBuffers:Ze,useProgram:Xe,setBlending:K,setMaterial:te,setFlipSided:he,setCullFace:Ee,setLineWidth:ve,setPolygonOffset:We,setScissorTest:Le,activeTexture:Oe,bindTexture:Nt,unbindTexture:ft,compressedTexImage2D:D,texImage2D:Ie,texImage3D:O,texStorage2D:xe,texStorage3D:be,texSubImage2D:P,texSubImage3D:Y,compressedTexSubImage2D:oe,scissor:ce,viewport:Ne,reset:ge}}function U6(r,e,t,n,s,i,o){let a=s.isWebGL2,c=s.maxTextures,l=s.maxCubemapSize,u=s.maxTextureSize,h=s.maxSamples,d=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=/OculusBrowser/g.test(navigator.userAgent),_=new WeakMap,f,m=new WeakMap,g=!1;try{g=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function x(D,P){return g?new OffscreenCanvas(D,P):tl("canvas")}function b(D,P,Y,oe){let xe=1;if((D.width>oe||D.height>oe)&&(xe=oe/Math.max(D.width,D.height)),xe<1||P===!0)if(typeof HTMLImageElement<"u"&&D instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&D instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&D instanceof ImageBitmap){let be=P?Ph:Math.floor,Ie=be(xe*D.width),O=be(xe*D.height);f===void 0&&(f=x(Ie,O));let ce=Y?x(Ie,O):f;return ce.width=Ie,ce.height=O,ce.getContext("2d").drawImage(D,0,0,Ie,O),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+D.width+"x"+D.height+") to ("+Ie+"x"+O+")."),ce}else return"data"in D&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+D.width+"x"+D.height+")."),D;return D}function v(D){return Sm(D.width)&&Sm(D.height)}function y(D){return a?!1:D.wrapS!==Sr||D.wrapT!==Sr||D.minFilter!==yn&&D.minFilter!==Vn}function E(D,P){return D.generateMipmaps&&P&&D.minFilter!==yn&&D.minFilter!==Vn}function C(D){r.generateMipmap(D)}function M(D,P,Y,oe,xe=!1){if(a===!1)return P;if(D!==null){if(r[D]!==void 0)return r[D];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+D+"'")}let be=P;return P===6403&&(Y===5126&&(be=33326),Y===5131&&(be=33325),Y===5121&&(be=33321)),P===33319&&(Y===5126&&(be=33328),Y===5131&&(be=33327),Y===5121&&(be=33323)),P===6408&&(Y===5126&&(be=34836),Y===5131&&(be=34842),Y===5121&&(be=oe===Et&&xe===!1?35907:32856),Y===32819&&(be=32854),Y===32820&&(be=32855)),(be===33325||be===33326||be===33327||be===33328||be===34842||be===34836)&&e.get("EXT_color_buffer_float"),be}function R(D,P,Y){return E(D,Y)===!0||D.isFramebufferTexture&&D.minFilter!==yn&&D.minFilter!==Vn?Math.log2(Math.max(P.width,P.height))+1:D.mipmaps!==void 0&&D.mipmaps.length>0?D.mipmaps.length:D.isCompressedTexture&&Array.isArray(D.image)?P.mipmaps.length:1}function N(D){return D===yn||D===V1||D===q1?9728:9729}function w(D){let P=D.target;P.removeEventListener("dispose",w),F(P),P.isVideoTexture&&_.delete(P)}function T(D){let P=D.target;P.removeEventListener("dispose",T),V(P)}function F(D){let P=n.get(D);if(P.__webglInit===void 0)return;let Y=D.source,oe=m.get(Y);if(oe){let xe=oe[P.__cacheKey];xe.usedTimes--,xe.usedTimes===0&&L(D),Object.keys(oe).length===0&&m.delete(Y)}n.remove(D)}function L(D){let P=n.get(D);r.deleteTexture(P.__webglTexture);let Y=D.source,oe=m.get(Y);delete oe[P.__cacheKey],o.memory.textures--}function V(D){let P=D.texture,Y=n.get(D),oe=n.get(P);if(oe.__webglTexture!==void 0&&(r.deleteTexture(oe.__webglTexture),o.memory.textures--),D.depthTexture&&D.depthTexture.dispose(),D.isWebGLCubeRenderTarget)for(let xe=0;xe<6;xe++)r.deleteFramebuffer(Y.__webglFramebuffer[xe]),Y.__webglDepthbuffer&&r.deleteRenderbuffer(Y.__webglDepthbuffer[xe]);else r.deleteFramebuffer(Y.__webglFramebuffer),Y.__webglDepthbuffer&&r.deleteRenderbuffer(Y.__webglDepthbuffer),Y.__webglMultisampledFramebuffer&&r.deleteFramebuffer(Y.__webglMultisampledFramebuffer),Y.__webglColorRenderbuffer&&r.deleteRenderbuffer(Y.__webglColorRenderbuffer),Y.__webglDepthRenderbuffer&&r.deleteRenderbuffer(Y.__webglDepthRenderbuffer);if(D.isWebGLMultipleRenderTargets)for(let xe=0,be=P.length;xe<be;xe++){let Ie=n.get(P[xe]);Ie.__webglTexture&&(r.deleteTexture(Ie.__webglTexture),o.memory.textures--),n.remove(P[xe])}n.remove(P),n.remove(D)}let B=0;function H(){B=0}function z(){let D=B;return D>=c&&console.warn("THREE.WebGLTextures: Trying to use "+D+" texture units while this GPU supports only "+c),B+=1,D}function X(D){let P=[];return P.push(D.wrapS),P.push(D.wrapT),P.push(D.magFilter),P.push(D.minFilter),P.push(D.anisotropy),P.push(D.internalFormat),P.push(D.format),P.push(D.type),P.push(D.generateMipmaps),P.push(D.premultiplyAlpha),P.push(D.flipY),P.push(D.unpackAlignment),P.push(D.encoding),P.join()}function ee(D,P){let Y=n.get(D);if(D.isVideoTexture&&Nt(D),D.isRenderTargetTexture===!1&&D.version>0&&Y.__version!==D.version){let oe=D.image;if(oe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(oe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Ze(Y,D,P);return}}t.activeTexture(33984+P),t.bindTexture(3553,Y.__webglTexture)}function le(D,P){let Y=n.get(D);if(D.version>0&&Y.__version!==D.version){Ze(Y,D,P);return}t.activeTexture(33984+P),t.bindTexture(35866,Y.__webglTexture)}function re(D,P){let Y=n.get(D);if(D.version>0&&Y.__version!==D.version){Ze(Y,D,P);return}t.activeTexture(33984+P),t.bindTexture(32879,Y.__webglTexture)}function Pe(D,P){let Y=n.get(D);if(D.version>0&&Y.__version!==D.version){Xe(Y,D,P);return}t.activeTexture(33984+P),t.bindTexture(34067,Y.__webglTexture)}let He={[ua]:10497,[Sr]:33071,[Em]:33648},ke={[yn]:9728,[V1]:9984,[q1]:9986,[Vn]:9729,[T4]:9985,[Lh]:9987};function Q(D,P,Y){if(Y?(r.texParameteri(D,10242,He[P.wrapS]),r.texParameteri(D,10243,He[P.wrapT]),(D===32879||D===35866)&&r.texParameteri(D,32882,He[P.wrapR]),r.texParameteri(D,10240,ke[P.magFilter]),r.texParameteri(D,10241,ke[P.minFilter])):(r.texParameteri(D,10242,33071),r.texParameteri(D,10243,33071),(D===32879||D===35866)&&r.texParameteri(D,32882,33071),(P.wrapS!==Sr||P.wrapT!==Sr)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),r.texParameteri(D,10240,N(P.magFilter)),r.texParameteri(D,10241,N(P.minFilter)),P.minFilter!==yn&&P.minFilter!==Vn&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),e.has("EXT_texture_filter_anisotropic")===!0){let oe=e.get("EXT_texture_filter_anisotropic");if(P.type===hs&&e.has("OES_texture_float_linear")===!1||a===!1&&P.type===oa&&e.has("OES_texture_half_float_linear")===!1)return;(P.anisotropy>1||n.get(P).__currentAnisotropy)&&(r.texParameterf(D,oe.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(P.anisotropy,s.getMaxAnisotropy())),n.get(P).__currentAnisotropy=P.anisotropy)}}function ut(D,P){let Y=!1;D.__webglInit===void 0&&(D.__webglInit=!0,P.addEventListener("dispose",w));let oe=P.source,xe=m.get(oe);xe===void 0&&(xe={},m.set(oe,xe));let be=X(P);if(be!==D.__cacheKey){xe[be]===void 0&&(xe[be]={texture:r.createTexture(),usedTimes:0},o.memory.textures++,Y=!0),xe[be].usedTimes++;let Ie=xe[D.__cacheKey];Ie!==void 0&&(xe[D.__cacheKey].usedTimes--,Ie.usedTimes===0&&L(P)),D.__cacheKey=be,D.__webglTexture=xe[be].texture}return Y}function Ze(D,P,Y){let oe=3553;P.isDataArrayTexture&&(oe=35866),P.isData3DTexture&&(oe=32879);let xe=ut(D,P),be=P.source;if(t.activeTexture(33984+Y),t.bindTexture(oe,D.__webglTexture),be.version!==be.__currentVersion||xe===!0){r.pixelStorei(37440,P.flipY),r.pixelStorei(37441,P.premultiplyAlpha),r.pixelStorei(3317,P.unpackAlignment),r.pixelStorei(37443,0);let Ie=y(P)&&v(P.image)===!1,O=b(P.image,Ie,!1,u);O=ft(P,O);let ce=v(O)||a,Ne=i.convert(P.format,P.encoding),ge=i.convert(P.type),k=M(P.internalFormat,Ne,ge,P.encoding,P.isVideoTexture);Q(oe,P,ce);let me,de=P.mipmaps,Ue=a&&P.isVideoTexture!==!0,we=D.__version===void 0,Re=R(P,O,ce);if(P.isDepthTexture)k=6402,a?P.type===hs?k=36012:P.type===wh?k=33190:P.type===aa?k=35056:k=33189:P.type===hs&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),P.format===Ni&&k===6402&&P.type!==Kc&&P.type!==wh&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),P.type=Kc,ge=i.convert(P.type)),P.format===ha&&k===6402&&(k=34041,P.type!==aa&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),P.type=aa,ge=i.convert(P.type))),Ue&&we?t.texStorage2D(3553,1,k,O.width,O.height):t.texImage2D(3553,0,k,O.width,O.height,0,Ne,ge,null);else if(P.isDataTexture)if(de.length>0&&ce){Ue&&we&&t.texStorage2D(3553,Re,k,de[0].width,de[0].height);for(let ue=0,qe=de.length;ue<qe;ue++)me=de[ue],Ue?t.texSubImage2D(3553,ue,0,0,me.width,me.height,Ne,ge,me.data):t.texImage2D(3553,ue,k,me.width,me.height,0,Ne,ge,me.data);P.generateMipmaps=!1}else Ue?(we&&t.texStorage2D(3553,Re,k,O.width,O.height),t.texSubImage2D(3553,0,0,0,O.width,O.height,Ne,ge,O.data)):t.texImage2D(3553,0,k,O.width,O.height,0,Ne,ge,O.data);else if(P.isCompressedTexture){Ue&&we&&t.texStorage2D(3553,Re,k,de[0].width,de[0].height);for(let ue=0,qe=de.length;ue<qe;ue++)me=de[ue],P.format!==Qn?Ne!==null?Ue?t.compressedTexSubImage2D(3553,ue,0,0,me.width,me.height,Ne,me.data):t.compressedTexImage2D(3553,ue,k,me.width,me.height,0,me.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ue?t.texSubImage2D(3553,ue,0,0,me.width,me.height,Ne,ge,me.data):t.texImage2D(3553,ue,k,me.width,me.height,0,Ne,ge,me.data)}else if(P.isDataArrayTexture)Ue?(we&&t.texStorage3D(35866,Re,k,O.width,O.height,O.depth),t.texSubImage3D(35866,0,0,0,0,O.width,O.height,O.depth,Ne,ge,O.data)):t.texImage3D(35866,0,k,O.width,O.height,O.depth,0,Ne,ge,O.data);else if(P.isData3DTexture)Ue?(we&&t.texStorage3D(32879,Re,k,O.width,O.height,O.depth),t.texSubImage3D(32879,0,0,0,0,O.width,O.height,O.depth,Ne,ge,O.data)):t.texImage3D(32879,0,k,O.width,O.height,O.depth,0,Ne,ge,O.data);else if(P.isFramebufferTexture)Ue&&we?t.texStorage2D(3553,Re,k,O.width,O.height):t.texImage2D(3553,0,k,O.width,O.height,0,Ne,ge,null);else if(de.length>0&&ce){Ue&&we&&t.texStorage2D(3553,Re,k,de[0].width,de[0].height);for(let ue=0,qe=de.length;ue<qe;ue++)me=de[ue],Ue?t.texSubImage2D(3553,ue,0,0,Ne,ge,me):t.texImage2D(3553,ue,k,Ne,ge,me);P.generateMipmaps=!1}else Ue?(we&&t.texStorage2D(3553,Re,k,O.width,O.height),t.texSubImage2D(3553,0,0,0,Ne,ge,O)):t.texImage2D(3553,0,k,Ne,ge,O);E(P,ce)&&C(oe),be.__currentVersion=be.version,P.onUpdate&&P.onUpdate(P)}D.__version=P.version}function Xe(D,P,Y){if(P.image.length!==6)return;let oe=ut(D,P),xe=P.source;if(t.activeTexture(33984+Y),t.bindTexture(34067,D.__webglTexture),xe.version!==xe.__currentVersion||oe===!0){r.pixelStorei(37440,P.flipY),r.pixelStorei(37441,P.premultiplyAlpha),r.pixelStorei(3317,P.unpackAlignment),r.pixelStorei(37443,0);let be=P.isCompressedTexture||P.image[0].isCompressedTexture,Ie=P.image[0]&&P.image[0].isDataTexture,O=[];for(let ue=0;ue<6;ue++)!be&&!Ie?O[ue]=b(P.image[ue],!1,!0,l):O[ue]=Ie?P.image[ue].image:P.image[ue],O[ue]=ft(P,O[ue]);let ce=O[0],Ne=v(ce)||a,ge=i.convert(P.format,P.encoding),k=i.convert(P.type),me=M(P.internalFormat,ge,k,P.encoding),de=a&&P.isVideoTexture!==!0,Ue=D.__version===void 0,we=R(P,ce,Ne);Q(34067,P,Ne);let Re;if(be){de&&Ue&&t.texStorage2D(34067,we,me,ce.width,ce.height);for(let ue=0;ue<6;ue++){Re=O[ue].mipmaps;for(let qe=0;qe<Re.length;qe++){let wt=Re[qe];P.format!==Qn?ge!==null?de?t.compressedTexSubImage2D(34069+ue,qe,0,0,wt.width,wt.height,ge,wt.data):t.compressedTexImage2D(34069+ue,qe,me,wt.width,wt.height,0,wt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):de?t.texSubImage2D(34069+ue,qe,0,0,wt.width,wt.height,ge,k,wt.data):t.texImage2D(34069+ue,qe,me,wt.width,wt.height,0,ge,k,wt.data)}}}else{Re=P.mipmaps,de&&Ue&&(Re.length>0&&we++,t.texStorage2D(34067,we,me,O[0].width,O[0].height));for(let ue=0;ue<6;ue++)if(Ie){de?t.texSubImage2D(34069+ue,0,0,0,O[ue].width,O[ue].height,ge,k,O[ue].data):t.texImage2D(34069+ue,0,me,O[ue].width,O[ue].height,0,ge,k,O[ue].data);for(let qe=0;qe<Re.length;qe++){let at=Re[qe].image[ue].image;de?t.texSubImage2D(34069+ue,qe+1,0,0,at.width,at.height,ge,k,at.data):t.texImage2D(34069+ue,qe+1,me,at.width,at.height,0,ge,k,at.data)}}else{de?t.texSubImage2D(34069+ue,0,0,0,ge,k,O[ue]):t.texImage2D(34069+ue,0,me,ge,k,O[ue]);for(let qe=0;qe<Re.length;qe++){let wt=Re[qe];de?t.texSubImage2D(34069+ue,qe+1,0,0,ge,k,wt.image[ue]):t.texImage2D(34069+ue,qe+1,me,ge,k,wt.image[ue])}}}E(P,Ne)&&C(34067),xe.__currentVersion=xe.version,P.onUpdate&&P.onUpdate(P)}D.__version=P.version}function fe(D,P,Y,oe,xe){let be=i.convert(Y.format,Y.encoding),Ie=i.convert(Y.type),O=M(Y.internalFormat,be,Ie,Y.encoding);n.get(P).__hasExternalTextures||(xe===32879||xe===35866?t.texImage3D(xe,0,O,P.width,P.height,P.depth,0,be,Ie,null):t.texImage2D(xe,0,O,P.width,P.height,0,be,Ie,null)),t.bindFramebuffer(36160,D),Oe(P)?d.framebufferTexture2DMultisampleEXT(36160,oe,xe,n.get(Y).__webglTexture,0,Le(P)):r.framebufferTexture2D(36160,oe,xe,n.get(Y).__webglTexture,0),t.bindFramebuffer(36160,null)}function et(D,P,Y){if(r.bindRenderbuffer(36161,D),P.depthBuffer&&!P.stencilBuffer){let oe=33189;if(Y||Oe(P)){let xe=P.depthTexture;xe&&xe.isDepthTexture&&(xe.type===hs?oe=36012:xe.type===wh&&(oe=33190));let be=Le(P);Oe(P)?d.renderbufferStorageMultisampleEXT(36161,be,oe,P.width,P.height):r.renderbufferStorageMultisample(36161,be,oe,P.width,P.height)}else r.renderbufferStorage(36161,oe,P.width,P.height);r.framebufferRenderbuffer(36160,36096,36161,D)}else if(P.depthBuffer&&P.stencilBuffer){let oe=Le(P);Y&&Oe(P)===!1?r.renderbufferStorageMultisample(36161,oe,35056,P.width,P.height):Oe(P)?d.renderbufferStorageMultisampleEXT(36161,oe,35056,P.width,P.height):r.renderbufferStorage(36161,34041,P.width,P.height),r.framebufferRenderbuffer(36160,33306,36161,D)}else{let oe=P.isWebGLMultipleRenderTargets===!0?P.texture[0]:P.texture,xe=i.convert(oe.format,oe.encoding),be=i.convert(oe.type),Ie=M(oe.internalFormat,xe,be,oe.encoding),O=Le(P);Y&&Oe(P)===!1?r.renderbufferStorageMultisample(36161,O,Ie,P.width,P.height):Oe(P)?d.renderbufferStorageMultisampleEXT(36161,O,Ie,P.width,P.height):r.renderbufferStorage(36161,Ie,P.width,P.height)}r.bindRenderbuffer(36161,null)}function K(D,P){if(P&&P.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,D),!(P.depthTexture&&P.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!n.get(P.depthTexture).__webglTexture||P.depthTexture.image.width!==P.width||P.depthTexture.image.height!==P.height)&&(P.depthTexture.image.width=P.width,P.depthTexture.image.height=P.height,P.depthTexture.needsUpdate=!0),ee(P.depthTexture,0);let oe=n.get(P.depthTexture).__webglTexture,xe=Le(P);if(P.depthTexture.format===Ni)Oe(P)?d.framebufferTexture2DMultisampleEXT(36160,36096,3553,oe,0,xe):r.framebufferTexture2D(36160,36096,3553,oe,0);else if(P.depthTexture.format===ha)Oe(P)?d.framebufferTexture2DMultisampleEXT(36160,33306,3553,oe,0,xe):r.framebufferTexture2D(36160,33306,3553,oe,0);else throw new Error("Unknown depthTexture format")}function te(D){let P=n.get(D),Y=D.isWebGLCubeRenderTarget===!0;if(D.depthTexture&&!P.__autoAllocateDepthBuffer){if(Y)throw new Error("target.depthTexture not supported in Cube render targets");K(P.__webglFramebuffer,D)}else if(Y){P.__webglDepthbuffer=[];for(let oe=0;oe<6;oe++)t.bindFramebuffer(36160,P.__webglFramebuffer[oe]),P.__webglDepthbuffer[oe]=r.createRenderbuffer(),et(P.__webglDepthbuffer[oe],D,!1)}else t.bindFramebuffer(36160,P.__webglFramebuffer),P.__webglDepthbuffer=r.createRenderbuffer(),et(P.__webglDepthbuffer,D,!1);t.bindFramebuffer(36160,null)}function he(D,P,Y){let oe=n.get(D);P!==void 0&&fe(oe.__webglFramebuffer,D,D.texture,36064,3553),Y!==void 0&&te(D)}function Ee(D){let P=D.texture,Y=n.get(D),oe=n.get(P);D.addEventListener("dispose",T),D.isWebGLMultipleRenderTargets!==!0&&(oe.__webglTexture===void 0&&(oe.__webglTexture=r.createTexture()),oe.__version=P.version,o.memory.textures++);let xe=D.isWebGLCubeRenderTarget===!0,be=D.isWebGLMultipleRenderTargets===!0,Ie=v(D)||a;if(xe){Y.__webglFramebuffer=[];for(let O=0;O<6;O++)Y.__webglFramebuffer[O]=r.createFramebuffer()}else if(Y.__webglFramebuffer=r.createFramebuffer(),be)if(s.drawBuffers){let O=D.texture;for(let ce=0,Ne=O.length;ce<Ne;ce++){let ge=n.get(O[ce]);ge.__webglTexture===void 0&&(ge.__webglTexture=r.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(a&&D.samples>0&&Oe(D)===!1){Y.__webglMultisampledFramebuffer=r.createFramebuffer(),Y.__webglColorRenderbuffer=r.createRenderbuffer(),r.bindRenderbuffer(36161,Y.__webglColorRenderbuffer);let O=i.convert(P.format,P.encoding),ce=i.convert(P.type),Ne=M(P.internalFormat,O,ce,P.encoding),ge=Le(D);r.renderbufferStorageMultisample(36161,ge,Ne,D.width,D.height),t.bindFramebuffer(36160,Y.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(36160,36064,36161,Y.__webglColorRenderbuffer),r.bindRenderbuffer(36161,null),D.depthBuffer&&(Y.__webglDepthRenderbuffer=r.createRenderbuffer(),et(Y.__webglDepthRenderbuffer,D,!0)),t.bindFramebuffer(36160,null)}if(xe){t.bindTexture(34067,oe.__webglTexture),Q(34067,P,Ie);for(let O=0;O<6;O++)fe(Y.__webglFramebuffer[O],D,P,36064,34069+O);E(P,Ie)&&C(34067),t.unbindTexture()}else if(be){let O=D.texture;for(let ce=0,Ne=O.length;ce<Ne;ce++){let ge=O[ce],k=n.get(ge);t.bindTexture(3553,k.__webglTexture),Q(3553,ge,Ie),fe(Y.__webglFramebuffer,D,ge,36064+ce,3553),E(ge,Ie)&&C(3553)}t.unbindTexture()}else{let O=3553;(D.isWebGL3DRenderTarget||D.isWebGLArrayRenderTarget)&&(a?O=D.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(O,oe.__webglTexture),Q(O,P,Ie),fe(Y.__webglFramebuffer,D,P,36064,O),E(P,Ie)&&C(O),t.unbindTexture()}D.depthBuffer&&te(D)}function ve(D){let P=v(D)||a,Y=D.isWebGLMultipleRenderTargets===!0?D.texture:[D.texture];for(let oe=0,xe=Y.length;oe<xe;oe++){let be=Y[oe];if(E(be,P)){let Ie=D.isWebGLCubeRenderTarget?34067:3553,O=n.get(be).__webglTexture;t.bindTexture(Ie,O),C(Ie),t.unbindTexture()}}}function We(D){if(a&&D.samples>0&&Oe(D)===!1){let P=D.width,Y=D.height,oe=16384,xe=[36064],be=D.stencilBuffer?33306:36096;D.depthBuffer&&xe.push(be);let Ie=n.get(D),O=Ie.__ignoreDepthValues!==void 0?Ie.__ignoreDepthValues:!1;O===!1&&(D.depthBuffer&&(oe|=256),D.stencilBuffer&&(oe|=1024)),t.bindFramebuffer(36008,Ie.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,Ie.__webglFramebuffer),O===!0&&(r.invalidateFramebuffer(36008,[be]),r.invalidateFramebuffer(36009,[be])),r.blitFramebuffer(0,0,P,Y,0,0,P,Y,oe,9728),p&&r.invalidateFramebuffer(36008,xe),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,Ie.__webglMultisampledFramebuffer)}}function Le(D){return Math.min(h,D.samples)}function Oe(D){let P=n.get(D);return a&&D.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&P.__useRenderToTexture!==!1}function Nt(D){let P=o.render.frame;_.get(D)!==P&&(_.set(D,P),D.update())}function ft(D,P){let Y=D.encoding,oe=D.format,xe=D.type;return D.isCompressedTexture===!0||D.isVideoTexture===!0||D.format===Cm||Y!==Tr&&(Y===Et?a===!1?e.has("EXT_sRGB")===!0&&oe===Qn?(D.format=Cm,D.minFilter=Vn,D.generateMipmaps=!1):P=Ks.sRGBToLinear(P):(oe!==Qn||xe!==Oi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",Y)),P}this.allocateTextureUnit=z,this.resetTextureUnits=H,this.setTexture2D=ee,this.setTexture2DArray=le,this.setTexture3D=re,this.setTextureCube=Pe,this.rebindTextures=he,this.setupRenderTarget=Ee,this.updateRenderTargetMipmap=ve,this.updateMultisampleRenderTarget=We,this.setupDepthRenderbuffer=te,this.setupFrameBufferTexture=fe,this.useMultisampledRTT=Oe}function z6(r,e,t){let n=t.isWebGL2;function s(i,o=null){let a;if(i===Oi)return 5121;if(i===R4)return 32819;if(i===O4)return 32820;if(i===M4)return 5120;if(i===P4)return 5122;if(i===Kc)return 5123;if(i===N4)return 5124;if(i===wh)return 5125;if(i===hs)return 5126;if(i===oa)return n?5131:(a=e.get("OES_texture_half_float"),a!==null?a.HALF_FLOAT_OES:null);if(i===I4)return 6406;if(i===Qn)return 6408;if(i===L4)return 6409;if(i===B4)return 6410;if(i===Ni)return 6402;if(i===ha)return 34041;if(i===k4)return 6403;if(i===D4)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(i===Cm)return a=e.get("EXT_sRGB"),a!==null?a.SRGB_ALPHA_EXT:null;if(i===F4)return 36244;if(i===U4)return 33319;if(i===z4)return 33320;if(i===V4)return 36249;if(i===Bf||i===kf||i===Ff||i===Uf)if(o===Et)if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),a!==null){if(i===Bf)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===kf)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Ff)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Uf)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(a=e.get("WEBGL_compressed_texture_s3tc"),a!==null){if(i===Bf)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===kf)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Ff)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Uf)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===G1||i===H1||i===W1||i===j1)if(a=e.get("WEBGL_compressed_texture_pvrtc"),a!==null){if(i===G1)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===H1)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===W1)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===j1)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===q4)return a=e.get("WEBGL_compressed_texture_etc1"),a!==null?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===$1||i===X1)if(a=e.get("WEBGL_compressed_texture_etc"),a!==null){if(i===$1)return o===Et?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(i===X1)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===Y1||i===Z1||i===J1||i===K1||i===Q1||i===ew||i===tw||i===nw||i===rw||i===sw||i===iw||i===ow||i===aw||i===cw)if(a=e.get("WEBGL_compressed_texture_astc"),a!==null){if(i===Y1)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===Z1)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===J1)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===K1)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===Q1)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===ew)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===tw)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===nw)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===rw)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===sw)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===iw)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===ow)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===aw)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===cw)return o===Et?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===lw)if(a=e.get("EXT_texture_compression_bptc"),a!==null){if(i===lw)return o===Et?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(i===aa)return n?34042:(a=e.get("WEBGL_depth_texture"),a!==null?a.UNSIGNED_INT_24_8_WEBGL:null)}return{convert:s}}var Xm=class extends hn{constructor(e=[]){super();this.cameras=e}};Xm.prototype.isArrayCamera=!0;var Wt=class extends nt{constructor(){super();this.type="Group"}};Wt.prototype.isGroup=!0;var V6={type:"move"},Ch=class{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new Wt,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new Wt,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new A,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new A),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new Wt,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new A,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new A),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let s=null,i=null,o=null,a=this._targetRay,c=this._grip,l=this._hand;if(e&&t.session.visibilityState!=="visible-blurred")if(a!==null&&(s=t.getPose(e.targetRaySpace,n),s!==null&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(V6))),l&&e.hand){o=!0;for(let f of e.hand.values()){let m=t.getJointPose(f,n);if(l.joints[f.jointName]===void 0){let x=new Wt;x.matrixAutoUpdate=!1,x.visible=!1,l.joints[f.jointName]=x,l.add(x)}let g=l.joints[f.jointName];m!==null&&(g.matrix.fromArray(m.transform.matrix),g.matrix.decompose(g.position,g.rotation,g.scale),g.jointRadius=m.radius),g.visible=m!==null}let u=l.joints["index-finger-tip"],h=l.joints["thumb-tip"],d=u.position.distanceTo(h.position),p=.02,_=.005;l.inputState.pinching&&d>p+_?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&d<=p-_&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(i=t.getPose(e.gripSpace,n),i!==null&&(c.matrix.fromArray(i.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),i.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(i.linearVelocity)):c.hasLinearVelocity=!1,i.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(i.angularVelocity)):c.hasAngularVelocity=!1));return a!==null&&(a.visible=s!==null),c!==null&&(c.visible=i!==null),l!==null&&(l.visible=o!==null),this}},Ym=class extends Xt{constructor(e,t,n,s,i,o,a,c,l,u){if(u=u!==void 0?u:Ni,u!==Ni&&u!==ha)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");n===void 0&&u===Ni&&(n=Kc),n===void 0&&u===ha&&(n=aa);super(null,s,i,o,a,c,u,n,l);this.image={width:e,height:t},this.magFilter=a!==void 0?a:yn,this.minFilter=c!==void 0?c:yn,this.flipY=!1,this.generateMipmaps=!1}};Ym.prototype.isDepthTexture=!0;var qE=class extends pr{constructor(e,t){super();let n=this,s=null,i=1,o=null,a="local-floor",c=null,l=null,u=null,h=null,d=null,p=t.getContextAttributes(),_=null,f=null,m=[],g=new Map,x=new hn;x.layers.enable(1),x.viewport=new Se;let b=new hn;b.layers.enable(2),b.viewport=new Se;let v=[x,b],y=new Xm;y.layers.enable(1),y.layers.enable(2);let E=null,C=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(z){let X=m[z];return X===void 0&&(X=new Ch,m[z]=X),X.getTargetRaySpace()},this.getControllerGrip=function(z){let X=m[z];return X===void 0&&(X=new Ch,m[z]=X),X.getGripSpace()},this.getHand=function(z){let X=m[z];return X===void 0&&(X=new Ch,m[z]=X),X.getHandSpace()};function M(z){let X=g.get(z.inputSource);X&&X.dispatchEvent({type:z.type,data:z.inputSource})}function R(){g.forEach(function(z,X){z.disconnect(X)}),g.clear(),E=null,C=null,e.setRenderTarget(_),h=null,u=null,l=null,s=null,f=null,H.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(z){i=z,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(z){a=z,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return u!==null?u:h},this.getBinding=function(){return l},this.getFrame=function(){return d},this.getSession=function(){return s},this.setSession=async function(z){if(s=z,s!==null){if(_=e.getRenderTarget(),s.addEventListener("select",M),s.addEventListener("selectstart",M),s.addEventListener("selectend",M),s.addEventListener("squeeze",M),s.addEventListener("squeezestart",M),s.addEventListener("squeezeend",M),s.addEventListener("end",R),s.addEventListener("inputsourceschange",N),p.xrCompatible!==!0&&await t.makeXRCompatible(),s.renderState.layers===void 0||e.capabilities.isWebGL2===!1){let X={antialias:s.renderState.layers===void 0?p.antialias:!0,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:i};h=new XRWebGLLayer(s,t,X),s.updateRenderState({baseLayer:h}),f=new En(h.framebufferWidth,h.framebufferHeight,{format:Qn,type:Oi,encoding:e.outputEncoding})}else{let X=null,ee=null,le=null;p.depth&&(le=p.stencil?35056:33190,X=p.stencil?ha:Ni,ee=p.stencil?aa:Kc);let re={colorFormat:e.outputEncoding===Et?35907:32856,depthFormat:le,scaleFactor:i};l=new XRWebGLBinding(s,t),u=l.createProjectionLayer(re),s.updateRenderState({layers:[u]}),f=new En(u.textureWidth,u.textureHeight,{format:Qn,type:Oi,depthTexture:new Ym(u.textureWidth,u.textureHeight,ee,void 0,void 0,void 0,void 0,void 0,void 0,X),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0});let Pe=e.properties.get(f);Pe.__ignoreDepthValues=u.ignoreDepthValues}f.isXRRenderTarget=!0,this.setFoveation(1),o=await s.requestReferenceSpace(a),H.setContext(s),H.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}};function N(z){let X=s.inputSources;for(let ee=0;ee<m.length;ee++)g.set(X[ee],m[ee]);for(let ee=0;ee<z.removed.length;ee++){let le=z.removed[ee],re=g.get(le);re&&(re.dispatchEvent({type:"disconnected",data:le}),g.delete(le))}for(let ee=0;ee<z.added.length;ee++){let le=z.added[ee],re=g.get(le);re&&re.dispatchEvent({type:"connected",data:le})}}let w=new A,T=new A;function F(z,X,ee){w.setFromMatrixPosition(X.matrixWorld),T.setFromMatrixPosition(ee.matrixWorld);let le=w.distanceTo(T),re=X.projectionMatrix.elements,Pe=ee.projectionMatrix.elements,He=re[14]/(re[10]-1),ke=re[14]/(re[10]+1),Q=(re[9]+1)/re[5],ut=(re[9]-1)/re[5],Ze=(re[8]-1)/re[0],Xe=(Pe[8]+1)/Pe[0],fe=He*Ze,et=He*Xe,K=le/(-Ze+Xe),te=K*-Ze;X.matrixWorld.decompose(z.position,z.quaternion,z.scale),z.translateX(te),z.translateZ(K),z.matrixWorld.compose(z.position,z.quaternion,z.scale),z.matrixWorldInverse.copy(z.matrixWorld).invert();let he=He+K,Ee=ke+K,ve=fe-te,We=et+(le-te),Le=Q*ke/Ee*he,Oe=ut*ke/Ee*he;z.projectionMatrix.makePerspective(ve,We,Le,Oe,he,Ee)}function L(z,X){X===null?z.matrixWorld.copy(z.matrix):z.matrixWorld.multiplyMatrices(X.matrixWorld,z.matrix),z.matrixWorldInverse.copy(z.matrixWorld).invert()}this.updateCamera=function(z){if(s===null)return;y.near=b.near=x.near=z.near,y.far=b.far=x.far=z.far,(E!==y.near||C!==y.far)&&(s.updateRenderState({depthNear:y.near,depthFar:y.far}),E=y.near,C=y.far);let X=z.parent,ee=y.cameras;L(y,X);for(let re=0;re<ee.length;re++)L(ee[re],X);y.matrixWorld.decompose(y.position,y.quaternion,y.scale),z.position.copy(y.position),z.quaternion.copy(y.quaternion),z.scale.copy(y.scale),z.matrix.copy(y.matrix),z.matrixWorld.copy(y.matrixWorld);let le=z.children;for(let re=0,Pe=le.length;re<Pe;re++)le[re].updateMatrixWorld(!0);ee.length===2?F(y,x,b):y.projectionMatrix.copy(x.projectionMatrix)},this.getCamera=function(){return y},this.getFoveation=function(){if(u!==null)return u.fixedFoveation;if(h!==null)return h.fixedFoveation},this.setFoveation=function(z){u!==null&&(u.fixedFoveation=z),h!==null&&h.fixedFoveation!==void 0&&(h.fixedFoveation=z)};let V=null;function B(z,X){if(c=X.getViewerPose(o),d=X,c!==null){let le=c.views;h!==null&&(e.setRenderTargetFramebuffer(f,h.framebuffer),e.setRenderTarget(f));let re=!1;le.length!==y.cameras.length&&(y.cameras.length=0,re=!0);for(let Pe=0;Pe<le.length;Pe++){let He=le[Pe],ke=null;if(h!==null)ke=h.getViewport(He);else{let ut=l.getViewSubImage(u,He);ke=ut.viewport,Pe===0&&(e.setRenderTargetTextures(f,ut.colorTexture,u.ignoreDepthValues?void 0:ut.depthStencilTexture),e.setRenderTarget(f))}let Q=v[Pe];Q.matrix.fromArray(He.transform.matrix),Q.projectionMatrix.fromArray(He.projectionMatrix),Q.viewport.set(ke.x,ke.y,ke.width,ke.height),Pe===0&&y.matrix.copy(Q.matrix),re===!0&&y.cameras.push(Q)}}let ee=s.inputSources;for(let le=0;le<m.length;le++){let re=m[le],Pe=ee[le];re.update(Pe,X,o)}V&&V(z,X),d=null}let H=new RE;H.setAnimationLoop(B),this.setAnimationLoop=function(z){V=z},this.dispose=function(){}}};function q6(r,e){function t(f,m){f.fogColor.value.copy(m.color),m.isFog?(f.fogNear.value=m.near,f.fogFar.value=m.far):m.isFogExp2&&(f.fogDensity.value=m.density)}function n(f,m,g,x,b){m.isMeshBasicMaterial||m.isMeshLambertMaterial?s(f,m):m.isMeshToonMaterial?(s(f,m),u(f,m)):m.isMeshPhongMaterial?(s(f,m),l(f,m)):m.isMeshStandardMaterial?(s(f,m),h(f,m),m.isMeshPhysicalMaterial&&d(f,m,b)):m.isMeshMatcapMaterial?(s(f,m),p(f,m)):m.isMeshDepthMaterial?s(f,m):m.isMeshDistanceMaterial?(s(f,m),_(f,m)):m.isMeshNormalMaterial?s(f,m):m.isLineBasicMaterial?(i(f,m),m.isLineDashedMaterial&&o(f,m)):m.isPointsMaterial?a(f,m,g,x):m.isSpriteMaterial?c(f,m):m.isShadowMaterial?(f.color.value.copy(m.color),f.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}function s(f,m){f.opacity.value=m.opacity,m.color&&f.diffuse.value.copy(m.color),m.emissive&&f.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(f.map.value=m.map),m.alphaMap&&(f.alphaMap.value=m.alphaMap),m.bumpMap&&(f.bumpMap.value=m.bumpMap,f.bumpScale.value=m.bumpScale,m.side===er&&(f.bumpScale.value*=-1)),m.displacementMap&&(f.displacementMap.value=m.displacementMap,f.displacementScale.value=m.displacementScale,f.displacementBias.value=m.displacementBias),m.emissiveMap&&(f.emissiveMap.value=m.emissiveMap),m.normalMap&&(f.normalMap.value=m.normalMap,f.normalScale.value.copy(m.normalScale),m.side===er&&f.normalScale.value.negate()),m.specularMap&&(f.specularMap.value=m.specularMap),m.alphaTest>0&&(f.alphaTest.value=m.alphaTest);let g=e.get(m).envMap;if(g&&(f.envMap.value=g,f.flipEnvMap.value=g.isCubeTexture&&g.isRenderTargetTexture===!1?-1:1,f.reflectivity.value=m.reflectivity,f.ior.value=m.ior,f.refractionRatio.value=m.refractionRatio),m.lightMap){f.lightMap.value=m.lightMap;let v=r.physicallyCorrectLights!==!0?Math.PI:1;f.lightMapIntensity.value=m.lightMapIntensity*v}m.aoMap&&(f.aoMap.value=m.aoMap,f.aoMapIntensity.value=m.aoMapIntensity);let x;m.map?x=m.map:m.specularMap?x=m.specularMap:m.displacementMap?x=m.displacementMap:m.normalMap?x=m.normalMap:m.bumpMap?x=m.bumpMap:m.roughnessMap?x=m.roughnessMap:m.metalnessMap?x=m.metalnessMap:m.alphaMap?x=m.alphaMap:m.emissiveMap?x=m.emissiveMap:m.clearcoatMap?x=m.clearcoatMap:m.clearcoatNormalMap?x=m.clearcoatNormalMap:m.clearcoatRoughnessMap?x=m.clearcoatRoughnessMap:m.specularIntensityMap?x=m.specularIntensityMap:m.specularColorMap?x=m.specularColorMap:m.transmissionMap?x=m.transmissionMap:m.thicknessMap?x=m.thicknessMap:m.sheenColorMap?x=m.sheenColorMap:m.sheenRoughnessMap&&(x=m.sheenRoughnessMap),x!==void 0&&(x.isWebGLRenderTarget&&(x=x.texture),x.matrixAutoUpdate===!0&&x.updateMatrix(),f.uvTransform.value.copy(x.matrix));let b;m.aoMap?b=m.aoMap:m.lightMap&&(b=m.lightMap),b!==void 0&&(b.isWebGLRenderTarget&&(b=b.texture),b.matrixAutoUpdate===!0&&b.updateMatrix(),f.uv2Transform.value.copy(b.matrix))}function i(f,m){f.diffuse.value.copy(m.color),f.opacity.value=m.opacity}function o(f,m){f.dashSize.value=m.dashSize,f.totalSize.value=m.dashSize+m.gapSize,f.scale.value=m.scale}function a(f,m,g,x){f.diffuse.value.copy(m.color),f.opacity.value=m.opacity,f.size.value=m.size*g,f.scale.value=x*.5,m.map&&(f.map.value=m.map),m.alphaMap&&(f.alphaMap.value=m.alphaMap),m.alphaTest>0&&(f.alphaTest.value=m.alphaTest);let b;m.map?b=m.map:m.alphaMap&&(b=m.alphaMap),b!==void 0&&(b.matrixAutoUpdate===!0&&b.updateMatrix(),f.uvTransform.value.copy(b.matrix))}function c(f,m){f.diffuse.value.copy(m.color),f.opacity.value=m.opacity,f.rotation.value=m.rotation,m.map&&(f.map.value=m.map),m.alphaMap&&(f.alphaMap.value=m.alphaMap),m.alphaTest>0&&(f.alphaTest.value=m.alphaTest);let g;m.map?g=m.map:m.alphaMap&&(g=m.alphaMap),g!==void 0&&(g.matrixAutoUpdate===!0&&g.updateMatrix(),f.uvTransform.value.copy(g.matrix))}function l(f,m){f.specular.value.copy(m.specular),f.shininess.value=Math.max(m.shininess,1e-4)}function u(f,m){m.gradientMap&&(f.gradientMap.value=m.gradientMap)}function h(f,m){f.roughness.value=m.roughness,f.metalness.value=m.metalness,m.roughnessMap&&(f.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(f.metalnessMap.value=m.metalnessMap),e.get(m).envMap&&(f.envMapIntensity.value=m.envMapIntensity)}function d(f,m,g){f.ior.value=m.ior,m.sheen>0&&(f.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),f.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(f.sheenColorMap.value=m.sheenColorMap),m.sheenRoughnessMap&&(f.sheenRoughnessMap.value=m.sheenRoughnessMap)),m.clearcoat>0&&(f.clearcoat.value=m.clearcoat,f.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(f.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(f.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(f.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),f.clearcoatNormalMap.value=m.clearcoatNormalMap,m.side===er&&f.clearcoatNormalScale.value.negate())),m.transmission>0&&(f.transmission.value=m.transmission,f.transmissionSamplerMap.value=g.texture,f.transmissionSamplerSize.value.set(g.width,g.height),m.transmissionMap&&(f.transmissionMap.value=m.transmissionMap),f.thickness.value=m.thickness,m.thicknessMap&&(f.thicknessMap.value=m.thicknessMap),f.attenuationDistance.value=m.attenuationDistance,f.attenuationColor.value.copy(m.attenuationColor)),f.specularIntensity.value=m.specularIntensity,f.specularColor.value.copy(m.specularColor),m.specularIntensityMap&&(f.specularIntensityMap.value=m.specularIntensityMap),m.specularColorMap&&(f.specularColorMap.value=m.specularColorMap)}function p(f,m){m.matcap&&(f.matcap.value=m.matcap)}function _(f,m){f.referencePosition.value.copy(m.referencePosition),f.nearDistance.value=m.nearDistance,f.farDistance.value=m.farDistance}return{refreshFogUniforms:t,refreshMaterialUniforms:n}}function G6(){let r=tl("canvas");return r.style.display="block",r}function _t(r={}){let e=r.canvas!==void 0?r.canvas:G6(),t=r.context!==void 0?r.context:null,n=r.depth!==void 0?r.depth:!0,s=r.stencil!==void 0?r.stencil:!0,i=r.antialias!==void 0?r.antialias:!1,o=r.premultipliedAlpha!==void 0?r.premultipliedAlpha:!0,a=r.preserveDrawingBuffer!==void 0?r.preserveDrawingBuffer:!1,c=r.powerPreference!==void 0?r.powerPreference:"default",l=r.failIfMajorPerformanceCaveat!==void 0?r.failIfMajorPerformanceCaveat:!1,u;r.context!==void 0?u=t.getContextAttributes().alpha:u=r.alpha!==void 0?r.alpha:!1;let h=null,d=null,p=[],_=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Tr,this.physicallyCorrectLights=!1,this.toneMapping=Ar,this.toneMappingExposure=1;let f=this,m=!1,g=0,x=0,b=null,v=-1,y=null,E=new Se,C=new Se,M=null,R=e.width,N=e.height,w=1,T=null,F=null,L=new Se(0,0,R,N),V=new Se(0,0,R,N),B=!1,H=new ll,z=!1,X=!1,ee=null,le=new pe,re=new G,Pe=new A,He={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ke(){return b===null?w:1}let Q=t;function ut(I,j){for(let Z=0;Z<I.length;Z++){let $=I[Z],ne=e.getContext($,j);if(ne!==null)return ne}return null}try{let I={alpha:!0,depth:n,stencil:s,antialias:i,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:c,failIfMajorPerformanceCaveat:l};if("setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Im}`),e.addEventListener("webglcontextlost",k,!1),e.addEventListener("webglcontextrestored",me,!1),Q===null){let j=["webgl2","webgl","experimental-webgl"];if(f.isWebGL1Renderer===!0&&j.shift(),Q=ut(j,I),Q===null)throw ut(j)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}Q.getShaderPrecisionFormat===void 0&&(Q.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(I){throw console.error("THREE.WebGLRenderer: "+I.message),I}let Ze,Xe,fe,et,K,te,he,Ee,ve,We,Le,Oe,Nt,ft,D,P,Y,oe,xe,be,Ie,O,ce;function Ne(){Ze=new uH(Q),Xe=new sH(Q,Ze,r),Ze.init(Xe),O=new z6(Q,Ze,Xe),fe=new F6(Q,Ze,Xe),et=new pH(Q),K=new T6,te=new U6(Q,Ze,fe,K,Xe,O,et),he=new oH(f),Ee=new lH(f),ve=new TV(Q,Xe),ce=new nH(Q,Ze,ve,Xe),We=new hH(Q,ve,et,ce),Le=new gH(Q,We,ve,et),xe=new _H(Q,Xe,te),P=new iH(K),Oe=new A6(f,he,Ee,Ze,Xe,ce,P),Nt=new q6(f,K),ft=new P6,D=new L6(Ze,Xe),oe=new tH(f,he,fe,Le,u,o),Y=new VE(f,Le,Xe),be=new rH(Q,Ze,et,Xe),Ie=new dH(Q,Ze,et,Xe),et.programs=Oe.programs,f.capabilities=Xe,f.extensions=Ze,f.properties=K,f.renderLists=ft,f.shadowMap=Y,f.state=fe,f.info=et}Ne();let ge=new qE(f,Q);this.xr=ge,this.getContext=function(){return Q},this.getContextAttributes=function(){return Q.getContextAttributes()},this.forceContextLoss=function(){let I=Ze.get("WEBGL_lose_context");I&&I.loseContext()},this.forceContextRestore=function(){let I=Ze.get("WEBGL_lose_context");I&&I.restoreContext()},this.getPixelRatio=function(){return w},this.setPixelRatio=function(I){I!==void 0&&(w=I,this.setSize(R,N,!1))},this.getSize=function(I){return I.set(R,N)},this.setSize=function(I,j,Z){if(ge.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}R=I,N=j,e.width=Math.floor(I*w),e.height=Math.floor(j*w),Z!==!1&&(e.style.width=I+"px",e.style.height=j+"px"),this.setViewport(0,0,I,j)},this.getDrawingBufferSize=function(I){return I.set(R*w,N*w).floor()},this.setDrawingBufferSize=function(I,j,Z){R=I,N=j,w=Z,e.width=Math.floor(I*Z),e.height=Math.floor(j*Z),this.setViewport(0,0,I,j)},this.getCurrentViewport=function(I){return I.copy(E)},this.getViewport=function(I){return I.copy(L)},this.setViewport=function(I,j,Z,$){I.isVector4?L.set(I.x,I.y,I.z,I.w):L.set(I,j,Z,$),fe.viewport(E.copy(L).multiplyScalar(w).floor())},this.getScissor=function(I){return I.copy(V)},this.setScissor=function(I,j,Z,$){I.isVector4?V.set(I.x,I.y,I.z,I.w):V.set(I,j,Z,$),fe.scissor(C.copy(V).multiplyScalar(w).floor())},this.getScissorTest=function(){return B},this.setScissorTest=function(I){fe.setScissorTest(B=I)},this.setOpaqueSort=function(I){T=I},this.setTransparentSort=function(I){F=I},this.getClearColor=function(I){return I.copy(oe.getClearColor())},this.setClearColor=function(){oe.setClearColor.apply(oe,arguments)},this.getClearAlpha=function(){return oe.getClearAlpha()},this.setClearAlpha=function(){oe.setClearAlpha.apply(oe,arguments)},this.clear=function(I=!0,j=!0,Z=!0){let $=0;I&&($|=16384),j&&($|=256),Z&&($|=1024),Q.clear($)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",k,!1),e.removeEventListener("webglcontextrestored",me,!1),ft.dispose(),D.dispose(),K.dispose(),he.dispose(),Ee.dispose(),Le.dispose(),ce.dispose(),Oe.dispose(),ge.dispose(),ge.removeEventListener("sessionstart",qe),ge.removeEventListener("sessionend",wt),ee&&(ee.dispose(),ee=null),at.stop()};function k(I){I.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function me(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;let I=et.autoReset,j=Y.enabled,Z=Y.autoUpdate,$=Y.needsUpdate,ne=Y.type;Ne(),et.autoReset=I,Y.enabled=j,Y.autoUpdate=Z,Y.needsUpdate=$,Y.type=ne}function de(I){let j=I.target;j.removeEventListener("dispose",de),Ue(j)}function Ue(I){we(I),K.remove(I)}function we(I){let j=K.get(I).programs;j!==void 0&&(j.forEach(function(Z){Oe.releaseProgram(Z)}),I.isShaderMaterial&&Oe.releaseShaderCache(I))}this.renderBufferDirect=function(I,j,Z,$,ne,Ge){j===null&&(j=He);let Ke=ne.isMesh&&ne.matrixWorld.determinant()<0,rt=Qz(I,j,Z,$,ne);fe.setMaterial($,Ke);let tt=Z.index,yt=Z.attributes.position;if(tt===null){if(yt===void 0||yt.count===0)return}else if(tt.count===0)return;let ct=1;$.wireframe===!0&&(tt=We.getWireframeAttribute(Z),ct=2),ce.setup(ne,$,rt,Z,tt);let ht,Ht=be;tt!==null&&(ht=ve.get(tt),Ht=Ie,Ht.setIndex(ht));let wi=tt!==null?tt.count:yt.count,Io=Z.drawRange.start*ct,Do=Z.drawRange.count*ct,zr=Ge!==null?Ge.start*ct:0,mt=Ge!==null?Ge.count*ct:1/0,Lo=Math.max(Io,zr),en=Math.min(wi,Io+Do,zr+mt)-1,Vr=Math.max(0,en-Lo+1);if(Vr!==0){if(ne.isMesh)$.wireframe===!0?(fe.setLineWidth($.wireframeLinewidth*ke()),Ht.setMode(1)):Ht.setMode(4);else if(ne.isLine){let Us=$.linewidth;Us===void 0&&(Us=1),fe.setLineWidth(Us*ke()),ne.isLineSegments?Ht.setMode(1):ne.isLineLoop?Ht.setMode(2):Ht.setMode(3)}else ne.isPoints?Ht.setMode(0):ne.isSprite&&Ht.setMode(4);if(ne.isInstancedMesh)Ht.renderInstances(Lo,Vr,ne.count);else if(Z.isInstancedBufferGeometry){let Us=Math.min(Z.instanceCount,Z._maxInstanceCount);Ht.renderInstances(Lo,Vr,Us)}else Ht.render(Lo,Vr)}},this.compile=function(I,j){d=D.get(I),d.init(),_.push(d),I.traverseVisible(function(Z){Z.isLight&&Z.layers.test(j.layers)&&(d.pushLight(Z),Z.castShadow&&d.pushShadow(Z))}),d.setupLights(f.physicallyCorrectLights),I.traverse(function(Z){let $=Z.material;if($)if(Array.isArray($))for(let ne=0;ne<$.length;ne++){let Ge=$[ne];If(Ge,I,Z)}else If($,I,Z)}),_.pop(),d=null};let Re=null;function ue(I){Re&&Re(I)}function qe(){at.stop()}function wt(){at.start()}let at=new RE;at.setAnimationLoop(ue),typeof self<"u"&&at.setContext(self),this.setAnimationLoop=function(I){Re=I,ge.setAnimationLoop(I),I===null?at.stop():at.start()},ge.addEventListener("sessionstart",qe),ge.addEventListener("sessionend",wt),this.render=function(I,j){if(j!==void 0&&j.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(m===!0)return;I.autoUpdate===!0&&I.updateMatrixWorld(),j.parent===null&&j.updateMatrixWorld(),ge.enabled===!0&&ge.isPresenting===!0&&(ge.cameraAutoUpdate===!0&&ge.updateCamera(j),j=ge.getCamera()),I.isScene===!0&&I.onBeforeRender(f,I,j,b),d=D.get(I,_.length),d.init(),_.push(d),le.multiplyMatrices(j.projectionMatrix,j.matrixWorldInverse),H.setFromProjectionMatrix(le),X=this.localClippingEnabled,z=P.init(this.clippingPlanes,X,j),h=ft.get(I,p.length),h.init(),p.push(h),Fr(I,j,0,f.sortObjects),h.finish(),f.sortObjects===!0&&h.sort(T,F),z===!0&&P.beginShadows();let Z=d.state.shadowsArray;if(Y.render(Z,I,j),z===!0&&P.endShadows(),this.info.autoReset===!0&&this.info.reset(),oe.render(h,I),d.setupLights(f.physicallyCorrectLights),j.isArrayCamera){let $=j.cameras;for(let ne=0,Ge=$.length;ne<Ge;ne++){let Ke=$[ne];Ur(h,I,Ke,Ke.viewport)}}else Ur(h,I,j);b!==null&&(te.updateMultisampleRenderTarget(b),te.updateRenderTargetMipmap(b)),I.isScene===!0&&I.onAfterRender(f,I,j),ce.resetDefaultState(),v=-1,y=null,_.pop(),_.length>0?d=_[_.length-1]:d=null,p.pop(),p.length>0?h=p[p.length-1]:h=null};function Fr(I,j,Z,$){if(I.visible===!1)return;if(I.layers.test(j.layers)){if(I.isGroup)Z=I.renderOrder;else if(I.isLOD)I.autoUpdate===!0&&I.update(j);else if(I.isLight)d.pushLight(I),I.castShadow&&d.pushShadow(I);else if(I.isSprite){if(!I.frustumCulled||H.intersectsSprite(I)){$&&Pe.setFromMatrixPosition(I.matrixWorld).applyMatrix4(le);let Ke=Le.update(I),rt=I.material;rt.visible&&h.push(I,Ke,rt,Z,Pe.z,null)}}else if((I.isMesh||I.isLine||I.isPoints)&&(I.isSkinnedMesh&&I.skeleton.frame!==et.render.frame&&(I.skeleton.update(),I.skeleton.frame=et.render.frame),!I.frustumCulled||H.intersectsObject(I))){$&&Pe.setFromMatrixPosition(I.matrixWorld).applyMatrix4(le);let Ke=Le.update(I),rt=I.material;if(Array.isArray(rt)){let tt=Ke.groups;for(let yt=0,ct=tt.length;yt<ct;yt++){let ht=tt[yt],Ht=rt[ht.materialIndex];Ht&&Ht.visible&&h.push(I,Ke,Ht,Z,Pe.z,ht)}}else rt.visible&&h.push(I,Ke,rt,Z,Pe.z,null)}}let Ge=I.children;for(let Ke=0,rt=Ge.length;Ke<rt;Ke++)Fr(Ge[Ke],j,Z,$)}function Ur(I,j,Z,$){let ne=I.opaque,Ge=I.transmissive,Ke=I.transparent;d.setupLightsView(Z),Ge.length>0&&Jz(ne,j,Z),$&&fe.viewport(E.copy($)),ne.length>0&&Vu(ne,j,Z),Ge.length>0&&Vu(Ge,j,Z),Ke.length>0&&Vu(Ke,j,Z),fe.buffers.depth.setTest(!0),fe.buffers.depth.setMask(!0),fe.buffers.color.setMask(!0),fe.setPolygonOffset(!1)}function Jz(I,j,Z){let $=Xe.isWebGL2;ee===null&&(ee=new En(1,1,{generateMipmaps:!0,type:O.convert(oa)!==null?oa:Oi,minFilter:Lh,samples:$&&i===!0?4:0})),f.getDrawingBufferSize(re),$?ee.setSize(re.x,re.y):ee.setSize(Ph(re.x),Ph(re.y));let ne=f.getRenderTarget();f.setRenderTarget(ee),f.clear();let Ge=f.toneMapping;f.toneMapping=Ar,Vu(I,j,Z),f.toneMapping=Ge,te.updateMultisampleRenderTarget(ee),te.updateRenderTargetMipmap(ee),f.setRenderTarget(ne)}function Vu(I,j,Z){let $=j.isScene===!0?j.overrideMaterial:null;for(let ne=0,Ge=I.length;ne<Ge;ne++){let Ke=I[ne],rt=Ke.object,tt=Ke.geometry,yt=$===null?Ke.material:$,ct=Ke.group;rt.layers.test(Z.layers)&&Kz(rt,j,Z,tt,yt,ct)}}function Kz(I,j,Z,$,ne,Ge){I.onBeforeRender(f,j,Z,$,ne,Ge),I.modelViewMatrix.multiplyMatrices(Z.matrixWorldInverse,I.matrixWorld),I.normalMatrix.getNormalMatrix(I.modelViewMatrix),ne.onBeforeRender(f,j,Z,$,I,Ge),ne.transparent===!0&&ne.side===Zs?(ne.side=er,ne.needsUpdate=!0,f.renderBufferDirect(Z,j,$,ne,I,Ge),ne.side=tr,ne.needsUpdate=!0,f.renderBufferDirect(Z,j,$,ne,I,Ge),ne.side=Zs):f.renderBufferDirect(Z,j,$,ne,I,Ge),I.onAfterRender(f,j,Z,$,ne,Ge)}function If(I,j,Z){j.isScene!==!0&&(j=He);let $=K.get(I),ne=d.state.lights,Ge=d.state.shadowsArray,Ke=ne.state.version,rt=Oe.getParameters(I,ne.state,Ge,j,Z),tt=Oe.getProgramCacheKey(rt),yt=$.programs;$.environment=I.isMeshStandardMaterial?j.environment:null,$.fog=j.fog,$.envMap=(I.isMeshStandardMaterial?Ee:he).get(I.envMap||$.environment),yt===void 0&&(I.addEventListener("dispose",de),yt=new Map,$.programs=yt);let ct=yt.get(tt);if(ct!==void 0){if($.currentProgram===ct&&$.lightsStateVersion===Ke)return O1(I,rt),ct}else rt.uniforms=Oe.getUniforms(I),I.onBuild(Z,rt,f),I.onBeforeCompile(rt,f),ct=Oe.acquireProgram(rt,tt),yt.set(tt,ct),$.uniforms=rt.uniforms;let ht=$.uniforms;(!I.isShaderMaterial&&!I.isRawShaderMaterial||I.clipping===!0)&&(ht.clippingPlanes=P.uniform),O1(I,rt),$.needsLights=t4(I),$.lightsStateVersion=Ke,$.needsLights&&(ht.ambientLightColor.value=ne.state.ambient,ht.lightProbe.value=ne.state.probe,ht.directionalLights.value=ne.state.directional,ht.directionalLightShadows.value=ne.state.directionalShadow,ht.spotLights.value=ne.state.spot,ht.spotLightShadows.value=ne.state.spotShadow,ht.rectAreaLights.value=ne.state.rectArea,ht.ltc_1.value=ne.state.rectAreaLTC1,ht.ltc_2.value=ne.state.rectAreaLTC2,ht.pointLights.value=ne.state.point,ht.pointLightShadows.value=ne.state.pointShadow,ht.hemisphereLights.value=ne.state.hemi,ht.directionalShadowMap.value=ne.state.directionalShadowMap,ht.directionalShadowMatrix.value=ne.state.directionalShadowMatrix,ht.spotShadowMap.value=ne.state.spotShadowMap,ht.spotShadowMatrix.value=ne.state.spotShadowMatrix,ht.pointShadowMap.value=ne.state.pointShadowMap,ht.pointShadowMatrix.value=ne.state.pointShadowMatrix);let Ht=ct.getUniforms(),wi=Ys.seqWithValue(Ht.seq,ht);return $.currentProgram=ct,$.uniformsList=wi,ct}function O1(I,j){let Z=K.get(I);Z.outputEncoding=j.outputEncoding,Z.instancing=j.instancing,Z.skinning=j.skinning,Z.morphTargets=j.morphTargets,Z.morphNormals=j.morphNormals,Z.morphColors=j.morphColors,Z.morphTargetsCount=j.morphTargetsCount,Z.numClippingPlanes=j.numClippingPlanes,Z.numIntersection=j.numClipIntersection,Z.vertexAlphas=j.vertexAlphas,Z.vertexTangents=j.vertexTangents,Z.toneMapping=j.toneMapping}function Qz(I,j,Z,$,ne){j.isScene!==!0&&(j=He),te.resetTextureUnits();let Ge=j.fog,Ke=$.isMeshStandardMaterial?j.environment:null,rt=b===null?f.outputEncoding:b.isXRRenderTarget===!0?b.texture.encoding:Tr,tt=($.isMeshStandardMaterial?Ee:he).get($.envMap||Ke),yt=$.vertexColors===!0&&!!Z.attributes.color&&Z.attributes.color.itemSize===4,ct=!!$.normalMap&&!!Z.attributes.tangent,ht=!!Z.morphAttributes.position,Ht=!!Z.morphAttributes.normal,wi=!!Z.morphAttributes.color,Io=$.toneMapped?f.toneMapping:Ar,Do=Z.morphAttributes.position||Z.morphAttributes.normal||Z.morphAttributes.color,zr=Do!==void 0?Do.length:0,mt=K.get($),Lo=d.state.lights;if(z===!0&&(X===!0||I!==y)){let vr=I===y&&$.id===v;P.setState($,I,vr)}let en=!1;$.version===mt.__version?(mt.needsLights&&mt.lightsStateVersion!==Lo.state.version||mt.outputEncoding!==rt||ne.isInstancedMesh&&mt.instancing===!1||!ne.isInstancedMesh&&mt.instancing===!0||ne.isSkinnedMesh&&mt.skinning===!1||!ne.isSkinnedMesh&&mt.skinning===!0||mt.envMap!==tt||$.fog&&mt.fog!==Ge||mt.numClippingPlanes!==void 0&&(mt.numClippingPlanes!==P.numPlanes||mt.numIntersection!==P.numIntersection)||mt.vertexAlphas!==yt||mt.vertexTangents!==ct||mt.morphTargets!==ht||mt.morphNormals!==Ht||mt.morphColors!==wi||mt.toneMapping!==Io||Xe.isWebGL2===!0&&mt.morphTargetsCount!==zr)&&(en=!0):(en=!0,mt.__version=$.version);let Vr=mt.currentProgram;en===!0&&(Vr=If($,j,ne));let Us=!1,Bc=!1,Df=!1,Tn=Vr.getUniforms(),kc=mt.uniforms;if(fe.useProgram(Vr.program)&&(Us=!0,Bc=!0,Df=!0),$.id!==v&&(v=$.id,Bc=!0),Us||y!==I){if(Tn.setValue(Q,"projectionMatrix",I.projectionMatrix),Xe.logarithmicDepthBuffer&&Tn.setValue(Q,"logDepthBufFC",2/(Math.log(I.far+1)/Math.LN2)),y!==I&&(y=I,Bc=!0,Df=!0),$.isShaderMaterial||$.isMeshPhongMaterial||$.isMeshToonMaterial||$.isMeshStandardMaterial||$.envMap){let vr=Tn.map.cameraPosition;vr!==void 0&&vr.setValue(Q,Pe.setFromMatrixPosition(I.matrixWorld))}($.isMeshPhongMaterial||$.isMeshToonMaterial||$.isMeshLambertMaterial||$.isMeshBasicMaterial||$.isMeshStandardMaterial||$.isShaderMaterial)&&Tn.setValue(Q,"isOrthographic",I.isOrthographicCamera===!0),($.isMeshPhongMaterial||$.isMeshToonMaterial||$.isMeshLambertMaterial||$.isMeshBasicMaterial||$.isMeshStandardMaterial||$.isShaderMaterial||$.isShadowMaterial||ne.isSkinnedMesh)&&Tn.setValue(Q,"viewMatrix",I.matrixWorldInverse)}if(ne.isSkinnedMesh){Tn.setOptional(Q,ne,"bindMatrix"),Tn.setOptional(Q,ne,"bindMatrixInverse");let vr=ne.skeleton;vr&&(Xe.floatVertexTextures?(vr.boneTexture===null&&vr.computeBoneTexture(),Tn.setValue(Q,"boneTexture",vr.boneTexture,te),Tn.setValue(Q,"boneTextureSize",vr.boneTextureSize)):Tn.setOptional(Q,vr,"boneMatrices"))}let Lf=Z.morphAttributes;return(Lf.position!==void 0||Lf.normal!==void 0||Lf.color!==void 0&&Xe.isWebGL2===!0)&&xe.update(ne,Z,$,Vr),(Bc||mt.receiveShadow!==ne.receiveShadow)&&(mt.receiveShadow=ne.receiveShadow,Tn.setValue(Q,"receiveShadow",ne.receiveShadow)),Bc&&(Tn.setValue(Q,"toneMappingExposure",f.toneMappingExposure),mt.needsLights&&e4(kc,Df),Ge&&$.fog&&Nt.refreshFogUniforms(kc,Ge),Nt.refreshMaterialUniforms(kc,$,w,N,ee),Ys.upload(Q,mt.uniformsList,kc,te)),$.isShaderMaterial&&$.uniformsNeedUpdate===!0&&(Ys.upload(Q,mt.uniformsList,kc,te),$.uniformsNeedUpdate=!1),$.isSpriteMaterial&&Tn.setValue(Q,"center",ne.center),Tn.setValue(Q,"modelViewMatrix",ne.modelViewMatrix),Tn.setValue(Q,"normalMatrix",ne.normalMatrix),Tn.setValue(Q,"modelMatrix",ne.matrixWorld),Vr}function e4(I,j){I.ambientLightColor.needsUpdate=j,I.lightProbe.needsUpdate=j,I.directionalLights.needsUpdate=j,I.directionalLightShadows.needsUpdate=j,I.pointLights.needsUpdate=j,I.pointLightShadows.needsUpdate=j,I.spotLights.needsUpdate=j,I.spotLightShadows.needsUpdate=j,I.rectAreaLights.needsUpdate=j,I.hemisphereLights.needsUpdate=j}function t4(I){return I.isMeshLambertMaterial||I.isMeshToonMaterial||I.isMeshPhongMaterial||I.isMeshStandardMaterial||I.isShadowMaterial||I.isShaderMaterial&&I.lights===!0}this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return x},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(I,j,Z){K.get(I.texture).__webglTexture=j,K.get(I.depthTexture).__webglTexture=Z;let $=K.get(I);$.__hasExternalTextures=!0,$.__hasExternalTextures&&($.__autoAllocateDepthBuffer=Z===void 0,$.__autoAllocateDepthBuffer||Ze.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),$.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(I,j){let Z=K.get(I);Z.__webglFramebuffer=j,Z.__useDefaultFramebuffer=j===void 0},this.setRenderTarget=function(I,j=0,Z=0){b=I,g=j,x=Z;let $=!0;if(I){let tt=K.get(I);tt.__useDefaultFramebuffer!==void 0?(fe.bindFramebuffer(36160,null),$=!1):tt.__webglFramebuffer===void 0?te.setupRenderTarget(I):tt.__hasExternalTextures&&te.rebindTextures(I,K.get(I.texture).__webglTexture,K.get(I.depthTexture).__webglTexture)}let ne=null,Ge=!1,Ke=!1;if(I){let tt=I.texture;(tt.isData3DTexture||tt.isDataArrayTexture)&&(Ke=!0);let yt=K.get(I).__webglFramebuffer;I.isWebGLCubeRenderTarget?(ne=yt[j],Ge=!0):Xe.isWebGL2&&I.samples>0&&te.useMultisampledRTT(I)===!1?ne=K.get(I).__webglMultisampledFramebuffer:ne=yt,E.copy(I.viewport),C.copy(I.scissor),M=I.scissorTest}else E.copy(L).multiplyScalar(w).floor(),C.copy(V).multiplyScalar(w).floor(),M=B;if(fe.bindFramebuffer(36160,ne)&&Xe.drawBuffers&&$&&fe.drawBuffers(I,ne),fe.viewport(E),fe.scissor(C),fe.setScissorTest(M),Ge){let tt=K.get(I.texture);Q.framebufferTexture2D(36160,36064,34069+j,tt.__webglTexture,Z)}else if(Ke){let tt=K.get(I.texture),yt=j||0;Q.framebufferTextureLayer(36160,36064,tt.__webglTexture,Z||0,yt)}v=-1},this.readRenderTargetPixels=function(I,j,Z,$,ne,Ge,Ke){if(!(I&&I.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let rt=K.get(I).__webglFramebuffer;if(I.isWebGLCubeRenderTarget&&Ke!==void 0&&(rt=rt[Ke]),rt){fe.bindFramebuffer(36160,rt);try{let tt=I.texture,yt=tt.format,ct=tt.type;if(yt!==Qn&&O.convert(yt)!==Q.getParameter(35739)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}let ht=ct===oa&&(Ze.has("EXT_color_buffer_half_float")||Xe.isWebGL2&&Ze.has("EXT_color_buffer_float"));if(ct!==Oi&&O.convert(ct)!==Q.getParameter(35738)&&!(ct===hs&&(Xe.isWebGL2||Ze.has("OES_texture_float")||Ze.has("WEBGL_color_buffer_float")))&&!ht){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}j>=0&&j<=I.width-$&&Z>=0&&Z<=I.height-ne&&Q.readPixels(j,Z,$,ne,O.convert(yt),O.convert(ct),Ge)}finally{let tt=b!==null?K.get(b).__webglFramebuffer:null;fe.bindFramebuffer(36160,tt)}}},this.copyFramebufferToTexture=function(I,j,Z=0){if(j.isFramebufferTexture!==!0){console.error("THREE.WebGLRenderer: copyFramebufferToTexture() can only be used with FramebufferTexture.");return}let $=Math.pow(2,-Z),ne=Math.floor(j.image.width*$),Ge=Math.floor(j.image.height*$);te.setTexture2D(j,0),Q.copyTexSubImage2D(3553,Z,0,0,I.x,I.y,ne,Ge),fe.unbindTexture()},this.copyTextureToTexture=function(I,j,Z,$=0){let ne=j.image.width,Ge=j.image.height,Ke=O.convert(Z.format),rt=O.convert(Z.type);te.setTexture2D(Z,0),Q.pixelStorei(37440,Z.flipY),Q.pixelStorei(37441,Z.premultiplyAlpha),Q.pixelStorei(3317,Z.unpackAlignment),j.isDataTexture?Q.texSubImage2D(3553,$,I.x,I.y,ne,Ge,Ke,rt,j.image.data):j.isCompressedTexture?Q.compressedTexSubImage2D(3553,$,I.x,I.y,j.mipmaps[0].width,j.mipmaps[0].height,Ke,j.mipmaps[0].data):Q.texSubImage2D(3553,$,I.x,I.y,Ke,rt,j.image),$===0&&Z.generateMipmaps&&Q.generateMipmap(3553),fe.unbindTexture()},this.copyTextureToTexture3D=function(I,j,Z,$,ne=0){if(f.isWebGL1Renderer){console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");return}let Ge=I.max.x-I.min.x+1,Ke=I.max.y-I.min.y+1,rt=I.max.z-I.min.z+1,tt=O.convert($.format),yt=O.convert($.type),ct;if($.isData3DTexture)te.setTexture3D($,0),ct=32879;else if($.isDataArrayTexture)te.setTexture2DArray($,0),ct=35866;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Q.pixelStorei(37440,$.flipY),Q.pixelStorei(37441,$.premultiplyAlpha),Q.pixelStorei(3317,$.unpackAlignment);let ht=Q.getParameter(3314),Ht=Q.getParameter(32878),wi=Q.getParameter(3316),Io=Q.getParameter(3315),Do=Q.getParameter(32877),zr=Z.isCompressedTexture?Z.mipmaps[0]:Z.image;Q.pixelStorei(3314,zr.width),Q.pixelStorei(32878,zr.height),Q.pixelStorei(3316,I.min.x),Q.pixelStorei(3315,I.min.y),Q.pixelStorei(32877,I.min.z),Z.isDataTexture||Z.isData3DTexture?Q.texSubImage3D(ct,ne,j.x,j.y,j.z,Ge,Ke,rt,tt,yt,zr.data):Z.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Q.compressedTexSubImage3D(ct,ne,j.x,j.y,j.z,Ge,Ke,rt,tt,zr.data)):Q.texSubImage3D(ct,ne,j.x,j.y,j.z,Ge,Ke,rt,tt,yt,zr),Q.pixelStorei(3314,ht),Q.pixelStorei(32878,Ht),Q.pixelStorei(3316,wi),Q.pixelStorei(3315,Io),Q.pixelStorei(32877,Do),ne===0&&$.generateMipmaps&&Q.generateMipmap(ct),fe.unbindTexture()},this.initTexture=function(I){te.setTexture2D(I,0),fe.unbindTexture()},this.resetState=function(){g=0,x=0,b=null,fe.reset(),ce.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}_t.prototype.isWebGLRenderer=!0;var GE=class extends _t{};GE.prototype.isWebGL1Renderer=!0;var xa=class{constructor(e,t=25e-5){this.name="",this.color=new ae(e),this.density=t}clone(){return new xa(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}};xa.prototype.isFogExp2=!0;var va=class{constructor(e,t=1,n=1e3){this.name="",this.color=new ae(e),this.near=t,this.far=n}clone(){return new va(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}};va.prototype.isFog=!0;var ms=class extends nt{constructor(){super();this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){let t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),t}};ms.prototype.isScene=!0;var ki=class{constructor(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Qc,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=dr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let s=0,i=this.stride;s<i;s++)this.array[e+s]=t.array[n+s];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=dr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);let t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=dr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}};ki.prototype.isInterleavedBuffer=!0;var In=new A,Ii=class{constructor(e,t,n,s=!1){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=s===!0}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)In.fromBufferAttribute(this,t),In.applyMatrix4(e),this.setXYZ(t,In.x,In.y,In.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)In.fromBufferAttribute(this,t),In.applyNormalMatrix(e),this.setXYZ(t,In.x,In.y,In.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)In.fromBufferAttribute(this,t),In.transformDirection(e),this.setXYZ(t,In.x,In.y,In.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this}setXYZW(e,t,n,s,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=s,this.data.array[e+3]=i,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let n=0;n<this.count;n++){let s=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)t.push(this.data.array[s+i])}return new xt(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new Ii(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");let t=[];for(let n=0;n<this.count;n++){let s=n*this.data.stride+this.offset;for(let i=0;i<this.itemSize;i++)t.push(this.data.array[s+i])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}};Ii.prototype.isInterleavedBufferAttribute=!0;var Gh=class extends nn{constructor(e){super();this.type="SpriteMaterial",this.color=new ae(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}};Gh.prototype.isSpriteMaterial=!0;var Zo,qc=new A,Jo=new A,Ko=new A,Qo=new G,Gc=new G,HE=new pe,ch=new A,Hc=new A,lh=new A,Hw=new G,pm=new G,Ww=new G,WE=class extends nt{constructor(e){super();if(this.type="Sprite",Zo===void 0){Zo=new st;let t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new ki(t,5);Zo.setIndex([0,1,2,0,2,3]),Zo.setAttribute("position",new Ii(n,3,0,!1)),Zo.setAttribute("uv",new Ii(n,2,3,!1))}this.geometry=Zo,this.material=e!==void 0?e:new Gh,this.center=new G(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Jo.setFromMatrixScale(this.matrixWorld),HE.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Ko.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Jo.multiplyScalar(-Ko.z);let n=this.material.rotation,s,i;n!==0&&(i=Math.cos(n),s=Math.sin(n));let o=this.center;uh(ch.set(-.5,-.5,0),Ko,o,Jo,s,i),uh(Hc.set(.5,-.5,0),Ko,o,Jo,s,i),uh(lh.set(.5,.5,0),Ko,o,Jo,s,i),Hw.set(0,0),pm.set(1,0),Ww.set(1,1);let a=e.ray.intersectTriangle(ch,Hc,lh,!1,qc);if(a===null&&(uh(Hc.set(-.5,.5,0),Ko,o,Jo,s,i),pm.set(0,1),a=e.ray.intersectTriangle(ch,lh,Hc,!1,qc),a===null))return;let c=e.ray.origin.distanceTo(qc);c<e.near||c>e.far||t.push({distance:c,point:qc.clone(),uv:Ct.getUV(qc,ch,Hc,lh,Hw,pm,Ww,new G),face:null,object:this})}copy(e){return super.copy(e),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}};WE.prototype.isSprite=!0;function uh(r,e,t,n,s,i){Qo.subVectors(r,t).addScalar(.5).multiply(n),s!==void 0?(Gc.x=i*Qo.x-s*Qo.y,Gc.y=s*Qo.x+i*Qo.y):Gc.copy(Qo),r.copy(e),r.x+=Gc.x,r.y+=Gc.y,r.applyMatrix4(HE)}var hh=new A,jw=new A,Hh=class extends nt{constructor(){super();this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);let t=e.levels;for(let n=0,s=t.length;n<s;n++){let i=t[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);let n=this.levels,s;for(s=0;s<n.length&&!(t<n[s].distance);s++);return n.splice(s,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){let t=this.levels;if(t.length>0){let n,s;for(n=1,s=t.length;n<s&&!(e<t[n].distance);n++);return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){hh.setFromMatrixPosition(this.matrixWorld);let s=e.ray.origin.distanceTo(hh);this.getObjectForDistance(s).raycast(e,t)}}update(e){let t=this.levels;if(t.length>1){hh.setFromMatrixPosition(e.matrixWorld),jw.setFromMatrixPosition(this.matrixWorld);let n=hh.distanceTo(jw)/e.zoom;t[0].object.visible=!0;let s,i;for(s=1,i=t.length;s<i&&n>=t[s].distance;s++)t[s-1].object.visible=!1,t[s].object.visible=!0;for(this._currentLevel=s-1;s<i;s++)t[s].object.visible=!1}}toJSON(e){let t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];let n=this.levels;for(let s=0,i=n.length;s<i;s++){let o=n[s];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}},$w=new A,Xw=new Se,Yw=new Se,H6=new A,Zw=new pe,ul=class extends St{constructor(e,t){super(e,t);this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new pe,this.bindMatrixInverse=new pe}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){let e=new Se,t=this.geometry.attributes.skinWeight;for(let n=0,s=t.count;n<s;n++){e.fromBufferAttribute(t,n);let i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode==="attached"?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode==="detached"?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){let n=this.skeleton,s=this.geometry;Xw.fromBufferAttribute(s.attributes.skinIndex,e),Yw.fromBufferAttribute(s.attributes.skinWeight,e),$w.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let i=0;i<4;i++){let o=Yw.getComponent(i);if(o!==0){let a=Xw.getComponent(i);Zw.multiplyMatrices(n.bones[a].matrixWorld,n.boneInverses[a]),t.addScaledVector(H6.copy($w).applyMatrix4(Zw),o)}}return t.applyMatrix4(this.bindMatrixInverse)}};ul.prototype.isSkinnedMesh=!0;var Wh=class extends nt{constructor(){super();this.type="Bone"}};Wh.prototype.isBone=!0;var jh=class extends Xt{constructor(e=null,t=1,n=1,s,i,o,a,c,l=yn,u=yn,h,d){super(null,o,a,c,l,u,s,i,h,d);this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}};jh.prototype.isDataTexture=!0;var Nh=class extends xt{constructor(e,t,n,s=1){typeof n=="number"&&(s=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument."));super(e,t,n);this.meshPerAttribute=s}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){let e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}};Nh.prototype.isInstancedBufferAttribute=!0;var Jw=new pe,Kw=new pe,dh=[],Wc=new St,jE=class extends St{constructor(e,t,n){super(e,t);this.instanceMatrix=new Nh(new Float32Array(n*16),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}raycast(e,t){let n=this.matrixWorld,s=this.count;if(Wc.geometry=this.geometry,Wc.material=this.material,Wc.material!==void 0)for(let i=0;i<s;i++){this.getMatrixAt(i,Jw),Kw.multiplyMatrices(n,Jw),Wc.matrixWorld=Kw,Wc.raycast(e,dh);for(let o=0,a=dh.length;o<a;o++){let c=dh[o];c.instanceId=i,c.object=this,t.push(c)}dh.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Nh(new Float32Array(this.instanceMatrix.count*3),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}};jE.prototype.isInstancedMesh=!0;var Ln=class extends nn{constructor(e){super();this.type="LineBasicMaterial",this.color=new ae(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}};Ln.prototype.isLineBasicMaterial=!0;var Qw=new A,eE=new A,tE=new pe,fm=new Wr,ph=new fs,$h=class extends nt{constructor(e=new st,t=new Ln){super();this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,n=[0];for(let s=1,i=t.count;s<i;s++)Qw.fromBufferAttribute(t,s-1),eE.fromBufferAttribute(t,s),n[s]=n[s-1],n[s]+=Qw.distanceTo(eE);e.setAttribute("lineDistance",new Je(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){let n=this.geometry,s=this.matrixWorld,i=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),ph.copy(n.boundingSphere),ph.applyMatrix4(s),ph.radius+=i,e.ray.intersectsSphere(ph)===!1)return;tE.copy(s).invert(),fm.copy(e.ray).applyMatrix4(tE);let a=i/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=new A,u=new A,h=new A,d=new A,p=this.isLineSegments?2:1;if(n.isBufferGeometry){let _=n.index,m=n.attributes.position;if(_!==null){let g=Math.max(0,o.start),x=Math.min(_.count,o.start+o.count);for(let b=g,v=x-1;b<v;b+=p){let y=_.getX(b),E=_.getX(b+1);if(l.fromBufferAttribute(m,y),u.fromBufferAttribute(m,E),fm.distanceSqToSegment(l,u,d,h)>c)continue;d.applyMatrix4(this.matrixWorld);let M=e.ray.origin.distanceTo(d);M<e.near||M>e.far||t.push({distance:M,point:h.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}else{let g=Math.max(0,o.start),x=Math.min(m.count,o.start+o.count);for(let b=g,v=x-1;b<v;b+=p){if(l.fromBufferAttribute(m,b),u.fromBufferAttribute(m,b+1),fm.distanceSqToSegment(l,u,d,h)>c)continue;d.applyMatrix4(this.matrixWorld);let E=e.ray.origin.distanceTo(d);E<e.near||E>e.far||t.push({distance:E,point:h.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,o=s.length;i<o;i++){let a=s[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};$h.prototype.isLine=!0;var nE=new A,rE=new A,sr=class extends $h{constructor(e,t){super(e,t);this.type="LineSegments"}computeLineDistances(){let e=this.geometry;if(e.isBufferGeometry)if(e.index===null){let t=e.attributes.position,n=[];for(let s=0,i=t.count;s<i;s+=2)nE.fromBufferAttribute(t,s),rE.fromBufferAttribute(t,s+1),n[s]=s===0?0:n[s-1],n[s+1]=n[s]+nE.distanceTo(rE);e.setAttribute("lineDistance",new Je(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}};sr.prototype.isLineSegments=!0;var $E=class extends $h{constructor(e,t){super(e,t);this.type="LineLoop"}};$E.prototype.isLineLoop=!0;var ba=class extends nn{constructor(e){super();this.type="PointsMaterial",this.color=new ae(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}};ba.prototype.isPointsMaterial=!0;var sE=new pe,Mm=new Wr,fh=new fs,mh=new A,Fi=class extends nt{constructor(e=new st,t=new ba){super();this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){let n=this.geometry,s=this.matrixWorld,i=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),fh.copy(n.boundingSphere),fh.applyMatrix4(s),fh.radius+=i,e.ray.intersectsSphere(fh)===!1)return;sE.copy(s).invert(),Mm.copy(e.ray).applyMatrix4(sE);let a=i/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a;if(n.isBufferGeometry){let l=n.index,h=n.attributes.position;if(l!==null){let d=Math.max(0,o.start),p=Math.min(l.count,o.start+o.count);for(let _=d,f=p;_<f;_++){let m=l.getX(_);mh.fromBufferAttribute(h,m),iE(mh,m,c,s,e,t,this)}}else{let d=Math.max(0,o.start),p=Math.min(h.count,o.start+o.count);for(let _=d,f=p;_<f;_++)mh.fromBufferAttribute(h,_),iE(mh,_,c,s,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){let e=this.geometry;if(e.isBufferGeometry){let t=e.morphAttributes,n=Object.keys(t);if(n.length>0){let s=t[n[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let i=0,o=s.length;i<o;i++){let a=s[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=i}}}}else{let t=e.morphTargets;t!==void 0&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}};Fi.prototype.isPoints=!0;function iE(r,e,t,n,s,i,o){let a=Mm.distanceSqToPoint(r);if(a<t){let c=new A;Mm.closestPointToPoint(r,c),c.applyMatrix4(n);let l=s.ray.origin.distanceTo(c);if(l<s.near||l>s.far)return;i.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:e,face:null,object:o})}}var XE=class extends Xt{constructor(e,t,n,s,i,o,a,c,l){super(e,t,n,s,i,o,a,c,l);this.minFilter=o!==void 0?o:Vn,this.magFilter=i!==void 0?i:Vn,this.generateMipmaps=!1;let u=this;function h(){u.needsUpdate=!0,e.requestVideoFrameCallback(h)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(h)}clone(){return new this.constructor(this.image).copy(this)}update(){let e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}};XE.prototype.isVideoTexture=!0;var YE=class extends Xt{constructor(e,t,n){super({width:e,height:t});this.format=n,this.magFilter=yn,this.minFilter=yn,this.generateMipmaps=!1,this.needsUpdate=!0}};YE.prototype.isFramebufferTexture=!0;var ZE=class extends Xt{constructor(e,t,n,s,i,o,a,c,l,u,h,d){super(null,o,a,c,l,u,s,i,h,d);this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}};ZE.prototype.isCompressedTexture=!0;var JE=class extends Xt{constructor(e,t,n,s,i,o,a,c,l){super(e,t,n,s,i,o,a,c,l);this.needsUpdate=!0}};JE.prototype.isCanvasTexture=!0;var nr=class{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){let n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){let t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){let e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;let t=[],n,s=this.getPoint(0),i=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),i+=n.distanceTo(s),t.push(i),s=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){let n=this.getLengths(),s=0,i=n.length,o;t?o=t:o=e*n[i-1];let a=0,c=i-1,l;for(;a<=c;)if(s=Math.floor(a+(c-a)/2),l=n[s]-o,l<0)a=s+1;else if(l>0)c=s-1;else{c=s;break}if(s=c,n[s]===o)return s/(i-1);let u=n[s],d=n[s+1]-u,p=(o-u)/d;return(s+p)/(i-1)}getTangent(e,t){let s=e-1e-4,i=e+1e-4;s<0&&(s=0),i>1&&(i=1);let o=this.getPoint(s),a=this.getPoint(i),c=t||(o.isVector2?new G:new A);return c.copy(a).sub(o).normalize(),c}getTangentAt(e,t){let n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t){let n=new A,s=[],i=[],o=[],a=new A,c=new pe;for(let p=0;p<=e;p++){let _=p/e;s[p]=this.getTangentAt(_,new A)}i[0]=new A,o[0]=new A;let l=Number.MAX_VALUE,u=Math.abs(s[0].x),h=Math.abs(s[0].y),d=Math.abs(s[0].z);u<=l&&(l=u,n.set(1,0,0)),h<=l&&(l=h,n.set(0,1,0)),d<=l&&n.set(0,0,1),a.crossVectors(s[0],n).normalize(),i[0].crossVectors(s[0],a),o[0].crossVectors(s[0],i[0]);for(let p=1;p<=e;p++){if(i[p]=i[p-1].clone(),o[p]=o[p-1].clone(),a.crossVectors(s[p-1],s[p]),a.length()>Number.EPSILON){a.normalize();let _=Math.acos(un(s[p-1].dot(s[p]),-1,1));i[p].applyMatrix4(c.makeRotationAxis(a,_))}o[p].crossVectors(s[p],i[p])}if(t===!0){let p=Math.acos(un(i[0].dot(i[e]),-1,1));p/=e,s[0].dot(a.crossVectors(i[0],i[e]))>0&&(p=-p);for(let _=1;_<=e;_++)i[_].applyMatrix4(c.makeRotationAxis(s[_],p*_)),o[_].crossVectors(s[_],i[_])}return{tangents:s,normals:i,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){let e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},hl=class extends nr{constructor(e=0,t=0,n=1,s=1,i=0,o=Math.PI*2,a=!1,c=0){super();this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=s,this.aStartAngle=i,this.aEndAngle=o,this.aClockwise=a,this.aRotation=c}getPoint(e,t){let n=t||new G,s=Math.PI*2,i=this.aEndAngle-this.aStartAngle,o=Math.abs(i)<Number.EPSILON;for(;i<0;)i+=s;for(;i>s;)i-=s;i<Number.EPSILON&&(o?i=0:i=s),this.aClockwise===!0&&!o&&(i===s?i=-s:i=i-s);let a=this.aStartAngle+e*i,c=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){let u=Math.cos(this.aRotation),h=Math.sin(this.aRotation),d=c-this.aX,p=l-this.aY;c=d*u-p*h+this.aX,l=d*h+p*u+this.aY}return n.set(c,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){let e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}};hl.prototype.isEllipseCurve=!0;var Zm=class extends hl{constructor(e,t,n,s,i,o){super(e,t,n,n,s,i,o);this.type="ArcCurve"}};Zm.prototype.isArcCurve=!0;function Jm(){let r=0,e=0,t=0,n=0;function s(i,o,a,c){r=i,e=a,t=-3*i+3*o-2*a-c,n=2*i-2*o+a+c}return{initCatmullRom:function(i,o,a,c,l){s(o,a,l*(a-i),l*(c-o))},initNonuniformCatmullRom:function(i,o,a,c,l,u,h){let d=(o-i)/l-(a-i)/(l+u)+(a-o)/u,p=(a-o)/u-(c-o)/(u+h)+(c-a)/h;d*=u,p*=u,s(o,a,d,p)},calc:function(i){let o=i*i,a=o*i;return r+e*i+t*o+n*a}}}var _h=new A,mm=new Jm,_m=new Jm,gm=new Jm,Km=class extends nr{constructor(e=[],t=!1,n="centripetal",s=.5){super();this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=s}getPoint(e,t=new A){let n=t,s=this.points,i=s.length,o=(i-(this.closed?0:1))*e,a=Math.floor(o),c=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/i)+1)*i:c===0&&a===i-1&&(a=i-2,c=1);let l,u;this.closed||a>0?l=s[(a-1)%i]:(_h.subVectors(s[0],s[1]).add(s[0]),l=_h);let h=s[a%i],d=s[(a+1)%i];if(this.closed||a+2<i?u=s[(a+2)%i]:(_h.subVectors(s[i-1],s[i-2]).add(s[i-1]),u=_h),this.curveType==="centripetal"||this.curveType==="chordal"){let p=this.curveType==="chordal"?.5:.25,_=Math.pow(l.distanceToSquared(h),p),f=Math.pow(h.distanceToSquared(d),p),m=Math.pow(d.distanceToSquared(u),p);f<1e-4&&(f=1),_<1e-4&&(_=f),m<1e-4&&(m=f),mm.initNonuniformCatmullRom(l.x,h.x,d.x,u.x,_,f,m),_m.initNonuniformCatmullRom(l.y,h.y,d.y,u.y,_,f,m),gm.initNonuniformCatmullRom(l.z,h.z,d.z,u.z,_,f,m)}else this.curveType==="catmullrom"&&(mm.initCatmullRom(l.x,h.x,d.x,u.x,this.tension),_m.initCatmullRom(l.y,h.y,d.y,u.y,this.tension),gm.initCatmullRom(l.z,h.z,d.z,u.z,this.tension));return n.set(mm.calc(c),_m.calc(c),gm.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let s=e.points[t];this.points.push(s.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let s=this.points[t];e.points.push(s.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let s=e.points[t];this.points.push(new A().fromArray(s))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}};Km.prototype.isCatmullRomCurve3=!0;function oE(r,e,t,n,s){let i=(n-e)*.5,o=(s-t)*.5,a=r*r,c=r*a;return(2*t-2*n+i+o)*c+(-3*t+3*n-2*i-o)*a+i*r+t}function W6(r,e){let t=1-r;return t*t*e}function j6(r,e){return 2*(1-r)*r*e}function $6(r,e){return r*r*e}function Zc(r,e,t,n){return W6(r,e)+j6(r,t)+$6(r,n)}function X6(r,e){let t=1-r;return t*t*t*e}function Y6(r,e){let t=1-r;return 3*t*t*r*e}function Z6(r,e){return 3*(1-r)*r*r*e}function J6(r,e){return r*r*r*e}function Jc(r,e,t,n,s){return X6(r,e)+Y6(r,t)+Z6(r,n)+J6(r,s)}var Xh=class extends nr{constructor(e=new G,t=new G,n=new G,s=new G){super();this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new G){let n=t,s=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Jc(e,s.x,i.x,o.x,a.x),Jc(e,s.y,i.y,o.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};Xh.prototype.isCubicBezierCurve=!0;var Qm=class extends nr{constructor(e=new A,t=new A,n=new A,s=new A){super();this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=s}getPoint(e,t=new A){let n=t,s=this.v0,i=this.v1,o=this.v2,a=this.v3;return n.set(Jc(e,s.x,i.x,o.x,a.x),Jc(e,s.y,i.y,o.y,a.y),Jc(e,s.z,i.z,o.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}};Qm.prototype.isCubicBezierCurve3=!0;var dl=class extends nr{constructor(e=new G,t=new G){super();this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new G){let n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){let n=t||new G;return n.copy(this.v2).sub(this.v1).normalize(),n}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};dl.prototype.isLineCurve=!0;var KE=class extends nr{constructor(e=new A,t=new A){super();this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new A){let n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}},Yh=class extends nr{constructor(e=new G,t=new G,n=new G){super();this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new G){let n=t,s=this.v0,i=this.v1,o=this.v2;return n.set(Zc(e,s.x,i.x,o.x),Zc(e,s.y,i.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};Yh.prototype.isQuadraticBezierCurve=!0;var e_=class extends nr{constructor(e=new A,t=new A,n=new A){super();this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new A){let n=t,s=this.v0,i=this.v1,o=this.v2;return n.set(Zc(e,s.x,i.x,o.x),Zc(e,s.y,i.y,o.y),Zc(e,s.z,i.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){let e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}};e_.prototype.isQuadraticBezierCurve3=!0;var Zh=class extends nr{constructor(e=[]){super();this.type="SplineCurve",this.points=e}getPoint(e,t=new G){let n=t,s=this.points,i=(s.length-1)*e,o=Math.floor(i),a=i-o,c=s[o===0?o:o-1],l=s[o],u=s[o>s.length-2?s.length-1:o+1],h=s[o>s.length-3?s.length-1:o+2];return n.set(oE(a,c.x,l.x,u.x,h.x),oE(a,c.y,l.y,u.y,h.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let s=e.points[t];this.points.push(s.clone())}return this}toJSON(){let e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){let s=this.points[t];e.points.push(s.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){let s=e.points[t];this.points.push(new G().fromArray(s))}return this}};Zh.prototype.isSplineCurve=!0;var QE=Object.freeze({__proto__:null,ArcCurve:Zm,CatmullRomCurve3:Km,CubicBezierCurve:Xh,CubicBezierCurve3:Qm,EllipseCurve:hl,LineCurve:dl,LineCurve3:KE,QuadraticBezierCurve:Yh,QuadraticBezierCurve3:e_,SplineCurve:Zh}),eC=class extends nr{constructor(){super();this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){let e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new dl(t,e))}getPoint(e,t){let n=e*this.getLength(),s=this.getCurveLengths(),i=0;for(;i<s.length;){if(s[i]>=n){let o=s[i]-n,a=this.curves[i],c=a.getLength(),l=c===0?0:1-o/c;return a.getPointAt(l,t)}i++}return null}getLength(){let e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;let e=[],t=0;for(let n=0,s=this.curves.length;n<s;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){let t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){let t=[],n;for(let s=0,i=this.curves;s<i.length;s++){let o=i[s],a=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,c=o.getPoints(a);for(let l=0;l<c.length;l++){let u=c[l];n&&n.equals(u)||(t.push(u),n=u)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let s=e.curves[t];this.curves.push(s.clone())}return this.autoClose=e.autoClose,this}toJSON(){let e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){let s=this.curves[t];e.curves.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){let s=e.curves[t];this.curves.push(new QE[s.type]().fromJSON(s))}return this}},Rh=class extends eC{constructor(e){super();this.type="Path",this.currentPoint=new G,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){let n=new dl(this.currentPoint.clone(),new G(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,s){let i=new Yh(this.currentPoint.clone(),new G(e,t),new G(n,s));return this.curves.push(i),this.currentPoint.set(n,s),this}bezierCurveTo(e,t,n,s,i,o){let a=new Xh(this.currentPoint.clone(),new G(e,t),new G(n,s),new G(i,o));return this.curves.push(a),this.currentPoint.set(i,o),this}splineThru(e){let t=[this.currentPoint.clone()].concat(e),n=new Zh(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,s,i,o){let a=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(e+a,t+c,n,s,i,o),this}absarc(e,t,n,s,i,o){return this.absellipse(e,t,n,n,s,i,o),this}ellipse(e,t,n,s,i,o,a,c){let l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,s,i,o,a,c),this}absellipse(e,t,n,s,i,o,a,c){let l=new hl(e,t,n,s,i,o,a,c);if(this.curves.length>0){let h=l.getPoint(0);h.equals(this.currentPoint)||this.lineTo(h.x,h.y)}this.curves.push(l);let u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){let e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}};var pl=class extends st{constructor(e=1,t=8,n=0,s=Math.PI*2){super();this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:s},t=Math.max(3,t);let i=[],o=[],a=[],c=[],l=new A,u=new G;o.push(0,0,0),a.push(0,0,1),c.push(.5,.5);for(let h=0,d=3;h<=t;h++,d+=3){let p=n+h/t*s;l.x=e*Math.cos(p),l.y=e*Math.sin(p),o.push(l.x,l.y,l.z),a.push(0,0,1),u.x=(o[d]/e+1)/2,u.y=(o[d+1]/e+1)/2,c.push(u.x,u.y)}for(let h=1;h<=t;h++)i.push(h,h+1,0);this.setIndex(i),this.setAttribute("position",new Je(o,3)),this.setAttribute("normal",new Je(a,3)),this.setAttribute("uv",new Je(c,2))}static fromJSON(e){return new pl(e.radius,e.segments,e.thetaStart,e.thetaLength)}},Jh=class extends st{constructor(e=1,t=1,n=1,s=8,i=1,o=!1,a=0,c=Math.PI*2){super();this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:s,heightSegments:i,openEnded:o,thetaStart:a,thetaLength:c};let l=this;s=Math.floor(s),i=Math.floor(i);let u=[],h=[],d=[],p=[],_=0,f=[],m=n/2,g=0;x(),o===!1&&(e>0&&b(!0),t>0&&b(!1)),this.setIndex(u),this.setAttribute("position",new Je(h,3)),this.setAttribute("normal",new Je(d,3)),this.setAttribute("uv",new Je(p,2));function x(){let v=new A,y=new A,E=0,C=(t-e)/n;for(let M=0;M<=i;M++){let R=[],N=M/i,w=N*(t-e)+e;for(let T=0;T<=s;T++){let F=T/s,L=F*c+a,V=Math.sin(L),B=Math.cos(L);y.x=w*V,y.y=-N*n+m,y.z=w*B,h.push(y.x,y.y,y.z),v.set(V,C,B).normalize(),d.push(v.x,v.y,v.z),p.push(F,1-N),R.push(_++)}f.push(R)}for(let M=0;M<s;M++)for(let R=0;R<i;R++){let N=f[R][M],w=f[R+1][M],T=f[R+1][M+1],F=f[R][M+1];u.push(N,w,F),u.push(w,T,F),E+=6}l.addGroup(g,E,0),g+=E}function b(v){let y=_,E=new G,C=new A,M=0,R=v===!0?e:t,N=v===!0?1:-1;for(let T=1;T<=s;T++)h.push(0,m*N,0),d.push(0,N,0),p.push(.5,.5),_++;let w=_;for(let T=0;T<=s;T++){let L=T/s*c+a,V=Math.cos(L),B=Math.sin(L);C.x=R*B,C.y=m*N,C.z=R*V,h.push(C.x,C.y,C.z),d.push(0,N,0),E.x=V*.5+.5,E.y=B*.5*N+.5,p.push(E.x,E.y),_++}for(let T=0;T<s;T++){let F=y+T,L=w+T;v===!0?u.push(L,L+1,F):u.push(L+1,L,F),M+=3}l.addGroup(g,M,v===!0?1:2),g+=M}}static fromJSON(e){return new Jh(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},fl=class extends Jh{constructor(e=1,t=1,n=8,s=1,i=!1,o=0,a=Math.PI*2){super(0,e,t,n,s,i,o,a);this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:s,openEnded:i,thetaStart:o,thetaLength:a}}static fromJSON(e){return new fl(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}},Kh=class extends st{constructor(e=[],t=[],n=1,s=0){super();this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:s};let i=[],o=[];a(s),l(n),u(),this.setAttribute("position",new Je(i,3)),this.setAttribute("normal",new Je(i.slice(),3)),this.setAttribute("uv",new Je(o,2)),s===0?this.computeVertexNormals():this.normalizeNormals();function a(x){let b=new A,v=new A,y=new A;for(let E=0;E<t.length;E+=3)p(t[E+0],b),p(t[E+1],v),p(t[E+2],y),c(b,v,y,x)}function c(x,b,v,y){let E=y+1,C=[];for(let M=0;M<=E;M++){C[M]=[];let R=x.clone().lerp(v,M/E),N=b.clone().lerp(v,M/E),w=E-M;for(let T=0;T<=w;T++)T===0&&M===E?C[M][T]=R:C[M][T]=R.clone().lerp(N,T/w)}for(let M=0;M<E;M++)for(let R=0;R<2*(E-M)-1;R++){let N=Math.floor(R/2);R%2===0?(d(C[M][N+1]),d(C[M+1][N]),d(C[M][N])):(d(C[M][N+1]),d(C[M+1][N+1]),d(C[M+1][N]))}}function l(x){let b=new A;for(let v=0;v<i.length;v+=3)b.x=i[v+0],b.y=i[v+1],b.z=i[v+2],b.normalize().multiplyScalar(x),i[v+0]=b.x,i[v+1]=b.y,i[v+2]=b.z}function u(){let x=new A;for(let b=0;b<i.length;b+=3){x.x=i[b+0],x.y=i[b+1],x.z=i[b+2];let v=m(x)/2/Math.PI+.5,y=g(x)/Math.PI+.5;o.push(v,1-y)}_(),h()}function h(){for(let x=0;x<o.length;x+=6){let b=o[x+0],v=o[x+2],y=o[x+4],E=Math.max(b,v,y),C=Math.min(b,v,y);E>.9&&C<.1&&(b<.2&&(o[x+0]+=1),v<.2&&(o[x+2]+=1),y<.2&&(o[x+4]+=1))}}function d(x){i.push(x.x,x.y,x.z)}function p(x,b){let v=x*3;b.x=e[v+0],b.y=e[v+1],b.z=e[v+2]}function _(){let x=new A,b=new A,v=new A,y=new A,E=new G,C=new G,M=new G;for(let R=0,N=0;R<i.length;R+=9,N+=6){x.set(i[R+0],i[R+1],i[R+2]),b.set(i[R+3],i[R+4],i[R+5]),v.set(i[R+6],i[R+7],i[R+8]),E.set(o[N+0],o[N+1]),C.set(o[N+2],o[N+3]),M.set(o[N+4],o[N+5]),y.copy(x).add(b).add(v).divideScalar(3);let w=m(y);f(E,N+0,x,w),f(C,N+2,b,w),f(M,N+4,v,w)}}function f(x,b,v,y){y<0&&x.x===1&&(o[b]=x.x-1),v.x===0&&v.z===0&&(o[b]=y/2/Math.PI+.5)}function m(x){return Math.atan2(x.z,-x.x)}function g(x){return Math.atan2(-x.y,Math.sqrt(x.x*x.x+x.z*x.z))}}static fromJSON(e){return new Kh(e.vertices,e.indices,e.radius,e.details)}};var jde=new A,$de=new A,Xde=new A,Yde=new Ct;var wa=class extends Rh{constructor(e){super(e);this.uuid=dr(),this.type="Shape",this.holes=[]}getPointsHoles(e){let t=[];for(let n=0,s=this.holes.length;n<s;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let s=e.holes[t];this.holes.push(s.clone())}return this}toJSON(){let e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){let s=this.holes[t];e.holes.push(s.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){let s=e.holes[t];this.holes.push(new Rh().fromJSON(s))}return this}},K6={triangulate:function(r,e,t=2){let n=e&&e.length,s=n?e[0]*t:r.length,i=tC(r,0,s,t,!0),o=[];if(!i||i.next===i.prev)return o;let a,c,l,u,h,d,p;if(n&&(i=rW(r,e,i,t)),r.length>80*t){a=l=r[0],c=u=r[1];for(let _=t;_<s;_+=t)h=r[_],d=r[_+1],h<a&&(a=h),d<c&&(c=d),h>l&&(l=h),d>u&&(u=d);p=Math.max(l-a,u-c),p=p!==0?1/p:0}return nl(i,o,t,a,c,p),o}};function tC(r,e,t,n,s){let i,o;if(s===fW(r,e,t,n)>0)for(i=e;i<t;i+=n)o=aE(i,r[i],r[i+1],o);else for(i=t-n;i>=e;i-=n)o=aE(i,r[i],r[i+1],o);return o&&Qh(o,o.next)&&(sl(o),o=o.next),o}function Js(r,e){if(!r)return r;e||(e=r);let t=r,n;do if(n=!1,!t.steiner&&(Qh(t,t.next)||Vt(t.prev,t,t.next)===0)){if(sl(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function nl(r,e,t,n,s,i,o){if(!r)return;!o&&i&&cW(r,n,s,i);let a=r,c,l;for(;r.prev!==r.next;){if(c=r.prev,l=r.next,i?eW(r,n,s,i):Q6(r)){e.push(c.i/t),e.push(r.i/t),e.push(l.i/t),sl(r),r=l.next,a=l.next;continue}if(r=l,r===a){o?o===1?(r=tW(Js(r),e,t),nl(r,e,t,n,s,i,2)):o===2&&nW(r,e,t,n,s,i):nl(Js(r),e,t,n,s,i,1);break}}}function Q6(r){let e=r.prev,t=r,n=r.next;if(Vt(e,t,n)>=0)return!1;let s=r.next.next;for(;s!==r.prev;){if(sa(e.x,e.y,t.x,t.y,n.x,n.y,s.x,s.y)&&Vt(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function eW(r,e,t,n){let s=r.prev,i=r,o=r.next;if(Vt(s,i,o)>=0)return!1;let a=s.x<i.x?s.x<o.x?s.x:o.x:i.x<o.x?i.x:o.x,c=s.y<i.y?s.y<o.y?s.y:o.y:i.y<o.y?i.y:o.y,l=s.x>i.x?s.x>o.x?s.x:o.x:i.x>o.x?i.x:o.x,u=s.y>i.y?s.y>o.y?s.y:o.y:i.y>o.y?i.y:o.y,h=Pm(a,c,e,t,n),d=Pm(l,u,e,t,n),p=r.prevZ,_=r.nextZ;for(;p&&p.z>=h&&_&&_.z<=d;){if(p!==r.prev&&p!==r.next&&sa(s.x,s.y,i.x,i.y,o.x,o.y,p.x,p.y)&&Vt(p.prev,p,p.next)>=0||(p=p.prevZ,_!==r.prev&&_!==r.next&&sa(s.x,s.y,i.x,i.y,o.x,o.y,_.x,_.y)&&Vt(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;p&&p.z>=h;){if(p!==r.prev&&p!==r.next&&sa(s.x,s.y,i.x,i.y,o.x,o.y,p.x,p.y)&&Vt(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;_&&_.z<=d;){if(_!==r.prev&&_!==r.next&&sa(s.x,s.y,i.x,i.y,o.x,o.y,_.x,_.y)&&Vt(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function tW(r,e,t){let n=r;do{let s=n.prev,i=n.next.next;!Qh(s,i)&&nC(s,n,n.next,i)&&rl(s,i)&&rl(i,s)&&(e.push(s.i/t),e.push(n.i/t),e.push(i.i/t),sl(n),sl(n.next),n=r=i),n=n.next}while(n!==r);return Js(n)}function nW(r,e,t,n,s,i){let o=r;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&hW(o,a)){let c=rC(o,a);o=Js(o,o.next),c=Js(c,c.next),nl(o,e,t,n,s,i),nl(c,e,t,n,s,i);return}a=a.next}o=o.next}while(o!==r)}function rW(r,e,t,n){let s=[],i,o,a,c,l;for(i=0,o=e.length;i<o;i++)a=e[i]*n,c=i<o-1?e[i+1]*n:r.length,l=tC(r,a,c,n,!1),l===l.next&&(l.steiner=!0),s.push(uW(l));for(s.sort(sW),i=0;i<s.length;i++)iW(s[i],t),t=Js(t,t.next);return t}function sW(r,e){return r.x-e.x}function iW(r,e){if(e=oW(r,e),e){let t=rC(e,r);Js(e,e.next),Js(t,t.next)}}function oW(r,e){let t=e,n=r.x,s=r.y,i=-1/0,o;do{if(s<=t.y&&s>=t.next.y&&t.next.y!==t.y){let d=t.x+(s-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(d<=n&&d>i){if(i=d,d===n){if(s===t.y)return t;if(s===t.next.y)return t.next}o=t.x<t.next.x?t:t.next}}t=t.next}while(t!==e);if(!o)return null;if(n===i)return o;let a=o,c=o.x,l=o.y,u=1/0,h;t=o;do n>=t.x&&t.x>=c&&n!==t.x&&sa(s<l?n:i,s,c,l,s<l?i:n,s,t.x,t.y)&&(h=Math.abs(s-t.y)/(n-t.x),rl(t,r)&&(h<u||h===u&&(t.x>o.x||t.x===o.x&&aW(o,t)))&&(o=t,u=h)),t=t.next;while(t!==a);return o}function aW(r,e){return Vt(r.prev,r,e.prev)<0&&Vt(e.next,r,r.next)<0}function cW(r,e,t,n){let s=r;do s.z===null&&(s.z=Pm(s.x,s.y,e,t,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next;while(s!==r);s.prevZ.nextZ=null,s.prevZ=null,lW(s)}function lW(r){let e,t,n,s,i,o,a,c,l=1;do{for(t=r,r=null,i=null,o=0;t;){for(o++,n=t,a=0,e=0;e<l&&(a++,n=n.nextZ,!!n);e++);for(c=l;a>0||c>0&&n;)a!==0&&(c===0||!n||t.z<=n.z)?(s=t,t=t.nextZ,a--):(s=n,n=n.nextZ,c--),i?i.nextZ=s:r=s,s.prevZ=i,i=s;t=n}i.nextZ=null,l*=2}while(o>1);return r}function Pm(r,e,t,n,s){return r=32767*(r-t)*s,e=32767*(e-n)*s,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function uW(r){let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function sa(r,e,t,n,s,i,o,a){return(s-o)*(e-a)-(r-o)*(i-a)>=0&&(r-o)*(n-a)-(t-o)*(e-a)>=0&&(t-o)*(i-a)-(s-o)*(n-a)>=0}function hW(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!dW(r,e)&&(rl(r,e)&&rl(e,r)&&pW(r,e)&&(Vt(r.prev,r,e.prev)||Vt(r,e.prev,e))||Qh(r,e)&&Vt(r.prev,r,r.next)>0&&Vt(e.prev,e,e.next)>0)}function Vt(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Qh(r,e){return r.x===e.x&&r.y===e.y}function nC(r,e,t,n){let s=yh(Vt(r,e,t)),i=yh(Vt(r,e,n)),o=yh(Vt(t,n,r)),a=yh(Vt(t,n,e));return!!(s!==i&&o!==a||s===0&&gh(r,t,e)||i===0&&gh(r,n,e)||o===0&&gh(t,r,n)||a===0&&gh(t,e,n))}function gh(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function yh(r){return r>0?1:r<0?-1:0}function dW(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&nC(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function rl(r,e){return Vt(r.prev,r,r.next)<0?Vt(r,e,r.next)>=0&&Vt(r,r.prev,e)>=0:Vt(r,e,r.prev)<0||Vt(r,r.next,e)<0}function pW(r,e){let t=r,n=!1,s=(r.x+e.x)/2,i=(r.y+e.y)/2;do t.y>i!=t.next.y>i&&t.next.y!==t.y&&s<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n}function rC(r,e){let t=new Nm(r.i,r.x,r.y),n=new Nm(e.i,e.x,e.y),s=r.next,i=e.prev;return r.next=e,e.prev=r,t.next=s,s.prev=t,n.next=t,t.prev=n,i.next=n,n.prev=i,n}function aE(r,e,t,n){let s=new Nm(r,e,t);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function sl(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Nm(r,e,t){this.i=r,this.x=e,this.y=t,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function fW(r,e,t,n){let s=0;for(let i=e,o=t-n;i<t;i+=n)s+=(r[o]-r[i])*(r[i+1]+r[o+1]),o=i;return s}var ds=class{static area(e){let t=e.length,n=0;for(let s=t-1,i=0;i<t;s=i++)n+=e[s].x*e[i].y-e[i].x*e[s].y;return n*.5}static isClockWise(e){return ds.area(e)<0}static triangulateShape(e,t){let n=[],s=[],i=[];cE(e),lE(n,e);let o=e.length;t.forEach(cE);for(let c=0;c<t.length;c++)s.push(o),o+=t[c].length,lE(n,t[c]);let a=K6.triangulate(n,s);for(let c=0;c<a.length;c+=3)i.push(a.slice(c,c+3));return i}};function cE(r){let e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function lE(r,e){for(let t=0;t<e.length;t++)r.push(e[t].x),r.push(e[t].y)}var Ui=class extends st{constructor(e=new wa([new G(.5,.5),new G(-.5,.5),new G(-.5,-.5),new G(.5,-.5)]),t={}){super();this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];let n=this,s=[],i=[];for(let a=0,c=e.length;a<c;a++){let l=e[a];o(l)}this.setAttribute("position",new Je(s,3)),this.setAttribute("uv",new Je(i,2)),this.computeVertexNormals();function o(a){let c=[],l=t.curveSegments!==void 0?t.curveSegments:12,u=t.steps!==void 0?t.steps:1,h=t.depth!==void 0?t.depth:1,d=t.bevelEnabled!==void 0?t.bevelEnabled:!0,p=t.bevelThickness!==void 0?t.bevelThickness:.2,_=t.bevelSize!==void 0?t.bevelSize:p-.1,f=t.bevelOffset!==void 0?t.bevelOffset:0,m=t.bevelSegments!==void 0?t.bevelSegments:3,g=t.extrudePath,x=t.UVGenerator!==void 0?t.UVGenerator:mW;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),h=t.amount);let b,v=!1,y,E,C,M;g&&(b=g.getSpacedPoints(u),v=!0,d=!1,y=g.computeFrenetFrames(u,!1),E=new A,C=new A,M=new A),d||(m=0,p=0,_=0,f=0);let R=a.extractPoints(l),N=R.shape,w=R.holes;if(!ds.isClockWise(N)){N=N.reverse();for(let K=0,te=w.length;K<te;K++){let he=w[K];ds.isClockWise(he)&&(w[K]=he.reverse())}}let F=ds.triangulateShape(N,w),L=N;for(let K=0,te=w.length;K<te;K++){let he=w[K];N=N.concat(he)}function V(K,te,he){return te||console.error("THREE.ExtrudeGeometry: vec does not exist"),te.clone().multiplyScalar(he).add(K)}let B=N.length,H=F.length;function z(K,te,he){let Ee,ve,We,Le=K.x-te.x,Oe=K.y-te.y,Nt=he.x-K.x,ft=he.y-K.y,D=Le*Le+Oe*Oe,P=Le*ft-Oe*Nt;if(Math.abs(P)>Number.EPSILON){let Y=Math.sqrt(D),oe=Math.sqrt(Nt*Nt+ft*ft),xe=te.x-Oe/Y,be=te.y+Le/Y,Ie=he.x-ft/oe,O=he.y+Nt/oe,ce=((Ie-xe)*ft-(O-be)*Nt)/(Le*ft-Oe*Nt);Ee=xe+Le*ce-K.x,ve=be+Oe*ce-K.y;let Ne=Ee*Ee+ve*ve;if(Ne<=2)return new G(Ee,ve);We=Math.sqrt(Ne/2)}else{let Y=!1;Le>Number.EPSILON?Nt>Number.EPSILON&&(Y=!0):Le<-Number.EPSILON?Nt<-Number.EPSILON&&(Y=!0):Math.sign(Oe)===Math.sign(ft)&&(Y=!0),Y?(Ee=-Oe,ve=Le,We=Math.sqrt(D)):(Ee=Le,ve=Oe,We=Math.sqrt(D/2))}return new G(Ee/We,ve/We)}let X=[];for(let K=0,te=L.length,he=te-1,Ee=K+1;K<te;K++,he++,Ee++)he===te&&(he=0),Ee===te&&(Ee=0),X[K]=z(L[K],L[he],L[Ee]);let ee=[],le,re=X.concat();for(let K=0,te=w.length;K<te;K++){let he=w[K];le=[];for(let Ee=0,ve=he.length,We=ve-1,Le=Ee+1;Ee<ve;Ee++,We++,Le++)We===ve&&(We=0),Le===ve&&(Le=0),le[Ee]=z(he[Ee],he[We],he[Le]);ee.push(le),re=re.concat(le)}for(let K=0;K<m;K++){let te=K/m,he=p*Math.cos(te*Math.PI/2),Ee=_*Math.sin(te*Math.PI/2)+f;for(let ve=0,We=L.length;ve<We;ve++){let Le=V(L[ve],X[ve],Ee);ut(Le.x,Le.y,-he)}for(let ve=0,We=w.length;ve<We;ve++){let Le=w[ve];le=ee[ve];for(let Oe=0,Nt=Le.length;Oe<Nt;Oe++){let ft=V(Le[Oe],le[Oe],Ee);ut(ft.x,ft.y,-he)}}}let Pe=_+f;for(let K=0;K<B;K++){let te=d?V(N[K],re[K],Pe):N[K];v?(C.copy(y.normals[0]).multiplyScalar(te.x),E.copy(y.binormals[0]).multiplyScalar(te.y),M.copy(b[0]).add(C).add(E),ut(M.x,M.y,M.z)):ut(te.x,te.y,0)}for(let K=1;K<=u;K++)for(let te=0;te<B;te++){let he=d?V(N[te],re[te],Pe):N[te];v?(C.copy(y.normals[K]).multiplyScalar(he.x),E.copy(y.binormals[K]).multiplyScalar(he.y),M.copy(b[K]).add(C).add(E),ut(M.x,M.y,M.z)):ut(he.x,he.y,h/u*K)}for(let K=m-1;K>=0;K--){let te=K/m,he=p*Math.cos(te*Math.PI/2),Ee=_*Math.sin(te*Math.PI/2)+f;for(let ve=0,We=L.length;ve<We;ve++){let Le=V(L[ve],X[ve],Ee);ut(Le.x,Le.y,h+he)}for(let ve=0,We=w.length;ve<We;ve++){let Le=w[ve];le=ee[ve];for(let Oe=0,Nt=Le.length;Oe<Nt;Oe++){let ft=V(Le[Oe],le[Oe],Ee);v?ut(ft.x,ft.y+b[u-1].y,b[u-1].x+he):ut(ft.x,ft.y,h+he)}}}He(),ke();function He(){let K=s.length/3;if(d){let te=0,he=B*te;for(let Ee=0;Ee<H;Ee++){let ve=F[Ee];Ze(ve[2]+he,ve[1]+he,ve[0]+he)}te=u+m*2,he=B*te;for(let Ee=0;Ee<H;Ee++){let ve=F[Ee];Ze(ve[0]+he,ve[1]+he,ve[2]+he)}}else{for(let te=0;te<H;te++){let he=F[te];Ze(he[2],he[1],he[0])}for(let te=0;te<H;te++){let he=F[te];Ze(he[0]+B*u,he[1]+B*u,he[2]+B*u)}}n.addGroup(K,s.length/3-K,0)}function ke(){let K=s.length/3,te=0;Q(L,te),te+=L.length;for(let he=0,Ee=w.length;he<Ee;he++){let ve=w[he];Q(ve,te),te+=ve.length}n.addGroup(K,s.length/3-K,1)}function Q(K,te){let he=K.length;for(;--he>=0;){let Ee=he,ve=he-1;ve<0&&(ve=K.length-1);for(let We=0,Le=u+m*2;We<Le;We++){let Oe=B*We,Nt=B*(We+1),ft=te+Ee+Oe,D=te+ve+Oe,P=te+ve+Nt,Y=te+Ee+Nt;Xe(ft,D,P,Y)}}}function ut(K,te,he){c.push(K),c.push(te),c.push(he)}function Ze(K,te,he){fe(K),fe(te),fe(he);let Ee=s.length/3,ve=x.generateTopUV(n,s,Ee-3,Ee-2,Ee-1);et(ve[0]),et(ve[1]),et(ve[2])}function Xe(K,te,he,Ee){fe(K),fe(te),fe(Ee),fe(te),fe(he),fe(Ee);let ve=s.length/3,We=x.generateSideWallUV(n,s,ve-6,ve-3,ve-2,ve-1);et(We[0]),et(We[1]),et(We[3]),et(We[1]),et(We[2]),et(We[3])}function fe(K){s.push(c[K*3+0]),s.push(c[K*3+1]),s.push(c[K*3+2])}function et(K){i.push(K.x),i.push(K.y)}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return _W(t,n,e)}static fromJSON(e,t){let n=[];for(let i=0,o=e.shapes.length;i<o;i++){let a=t[e.shapes[i]];n.push(a)}let s=e.options.extrudePath;return s!==void 0&&(e.options.extrudePath=new QE[s.type]().fromJSON(s)),new Ui(n,e.options)}},mW={generateTopUV:function(r,e,t,n,s){let i=e[t*3],o=e[t*3+1],a=e[n*3],c=e[n*3+1],l=e[s*3],u=e[s*3+1];return[new G(i,o),new G(a,c),new G(l,u)]},generateSideWallUV:function(r,e,t,n,s,i){let o=e[t*3],a=e[t*3+1],c=e[t*3+2],l=e[n*3],u=e[n*3+1],h=e[n*3+2],d=e[s*3],p=e[s*3+1],_=e[s*3+2],f=e[i*3],m=e[i*3+1],g=e[i*3+2];return Math.abs(a-u)<Math.abs(o-l)?[new G(o,1-c),new G(l,1-h),new G(d,1-_),new G(f,1-g)]:[new G(a,1-c),new G(u,1-h),new G(p,1-_),new G(m,1-g)]}};function _W(r,e,t){if(t.shapes=[],Array.isArray(r))for(let n=0,s=r.length;n<s;n++){let i=r[n];t.shapes.push(i.uuid)}else t.shapes.push(r.uuid);return e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}var ml=class extends Kh{constructor(e=1,t=0){let n=(1+Math.sqrt(5))/2,s=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],i=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(s,i,e,t);this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ml(e.radius,e.detail)}};var ed=class extends st{constructor(e=new wa([new G(0,.5),new G(-.5,-.5),new G(.5,-.5)]),t=12){super();this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};let n=[],s=[],i=[],o=[],a=0,c=0;if(Array.isArray(e)===!1)l(e);else for(let u=0;u<e.length;u++)l(e[u]),this.addGroup(a,c,u),a+=c,c=0;this.setIndex(n),this.setAttribute("position",new Je(s,3)),this.setAttribute("normal",new Je(i,3)),this.setAttribute("uv",new Je(o,2));function l(u){let h=s.length/3,d=u.extractPoints(t),p=d.shape,_=d.holes;ds.isClockWise(p)===!1&&(p=p.reverse());for(let m=0,g=_.length;m<g;m++){let x=_[m];ds.isClockWise(x)===!0&&(_[m]=x.reverse())}let f=ds.triangulateShape(p,_);for(let m=0,g=_.length;m<g;m++){let x=_[m];p=p.concat(x)}for(let m=0,g=p.length;m<g;m++){let x=p[m];s.push(x.x,x.y,0),i.push(0,0,1),o.push(x.x,x.y)}for(let m=0,g=f.length;m<g;m++){let x=f[m],b=x[0]+h,v=x[1]+h,y=x[2]+h;n.push(b,v,y),c+=3}}}toJSON(){let e=super.toJSON(),t=this.parameters.shapes;return gW(t,e)}static fromJSON(e,t){let n=[];for(let s=0,i=e.shapes.length;s<i;s++){let o=t[e.shapes[s]];n.push(o)}return new ed(n,e.curveSegments)}};function gW(r,e){if(e.shapes=[],Array.isArray(r))for(let t=0,n=r.length;t<n;t++){let s=r[t];e.shapes.push(s.uuid)}else e.shapes.push(r.uuid);return e}var t_=class extends nn{constructor(e){super();this.type="ShadowMaterial",this.color=new ae(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}};t_.prototype.isShadowMaterial=!0;var n_=class extends Gn{constructor(e){super(e);this.type="RawShaderMaterial"}};n_.prototype.isRawShaderMaterial=!0;var _s=class extends nn{constructor(e){super();this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new ae(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=fa,this.normalScale=new G(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}};_s.prototype.isMeshStandardMaterial=!0;var r_=class extends _s{constructor(e){super();this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new G(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return un(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.sheenColor=new ae(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new ae(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ae(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}};r_.prototype.isMeshPhysicalMaterial=!0;var s_=class extends nn{constructor(e){super();this.type="MeshPhongMaterial",this.color=new ae(16777215),this.specular=new ae(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=fa,this.normalScale=new G(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ih,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}};s_.prototype.isMeshPhongMaterial=!0;var i_=class extends nn{constructor(e){super();this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ae(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=fa,this.normalScale=new G(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}};i_.prototype.isMeshToonMaterial=!0;var o_=class extends nn{constructor(e){super();this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=fa,this.normalScale=new G(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}};o_.prototype.isMeshNormalMaterial=!0;var a_=class extends nn{constructor(e){super();this.type="MeshLambertMaterial",this.color=new ae(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ae(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ih,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}};a_.prototype.isMeshLambertMaterial=!0;var c_=class extends nn{constructor(e){super();this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ae(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=fa,this.normalScale=new G(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}};c_.prototype.isMeshMatcapMaterial=!0;var l_=class extends Ln{constructor(e){super();this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}};l_.prototype.isLineDashedMaterial=!0;var yW={ShadowMaterial:t_,SpriteMaterial:Gh,RawShaderMaterial:n_,ShaderMaterial:Gn,PointsMaterial:ba,MeshPhysicalMaterial:r_,MeshStandardMaterial:_s,MeshPhongMaterial:s_,MeshToonMaterial:i_,MeshNormalMaterial:o_,MeshLambertMaterial:a_,MeshDepthMaterial:Vh,MeshDistanceMaterial:qh,MeshBasicMaterial:Bi,MeshMatcapMaterial:c_,LineDashedMaterial:l_,LineBasicMaterial:Ln,Material:nn};nn.fromType=function(r){return new yW[r]};var Ft={arraySlice:function(r,e,t){return Ft.isTypedArray(r)?new r.constructor(r.subarray(e,t!==void 0?t:r.length)):r.slice(e,t)},convertArray:function(r,e,t){return!r||!t&&r.constructor===e?r:typeof e.BYTES_PER_ELEMENT=="number"?new e(r):Array.prototype.slice.call(r)},isTypedArray:function(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)},getKeyframeOrder:function(r){function e(s,i){return r[s]-r[i]}let t=r.length,n=new Array(t);for(let s=0;s!==t;++s)n[s]=s;return n.sort(e),n},sortedArray:function(r,e,t){let n=r.length,s=new r.constructor(n);for(let i=0,o=0;o!==n;++i){let a=t[i]*e;for(let c=0;c!==e;++c)s[o++]=r[a+c]}return s},flattenJSON:function(r,e,t,n){let s=1,i=r[0];for(;i!==void 0&&i[n]===void 0;)i=r[s++];if(i===void 0)return;let o=i[n];if(o!==void 0)if(Array.isArray(o))do o=i[n],o!==void 0&&(e.push(i.time),t.push.apply(t,o)),i=r[s++];while(i!==void 0);else if(o.toArray!==void 0)do o=i[n],o!==void 0&&(e.push(i.time),o.toArray(t,t.length)),i=r[s++];while(i!==void 0);else do o=i[n],o!==void 0&&(e.push(i.time),t.push(o)),i=r[s++];while(i!==void 0)},subclip:function(r,e,t,n,s=30){let i=r.clone();i.name=e;let o=[];for(let c=0;c<i.tracks.length;++c){let l=i.tracks[c],u=l.getValueSize(),h=[],d=[];for(let p=0;p<l.times.length;++p){let _=l.times[p]*s;if(!(_<t||_>=n)){h.push(l.times[p]);for(let f=0;f<u;++f)d.push(l.values[p*u+f])}}h.length!==0&&(l.times=Ft.convertArray(h,l.times.constructor),l.values=Ft.convertArray(d,l.values.constructor),o.push(l))}i.tracks=o;let a=1/0;for(let c=0;c<i.tracks.length;++c)a>i.tracks[c].times[0]&&(a=i.tracks[c].times[0]);for(let c=0;c<i.tracks.length;++c)i.tracks[c].shift(-1*a);return i.resetDuration(),i},makeClipAdditive:function(r,e=0,t=r,n=30){n<=0&&(n=30);let s=t.tracks.length,i=e/n;for(let o=0;o<s;++o){let a=t.tracks[o],c=a.ValueTypeName;if(c==="bool"||c==="string")continue;let l=r.tracks.find(function(g){return g.name===a.name&&g.ValueTypeName===c});if(l===void 0)continue;let u=0,h=a.getValueSize();a.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=h/3);let d=0,p=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(d=p/3);let _=a.times.length-1,f;if(i<=a.times[0]){let g=u,x=h-u;f=Ft.arraySlice(a.values,g,x)}else if(i>=a.times[_]){let g=_*h+u,x=g+h-u;f=Ft.arraySlice(a.values,g,x)}else{let g=a.createInterpolant(),x=u,b=h-u;g.evaluate(i),f=Ft.arraySlice(g.resultBuffer,x,b)}c==="quaternion"&&new dt().fromArray(f).normalize().conjugate().toArray(f);let m=l.times.length;for(let g=0;g<m;++g){let x=g*p+d;if(c==="quaternion")dt.multiplyQuaternionsFlat(l.values,x,f,0,l.values,x);else{let b=p-d*2;for(let v=0;v<b;++v)l.values[x+v]-=f[v]}}}return r.blendMode=EE,r}},ps=class{constructor(e,t,n,s){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=s!==void 0?s:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){let t=this.parameterPositions,n=this._cachedIndex,s=t[n],i=t[n-1];e:{t:{let o;n:{r:if(!(e<s)){for(let a=n+2;;){if(s===void 0){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===a)break;if(i=s,s=t[++n],e<s)break t}o=t.length;break n}if(!(e>=i)){let a=t[1];e<a&&(n=2,i=a);for(let c=n-2;;){if(i===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,s);if(n===c)break;if(s=i,i=t[--n-1],e>=i)break t}o=n,n=0;break n}break e}for(;n<o;){let a=n+o>>>1;e<t[a]?o=a:n=a+1}if(s=t[n],i=t[n-1],i===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,s);if(s===void 0)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,s)}return this.interpolate_(n,i,e,s)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){let t=this.resultBuffer,n=this.sampleValues,s=this.valueSize,i=e*s;for(let o=0;o!==s;++o)t[o]=n[i+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}};ps.prototype.beforeStart_=ps.prototype.copySampleValue_;ps.prototype.afterEnd_=ps.prototype.copySampleValue_;var td=class extends ps{constructor(e,t,n,s){super(e,t,n,s);this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:ta,endingEnd:ta}}intervalChanged_(e,t,n){let s=this.parameterPositions,i=e-2,o=e+1,a=s[i],c=s[o];if(a===void 0)switch(this.getSettings_().endingStart){case na:i=e,a=2*t-n;break;case Th:i=s.length-2,a=t+s[i]-s[i+1];break;default:i=e,a=n}if(c===void 0)switch(this.getSettings_().endingEnd){case na:o=e,c=2*n-t;break;case Th:o=1,c=n+s[1]-s[0];break;default:o=e-1,c=t}let l=(n-t)*.5,u=this.valueSize;this._weightPrev=l/(t-a),this._weightNext=l/(c-n),this._offsetPrev=i*u,this._offsetNext=o*u}interpolate_(e,t,n,s){let i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=this._offsetPrev,h=this._offsetNext,d=this._weightPrev,p=this._weightNext,_=(n-t)/(s-t),f=_*_,m=f*_,g=-d*m+2*d*f-d*_,x=(1+d)*m+(-1.5-2*d)*f+(-.5+d)*_+1,b=(-1-p)*m+(1.5+p)*f+.5*_,v=p*m-p*f;for(let y=0;y!==a;++y)i[y]=g*o[u+y]+x*o[l+y]+b*o[c+y]+v*o[h+y];return i}},u_=class extends ps{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){let i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=e*a,l=c-a,u=(n-t)/(s-t),h=1-u;for(let d=0;d!==a;++d)i[d]=o[l+d]*h+o[c+d]*u;return i}},sC=class extends ps{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e){return this.copySampleValue_(e-1)}},Pr=class{constructor(e,t,n,s){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Ft.convertArray(t,this.TimeBufferType),this.values=Ft.convertArray(n,this.ValueBufferType),this.setInterpolation(s||this.DefaultInterpolation)}static toJSON(e){let t=e.constructor,n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Ft.convertArray(e.times,Array),values:Ft.convertArray(e.values,Array)};let s=e.getInterpolation();s!==e.DefaultInterpolation&&(n.interpolation=s)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new sC(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new u_(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new td(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Sh:t=this.InterpolantFactoryMethodDiscrete;break;case Ah:t=this.InterpolantFactoryMethodLinear;break;case zf:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){let n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Sh;case this.InterpolantFactoryMethodLinear:return Ah;case this.InterpolantFactoryMethodSmooth:return zf}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){let t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]+=e}return this}scale(e){if(e!==1){let t=this.times;for(let n=0,s=t.length;n!==s;++n)t[n]*=e}return this}trim(e,t){let n=this.times,s=n.length,i=0,o=s-1;for(;i!==s&&n[i]<e;)++i;for(;o!==-1&&n[o]>t;)--o;if(++o,i!==0||o!==s){i>=o&&(o=Math.max(o,1),i=o-1);let a=this.getValueSize();this.times=Ft.arraySlice(n,i,o),this.values=Ft.arraySlice(this.values,i*a,o*a)}return this}validate(){let e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);let n=this.times,s=this.values,i=n.length;i===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==i;a++){let c=n[a];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,c),e=!1;break}if(o!==null&&o>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,c,o),e=!1;break}o=c}if(s!==void 0&&Ft.isTypedArray(s))for(let a=0,c=s.length;a!==c;++a){let l=s[a];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,l),e=!1;break}}return e}optimize(){let e=Ft.arraySlice(this.times),t=Ft.arraySlice(this.values),n=this.getValueSize(),s=this.getInterpolation()===zf,i=e.length-1,o=1;for(let a=1;a<i;++a){let c=!1,l=e[a],u=e[a+1];if(l!==u&&(a!==1||l!==e[0]))if(s)c=!0;else{let h=a*n,d=h-n,p=h+n;for(let _=0;_!==n;++_){let f=t[h+_];if(f!==t[d+_]||f!==t[p+_]){c=!0;break}}}if(c){if(a!==o){e[o]=e[a];let h=a*n,d=o*n;for(let p=0;p!==n;++p)t[d+p]=t[h+p]}++o}}if(i>0){e[o]=e[i];for(let a=i*n,c=o*n,l=0;l!==n;++l)t[c+l]=t[a+l];++o}return o!==e.length?(this.times=Ft.arraySlice(e,0,o),this.values=Ft.arraySlice(t,0,o*n)):(this.times=e,this.values=t),this}clone(){let e=Ft.arraySlice(this.times,0),t=Ft.arraySlice(this.values,0),n=this.constructor,s=new n(this.name,e,t);return s.createInterpolant=this.createInterpolant,s}};Pr.prototype.TimeBufferType=Float32Array;Pr.prototype.ValueBufferType=Float32Array;Pr.prototype.DefaultInterpolation=Ah;var zi=class extends Pr{};zi.prototype.ValueTypeName="bool";zi.prototype.ValueBufferType=Array;zi.prototype.DefaultInterpolation=Sh;zi.prototype.InterpolantFactoryMethodLinear=void 0;zi.prototype.InterpolantFactoryMethodSmooth=void 0;var h_=class extends Pr{};h_.prototype.ValueTypeName="color";var il=class extends Pr{};il.prototype.ValueTypeName="number";var iC=class extends ps{constructor(e,t,n,s){super(e,t,n,s)}interpolate_(e,t,n,s){let i=this.resultBuffer,o=this.sampleValues,a=this.valueSize,c=(n-t)/(s-t),l=e*a;for(let u=l+a;l!==u;l+=4)dt.slerpFlat(i,0,o,l-a,o,l,c);return i}},Ea=class extends Pr{InterpolantFactoryMethodLinear(e){return new iC(this.times,this.values,this.getValueSize(),e)}};Ea.prototype.ValueTypeName="quaternion";Ea.prototype.DefaultInterpolation=Ah;Ea.prototype.InterpolantFactoryMethodSmooth=void 0;var Vi=class extends Pr{};Vi.prototype.ValueTypeName="string";Vi.prototype.ValueBufferType=Array;Vi.prototype.DefaultInterpolation=Sh;Vi.prototype.InterpolantFactoryMethodLinear=void 0;Vi.prototype.InterpolantFactoryMethodSmooth=void 0;var ol=class extends Pr{};ol.prototype.ValueTypeName="vector";var Rm=class{constructor(e,t=-1,n,s=Um){this.name=e,this.tracks=n,this.duration=t,this.blendMode=s,this.uuid=dr(),this.duration<0&&this.resetDuration()}static parse(e){let t=[],n=e.tracks,s=1/(e.fps||1);for(let o=0,a=n.length;o!==a;++o)t.push(vW(n[o]).scale(s));let i=new this(e.name,e.duration,t,e.blendMode);return i.uuid=e.uuid,i}static toJSON(e){let t=[],n=e.tracks,s={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let i=0,o=n.length;i!==o;++i)t.push(Pr.toJSON(n[i]));return s}static CreateFromMorphTargetSequence(e,t,n,s){let i=t.length,o=[];for(let a=0;a<i;a++){let c=[],l=[];c.push((a+i-1)%i,a,(a+1)%i),l.push(0,1,0);let u=Ft.getKeyframeOrder(c);c=Ft.sortedArray(c,1,u),l=Ft.sortedArray(l,1,u),!s&&c[0]===0&&(c.push(i),l.push(l[0])),o.push(new il(".morphTargetInfluences["+t[a].name+"]",c,l).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){let s=e;n=s.geometry&&s.geometry.animations||s.animations}for(let s=0;s<n.length;s++)if(n[s].name===t)return n[s];return null}static CreateClipsFromMorphTargetSequences(e,t,n){let s={},i=/^([\w-]*?)([\d]+)$/;for(let a=0,c=e.length;a<c;a++){let l=e[a],u=l.name.match(i);if(u&&u.length>1){let h=u[1],d=s[h];d||(s[h]=d=[]),d.push(l)}}let o=[];for(let a in s)o.push(this.CreateFromMorphTargetSequence(a,s[a],t,n));return o}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;let n=function(h,d,p,_,f){if(p.length!==0){let m=[],g=[];Ft.flattenJSON(p,m,g,_),m.length!==0&&f.push(new h(d,m,g))}},s=[],i=e.name||"default",o=e.fps||30,a=e.blendMode,c=e.length||-1,l=e.hierarchy||[];for(let h=0;h<l.length;h++){let d=l[h].keys;if(!(!d||d.length===0))if(d[0].morphTargets){let p={},_;for(_=0;_<d.length;_++)if(d[_].morphTargets)for(let f=0;f<d[_].morphTargets.length;f++)p[d[_].morphTargets[f]]=-1;for(let f in p){let m=[],g=[];for(let x=0;x!==d[_].morphTargets.length;++x){let b=d[_];m.push(b.time),g.push(b.morphTarget===f?1:0)}s.push(new il(".morphTargetInfluence["+f+"]",m,g))}c=p.length*o}else{let p=".bones["+t[h].name+"]";n(ol,p+".position",d,"pos",s),n(Ea,p+".quaternion",d,"rot",s),n(ol,p+".scale",d,"scl",s)}}return s.length===0?null:new this(i,c,s,a)}resetDuration(){let e=this.tracks,t=0;for(let n=0,s=e.length;n!==s;++n){let i=this.tracks[n];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){let e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}};function xW(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return il;case"vector":case"vector2":case"vector3":case"vector4":return ol;case"color":return h_;case"quaternion":return Ea;case"bool":case"boolean":return zi;case"string":return Vi}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function vW(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");let e=xW(r.type);if(r.times===void 0){let t=[],n=[];Ft.flattenJSON(r.keys,t,n,"value"),r.times=t,r.values=n}return e.parse!==void 0?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}var pa={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}},nd=class{constructor(e,t,n){let s=this,i=!1,o=0,a=0,c,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(u){a++,i===!1&&s.onStart!==void 0&&s.onStart(u,o,a),i=!0},this.itemEnd=function(u){o++,s.onProgress!==void 0&&s.onProgress(u,o,a),o===a&&(i=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(u){s.onError!==void 0&&s.onError(u)},this.resolveURL=function(u){return c?c(u):u},this.setURLModifier=function(u){return c=u,this},this.addHandler=function(u,h){return l.push(u,h),this},this.removeHandler=function(u){let h=l.indexOf(u);return h!==-1&&l.splice(h,2),this},this.getHandler=function(u){for(let h=0,d=l.length;h<d;h+=2){let p=l[h],_=l[h+1];if(p.global&&(p.lastIndex=0),p.test(u))return _}return null}}},bW=new nd,gs=class{constructor(e){this.manager=e!==void 0?e:bW,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){let n=this;return new Promise(function(s,i){n.load(e,s,t,i)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}},ls={},oC=class extends gs{constructor(e){super(e)}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let i=pa.get(e);if(i!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(i),this.manager.itemEnd(e)},0),i;if(ls[e]!==void 0){ls[e].push({onLoad:t,onProgress:n,onError:s});return}ls[e]=[],ls[e].push({onLoad:t,onProgress:n,onError:s});let o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),a=this.mimeType,c=this.responseType;fetch(o).then(l=>{if(l.status===200||l.status===0){if(l.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||l.body===void 0||l.body.getReader===void 0)return l;let u=ls[e],h=l.body.getReader(),d=l.headers.get("Content-Length"),p=d?parseInt(d):0,_=p!==0,f=0,m=new ReadableStream({start(g){x();function x(){h.read().then(({done:b,value:v})=>{if(b)g.close();else{f+=v.byteLength;let y=new ProgressEvent("progress",{lengthComputable:_,loaded:f,total:p});for(let E=0,C=u.length;E<C;E++){let M=u[E];M.onProgress&&M.onProgress(y)}g.enqueue(v),x()}})}}});return new Response(m)}else throw Error(`fetch for "${l.url}" responded with ${l.status}: ${l.statusText}`)}).then(l=>{switch(c){case"arraybuffer":return l.arrayBuffer();case"blob":return l.blob();case"document":return l.text().then(u=>new DOMParser().parseFromString(u,a));case"json":return l.json();default:if(a===void 0)return l.text();{let h=/charset="?([^;"\s]*)"?/i.exec(a),d=h&&h[1]?h[1].toLowerCase():void 0,p=new TextDecoder(d);return l.arrayBuffer().then(_=>p.decode(_))}}}).then(l=>{pa.add(e,l);let u=ls[e];delete ls[e];for(let h=0,d=u.length;h<d;h++){let p=u[h];p.onLoad&&p.onLoad(l)}}).catch(l=>{let u=ls[e];if(u===void 0)throw this.manager.itemError(e),l;delete ls[e];for(let h=0,d=u.length;h<d;h++){let p=u[h];p.onError&&p.onError(l)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}};var d_=class extends gs{constructor(e){super(e)}load(e,t,n,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let i=this,o=pa.get(e);if(o!==void 0)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;let a=tl("img");function c(){u(),pa.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(h){u(),s&&s(h),i.manager.itemError(e),i.manager.itemEnd(e)}function u(){a.removeEventListener("load",c,!1),a.removeEventListener("error",l,!1)}return a.addEventListener("load",c,!1),a.addEventListener("error",l,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(a.crossOrigin=this.crossOrigin),i.manager.itemStart(e),a.src=e,a}},aC=class extends gs{constructor(e){super(e)}load(e,t,n,s){let i=new cl,o=new d_(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let a=0;function c(l){o.load(e[l],function(u){i.images[l]=u,a++,a===6&&(i.needsUpdate=!0,t&&t(i))},void 0,s)}for(let l=0;l<e.length;++l)c(l);return i}};var cC=class extends gs{constructor(e){super(e)}load(e,t,n,s){let i=new Xt,o=new d_(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(a){i.image=a,i.needsUpdate=!0,t!==void 0&&t(i)},n,s),i}},Mr=class extends nt{constructor(e,t=1){super();this.type="Light",this.color=new ae(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){let t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}};Mr.prototype.isLight=!0;var lC=class extends Mr{constructor(e,t,n){super(e,n);this.type="HemisphereLight",this.position.copy(nt.DefaultUp),this.updateMatrix(),this.groundColor=new ae(t)}copy(e){return Mr.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}};lC.prototype.isHemisphereLight=!0;var uE=new pe,hE=new A,dE=new A,rd=class{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new G(512,512),this.map=null,this.mapPass=null,this.matrix=new pe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ll,this._frameExtents=new G(1,1),this._viewportCount=1,this._viewports=[new Se(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){let t=this.camera,n=this.matrix;hE.setFromMatrixPosition(e.matrixWorld),t.position.copy(hE),dE.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(dE),t.updateMatrixWorld(),uE.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(uE),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){let e={};return this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}},p_=class extends rd{constructor(){super(new hn(50,1,.5,500));this.focus=1}updateMatrices(e){let t=this.camera,n=el*2*e.angle*this.focus,s=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;(n!==t.fov||s!==t.aspect||i!==t.far)&&(t.fov=n,t.aspect=s,t.far=i,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}};p_.prototype.isSpotLightShadow=!0;var sd=class extends Mr{constructor(e,t,n=0,s=Math.PI/3,i=0,o=1){super(e,t);this.type="SpotLight",this.position.copy(nt.DefaultUp),this.updateMatrix(),this.target=new nt,this.distance=n,this.angle=s,this.penumbra=i,this.decay=o,this.shadow=new p_}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};sd.prototype.isSpotLight=!0;var pE=new pe,jc=new A,ym=new A,f_=class extends rd{constructor(){super(new hn(90,1,.5,500));this._frameExtents=new G(4,2),this._viewportCount=6,this._viewports=[new Se(2,1,1,1),new Se(0,1,1,1),new Se(3,1,1,1),new Se(1,1,1,1),new Se(3,0,1,1),new Se(1,0,1,1)],this._cubeDirections=[new A(1,0,0),new A(-1,0,0),new A(0,0,1),new A(0,0,-1),new A(0,1,0),new A(0,-1,0)],this._cubeUps=[new A(0,1,0),new A(0,1,0),new A(0,1,0),new A(0,1,0),new A(0,0,1),new A(0,0,-1)]}updateMatrices(e,t=0){let n=this.camera,s=this.matrix,i=e.distance||n.far;i!==n.far&&(n.far=i,n.updateProjectionMatrix()),jc.setFromMatrixPosition(e.matrixWorld),n.position.copy(jc),ym.copy(n.position),ym.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(ym),n.updateMatrixWorld(),s.makeTranslation(-jc.x,-jc.y,-jc.z),pE.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(pE)}};f_.prototype.isPointLightShadow=!0;var uC=class extends Mr{constructor(e,t,n=0,s=1){super(e,t);this.type="PointLight",this.distance=n,this.decay=s,this.shadow=new f_}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}};uC.prototype.isPointLight=!0;var m_=class extends rd{constructor(){super(new ga(-5,5,5,-5,.5,500))}};m_.prototype.isDirectionalLightShadow=!0;var hC=class extends Mr{constructor(e,t){super(e,t);this.type="DirectionalLight",this.position.copy(nt.DefaultUp),this.updateMatrix(),this.target=new nt,this.shadow=new m_}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}};hC.prototype.isDirectionalLight=!0;var dC=class extends Mr{constructor(e,t){super(e,t);this.type="AmbientLight"}};dC.prototype.isAmbientLight=!0;var pC=class extends Mr{constructor(e,t,n=10,s=10){super(e,t);this.type="RectAreaLight",this.width=n,this.height=s}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){let t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}};pC.prototype.isRectAreaLight=!0;var __=class{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new A)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){let n=e.x,s=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*s),t.addScaledVector(o[2],.488603*i),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*s)),t.addScaledVector(o[5],1.092548*(s*i)),t.addScaledVector(o[6],.315392*(3*i*i-1)),t.addScaledVector(o[7],1.092548*(n*i)),t.addScaledVector(o[8],.546274*(n*n-s*s)),t}getIrradianceAt(e,t){let n=e.x,s=e.y,i=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*s),t.addScaledVector(o[2],2*.511664*i),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*s),t.addScaledVector(o[5],2*.429043*s*i),t.addScaledVector(o[6],.743125*i*i-.247708),t.addScaledVector(o[7],2*.429043*n*i),t.addScaledVector(o[8],.429043*(n*n-s*s)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){let n=this.coefficients;for(let s=0;s<9;s++)n[s].fromArray(e,t+s*3);return this}toArray(e=[],t=0){let n=this.coefficients;for(let s=0;s<9;s++)n[s].toArray(e,t+s*3);return e}static getBasisAt(e,t){let n=e.x,s=e.y,i=e.z;t[0]=.282095,t[1]=.488603*s,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*s,t[5]=1.092548*s*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-s*s)}};__.prototype.isSphericalHarmonics3=!0;var id=class extends Mr{constructor(e=new __,t=1){super(void 0,t);this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){let t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}};id.prototype.isLightProbe=!0;var fC=class{static decodeText(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);let t="";for(let n=0,s=e.length;n<s;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch{return t}}static extractUrlBase(e){let t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}},mC=class extends st{constructor(){super();this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return new this.constructor().copy(this)}toJSON(){let e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}};mC.prototype.isInstancedBufferGeometry=!0;var _C=class extends gs{constructor(e){super(e);typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,s){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);let i=this,o=pa.get(e);if(o!==void 0)return i.manager.itemStart(e),setTimeout(function(){t&&t(o),i.manager.itemEnd(e)},0),o;let a={};a.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",a.headers=this.requestHeader,fetch(e,a).then(function(c){return c.blob()}).then(function(c){return createImageBitmap(c,Object.assign(i.options,{colorSpaceConversion:"none"}))}).then(function(c){pa.add(e,c),t&&t(c),i.manager.itemEnd(e)}).catch(function(c){s&&s(c),i.manager.itemError(e),i.manager.itemEnd(e)}),i.manager.itemStart(e)}};_C.prototype.isImageBitmapLoader=!0;var xh,wW={getContext:function(){return xh===void 0&&(xh=new(window.AudioContext||window.webkitAudioContext)),xh},setContext:function(r){xh=r}},gC=class extends gs{constructor(e){super(e)}load(e,t,n,s){let i=this,o=new oC(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(a){try{let c=a.slice(0);wW.getContext().decodeAudioData(c,function(u){t(u)})}catch(c){s?s(c):console.error(c),i.manager.itemError(e)}},n,s)}},yC=class extends id{constructor(e,t,n=1){super(void 0,n);let s=new ae().set(e),i=new ae().set(t),o=new A(s.r,s.g,s.b),a=new A(i.r,i.g,i.b),c=Math.sqrt(Math.PI),l=c*Math.sqrt(.75);this.sh.coefficients[0].copy(o).add(a).multiplyScalar(c),this.sh.coefficients[1].copy(o).sub(a).multiplyScalar(l)}};yC.prototype.isHemisphereLightProbe=!0;var xC=class extends id{constructor(e,t=1){super(void 0,t);let n=new ae().set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}};xC.prototype.isAmbientLightProbe=!0;var g_=class{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=fE(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){let t=fE();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}};function fE(){return(typeof performance>"u"?Date:performance).now()}var vC=class extends nt{constructor(e){super();this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;let t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}};var bC=class{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0,t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}},wC=class{constructor(e,t,n){this.binding=e,this.valueSize=n;let s,i,o;switch(t){case"quaternion":s=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":s=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:s=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=s,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){let n=this.buffer,s=this.valueSize,i=e*s+s,o=this.cumulativeWeight;if(o===0){for(let a=0;a!==s;++a)n[i+a]=n[a];o=t}else{o+=t;let a=t/o;this._mixBufferRegion(n,i,0,a,s)}this.cumulativeWeight=o}accumulateAdditive(e){let t=this.buffer,n=this.valueSize,s=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,s,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){let t=this.valueSize,n=this.buffer,s=e*t+t,i=this.cumulativeWeight,o=this.cumulativeWeightAdditive,a=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){let c=t*this._origIndex;this._mixBufferRegion(n,s,c,1-i,t)}o>0&&this._mixBufferRegionAdditive(n,s,this._addIndex*t,1,t);for(let c=t,l=t+t;c!==l;++c)if(n[c]!==n[c+t]){a.setValue(n,s);break}}saveOriginalState(){let e=this.binding,t=this.buffer,n=this.valueSize,s=n*this._origIndex;e.getValue(t,s);for(let i=n,o=s;i!==o;++i)t[i]=t[s+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){let e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){let e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){let e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,s,i){if(s>=.5)for(let o=0;o!==i;++o)e[t+o]=e[n+o]}_slerp(e,t,n,s){dt.slerpFlat(e,t,e,t,e,n,s)}_slerpAdditive(e,t,n,s,i){let o=this._workIndex*i;dt.multiplyQuaternionsFlat(e,o,e,t,e,n),dt.slerpFlat(e,t,e,t,e,o,s)}_lerp(e,t,n,s,i){let o=1-s;for(let a=0;a!==i;++a){let c=t+a;e[c]=e[c]*o+e[n+a]*s}}_lerpAdditive(e,t,n,s,i){for(let o=0;o!==i;++o){let a=t+o;e[a]=e[a]+e[n+o]*s}}},y_="\\[\\]\\.:\\/",EW=new RegExp("["+y_+"]","g"),x_="[^"+y_+"]",CW="[^"+y_.replace("\\.","")+"]",SW=/((?:WC+[\/:])*)/.source.replace("WC",x_),AW=/(WCOD+)?/.source.replace("WCOD",CW),TW=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",x_),MW=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",x_),PW=new RegExp("^"+SW+AW+TW+MW+"$"),NW=["material","materials","bones"],EC=class{constructor(e,t,n){let s=n||lt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,s)}getValue(e,t){this.bind();let n=this._targetGroup.nCachedObjects_,s=this._bindings[n];s!==void 0&&s.getValue(e,t)}setValue(e,t){let n=this._bindings;for(let s=this._targetGroup.nCachedObjects_,i=n.length;s!==i;++s)n[s].setValue(e,t)}bind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){let e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}},lt=class{constructor(e,t,n){this.path=t,this.parsedPath=n||lt.parseTrackName(t),this.node=lt.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new lt.Composite(e,t,n):new lt(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(EW,"")}static parseTrackName(e){let t=PW.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);let n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},s=n.nodeName&&n.nodeName.lastIndexOf(".");if(s!==void 0&&s!==-1){let i=n.nodeName.substring(s+1);NW.indexOf(i)!==-1&&(n.nodeName=n.nodeName.substring(0,s),n.objectName=i)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){let n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){let n=function(i){for(let o=0;o<i.length;o++){let a=i[o];if(a.name===t||a.uuid===t)return a;let c=n(a.children);if(c)return c}return null},s=n(e.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){let n=this.resolvedProperty;for(let s=0,i=n.length;s!==i;++s)e[t++]=n[s]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){let n=this.resolvedProperty;for(let s=0,i=n.length;s!==i;++s)n[s]=e[t++]}_setValue_array_setNeedsUpdate(e,t){let n=this.resolvedProperty;for(let s=0,i=n.length;s!==i;++s)n[s]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){let n=this.resolvedProperty;for(let s=0,i=n.length;s!==i;++s)n[s]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node,t=this.parsedPath,n=t.objectName,s=t.propertyName,i=t.propertyIndex;if(e||(e=lt.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(n){let l=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let u=0;u<e.length;u++)if(e[u].name===l){l=u;break}break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(l!==void 0){if(e[l]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[l]}}let o=e[s];if(o===void 0){let l=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+l+"."+s+" but it wasn't found.",e);return}let a=this.Versioning.None;this.targetObject=e,e.needsUpdate!==void 0?a=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(a=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(i!==void 0){if(s==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[i]!==void 0&&(i=e.morphTargetDictionary[i])}else{console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);return}}c=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=i}else o.fromArray!==void 0&&o.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(c=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][a]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}};lt.Composite=EC;lt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};lt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};lt.prototype.GetterByBindingType=[lt.prototype._getValue_direct,lt.prototype._getValue_array,lt.prototype._getValue_arrayElement,lt.prototype._getValue_toArray];lt.prototype.SetterByBindingTypeAndVersioning=[[lt.prototype._setValue_direct,lt.prototype._setValue_direct_setNeedsUpdate,lt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[lt.prototype._setValue_array,lt.prototype._setValue_array_setNeedsUpdate,lt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[lt.prototype._setValue_arrayElement,lt.prototype._setValue_arrayElement_setNeedsUpdate,lt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[lt.prototype._setValue_fromArray,lt.prototype._setValue_fromArray_setNeedsUpdate,lt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var CC=class{constructor(){this.uuid=dr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;let e={};this._indicesByUUID=e;for(let n=0,s=arguments.length;n!==s;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};let t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){let e=this._objects,t=this._indicesByUUID,n=this._paths,s=this._parsedPaths,i=this._bindings,o=i.length,a,c=e.length,l=this.nCachedObjects_;for(let u=0,h=arguments.length;u!==h;++u){let d=arguments[u],p=d.uuid,_=t[p];if(_===void 0){_=c++,t[p]=_,e.push(d);for(let f=0,m=o;f!==m;++f)i[f].push(new lt(d,n[f],s[f]))}else if(_<l){a=e[_];let f=--l,m=e[f];t[m.uuid]=_,e[_]=m,t[p]=f,e[f]=d;for(let g=0,x=o;g!==x;++g){let b=i[g],v=b[f],y=b[_];b[_]=v,y===void 0&&(y=new lt(d,n[g],s[g])),b[f]=y}}else e[_]!==a&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,s=n.length,i=this.nCachedObjects_;for(let o=0,a=arguments.length;o!==a;++o){let c=arguments[o],l=c.uuid,u=t[l];if(u!==void 0&&u>=i){let h=i++,d=e[h];t[d.uuid]=u,e[u]=d,t[l]=h,e[h]=c;for(let p=0,_=s;p!==_;++p){let f=n[p],m=f[h],g=f[u];f[u]=m,f[h]=g}}}this.nCachedObjects_=i}uncache(){let e=this._objects,t=this._indicesByUUID,n=this._bindings,s=n.length,i=this.nCachedObjects_,o=e.length;for(let a=0,c=arguments.length;a!==c;++a){let l=arguments[a],u=l.uuid,h=t[u];if(h!==void 0)if(delete t[u],h<i){let d=--i,p=e[d],_=--o,f=e[_];t[p.uuid]=h,e[h]=p,t[f.uuid]=d,e[d]=f,e.pop();for(let m=0,g=s;m!==g;++m){let x=n[m],b=x[d],v=x[_];x[h]=b,x[d]=v,x.pop()}}else{let d=--o,p=e[d];d>0&&(t[p.uuid]=h),e[h]=p,e.pop();for(let _=0,f=s;_!==f;++_){let m=n[_];m[h]=m[d],m.pop()}}}this.nCachedObjects_=i}subscribe_(e,t){let n=this._bindingsIndicesByPath,s=n[e],i=this._bindings;if(s!==void 0)return i[s];let o=this._paths,a=this._parsedPaths,c=this._objects,l=c.length,u=this.nCachedObjects_,h=new Array(l);s=i.length,n[e]=s,o.push(e),a.push(t),i.push(h);for(let d=u,p=c.length;d!==p;++d){let _=c[d];h[d]=new lt(_,e,t)}return h}unsubscribe_(e){let t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){let s=this._paths,i=this._parsedPaths,o=this._bindings,a=o.length-1,c=o[a],l=e[a];t[l]=n,o[n]=c,o.pop(),i[n]=i[a],i.pop(),s[n]=s[a],s.pop()}}};CC.prototype.isAnimationObjectGroup=!0;var SC=class{constructor(e,t,n=null,s=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=s;let i=t.tracks,o=i.length,a=new Array(o),c={endingStart:ta,endingEnd:ta};for(let l=0;l!==o;++l){let u=i[l].createInterpolant(null);a[l]=u,u.settings=c}this._interpolantSettings=c,this._interpolants=a,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=H4,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){let s=this._clip.duration,i=e._clip.duration,o=i/s,a=s/i;e.warp(1,o,t),this.warp(a,1,t)}return this}crossFadeTo(e,t,n){return e.crossFadeFrom(this,t,n)}stopFading(){let e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){let s=this._mixer,i=s.time,o=this.timeScale,a=this._timeScaleInterpolant;a===null&&(a=s._lendControlInterpolant(),this._timeScaleInterpolant=a);let c=a.parameterPositions,l=a.sampleValues;return c[0]=i,c[1]=i+n,l[0]=e/o,l[1]=t/o,this}stopWarping(){let e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,s){if(!this.enabled){this._updateWeight(e);return}let i=this._startTime;if(i!==null){let c=(e-i)*n;if(c<0||n===0)return;this._startTime=null,t=n*c}t*=this._updateTimeScale(e);let o=this._updateTime(t),a=this._updateWeight(e);if(a>0){let c=this._interpolants,l=this._propertyBindings;switch(this.blendMode){case EE:for(let u=0,h=c.length;u!==h;++u)c[u].evaluate(o),l[u].accumulateAdditive(a);break;case Um:default:for(let u=0,h=c.length;u!==h;++u)c[u].evaluate(o),l[u].accumulate(s,a)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;let n=this._weightInterpolant;if(n!==null){let s=n.evaluate(e)[0];t*=s,e>n.parameterPositions[1]&&(this.stopFading(),s===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;let n=this._timeScaleInterpolant;n!==null&&(t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t,t}_updateTime(e){let t=this._clip.duration,n=this.loop,s=this.time+e,i=this._loopCount,o=n===W4;if(e===0)return i===-1?s:o&&(i&1)===1?t-s:s;if(n===G4){i===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(s>=t)s=t;else if(s<0)s=0;else{this.time=s;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(i===-1&&(e>=0?(i=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),s>=t||s<0){let a=Math.floor(s/t);s-=t*a,i+=Math.abs(a);let c=this.repetitions-i;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,s=e>0?t:0,this.time=s,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){let l=e<0;this._setEndings(l,!l,o)}else this._setEndings(!1,!1,o);this._loopCount=i,this.time=s,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:a})}}else this.time=s;if(o&&(i&1)===1)return t-s}return s}_setEndings(e,t,n){let s=this._interpolantSettings;n?(s.endingStart=na,s.endingEnd=na):(e?s.endingStart=this.zeroSlopeAtStart?na:ta:s.endingStart=Th,t?s.endingEnd=this.zeroSlopeAtEnd?na:ta:s.endingEnd=Th)}_scheduleFading(e,t,n){let s=this._mixer,i=s.time,o=this._weightInterpolant;o===null&&(o=s._lendControlInterpolant(),this._weightInterpolant=o);let a=o.parameterPositions,c=o.sampleValues;return a[0]=i,c[0]=t,a[1]=i+e,c[1]=n,this}},AC=class extends pr{constructor(e){super();this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){let n=e._localRoot||this._root,s=e._clip.tracks,i=s.length,o=e._propertyBindings,a=e._interpolants,c=n.uuid,l=this._bindingsByRootAndName,u=l[c];u===void 0&&(u={},l[c]=u);for(let h=0;h!==i;++h){let d=s[h],p=d.name,_=u[p];if(_!==void 0)++_.referenceCount,o[h]=_;else{if(_=o[h],_!==void 0){_._cacheIndex===null&&(++_.referenceCount,this._addInactiveBinding(_,c,p));continue}let f=t&&t._propertyBindings[h].binding.parsedPath;_=new wC(lt.create(n,p,f),d.ValueTypeName,d.getValueSize()),++_.referenceCount,this._addInactiveBinding(_,c,p),o[h]=_}a[h].resultBuffer=_.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){let n=(e._localRoot||this._root).uuid,s=e._clip.uuid,i=this._actionsByClip[s];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,s,n)}let t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){let i=t[n];i.useCount++===0&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){let t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){let i=t[n];--i.useCount===0&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;let e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){let t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){let s=this._actions,i=this._actionsByClip,o=i[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=o;else{let a=o.knownActions;e._byClipCacheIndex=a.length,a.push(e)}e._cacheIndex=s.length,s.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){let t=this._actions,n=t[t.length-1],s=e._cacheIndex;n._cacheIndex=s,t[s]=n,t.pop(),e._cacheIndex=null;let i=e._clip.uuid,o=this._actionsByClip,a=o[i],c=a.knownActions,l=c[c.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,c[u]=l,c.pop(),e._byClipCacheIndex=null;let h=a.actionByRoot,d=(e._localRoot||this._root).uuid;delete h[d],c.length===0&&delete o[i],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){let t=e._propertyBindings;for(let n=0,s=t.length;n!==s;++n){let i=t[n];--i.referenceCount===0&&this._removeInactiveBinding(i)}}_lendAction(e){let t=this._actions,n=e._cacheIndex,s=this._nActiveActions++,i=t[s];e._cacheIndex=s,t[s]=e,i._cacheIndex=n,t[n]=i}_takeBackAction(e){let t=this._actions,n=e._cacheIndex,s=--this._nActiveActions,i=t[s];e._cacheIndex=s,t[s]=e,i._cacheIndex=n,t[n]=i}_addInactiveBinding(e,t,n){let s=this._bindingsByRootAndName,i=this._bindings,o=s[t];o===void 0&&(o={},s[t]=o),o[n]=e,e._cacheIndex=i.length,i.push(e)}_removeInactiveBinding(e){let t=this._bindings,n=e.binding,s=n.rootNode.uuid,i=n.path,o=this._bindingsByRootAndName,a=o[s],c=t[t.length-1],l=e._cacheIndex;c._cacheIndex=l,t[l]=c,t.pop(),delete a[i],Object.keys(a).length===0&&delete o[s]}_lendBinding(e){let t=this._bindings,n=e._cacheIndex,s=this._nActiveBindings++,i=t[s];e._cacheIndex=s,t[s]=e,i._cacheIndex=n,t[n]=i}_takeBackBinding(e){let t=this._bindings,n=e._cacheIndex,s=--this._nActiveBindings,i=t[s];e._cacheIndex=s,t[s]=e,i._cacheIndex=n,t[n]=i}_lendControlInterpolant(){let e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return n===void 0&&(n=new u_(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){let t=this._controlInterpolants,n=e.__cacheIndex,s=--this._nActiveControlInterpolants,i=t[s];e.__cacheIndex=s,t[s]=e,i.__cacheIndex=n,t[n]=i}clipAction(e,t,n){let s=t||this._root,i=s.uuid,o=typeof e=="string"?Rm.findByName(s,e):e,a=o!==null?o.uuid:e,c=this._actionsByClip[a],l=null;if(n===void 0&&(o!==null?n=o.blendMode:n=Um),c!==void 0){let h=c.actionByRoot[i];if(h!==void 0&&h.blendMode===n)return h;l=c.knownActions[0],o===null&&(o=l._clip)}if(o===null)return null;let u=new SC(this,o,t,n);return this._bindAction(u,l),this._addInactiveAction(u,a,i),u}existingAction(e,t){let n=t||this._root,s=n.uuid,i=typeof e=="string"?Rm.findByName(n,e):e,o=i?i.uuid:e,a=this._actionsByClip[o];return a!==void 0&&a.actionByRoot[s]||null}stopAllAction(){let e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;let t=this._actions,n=this._nActiveActions,s=this.time+=e,i=Math.sign(e),o=this._accuIndex^=1;for(let l=0;l!==n;++l)t[l]._update(s,e,i,o);let a=this._bindings,c=this._nActiveBindings;for(let l=0;l!==c;++l)a[l].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){let t=this._actions,n=e.uuid,s=this._actionsByClip,i=s[n];if(i!==void 0){let o=i.knownActions;for(let a=0,c=o.length;a!==c;++a){let l=o[a];this._deactivateAction(l);let u=l._cacheIndex,h=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,h._cacheIndex=u,t[u]=h,t.pop(),this._removeInactiveBindingsForAction(l)}delete s[n]}}uncacheRoot(e){let t=e.uuid,n=this._actionsByClip;for(let o in n){let a=n[o].actionByRoot,c=a[t];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}let s=this._bindingsByRootAndName,i=s[t];if(i!==void 0)for(let o in i){let a=i[o];a.restoreOriginalState(),this._removeInactiveBinding(a)}}uncacheAction(e,t){let n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}};AC.prototype._controlInterpolantsResultBuffer=new Float32Array(1);var od=class{constructor(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new od(this.value.clone===void 0?this.value:this.value.clone())}},TC=class extends ki{constructor(e,t,n=1){super(e,t);this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){let t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){let t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}};TC.prototype.isInstancedInterleavedBuffer=!0;var MC=class{constructor(e,t,n,s,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=s,this.count=i,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}};MC.prototype.isGLBufferAttribute=!0;var _l=class{constructor(e,t,n=0,s=1/0){this.ray=new Wr(e,t),this.near=n,this.far=s,this.camera=null,this.layers=new kh,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,n=[]){return Om(e,this,n,t),n.sort(mE),n}intersectObjects(e,t=!0,n=[]){for(let s=0,i=e.length;s<i;s++)Om(e[s],this,n,t);return n.sort(mE),n}};function mE(r,e){return r.distance-e.distance}function Om(r,e,t,n){if(r.layers.test(e.layers)&&r.raycast(e,t),n===!0){let s=r.children;for(let i=0,o=s.length;i<o;i++)Om(s[i],e,t,!0)}}var ad=class{constructor(e=1,t=0,n=0){return this.radius=e,this.phi=t,this.theta=n,this}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(un(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}};var _E=new G,Ca=class{constructor(e=new G(1/0,1/0),t=new G(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){let n=_E.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return _E.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}};Ca.prototype.isBox2=!0;var gE=new A,vh=new A,Hn=class{constructor(e=new A,t=new A){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){gE.subVectors(e,this.start),vh.subVectors(this.end,this.start);let n=vh.dot(vh),i=vh.dot(gE)/n;return t&&(i=un(i,0,1)),i}closestPointToPoint(e,t,n){let s=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(s).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}};var $s=new A,bh=new pe,xm=new pe,PC=class extends sr{constructor(e){let t=NC(e),n=new st,s=[],i=[],o=new ae(0,0,1),a=new ae(0,1,0);for(let l=0;l<t.length;l++){let u=t[l];u.parent&&u.parent.isBone&&(s.push(0,0,0),s.push(0,0,0),i.push(o.r,o.g,o.b),i.push(a.r,a.g,a.b))}n.setAttribute("position",new Je(s,3)),n.setAttribute("color",new Je(i,3));let c=new Ln({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,c);this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){let t=this.bones,n=this.geometry,s=n.getAttribute("position");xm.copy(this.root.matrixWorld).invert();for(let i=0,o=0;i<t.length;i++){let a=t[i];a.parent&&a.parent.isBone&&(bh.multiplyMatrices(xm,a.matrixWorld),$s.setFromMatrixPosition(bh),s.setXYZ(o,$s.x,$s.y,$s.z),bh.multiplyMatrices(xm,a.parent.matrixWorld),$s.setFromMatrixPosition(bh),s.setXYZ(o+1,$s.x,$s.y,$s.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}};function NC(r){let e=[];r.isBone===!0&&e.push(r);for(let t=0;t<r.children.length;t++)e.push.apply(e,NC(r.children[t]));return e}var RC=class extends sr{constructor(e=10,t=10,n=4473924,s=8947848){n=new ae(n),s=new ae(s);let i=t/2,o=e/t,a=e/2,c=[],l=[];for(let d=0,p=0,_=-a;d<=t;d++,_+=o){c.push(-a,0,_,a,0,_),c.push(_,0,-a,_,0,a);let f=d===i?n:s;f.toArray(l,p),p+=3,f.toArray(l,p),p+=3,f.toArray(l,p),p+=3,f.toArray(l,p),p+=3}let u=new st;u.setAttribute("position",new Je(c,3)),u.setAttribute("color",new Je(l,3));let h=new Ln({vertexColors:!0,toneMapped:!1});super(u,h);this.type="GridHelper"}};var OC=new ArrayBuffer(4),Zde=new Float32Array(OC),Jde=new Uint32Array(OC),qr=new Uint32Array(512),Gr=new Uint32Array(512);for(let r=0;r<256;++r){let e=r-127;e<-27?(qr[r]=0,qr[r|256]=32768,Gr[r]=24,Gr[r|256]=24):e<-14?(qr[r]=1024>>-e-14,qr[r|256]=1024>>-e-14|32768,Gr[r]=-e-1,Gr[r|256]=-e-1):e<=15?(qr[r]=e+15<<10,qr[r|256]=e+15<<10|32768,Gr[r]=13,Gr[r|256]=13):e<128?(qr[r]=31744,qr[r|256]=64512,Gr[r]=24,Gr[r|256]=24):(qr[r]=31744,qr[r|256]=64512,Gr[r]=13,Gr[r|256]=13)}var IC=new Uint32Array(2048),gl=new Uint32Array(64),RW=new Uint32Array(64);for(let r=1;r<1024;++r){let e=r<<13,t=0;for(;(e&8388608)===0;)e<<=1,t-=8388608;e&=-8388609,t+=947912704,IC[r]=e|t}for(let r=1024;r<2048;++r)IC[r]=939524096+(r-1024<<13);for(let r=1;r<31;++r)gl[r]=r<<23;gl[31]=1199570944;gl[32]=2147483648;for(let r=33;r<63;++r)gl[r]=2147483648+(r-32<<23);gl[63]=3347054592;for(let r=1;r<64;++r)r!==32&&(RW[r]=1024);nr.create=function(r,e){return console.log("THREE.Curve.create() has been deprecated"),r.prototype=Object.create(nr.prototype),r.prototype.constructor=r,r.prototype.getPoint=e,r};Rh.prototype.fromPoints=function(r){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(r)};RC.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};PC.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};gs.prototype.extractUrlBase=function(r){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),fC.extractUrlBase(r)};gs.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}};Ca.prototype.center=function(r){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(r)};Ca.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Ca.prototype.isIntersectionBox=function(r){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(r)};Ca.prototype.size=function(r){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(r)};Ut.prototype.center=function(r){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(r)};Ut.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()};Ut.prototype.isIntersectionBox=function(r){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(r)};Ut.prototype.isIntersectionSphere=function(r){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(r)};Ut.prototype.size=function(r){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(r)};rr.prototype.toVector3=function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")};fs.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()};ll.prototype.setFromMatrix=function(r){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(r)};Hn.prototype.center=function(r){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(r)};xn.prototype.flattenToArrayOffset=function(r,e){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(r,e)};xn.prototype.multiplyVector3=function(r){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),r.applyMatrix3(this)};xn.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")};xn.prototype.applyToBufferAttribute=function(r){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),r.applyMatrix3(this)};xn.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")};xn.prototype.getInverse=function(r){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(r).invert()};pe.prototype.extractPosition=function(r){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(r)};pe.prototype.flattenToArrayOffset=function(r,e){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(r,e)};pe.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new A().setFromMatrixColumn(this,3)};pe.prototype.setRotationFromQuaternion=function(r){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(r)};pe.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")};pe.prototype.multiplyVector3=function(r){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)};pe.prototype.multiplyVector4=function(r){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)};pe.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")};pe.prototype.rotateAxis=function(r){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),r.transformDirection(this)};pe.prototype.crossVector=function(r){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)};pe.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")};pe.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")};pe.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")};pe.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")};pe.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")};pe.prototype.applyToBufferAttribute=function(r){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),r.applyMatrix4(this)};pe.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")};pe.prototype.makeFrustum=function(r,e,t,n,s,i){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(r,e,n,t,s,i)};pe.prototype.getInverse=function(r){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(r).invert()};qn.prototype.isIntersectionLine=function(r){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(r)};dt.prototype.multiplyVector3=function(r){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),r.applyQuaternion(this)};dt.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()};Wr.prototype.isIntersectionBox=function(r){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(r)};Wr.prototype.isIntersectionPlane=function(r){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(r)};Wr.prototype.isIntersectionSphere=function(r){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(r)};Ct.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()};Ct.prototype.barycoordFromPoint=function(r,e){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(r,e)};Ct.prototype.midpoint=function(r){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(r)};Ct.prototypenormal=function(r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(r)};Ct.prototype.plane=function(r){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(r)};Ct.barycoordFromPoint=function(r,e,t,n,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Ct.getBarycoord(r,e,t,n,s)};Ct.normal=function(r,e,t,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Ct.getNormal(r,e,t,n)};wa.prototype.extractAllPoints=function(r){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(r)};wa.prototype.extrude=function(r){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Ui(this,r)};wa.prototype.makeGeometry=function(r){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ed(this,r)};G.prototype.fromAttribute=function(r,e,t){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(r,e,t)};G.prototype.distanceToManhattan=function(r){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(r)};G.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};A.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")};A.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")};A.prototype.getPositionFromMatrix=function(r){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(r)};A.prototype.getScaleFromMatrix=function(r){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(r)};A.prototype.getColumnFromMatrix=function(r,e){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(e,r)};A.prototype.applyProjection=function(r){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(r)};A.prototype.fromAttribute=function(r,e,t){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(r,e,t)};A.prototype.distanceToManhattan=function(r){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(r)};A.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};Se.prototype.fromAttribute=function(r,e,t){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(r,e,t)};Se.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()};nt.prototype.getChildByName=function(r){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(r)};nt.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")};nt.prototype.translate=function(r,e){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(e,r)};nt.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")};nt.prototype.applyMatrix=function(r){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(r)};Object.defineProperties(nt.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(r){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=r}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});St.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")};Object.defineProperties(St.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),CE},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}});ul.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")};hn.prototype.setLens=function(r,e){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),e!==void 0&&(this.filmGauge=e),this.setFocalLength(r)};Object.defineProperties(Mr.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(r){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=r}},shadowCameraLeft:{set:function(r){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=r}},shadowCameraRight:{set:function(r){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=r}},shadowCameraTop:{set:function(r){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=r}},shadowCameraBottom:{set:function(r){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=r}},shadowCameraNear:{set:function(r){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=r}},shadowCameraFar:{set:function(r){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=r}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(r){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=r}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(r){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=r}},shadowMapHeight:{set:function(r){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=r}}});Object.defineProperties(xt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===Mh},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(Mh)}}});xt.prototype.setDynamic=function(r){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(r===!0?Mh:Qc),this};xt.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},xt.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};st.prototype.addIndex=function(r){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(r)};st.prototype.addAttribute=function(r,e){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),!(e&&e.isBufferAttribute)&&!(e&&e.isInterleavedBufferAttribute)?(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(r,new xt(arguments[1],arguments[2]))):r==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(e),this):this.setAttribute(r,e)};st.prototype.addDrawCall=function(r,e,t){t!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(r,e)};st.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()};st.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")};st.prototype.removeAttribute=function(r){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(r)};st.prototype.applyMatrix=function(r){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(r)};Object.defineProperties(st.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}});ki.prototype.setDynamic=function(r){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(r===!0?Mh:Qc),this};ki.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")};Ui.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")};Ui.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")};Ui.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")};ms.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")};od.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this};Object.defineProperties(nn.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new ae}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(r){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===xE}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(r){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=r}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}});Object.defineProperties(Gn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(r){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=r}}});_t.prototype.clearTarget=function(r,e,t,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(r),this.clear(e,t,n)};_t.prototype.animate=function(r){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(r)};_t.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()};_t.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()};_t.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision};_t.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()};_t.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")};_t.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")};_t.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")};_t.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")};_t.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")};_t.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")};_t.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures};_t.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")};_t.prototype.enableScissorTest=function(r){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(r)};_t.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")};_t.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")};_t.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")};_t.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")};_t.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")};_t.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")};_t.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")};_t.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")};_t.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")};_t.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()};Object.defineProperties(_t.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(r){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=r}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(r){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=r}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(r){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=r===!0?Et:Tr}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}},gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});Object.defineProperties(VE.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(En.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(r){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=r}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(r){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=r}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(r){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=r}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(r){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=r}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(r){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=r}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(r){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=r}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(r){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=r}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(r){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=r}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(r){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=r}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(r){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=r}}});vC.prototype.load=function(r){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");let e=this;return new gC().load(r,function(n){e.setBuffer(n)}),this};bC.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};Fh.prototype.updateCubeMap=function(r,e){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(r,e)};Fh.prototype.clear=function(r,e,t,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(r,e,t,n)};Ks.crossOrigin=void 0;Ks.loadTexture=function(r,e,t,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");let s=new cC;s.setCrossOrigin(this.crossOrigin);let i=s.load(r,t,void 0,n);return e&&(i.mapping=e),i};Ks.loadTextureCube=function(r,e,t,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");let s=new aC;s.setCrossOrigin(this.crossOrigin);let i=s.load(r,t,void 0,n);return e&&(i.mapping=e),i};Ks.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")};Ks.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Im}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Im);var q=class{static isNumber(e){return typeof e=="number"}static isVector(e){return e instanceof G||e instanceof A||e instanceof Se}static isColor(e){return e instanceof ae}static isEuler(e){return e instanceof rr}static isQuaternion(e){return e instanceof dt}static isString(e){return typeof e=="string"}static isBoolean(e){return e===!0||e===!1}static isNaN(e){return isNaN(e)}static isArray(e){return Array.isArray(e)}static isObject(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}};var DC={};var OW=0,LC=class{constructor(){this._printDebug=!1,this._require_webgl2=!1}setPrintDebug(r=!0){this._printDebug=r}printDebug(){return this._printDebug}printDebugMessage(r){!this._printDebug||console.warn("[Poly debug]",r)}setRequireWebGL2(){this._require_webgl2||(this._require_webgl2=!0)}webGL2Available(){return this._webgl2_available===void 0&&(this._webgl2_available=this._setWebGL2Available()),this._webgl2_available}_setWebGL2Available(){let r=document.createElement("canvas");return(window.WebGL2RenderingContext&&r.getContext("webgl2"))!=null}createWebGLRenderer(r){let e=new _t(r);return this.assignIdToRenderer(e),this.printDebugMessage(["create renderer:",r]),e}assignIdToRenderer(r){if(r._polygonId!=null)return;let e=OW+=1;r._polygonId=e}rendererId(r){let e=r._polygonId;if(e==null){console.error("renderer has no _polygonId");return}return e}getRenderingContext(r){let e=null;return e=this._getRenderingContextWebgl(r,!0),e||console.warn("failed to create webgl2 context"),e||(e=this._getRenderingContextWebgl(r,!1)),e.contextId==null&&(e.contextId=LC._nextGlContextId++),e}_getRenderingContextWebgl(r,e){let t;this.webGL2Available()?t="webgl2":t=e?"webgl2":"webgl";let n=r.getContext(t,DC);return n?this.printDebugMessage(`create gl context: ${t}.`):(t=e?"experimental-webgl2":"experimental-webgl",this.printDebugMessage(`create gl context: ${t}.`),n=r.getContext(t,DC)),n}renderTarget(r,e,t){if(this.webGL2Available()){let n=new En(r,e,t);return n.samples=2,n}else return new En(r,e,t)}},v_=LC;v_._nextGlContextId=0;var b_=class{constructor(){this._rootPrefix="",this._root="/three/js/libs",this._KTX2Path="/ktx2",this._DRACOPath="/draco",this._DRACOGLTFPath="/draco/gltf",this._XATLASPath="/xatlas"}root(){if(this._root)if(this._rootPrefix.length>0){let e=this._root.replace(/^(\.)/,"");return`${this._rootPrefix}${e}`}else return this._root}setRoot(e){this._root=e}setRootPrefix(e){this._rootPrefix=e}KTX2Path(){return this._KTX2Path}DRACOPath(){return this._DRACOPath}DRACOGLTFPath(){return this._DRACOGLTFPath}XATLASPath(){return this._XATLASPath}};var Nr=class{constructor(e){this.poly=e,this._node_register=new Map,this._node_register_categories=new Map,this._node_register_options=new Map}static type(e){return this.filterType(e.type())}static filterType(e){return e.toLowerCase()}register(e,t,n){var s,i;let o=e.context(),a=Nr.type(e),c=n==null?void 0:n.printWarnings;c==null&&(c=!0);let l=this._node_register.get(o);if(l||(l=new Map,this._node_register.set(o,l)),l.get(a)){let h=((i=(s=this._node_register_options.get(o))==null?void 0:s.get(a))==null?void 0:i.polyNode)==!0,d=(n==null?void 0:n.polyNode)==!0;if(!(h&&d)){c&&console.warn(`node ${o}/${a} already registered`);return}}if(l.set(a,e),e.onRegister&&e.onRegister(this.poly),t){let h=this._node_register_categories.get(o);h||(h=new Map,this._node_register_categories.set(o,h)),h.set(a,t)}if(n){let h=this._node_register_options.get(o);h||(h=new Map,this._node_register_options.set(o,h)),h.set(a,n)}this.poly.pluginsRegister.registerNode(e)}deregister(e,t){var n,s,i;t=Nr.filterType(t),(n=this._node_register.get(e))==null||n.delete(t),(s=this._node_register_categories.get(e))==null||s.delete(t),(i=this._node_register_options.get(e))==null||i.delete(t)}isRegistered(e,t){let n=this._node_register.get(e);return n?(t=Nr.filterType(t),n.get(t)!=null):!1}nodeOptions(e,t){var n;return t=Nr.filterType(t),(n=this._node_register_options.get(e))==null?void 0:n.get(t)}registeredNodesForParentNode(e){var t,n;let s=(t=e.childrenController)==null?void 0:t.context;if(!s)return[];if(this._node_register.get(s)){let o=[];return(n=this._node_register.get(s))==null||n.forEach((a,c)=>{o.push(a)}),o.filter(a=>{let c=Nr.type(a),l=this.nodeOptions(s,c);if(l){let u=this.nodeOptions(e.context(),e.type());if((u==null?void 0:u.polyNode)==!0)return!0;let h=l.only,d=l.except,p=`${e.context()}/${e.type()}`;return h?h.includes(p):d?!d.includes(p):!0}else return!0})}else return[]}registeredNodes(e){let t={},n=this.registeredNodesForParentNode(e);for(let s of n){let i=Nr.type(s);t[i]=s}return t}registeredCategory(e,t){var n;return t=Nr.filterType(t),(n=this._node_register_categories.get(e))==null?void 0:n.get(t)}map(){return this._node_register}},Sa=class{constructor(e){this.poly=e,this._operation_register=new Map}static type(e){return this.filterType(e.type())}static filterType(e){return e.toLowerCase()}register(e,t){let n=t==null?void 0:t.printWarnings;n==null&&(n=!0);let s=e.context(),i=this._operation_register.get(s);i||(i=new Map,this._operation_register.set(s,i));let o=Sa.type(e);if(i.get(o)){if(n){let c=`operation ${s}/${o} already registered`;console.warn(c)}return}i.set(o,e),e.onRegister&&e.onRegister(this.poly),this.poly.pluginsRegister.registerOperation(e)}registeredOperationsForContextAndParentType(e,t){var n;if(this._operation_register.get(e)){let i=[];return(n=this._operation_register.get(e))==null||n.forEach((o,a)=>{i.push(o)}),i}else return[]}registeredOperation(e,t){let n=this._operation_register.get(e);if(n)return t=Sa.filterType(t),n.get(t)}};var w_=class{constructor(){this._methods_names=[],this._methods_by_name=new Map}register(e,t){this._methods_names.push(t),this._methods_by_name.set(t,e)}getMethod(e){return this._methods_by_name.get(e)}availableMethods(){return this._methods_names}};var E_=class extends w_{getMethod(e){return super.getMethod(e)}};var C_=class{constructor(){this._controllerAssemblerByName=new Map}register(e,t,n){this._controllerAssemblerByName.set(e,{controller:t,assembler:n})}unregister(e){this._controllerAssemblerByName.delete(e)}traverse(e){this._controllerAssemblerByName.forEach(e)}};var S_=class extends C_{assembler(e,t){let n=this._controllerAssemblerByName.get(t);if(n){let s=n.controller,i=n.assembler;return new s(e,i)}return n}unregister(e){let t=this._controllerAssemblerByName.get(e);return super.unregister(e),t}};var A_=class{constructor(e,t,n){this._name=e,this._callback=t,this._options=n}name(){return this._name}libraryName(){return this._options.libraryName}init(e){this._callback(e)}toJSON(){return{name:this._name,libraryName:this._options.libraryName,libraryImportPath:this._options.libraryImportPath}}};var T_=class{constructor(e){this.poly=e,this._pluginsByName=new Map,this._pluginNameByNodeContextByType=new Map,this._pluginNameByOperationContextByType=new Map}async wrapConfigurePolygonjs(e){this._configurePolygonjsPlugin=this._configurePolygonjsPlugin||new A_("configurePolygonjs",()=>{},{libraryImportPath:"",libraryName:""}),this._currentPlugin=this._configurePolygonjsPlugin,this._pluginsByName.set(this._currentPlugin.name(),this._currentPlugin),await e(),this._currentPlugin=void 0}register(e){let t=this._currentPlugin;this._currentPlugin=e,this._pluginsByName.set(e.name(),e),e.init(this.poly),this._currentPlugin=t}pluginByName(e){return this._pluginsByName.get(e)}registerNode(e){if(!this._currentPlugin)return;let t=e.context(),n=e.type(),s=this._pluginNameByNodeContextByType.get(t);s||(s=new Map,this._pluginNameByNodeContextByType.set(t,s)),s.set(n,this._currentPlugin.name())}registerOperation(e){if(!this._currentPlugin)return;let t=e.context(),n=e.type(),s=this._pluginNameByOperationContextByType.get(t);s||(s=new Map,this._pluginNameByOperationContextByType.set(t,s)),s.set(n,this._currentPlugin.name())}toJson(){let e={plugins:{},nodes:{},operations:{}};return this._pluginsByName.forEach((t,n)=>{e.plugins[n]=t.toJSON()}),this._pluginNameByNodeContextByType.forEach((t,n)=>{e.nodes[n]={},t.forEach((s,i)=>{e.nodes[n][i]=s})}),this._pluginNameByOperationContextByType.forEach((t,n)=>{e.operations[n]={},t.forEach((s,i)=>{e.operations[n][i]=s})}),e}};var M_=class{constructor(e){this._cameraNodeTypes=[],this._registeredViewerCreateCallbackByCamera=new Map}registerNodeType(e){this._cameraNodeTypes.includes(e)||this._cameraNodeTypes.push(e)}registeredNodeTypes(){return this._cameraNodeTypes}register(e,t){this._registeredViewerCreateCallbackByCamera.set(e,t)}createViewer(e){let t=this._registeredViewerCreateCallbackByCamera.get(e.camera.constructor);if(!t){console.error("no createViewer callback available"),console.log("createViewer",e.camera,e.camera.constructor,this._registeredViewerCreateCallbackByCamera);return}return t(e)}objectRegistered(e){return this._registeredViewerCreateCallbackByCamera.get(e.constructor)!=null}};function BC(r){return(window.URL||window.webkitURL).createObjectURL(r)}var P_=class{constructor(e){this.poly=e,this._blobWrappersByUrl=new Map}recording(){return!this.poly.playerMode()}blobUrl(e){var t;return(t=this._blobWrappersByUrl.get(e))==null?void 0:t.blobUrl}clear(){this._blobWrappersByUrl.clear()}clearBlobsForNode(e){let t=[],n=e.graphNodeId();this._blobWrappersByUrl.forEach((s,i)=>{s.referringNodeIds.has(n)&&t.push(i)});for(let s of t){let i=this._blobWrappersByUrl.get(s);i&&(i.referringNodeIds.size==1?this._blobWrappersByUrl.delete(s):i.referringNodeIds.delete(n))}}_assignBlobToNode(e,t,n,s={}){s.multiAssetsForNode!=!0&&this.clearBlobsForNode(t);let i=this._blobWrappersByUrl.get(e);i?i.referringNodeIds.add(t.graphNodeId()):this._blobWrappersByUrl.set(e,n)}async setVirtualFile(e,t){let s={blob:e,blobUrl:this._createBlobUrl(e),referringNodeIds:new Set};this._blobWrappersByUrl.set(t,s)}async fetchBlobGlobal(e){if(!this.recording())return{};try{let t=this._blobWrappersByUrl.get(e);if(t)return{blobWrapper:t};let n=this.poly.assetUrls.remapedUrl(e)||e,s=await fetch(n);if(s.ok){let i=await s.blob(),o={blob:i,blobUrl:this._createBlobUrl(i),referringNodeIds:new Set};return this._blobWrappersByUrl.set(e,o),{blobWrapper:o}}else return{error:`failed to fetch ${n}`}}catch{return{error:`failed to fetch ${e}`}}}async fetchBlobForNode(e){if(!this.recording())return{};try{let t=e.node.graphNodeId(),n=this._blobWrappersByUrl.get(e.fullUrl);if(n)return n.referringNodeIds.add(t),{blobWrapper:n};let s=this.poly.assetUrls.remapedUrl(e.fullUrl)||e.fullUrl,i=await fetch(s);if(i.ok){let o=await i.blob(),a=new Set;a.add(t);let c={blob:o,blobUrl:this._createBlobUrl(o),referringNodeIds:a};return this._assignBlobToNode(e.fullUrl,e.node,c,{multiAssetsForNode:e.multiAssetsForNode}),{blobWrapper:c}}else return{error:`failed to fetch ${e.fullUrl}`}}catch{return{error:`failed to fetch ${e.fullUrl}`}}}traverse(e){let t=(s,i)=>{this._blobWrappersByUrl.forEach((o,a)=>{o.referringNodeIds.size==0==i&&s.push(a)})},n=[];t(n,!0),t(n,!1),n.sort();for(let s of n){let i=this._blobWrappersByUrl.get(s);i&&e({url:s,blobWrapper:i})}}_createBlobUrl(e){return BC(e)}assetsManifestWithBlobsMap(){let e={},t=new Map,n=[],s=[];this.traverse(i=>{n.push(i.blobWrapper.blob);let o=i.url;s.push(o)});for(let i=0;i<n.length;i++){let o=s[i],a=n[i],c=o.split("?")[0],l=o.split("."),u=l[l.length-1],h=`${i}.${u}`,d=`assets/${h}`;t.set(d,a),e[c]=h}return{manifest:e,blobsMap:t}}};var N_=class{setMap(e){this._map=e}remapedUrl(e){if(!this._map)return;let t=e.split("?"),n=t[0],s=t[1],i=this._map[n];if(i)return s?`${i}?${s}`:i}};var R_=class{setPerformanceManager(e){this._performanceManager=e}performanceManager(){return this._performanceManager||window.performance}};var O_=class{constructor(){this._scenes=new Set,this._registerTimeByScene=new Map}registerScene(e){if(this._scenes.has(e)){console.warn("scene was already registered");return}this._scenes.add(e),this._registerTimeByScene.set(e,performance.now()),this._updateCache()}deregisterScene(e){this._scenes.delete(e),this._registerTimeByScene.delete(e),this._updateCache()}lastRegisteredScene(){return this._lastRegisteredScene}scenes(){let e=[];return this._scenes.forEach(t=>e.push(t)),e}_updateCache(){this._lastRegisteredScene=void 0,this._registerTimeByScene.forEach((e,t)=>{if(this._lastRegisteredScene==null)this._lastRegisteredScene=t;else{let n=this._registerTimeByScene.get(this._lastRegisteredScene);e!=null&&n!=null&&e>n&&(this._lastRegisteredScene=t)}})}};var I_=class{constructor(){this._logoDisplayed=!1,this._redirectUrl="https://polygonjs.com"}display(e){this._logoDisplayed=!0,this._datauri=e.datauri,this._redirectUrl=e.redirectUrl}displayed(){return this._logoDisplayed}datauri(){return this._datauri}redirectUrl(){return this._redirectUrl}};var cd=class{constructor(){this.renderersController=new v_,this.scenesRegister=new O_,this.nodesRegister=new Nr(this),this.operationsRegister=new Sa(this),this.expressionsRegister=new E_,this.assemblersRegister=new S_,this.pluginsRegister=new T_(this),this.camerasRegister=new M_(this),this.blobs=new P_(this),this.assetUrls=new N_,this.logo=new I_,this.performance=new R_,this.scenesByUuid={},this._playerMode=!0,this._logger=null}static _instance_(){if(window.__POLYGONJS_POLY_INSTANCE__)return window.__POLYGONJS_POLY_INSTANCE__;{let e=new cd;return window.__POLYGONJS_POLY_INSTANCE__=e,window.__POLYGONJS_POLY_INSTANCE__}}setPlayerMode(e){this._playerMode=e}playerMode(){return this._playerMode}registerNode(e,t,n){this.nodesRegister.register(e,t,n)}registerOperation(e,t){this.operationsRegister.register(e,t)}registerCamera(e,t){this.camerasRegister.register(e,t)}registerCameraNodeType(e){this.camerasRegister.registerNodeType(e)}registerPlugin(e){this.pluginsRegister.register(e)}wrapConfigurePolygonjs(e){this.pluginsRegister.wrapConfigurePolygonjs(e)}registeredNodes(e){return this.nodesRegister.registeredNodes(e)}registeredOperation(e,t){return this.operationsRegister.registeredOperation(e,t)}inWorkerThread(){return!1}get libs(){return this._libs_controller=this._libs_controller||new b_}setEnv(e){this._env=e}env(){return this._env}setLogger(e){this._logger=e}log(e,...t){var n;(n=this._logger)==null||n.log(e,...t)}warn(e,...t){var n;(n=this._logger)==null||n.warn(e,...t)}error(e,...t){var n;(n=this._logger)==null||n.error(e,...t)}},ie=cd._instance_();var D_=class{constructor(e){this.node=e,this._dirtyCount=0,this._dirty=!0}dispose(){this._cachedSuccessors=void 0,this._postDirtyHooks=void 0,this._postDirtyHookNames=void 0}isDirty(){return this._dirty===!0}dirtyTimestamp(){return this._dirtyTimestamp}dirtyCount(){return this._dirtyCount}addPostDirtyHook(e,t){this._postDirtyHookNames=this._postDirtyHookNames||[],this._postDirtyHooks=this._postDirtyHooks||[],this._postDirtyHookNames.includes(e)?console.warn(`hook with name ${e} already exists`,this.node):(this._postDirtyHookNames.push(e),this._postDirtyHooks.push(t))}removePostDirtyHook(e){if(this._postDirtyHookNames&&this._postDirtyHooks){let t=this._postDirtyHookNames.indexOf(e);t>=0&&(this._postDirtyHookNames.splice(t,1),this._postDirtyHooks.splice(t,1))}}hasHook(e){return this._postDirtyHookNames?this._postDirtyHookNames.includes(e):!1}removeDirtyState(){this._dirty=!1}setForbiddenTriggerNodes(e){this._forbiddenTriggerNodeIds?this._forbiddenTriggerNodeIds.clear():this._forbiddenTriggerNodeIds=new Set;for(let t of e)this._forbiddenTriggerNodeIds.add(t.graphNodeId()),t.dirtyController.clearSuccessorsCacheWithPredecessors()}isForbiddenTriggerNodeId(e){return this._forbiddenTriggerNodeIds!=null&&this._forbiddenTriggerNodeIds.has(e)}setDirty(e,t){t==null&&(t=!0),!(e&&this.isForbiddenTriggerNodeId(e.graphNodeId()))&&(e==null&&(e=this.node),this._dirty=!0,this._dirtyTimestamp=ie.performance.performanceManager().now(),this._dirtyCount+=1,this.runPostDirtyHooks(e),t===!0&&this.setSuccessorsDirty(e))}runPostDirtyHooks(e){if(!this._postDirtyHooks)return;let t=this.node.scene().cooker;if(t.blocked())t.enqueue(this.node,e);else for(let n of this._postDirtyHooks)n(e)}setSuccessorsDirty(e){e==null&&(e=this.node);let t=!1;this._cachedSuccessors=this._cachedSuccessors||this.node.graphAllSuccessors();for(let n of this._cachedSuccessors)n.dirtyController.setDirty(e,t)}clearSuccessorsCache(){this._cachedSuccessors=void 0}clearSuccessorsCacheWithPredecessors(){this.clearSuccessorsCache();for(let e of this.node.graphAllPredecessors())e.dirtyController.clearSuccessorsCache()}};var Rt=class{constructor(e,t){this._scene=e,this._name=t,this._dirtyController=new D_(this),this.disposed=!1,this._graphNodeId=e.graph.nextId(),e.graph.addNode(this),this._graph=e.graph}dispose(){this._dirtyController.dispose(),this.graphRemove(),this.disposed=!0}name(){return this._name}setName(e){this._name=e}scene(){return this._scene}graphNodeId(){return this._graphNodeId}get dirtyController(){return this._dirtyController}setDirty(e){e=e||this,this._dirtyController.setDirty(e)}setSuccessorsDirty(e){this._dirtyController.setSuccessorsDirty(e)}removeDirtyState(){this._dirtyController.removeDirtyState()}isDirty(){return this._dirtyController.isDirty()}addPostDirtyHook(e,t){this._dirtyController.addPostDirtyHook(e,t)}removePostDirtyHook(e){this._dirtyController.removePostDirtyHook(e)}graphRemove(){this._graph.removeNode(this)}addGraphInput(e,t=!0){return this._graph.connect(e,this,t)}removeGraphInput(e){this._graph.disconnect(e,this)}graphDisconnectPredecessors(){this._graph.disconnectPredecessors(this)}graphDisconnectSuccessors(){this._graph.disconnectSuccessors(this)}graphPredecessorIds(){return this._graph.predecessorIds(this._graphNodeId)||[]}graphPredecessors(){return this._graph.predecessors(this)}graphSuccessors(){return this._graph.successors(this)}graphAllPredecessors(){return this._graph.allPredecessors(this)}graphAllSuccessors(){return this._graph.allSuccessors(this)}};var Qs=(r=>(r.MAX_FRAME_UPDATED="scene_maxFrameUpdated",r.REALTIME_STATUS_UPDATED="scene_realtime_status_updated",r.FRAME_UPDATED="scene_frame_updated",r.PLAY_STATE_UPDATED="scene_play_state_updated",r))(Qs||{});var je=class{static arrayFromValues(e){let t=[];return e.forEach(n=>{t.push(n)}),t}static pushOnArrayAtEntry(e,t,n){e.has(t)?e.get(t).push(n):e.set(t,[n])}static addToSetAtEntry(e,t,n){if(e.has(t))e.get(t).add(n);else{let i=new Set;i.add(n),e.set(t,i)}}static popFromArrayAtEntry(e,t,n){if(e.has(t)){let i=e.get(t),o=i.indexOf(n);o>=0&&i.splice(o,1)}}static removeFromSetAtEntry(e,t,n){if(e.has(t)){let i=e.get(t);i.delete(n),i.size==0&&e.delete(t)}}static unshiftOnArrayAtEntry(e,t,n){e.has(t)?e.get(t).unshift(n):e.set(t,[n])}static concatOnArrayAtEntry(e,t,n){if(e.has(t)){let i=e.get(t);for(let o of n)i.push(o)}else e.set(t,n)}static async forEachSync(e,t){let n=[],s=[];e.forEach((i,o)=>{n.push(i),s.push(o)});for(let i=0;i<n.length;i++){let o=s[i],a=n[i];await t(a,o)}}static groupBy(e,t){let n=new Map;return e.forEach(s=>{let i=t(s);this.pushOnArrayAtEntry(n,i,s)}),n}};var ld=class extends Event{constructor(e){super(e)}get type(){return super.type}},kC={event:new ld("sceneLoaded")},FC={event:new ld("play")},UC={event:new ld("pause")},L_=class{constructor(){this._observersByEventType=new Map}dispatch(e){let t=e.event;if(!t)return;let n=this._observersByEventType.get(t.type);!n||n.forEach(s=>{s.processEvent(e)})}removeObserverFromAllEventTypes(e){this._observersByEventType.forEach((t,n)=>{t.delete(e)})}addObserver(e,t){je.addToSetAtEntry(this._observersByEventType,t,e)}};var zC=60,VC={updateClockDelta:!1},Aa=class{constructor(r){this.scene=r,this._frame=0,this._timeUniform={value:0},this._realtimeState=!0,this._maxFrame=600,this._maxFrameLocked=!1,this._playing=!1,this._clock=new g_,this._delta=0,this._onBeforeTickCallbacks=[],this._onAfterTickCallbacks=[],this._onPlayingStateChangeCallbacks=[],this._graphNode=new Rt(r,"timeController")}get graphNode(){return this._graphNode}updateClockDelta(){return this._delta=this._clock.getDelta()}delta(){return this._delta}setDelta(r){this._delta=r}frame(){return this._frame}timeUniform(){return this._timeUniform}time(){return this._timeUniform.value}timeDelta(){return this._delta}maxFrame(){return this._maxFrame}maxFrameLocked(){return this._maxFrameLocked}realtimeState(){return this._realtimeState}setMaxFrame(r){this._maxFrame=Math.floor(r),this.scene.dispatchController.dispatch(this._graphNode,Qs.MAX_FRAME_UPDATED)}setMaxFrameLocked(r){this._maxFrameLocked=r,this.scene.dispatchController.dispatch(this._graphNode,Qs.MAX_FRAME_UPDATED)}setRealtimeState(r){this._realtimeState=r,this.scene.dispatchController.dispatch(this._graphNode,Qs.REALTIME_STATUS_UPDATED)}setTime(r,e=!0){if(r==this._timeUniform.value)return;this._timeUniform.value=r,this.scene.cooker.block();let t=this._delta;for(let n of this._onBeforeTickCallbacks)n(t);if(this._playing==!0&&r>0&&this.scene.actorsManager.tick(),e){let n=Math.floor(this._timeUniform.value*zC),s=this._ensureFrameWithinBounds(n);n!=s?this.setFrame(s,!0):this._frame=n}this.scene.dispatchController.dispatch(this._graphNode,Qs.FRAME_UPDATED),this.graphNode.setSuccessorsDirty(),this.scene.cooker.unblock();for(let n of this._onAfterTickCallbacks)n(t)}setFrame(r,e=!0){r!=this._frame&&(r=this._ensureFrameWithinBounds(r),r!=this._frame&&(this._frame=r,this._frame==Aa.START_FRAME&&this.scene.actorsManager.runOnEventSceneReset(),e&&this.setTime(this._frame/zC,!1)))}setFrameToStart(){this.setFrame(Aa.START_FRAME,!0)}incrementTimeIfPlaying(r){this._playing&&(this.scene.root().areChildrenCooking()||this.incrementTime(r))}incrementTime(r){if((r==null?void 0:r.updateClockDelta)!=!1&&this.updateClockDelta(),this._realtimeState){let e=this._timeUniform.value+this._delta;this.setTime(e,!1),this.setFrame(this._frame+1,!1)}else this.setFrame(this.frame()+1)}_ensureFrameWithinBounds(r){if(this._playing){if(this._maxFrameLocked&&r>this._maxFrame)return Aa.START_FRAME}else{if(this._maxFrameLocked&&r>this._maxFrame)return this._maxFrame;if(r<Aa.START_FRAME)return Aa.START_FRAME}return r}playing(){return this._playing===!0}pause(){if(this._playing!=!1){this._playing=!1,this.scene.dispatchController.dispatch(this._graphNode,Qs.PLAY_STATE_UPDATED),this.scene.actorsManager.runOnEventScenePause(),this.scene.eventsDispatcher.sceneEventsController.dispatch(UC);for(let r of this._onPlayingStateChangeCallbacks)r()}}play(){if(this._playing!=!0){this._playing=!0,this.scene.actorsManager.runOnEventScenePlay(),this.scene.dispatchController.dispatch(this._graphNode,Qs.PLAY_STATE_UPDATED),this.scene.eventsDispatcher.sceneEventsController.dispatch(FC);for(let r of this._onPlayingStateChangeCallbacks)r()}}togglePlayPause(){this.playing()?this.pause():this.play()}registerOnBeforeTick(r,e){this._registerCallback(r,e,this.registeredBeforeTickCallbacks())}unRegisterOnBeforeTick(r){this._unregisterCallback(r,this._onBeforeTickCallbacksMap)}registeredBeforeTickCallbacks(){return this._onBeforeTickCallbacksMap=this._onBeforeTickCallbacksMap||new Map}registerOnAfterTick(r,e){this._registerCallback(r,e,this.registeredAfterTickCallbacks())}unRegisterOnAfterTick(r){this._unregisterCallback(r,this._onAfterTickCallbacksMap)}registeredAfterTickCallbacks(){return this._onAfterTickCallbacksMap=this._onAfterTickCallbacksMap||new Map}onPlayingStateChange(r){this._onPlayingStateChangeCallbacksMap=this._onPlayingStateChangeCallbacksMap||new Set,this._onPlayingStateChangeCallbacksMap.add(r),this._updateOnPlayingStateChangeCallbacks()}removeOnPlayingStateChange(r){this._onPlayingStateChangeCallbacksMap&&(this._onPlayingStateChangeCallbacksMap.delete(r),this._updateOnPlayingStateChangeCallbacks())}_updateOnPlayingStateChangeCallbacks(){this._onPlayingStateChangeCallbacks=[],this._onPlayingStateChangeCallbacksMap&&this._onPlayingStateChangeCallbacksMap.forEach(r=>{this._onPlayingStateChangeCallbacks.push(r)})}_registerCallback(r,e,t){if(t.has(r)){console.warn(`callback ${r} already registered`);return}t.set(r,e),this._updateCallbacks()}_unregisterCallback(r,e){!e||(e.delete(r),this._updateCallbacks())}_updateCallbacks(){var r,e;this._onBeforeTickCallbacks=[],(r=this._onBeforeTickCallbacksMap)==null||r.forEach(t=>{this._onBeforeTickCallbacks.push(t)}),this._onAfterTickCallbacks=[],(e=this._onAfterTickCallbacksMap)==null||e.forEach(t=>{this._onAfterTickCallbacks.push(t)})}},qi=Aa;qi.START_FRAME=0;var pt=(r=>(r.CREATED="node_created",r.DELETED="node_deleted",r.NAME_UPDATED="node_name_update",r.OVERRIDE_CLONABLE_STATE_UPDATE="node_override_clonable_state_update",r.NAMED_OUTPUTS_UPDATED="node_named_outputs_updated",r.NAMED_INPUTS_UPDATED="node_named_inputs_updated",r.INPUTS_UPDATED="node_inputs_updated",r.PARAMS_UPDATED="node_params_updated",r.UI_DATA_POSITION_UPDATED="node_ui_data_position_updated",r.UI_DATA_COMMENT_UPDATED="node_ui_data_comment_updated",r.ERROR_UPDATED="node_error_updated",r.FLAG_BYPASS_UPDATED="bypass_flag_updated",r.FLAG_DISPLAY_UPDATED="display_flag_updated",r.FLAG_OPTIMIZE_UPDATED="optimize_flag_updated",r.SELECTION_UPDATED="selection_updated",r))(pt||{});var B_=class{constructor(e,t=0,n=0){this.node=e,this._position=new G,this._width=50,this._color=new ae(.75,.75,.75),this._layoutVertical=!0,this._json={x:0,y:0},this._position.x=t,this._position.y=n}dispose(){this._comment=void 0}setComment(e){this._comment=e,this.node.emit(pt.UI_DATA_COMMENT_UPDATED)}comment(){return this._comment}setColor(e){this._color=e}color(){return this._color}setLayoutHorizontal(){this._layoutVertical=!1}isLayoutVertical(){return this._layoutVertical}copy(e){this._position.copy(e.position()),this._color.copy(e.color())}position(){return this._position}setPosition(e,t=0){if(q.isNumber(e)){let n=e;this._position.set(n,t)}else this._position.copy(e);return this.node.emit(pt.UI_DATA_POSITION_UPDATED),this}translate(e,t=!1){return this._position.add(e),t&&(this._position.x=Math.round(this._position.x),this._position.y=Math.round(this._position.y)),this.node.emit(pt.UI_DATA_POSITION_UPDATED),this}toJSON(){return this._json.x=this._position.x,this._json.y=this._position.y,this._json.comment=this._comment,this._json}};var Gi=class{constructor(e){this.node=e,this._state=!0,this._hooks=null}onUpdate(e){this._hooks=this._hooks||[],this._hooks.push(e)}_on_update(){}set(e){this._state!=e&&(this._state=e,this._on_update(),this.runHooks())}active(){return this._state}toggle(){this.set(!this._state)}runHooks(){if(this._hooks)for(let e of this._hooks)e()}};var k_=class extends Gi{constructor(){super(...arguments);this._state=!1}_on_update(){this.node.emit(pt.FLAG_BYPASS_UPDATED),this.node.setDirty()}};var F_=class extends Gi{_on_update(){this.node.emit(pt.FLAG_DISPLAY_UPDATED)}};var U_=class extends Gi{constructor(){super(...arguments);this._state=!1}_on_update(){this.node.emit(pt.FLAG_OPTIMIZE_UPDATED)}};var Hi=class{constructor(e){this.node=e}hasDisplay(){return!1}hasBypass(){return!1}hasOptimize(){return!1}};function z_(r){return class extends r{constructor(){super(...arguments);this.display=new F_(this.node)}hasDisplay(){return!0}}}function ud(r){return class extends r{constructor(){super(...arguments);this.bypass=new k_(this.node)}hasBypass(){return!0}}}function qC(r){return class extends r{constructor(){super(...arguments);this.optimize=new U_(this.node)}hasOptimize(){return!0}}}var Ta=class extends z_(Hi){},V_=class extends ud(Hi){},IW=class extends ud(z_(Hi)){},DW=class extends qC(ud(Hi)){},q_=class extends qC(ud(z_(Hi))){};var yl=class{constructor(e){this.node=e}};var G_=class extends yl{active(){return this.paramsTimeDependent()||this.inputsTimeDependent()}paramsTimeDependent(){let e=this.node.params.names;for(let t of e){let n=this.node.params.get(t);if(n&&n.states.timeDependent.active())return!0}return!1}inputsTimeDependent(){let e=this.node.io.inputs.inputs();for(let t of e)if(t&&t.states.timeDependent.active())return!0;return!1}forceTimeDependent(){let e=this.node.graphPredecessors().map(n=>n.graphNodeId()),t=this.node.scene().timeController.graphNode;e.includes(t.graphNodeId())||this.node.addGraphInput(t,!1)}unforceTimeDependent(){let e=this.node.scene().timeController.graphNode;this.node.removeGraphInput(e)}};var H_=class extends yl{set(e){this._message!=e&&(e?ie.error(`[${this.node.path()}] error: '${e}'`):ie.warn(`[${this.node.path()}] clear error`),this._message=e,this.onUpdate())}message(){return this._message}clear(){this.set(void 0)}active(){return this._message!=null}onUpdate(){this._message!=null&&this.node._setContainer(null,`from error '${this._message}'`),this.node.emit(pt.ERROR_UPDATED)}};var W_=class{constructor(e){this.node=e,this.timeDependent=new G_(this.node),this.error=new H_(this.node)}};var Rr=class{constructor(e=""){this._path=e,this._node=null}setPath(e){this._path=e}setNode(e){this._node=e}path(){return this._path}node(){return this._node}resolve(e){this._node=Qe.findNode(e,this._path)}clone(){let e=new Rr(this._path);return e.setNode(this._node),e}nodeWithContext(e,t){let n=this.node();if(!n){t==null||t.set(`no node found at ${this.path()}`);return}let s=n.context();if(s==e)return n;t==null||t.set(`expected ${e} node, but got a ${s}`)}},Wi=class{constructor(e=""){this._path=e,this._param=null}setPath(e){this._path=e}setParam(e){this._param=e}path(){return this._path}param(){return this._param}resolve(e){this._param=Qe.findParam(e,this._path)}clone(){let e=new Wi(this._path);return e.setParam(this._param),e}paramWithType(e,t){let n=this.param();if(!n){t==null||t.set(`no param found at ${this.path()}`);return}if(n.type()==e)return n;t==null||t.set(`expected ${e} node, but got a ${n.type()}`)}},vt=class{static splitParentChild(r){let e=r.split(vt.SEPARATOR).filter(s=>s.length>0),t=e.pop();return{parent:e.join(vt.SEPARATOR),child:t}}static findNode(r,e,t){if(!r)return null;let n=e.split(vt.SEPARATOR).filter(o=>o.length>0),s=n[0],i=null;if(e[0]===vt.SEPARATOR){let o=e.substring(1);i=this.findNode(r.root(),o,t)}else{switch(s){case vt.PARENT:t==null||t.add_path_element(s),i=r.parent();break;case vt.CURRENT:t==null||t.add_path_element(s),i=r;break;default:i=r.node(s),i&&(t==null||t.add_node(s,i))}if(i!=null&&n.length>1){let o=n.slice(1).join(vt.SEPARATOR);i=this.findNode(i,o,t)}return i}return i}static findParam(r,e,t){if(!r)return null;let n=e.split(vt.SEPARATOR);if(n.length===1)return r.params.get(n[0]);{let s=null;if(e[0]===vt.SEPARATOR&&n.length==2)s=r.root();else{let i=n.slice(0,+(n.length-2)+1||void 0).join(vt.SEPARATOR);s=this.findNode(r,i,t)}if(s!=null){let i=n[n.length-1],o=s.params.get(i);return t&&o&&t.add_node(i,o),o}else return null}}static relativePath(r,e){let t=this.closestCommonParent(r,e);if(t){let n=this.distanceToParent(r,t),s="";if(n>0){let u=0,h=[];for(;u++<n;)h.push(vt.PARENT);s=h.join(vt.SEPARATOR)+vt.SEPARATOR}let i=t.path().split(vt.SEPARATOR).filter(u=>u.length>0),o=e.path().split(vt.SEPARATOR).filter(u=>u.length>0),a=[],c=0;for(let u of o)i[c]||a.push(u),c++;let l=a.join(vt.SEPARATOR);return this.sanitizePath(`${s}${l}`)}else return e.path()}static sanitizePath(r){return r.replace(/\/\//g,"/")}static closestCommonParent(r,e){let t=this.parents(r).reverse().concat([r]),n=this.parents(e).reverse().concat([e]),s=Math.min(t.length,n.length),i=null;for(let o=0;o<s;o++)t[o].graphNodeId()==n[o].graphNodeId()&&(i=t[o]);return i}static parents(r){let e=[],t=r.parent();for(;t;)e.push(t),t=t.parent();return e}static distanceToParent(r,e){let t=0,n=r,s=e.graphNodeId();for(;n&&n.graphNodeId()!=s;)t+=1,n=n.parent();return n&&n.graphNodeId()==s?t:-1}static makeAbsolutePath(r,e){if(e[0]==vt.SEPARATOR)return e;let t=e.split(vt.SEPARATOR),n=t.shift();if(n)switch(n){case"..":{let s=r.parent();return s?s==r.scene().root()?vt.SEPARATOR+t.join(vt.SEPARATOR):this.makeAbsolutePath(s,t.join(vt.SEPARATOR)):null}case".":return this.makeAbsolutePath(r,t.join(vt.SEPARATOR));default:return[r.path(),e].join(vt.SEPARATOR)}else return r.path()}},Qe=vt;Qe.SEPARATOR="/";Qe.DOT=".";Qe.CURRENT=vt.DOT;Qe.PARENT="..";Qe.CURRENT_WITH_SLASH=`${vt.CURRENT}/`;Qe.PARENT_WITH_SLASH=`${vt.PARENT}/`;Qe.NON_LETTER_PREFIXES=[vt.SEPARATOR,vt.DOT];var j_=class{constructor(e){this.node=e,this._parent=null}parent(){return this._parent}setParent(e){e!=this.node.parentController.parent()&&(this._parent=e,this._parent&&this.node.nameController.requestNameToParent(this.node.name()))}firstAncestorWithContext(e){return this._parent?this._parent.context()==e?this._parent:this._parent.parentController.firstAncestorWithContext(e):null}findParent(e){return this._parent?e(this._parent)==!0?this._parent:this._parent.parentController.findParent(e):null}path(e){let t=Qe.SEPARATOR;if(this._parent!=null){if(this._parent==e)return this.node.name();{let n=this._parent.path(e);return n===t?n+this.node.name():n+t+this.node.name()}}else return t}onSetParent(){if(this._on_set_parent_hooks)for(let e of this._on_set_parent_hooks)e()}findNode(e){if(e==null)return null;if(e==Qe.CURRENT||e==Qe.CURRENT_WITH_SLASH)return this.node;if(e==Qe.PARENT||e==Qe.PARENT_WITH_SLASH)return this.node.parent();let t=Qe.SEPARATOR;if(e===t)return this.node.scene().root();if(e[0]===t)return e=e.substring(1,e.length),this.node.scene().root().node(e);if(e.split){let n=e.split(t);if(n.length===1){let s=n[0];return this.node.childrenController?this.node.childrenController.childByName(s):null}else return Qe.findNode(this.node,e)}else return console.error("unexpected path given:",e),null}};var Wn=class{static toArray(e){let t=[];return e.forEach(n=>{t.push(n)}),t}static fromArray(e){let t=new Set;for(let n of e)t.add(n);return t}static union(e,t){let n=new Set;return e.forEach(s=>n.add(s)),t.forEach(s=>n.add(s)),n}static intersection(e,t){let n=new Set;return e.forEach(s=>{t.has(s)&&n.add(s)}),t.forEach(s=>{e.has(s)&&n.add(s)}),n}static difference(e,t){let n=new Set;return e.forEach(s=>{t.has(s)||n.add(s)}),t.forEach(s=>{e.has(s)||n.add(s)}),n}};var Ce=class{static shallowClone(e){return[...e]}static min(e){let t=e[0];for(let n of e)n<t&&(t=n);return t}static max(e){let t=e[0];for(let n of e)n>t&&(t=n);return t}static sum(e){let t=0;for(let n of e)t+=n;return t}static compact(e){let t=[];for(let n of e)n!=null&&t.push(n);return t}static uniq(e){let t=[];for(let n of e)t.includes(n)||t.push(n);return t}static uniqWithoutPreservingOrder(e){return Wn.toArray(Wn.fromArray(e))}static chunk(e,t){let n=[],s=[];n.push(s);for(let i=0;i<e.length;i++)s.length==t&&(s=[],n.push(s)),s.push(e[i]);return n}static union(e,t){let n=[];return Wn.union(this.toSet(e),this.toSet(t)).forEach(i=>n.push(i)),n}static intersection(e,t){let n=[];return Wn.intersection(this.toSet(e),this.toSet(t)).forEach(i=>n.push(i)),n}static difference(e,t){let n=[];return Wn.difference(this.toSet(e),this.toSet(t)).forEach(i=>n.push(i)),n}static toSet(e){let t=new Set;for(let n of e)t.add(n);return t}static isEqual(e,t){if(e.length!=t.length)return!1;let n=e.length;for(let s=0;s<n;s++)if(e[s]!=t[s])return!1;return!0}static sortBy(e,t){if(e.length==0)return[];let n=new Map,s=new Set;for(let c of e){let l=t(c);s.add(l),je.pushOnArrayAtEntry(n,l,c)}let i=new Array(s.size),o=0;s.forEach(c=>{i[o]=c,o++}),q.isString(i[0])?i.sort():i.sort((c,l)=>c-l);let a=new Array(e.length);o=0;for(let c of i){let l=n.get(c);if(l)for(let u of l)a[o]=u,o++}return a}static range(e,t,n=1){t==null&&(t=e,e=0);let s=Math.floor((t-e)/n),i=new Array(s);for(let o=0;o<i.length;o++)i[o]=e+o*n;return i}};var LW=/[, ]/,GC=/\d+$/,BW=/^0+/,kW=/,| /,FW="0",UW=" ",zW=/^-?\d+\.?\d*$/;var Ae=class{static isBoolean(e){return e=="true"||e=="false"}static toBoolean(e){return e=="true"}static isNumber(e){return zW.test(e)}static tailDigits(e){let t=e.match(GC);return t?parseInt(t[0]):0}static increment(e){let t=e.match(GC);if(t){let n=t[0],s="",i=n.match(BW);i&&(s=i[0]);let o=parseInt(n);return o==0&&s.length>0&&s[s.length-1]==FW&&(s=s.slice(0,-1)),`${e.substring(0,e.length-t[0].length)}${s}${o+1}`}else return`${e}1`}static pluralize(e){return e[e.length-1]!=="s"?`${e}s`:e}static camelCase(e){let t=e.replace(/_/g," ").split(" "),n="";for(let s=0;s<t.length;s++){let i=t[s].toLowerCase();s>0&&(i=this.upperFirst(i)),n+=i}return n}static upperFirst(e){return e[0].toUpperCase()+e.substring(1)}static titleize(e){return e.split(/\s|_/g).map(s=>this.upperFirst(s)).join(" ")}static precision(e,t=2){t=Math.max(t,0);let n=`${e}`.split(".");if(t<=0)return n[0];let s=n[1];if(s!==void 0)return s.length>t&&(s=s.substring(0,t)),s=s.padEnd(t,"0"),`${n[0]}.${s}`;{let i=`${e}.`,o=i.length+t;return i.padEnd(o,"0")}}static ensureFloat(e){let t=`${e}`;return t.indexOf(".")>=0?t:`${t}.0`}static ensureInteger(e){let t=`${e}`;return t.indexOf(".")>=0?t.split(".")[0]:t}static matchMask(e,t){if(t==="*"||e==t)return!0;let n=t.split(UW),s=n.filter(o=>o.startsWith("^")).map(o=>o.substring(1));for(let o of s)if(this.matchMask(e,o))return!1;if(n.length>1){for(let o of n)if(this.matchMask(e,o))return!0;return!1}return t=t.split("*").join(".*"),t=`^${t}$`,new RegExp(t).test(e)}static matchesOneMask(e,t){let n=!1;for(let s of t)Ae.matchMask(e,s)&&(n=!0);return n}static attribNames(e){return Ce.uniq(e.split(LW).map(t=>t.trim()).filter(t=>t.length>0))}static indices(e){let t=e.split(kW);if(t.length>1){let n=t.flatMap(s=>this.indices(s));return Ce.uniq(n).sort((s,i)=>s-i)}else{let n=t[0];if(n){let s="-";if(n.indexOf(s)>0){let i=n.split(s);return Ce.range(parseInt(i[0]),parseInt(i[1])+1)}else{let i=parseInt(n);return q.isNumber(i)?[i]:[]}}else return[]}}static escapeLineBreaks(e){return e.replace(/(\r\n|\n|\r)/gm,"\\n")}static sanitizeName(e){return e=e.replace(/[^A-Za-z0-9]/g,"_"),e=e.replace(/^[0-9]/,"_"),e}};var $_=class{constructor(e){this._node=e,this._node_ids=[],this._json=[]}node(){return this._node}nodes(){return this._node.scene().graph.nodesFromIds(this._node_ids)}contains(e){return this._node_ids.includes(e.graphNodeId())}equals(e){let t=e.map(n=>n.graphNodeId()).sort();return Ce.isEqual(t,this._node_ids)}clear(){this._node_ids=[],this.send_update_event()}set(e){this._node_ids=[],this.add(e)}add(e){let t=e.map(n=>n.graphNodeId());this._node_ids=Ce.union(this._node_ids,t),this.send_update_event()}remove(e){let t=e.map(n=>n.graphNodeId());this._node_ids=Ce.difference(this._node_ids,t),this.send_update_event()}send_update_event(){this._node.emit(pt.SELECTION_UPDATED)}toJSON(){return this._json=this._json||[],this._json=this._node_ids.map(e=>e),this._json}};var Tt=(r=>(r.ALWAYS="always",r.NEVER="never",r.FROM_NODE="from_node",r))(Tt||{});var Bn=class{static unreachable(e){throw new Error("Didn't expect to get here")}};var X_=class{constructor(e){this.inputs_controller=e,this._clone_required_states=[],this._overridden=!1}initInputsClonedState(e){q.isArray(e)?this._cloned_states=e:this._cloned_state=e,this._update_clone_required_state()}override_cloned_state_allowed(){if(this._cloned_states){for(let e of this._cloned_states)if(e==Tt.FROM_NODE)return!0}return this._cloned_state?this._cloned_state==Tt.FROM_NODE:!1}clone_required_state(e){return this._clone_required_states[e]}clone_required_states(){return this._clone_required_states}_get_clone_required_state(e){let t=this._cloned_states;if(t){let n=t[e];if(n!=null)return this.clone_required_from_state(n)}return this._cloned_state?this.clone_required_from_state(this._cloned_state):!0}clone_required_from_state(e){switch(e){case Tt.ALWAYS:return!0;case Tt.NEVER:return!1;case Tt.FROM_NODE:return!this._overridden}return Bn.unreachable(e)}override_cloned_state(e){this._overridden=e,this._update_clone_required_state()}overriden(){return this._overridden}_update_clone_required_state(){if(this._cloned_states){let e=[];for(let t=0;t<this._cloned_states.length;t++)e[t]=this._get_clone_required_state(t);this._clone_required_states=e;return}if(this._cloned_state){let e=this.inputs_controller.inputsCount(),t=[];for(let n=0;n<e;n++)t[n]=this._get_clone_required_state(n);this._clone_required_states=t;return}}};var Y_=class{constructor(e){this.operationContainer=e}inputsCount(){return this.operationContainer.inputsCount()}initInputsClonedState(e){this._clonedStatesController||(this._clonedStatesController=new X_(this),this._clonedStatesController.initInputsClonedState(e))}cloneRequired(e){var t;let n=(t=this._clonedStatesController)==null?void 0:t.clone_required_state(e);return n??!0}override_cloned_state(e){var t;(t=this._clonedStatesController)==null||t.override_cloned_state(e)}};var Z_=class{constructor(e,t,n){this.operation=e,this.name=t,this.params={},this._applyDefaultParams(),this._applyInitParams(n),this._initClonedStates()}pathParamResolveRequired(){return this._path_params!=null}resolvePathParams(e){if(!!this._path_params)for(let t of this._path_params)t.resolve(e)}_applyDefaultParams(){let e=this.operation.constructor.DEFAULT_PARAMS,t=Object.keys(e);for(let n of t){let s=e[n],i=this._convertParamData(n,s);i!=null&&(this.params[n]=i)}}_applyInitParams(e){let t=Object.keys(e);for(let n of t){let s=e[n];if(s.simple_data!=null){let i=s.simple_data,o=this.operation.convertExportParamData({paramName:n,paramData:i,params:this.params});o!=null&&(this.params[n]=o)}}}_convertParamData(e,t){if(q.isNumber(t)||q.isBoolean(t)||q.isString(t))return t;if(t instanceof Rr){let n=t.clone();return this._path_params||(this._path_params=[]),this._path_params.push(n),n}if(t instanceof ae||t instanceof G||t instanceof A||t instanceof Se)return t.clone()}setInput(e,t){this._inputs=this._inputs||[],this._inputs[e]=t}inputsCount(){return this._inputs?this._inputs.length:0}inputsController(){return this._inputsController=this._inputsController||new Y_(this)}_initClonedStates(){let e=this.operation.constructor.INPUT_CLONED_STATE;this.inputsController().initInputsClonedState(e)}inputCloneRequired(e){return this._inputsController?this._inputsController.cloneRequired(e):!0}overrideInputCloneState(e){this.inputsController().override_cloned_state(e)}cook(e){return this.operation.cook(e,this.params)}};var J_=class extends Z_{constructor(e,t,n){super(e,t,n);this.operation=e,this.name=t,this.init_params=n,this._inputs=[],this._currentInputIndex=0,this._dirty=!0}operationType(){return this.operation.type()}addInput(e){super.setInput(this._currentInputIndex,e),this.incrementInputIndex()}incrementInputIndex(){this._currentInputIndex++}currentInputIndex(){return this._currentInputIndex}setDirty(){if(!this._dirty){this._computeResult=void 0;for(let e=0;e<this._inputs.length;e++)this._inputs[e].setDirty()}}async compute(e,t){if(this._computeResult)return this._computeResult;let n=[],s=t.get(this);s&&s.forEach((o,a)=>{n[a]=e[o]});for(let o=0;o<this._inputs.length;o++){let c=await this._inputs[o].compute(e,t);c&&(this.inputCloneRequired(o)&&(c=c.clone()),n[o]=c)}let i=this.operation.cook(n,this.params);return i?i instanceof Promise?this._computeResult=await i:this._computeResult=i:this._computeResult=void 0,this._dirty=!1,this._computeResult}};var xl=class{constructor(e){this.node=e,this._graphNode=new Rt(e.scene(),"nodeNameController")}dispose(){this._graphNode.dispose(),this._onSetNameHooks=void 0,this._onSetFullPathHooks=void 0}graphNode(){return this._graphNode}static baseName(e){let t=e.type(),n=t[t.length-1];return q.isNaN(parseInt(n))||(t+="_"),`${t}1`}requestNameToParent(e){let t=this.node.parent();t&&t.childrenAllowed()&&t.childrenController?t.childrenController.setChildName(this.node,e):console.warn("requestNameToParent failed, no parent found")}setName(e){e!=this.node.name()&&this.requestNameToParent(e)}updateNameFromParent(e){var t;if(this.node._setCoreName(e),this._postSetName(),this.runPostSetFullPathHooks(),this.node.childrenAllowed()){let n=(t=this.node.childrenController)==null?void 0:t.children();if(n)for(let s of n)s.nameController.runPostSetFullPathHooks()}this.node.lifecycle.creationCompleted()&&this.node.scene().loadingController.loaded()&&(this.node.scene().missingExpressionReferencesController.checkForMissingNodeReferences(this.node),this.node.scene().expressionsController.regenerateReferringExpressions(this.node)),this.node.scene().referencesController.notifyNameUpdated(this.node),this.node.emit(pt.NAME_UPDATED)}add_post_set_name_hook(e){this._onSetNameHooks=this._onSetNameHooks||[],this._onSetNameHooks.push(e)}add_post_set_fullPath_hook(e){this._onSetFullPathHooks=this._onSetFullPathHooks||[],this._onSetFullPathHooks.push(e)}_postSetName(){if(this._onSetNameHooks)for(let e of this._onSetNameHooks)e()}runPostSetFullPathHooks(){if(this._onSetFullPathHooks)for(let e of this._onSetFullPathHooks)e()}};var K_=class{constructor(e,t){this.node=e,this._context=t,this._childrenByName=new Map,this._childrenByType=new Map,this._childrenAndGrandchildrenByContext=new Map}get selection(){return this._selection=this._selection||new $_(this.node)}dispose(){let e=this.children();for(let t of e)this.node.removeNode(t);this._selection=void 0}get context(){return this._context}setOutputNodeFindMethod(e){this._output_node_find_method=e}outputNode(){if(this._output_node_find_method)return this._output_node_find_method()}setChildName(e,t){let n;if(t=Ae.sanitizeName(t),(n=this._childrenByName.get(t))!=null)return e.name()===t&&n.graphNodeId()===e.graphNodeId()?void 0:(t=Ae.increment(t),this.setChildName(e,t));{let s=e.name();this._childrenByName.get(s)&&this._childrenByName.delete(s),this._childrenByName.set(t,e),e.nameController.updateNameFromParent(t),this._addToNodesByType(e),this.node.scene().nodesController.addToInstanciatedNode(e)}}_nextAvailableChildName(e){return e=Ae.sanitizeName(e),this._childrenByName.get(e)?this._nextAvailableChildName(Ae.increment(e)):e}nodeContextSignature(){return`${this.node.context()}/${this.node.type()}`}availableChildrenClasses(){return ie.registeredNodes(this.node)}isValidChildType(e){return this.availableChildrenClasses()[e]!=null}createNode(e,t){if(typeof e=="string"){let n=this._findNodeClass(e);return this._createAndInitNode(n,t)}else return this._createAndInitNode(e,t)}_createAndInitNode(e,t){let n=(t==null?void 0:t.nodeName)||xl.baseName(e),s=this._nextAvailableChildName(n),i=new e(this.node.scene(),s,t);return i.initializeBaseAndNode(),this._addNode(i),i.lifecycle.setCreationCompleted(),i}_findNodeClass(e){let t=this.availableChildrenClasses()[e.toLowerCase()];if(t==null){let n=`child node type '${e}' not found for node '${this.node.path()}'. Available types are: ${Object.keys(this.availableChildrenClasses()).join(", ")}, ${this._context}, ${this.node.type()}`;throw console.error(n),n}return t}createOperationContainer(e,t,n){let s=ie.registeredOperation(this._context,e);if(s==null){let i=`no operation found with context ${this._context}/${e}`;throw console.error(i),i}else{let i=new s(this.node.scene());return new J_(i,t,(n==null?void 0:n.paramsInitValueOverrides)||{})}}_addNode(e){if(e.setParent(this.node),e.params.init(),e.parentController.onSetParent(),e.nameController.runPostSetFullPathHooks(),e.childrenAllowed()&&e.childrenController)for(let t of e.childrenController.children())t.nameController.runPostSetFullPathHooks();return this.node.emit(pt.CREATED,{child_node_json:e.toJSON()}),this.node.scene().lifecycleController.onAfterCreatedCallbackAllowed()&&e.lifecycle.runOnAfterCreatedCallbacks(),e.lifecycle.runOnAfterAddedCallbacks(),this.node.lifecycle.runOnChildAddCallbacks(e),e.require_webgl2()&&this.node.scene().webgl_controller.set_require_webgl2(),this.node.scene().missingExpressionReferencesController.checkForMissingNodeReferences(e),e}removeNode(e){if(e.parent()!=this.node)return console.warn(`node ${e.name()} not under parent ${this.node.path()}`);{e.lifecycle.runOnBeforeDeleteCallbacks(),this.selection.contains(e)&&this.selection.remove([e]);let t=e.io.connections.firstInputConnection(),n=e.io.connections.inputConnections(),s=e.io.connections.outputConnections();if(n)for(let i of n)i&&i.disconnect({setInput:!0});if(s){for(let i of s)if(i&&(i.disconnect({setInput:!0}),t)){let o=t.node_src,a=i.output_index,c=i.node_dest,l=i.input_index;c.io.inputs.setInput(l,o,a)}}e.setParent(null),this._childrenByName.delete(e.name()),this._removeFromNodesByType(e),this.node.scene().nodesController.removeFromInstanciatedNode(e),e.setSuccessorsDirty(this.node),e.graphDisconnectSuccessors(),this.node.lifecycle.runOnChildRemoveCallbacks(e),e.lifecycle.runOnDeleteCallbacks(),e.dispose(),e.emit(pt.DELETED,{parent_id:this.node.graphNodeId()})}}_addToNodesByType(e){let t=e.graphNodeId(),n=e.type();je.addToSetAtEntry(this._childrenByType,n,t),this._addToChildrenAndGrandchildrenByContext(e)}_removeFromNodesByType(e){let t=e.graphNodeId(),n=e.type();je.removeFromSetAtEntry(this._childrenByType,n,t),this._removeFromChildrenAndGrandchildrenByContext(e)}_addToChildrenAndGrandchildrenByContext(e){var t;let n=e.graphNodeId(),s=e.context();je.addToSetAtEntry(this._childrenAndGrandchildrenByContext,s,n);let i=this.node.parent();i&&i.childrenAllowed()&&((t=i.childrenController)==null||t._addToChildrenAndGrandchildrenByContext(e))}_removeFromChildrenAndGrandchildrenByContext(e){var t;let n=e.graphNodeId(),s=e.context();je.removeFromSetAtEntry(this._childrenAndGrandchildrenByContext,s,n);let i=this.node.parent();i&&i.childrenAllowed()&&((t=i.childrenController)==null||t._removeFromChildrenAndGrandchildrenByContext(e))}nodesByType(e){let t=this._childrenByType.get(e);if(!t)return[];let n=this.node.scene().graph,s=[];for(let i of t){let o=n.nodeFromId(i);o&&s.push(o)}return s}childByName(e){return this._childrenByName.get(e)||null}hasChildrenAndGrandchildrenWithContext(e){return this._childrenAndGrandchildrenByContext.get(e)!=null}children(){let e=[];return this._childrenByName.forEach(t=>{e.push(t)}),e}childrenNames(){let e=[];return this._childrenByName.forEach((t,n)=>{e.push(n)}),e}traverseChildren(e){this._childrenByName.forEach(t=>{var n;e(t),(n=t.childrenController)==null||n.traverseChildren(e)})}};var Q_=class{constructor(e){this.node=e,this._creationCompleted=!1}dispose(){this._onChildAddCallbacks=void 0,this._onChildRemoveCallbacks=void 0,this._onAfterCreatedCallbacks=void 0,this._onAfterAddedCallbacks=void 0,this._onBeforeDeletedCallbacks=void 0,this._onAfterDeletedCallbacks=void 0}setCreationCompleted(){this._creationCompleted||(this._creationCompleted=!0)}creationCompleted(){return this.node.scene().loadingController.loaded()&&this._creationCompleted}onChildAdd(e){this._onChildAddCallbacks=this._onChildAddCallbacks||[],this._onChildAddCallbacks.push(e)}runOnChildAddCallbacks(e){this._runCallbacksWithChildNode(this._onChildAddCallbacks,e)}onChildRemove(e){this._onChildRemoveCallbacks=this._onChildRemoveCallbacks||[],this._onChildRemoveCallbacks.push(e)}runOnChildRemoveCallbacks(e){this._runCallbacksWithChildNode(this._onChildRemoveCallbacks,e)}onAfterCreated(e){this._onAfterCreatedCallbacks=this._onAfterCreatedCallbacks||[],this._onAfterCreatedCallbacks.push(e)}runOnAfterCreatedCallbacks(){this._runCallbacks(this._onAfterCreatedCallbacks)}onAfterAdded(e){this._onAfterAddedCallbacks=this._onAfterAddedCallbacks||[],this._onAfterAddedCallbacks.push(e)}runOnAfterAddedCallbacks(){this._runCallbacks(this._onAfterAddedCallbacks)}onBeforeDeleted(e){this._onBeforeDeletedCallbacks=this._onBeforeDeletedCallbacks||[],this._onBeforeDeletedCallbacks.push(e)}runOnBeforeDeleteCallbacks(){this._runCallbacks(this._onBeforeDeletedCallbacks)}onAfterDeleted(e){this._onAfterDeletedCallbacks=this._onAfterDeletedCallbacks||[],this._onAfterDeletedCallbacks.push(e)}runOnDeleteCallbacks(){this._runCallbacks(this._onAfterDeletedCallbacks)}_runCallbacks(e){if(!e)return;let t;for(t of e)t()}_runCallbacksWithChildNode(e,t){if(!e)return;let n;for(n of e)n(t)}};var se=(r=>(r.ACTOR="actor",r.ANIM="anim",r.AUDIO="audio",r.COP="cop",r.CSG="csg",r.EVENT="event",r.GL="gl",r.JS="js",r.MANAGER="manager",r.MAT="mat",r.OBJ="obj",r.POST="post",r.ROP="rop",r.SOP="sop",r))(se||{}),vl=(r=>(r.ACTOR="actorsNetwork",r.ANIM="animationsNetwork",r.AUDIO="audioNetwork",r.COP="copNetwork",r.CSG="csgNetwork",r.EVENT="eventsNetwork",r.MAT="materialsNetwork",r.POST="postProcessNetwork",r.ROP="renderersNetwork",r.SUBNET="subnet",r))(vl||{}),Nn=(r=>(r.INPUT="subnetInput",r.OUTPUT="subnetOutput",r))(Nn||{}),ys=(r=>(r.PERSPECTIVE="perspectiveCamera",r.ORTHOGRAPHIC="orthographicCamera",r))(ys||{}),ji=(r=>(r.CONTROLS="cameraControls",r.CSS_RENDERER="cameraCSSRenderer",r.FRAME_MODE="cameraFrameMode",r.POST_PROCESS="cameraPostProcess",r.RENDER_SCENE="cameraRenderScene",r.RENDERER="cameraRenderer",r))(ji||{});var eg=(r=>(r.MAP="cameraMapControls",r.ORBIT="cameraOrbitControls",r.FIRST_PERSON="firstPersonControls",r.PLAYER="playerControls",r.MOBILE_JOYSTICK="mobileJoystickControls",r))(eg||{}),HC=["cameraMapControls","cameraOrbitControls","firstPersonControls","mobileJoystickControls"];var Mt=class{constructor(e){this._node=e}set_node(e){this._node=e}node(){return this._node}set_content(e){this._content=e,this._post_set_content()}has_content(){return this._content!=null}content(){return this._content}_post_set_content(){}coreContent(){return this._content}coreContentCloned(){return this._content}infos(){return[]}};var hd=class extends Mt{set_content(e){super.set_content(e)}setTimelineBuilder(e){return this.set_content(e)}timelineBuilder(){return this.content()}coreContentCloned(){if(this._content)return this._content.clone()}};var tg=class extends Mt{setContent(e){super.set_content(e)}setAudioBuilder(e){return this.set_content(e)}audioBuilder(){return this.content()}coreContentCloned(){if(this._content)return this._content.clone()}};var ng=class extends Mt{set_content(e){super.set_content(e)}};var kn=(r=>(r.OBJECT3D="Object3D",r.GROUP="Group",r.MESH="Mesh",r.POINTS="Points",r.LINE_SEGMENTS="LineSegments",r.LOD="LOD",r))(kn||{}),WC={Mesh:St,Group:Wt,Points:Fi,LineSegments:sr,Object3D:nt,LOD:Hh};function pd(r){switch(r){case nt:return"Object3D";case Wt:return"Group";case St:return"Mesh";case Fi:return"Points";case sr:return"LineSegments";case Hh:return"LOD";default:return"Mesh"}}var dd=["Mesh","Points","LineSegments"],Vme=[{name:"Mesh",value:dd.indexOf("Mesh")},{name:"Points",value:dd.indexOf("Points")},{name:"LineSegments",value:dd.indexOf("LineSegments")}],VW={MeshStandard:new _s({color:16777215,side:tr,metalness:.5,roughness:.9}),Mesh:new _s({color:16777215,side:tr,metalness:0,roughness:.9}),Points:new ba({color:16777215,size:.1,depthTest:!0}),LineSegments:new Ln({color:16777215,linewidth:1})};var qW=["vertex","object","container"],qme=qW.map((r,e)=>({name:r,value:e})),fr=(r=>(r.NUMERIC="numeric",r.STRING="string",r))(fr||{}),GW=["numeric","string"],Gme=GW.map((r,e)=>({name:r,value:e})),Ma=(r=>(r[r.FLOAT=1]="FLOAT",r[r.VECTOR2=2]="VECTOR2",r[r.VECTOR3=3]="VECTOR3",r[r.VECTOR4=4]="VECTOR4",r))(Ma||{});var $i={ATTRIB_CLASS:{VERTEX:"vertex",OBJECT:"object"},OBJECT_TYPES:dd,CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME:{[ms.name]:"Scene",[Wt.name]:"Group",[nt.name]:"Object3D",[St.name]:"Mesh",[Fi.name]:"Points",[sr.name]:"LineSegments",[Wh.name]:"Bone",[ul.name]:"SkinnedMesh"},CONSTRUCTORS_BY_NAME:{Mesh:St,Points:Fi,LineSegments:sr},MATERIALS:VW};var Or=(r=>(r.POINT_INDEX="ptnum",r.OBJECT_INDEX="objnum",r.COLOR="color",r.NORMAL="normal",r.POSITION="position",r.PSCALE="pscale",r.UP="up",r.UV="uv",r.SCALE="scale",r.TANGENT="tangent",r))(Or||{});var HW={P:"position",N:"normal",Cd:"color"},bt=class{static remapName(e){return HW[e]||e}static arrayToIndexedArrays(e){let t={},n=0,s=[],i=[],o=0;for(;o<e.length;){let a=e[o],c=t[a];c!=null?s.push(c):(i.push(a),s.push(n),t[a]=n,n+=1),o++}return{indices:s,values:i}}static default_value(e){switch(e){case 1:return 0;case 2:return new G(0,0);case 3:return new A(0,0,0);default:throw`size ${e} not yet implemented`}}static copy(e,t,n=!0){let s=e==null?void 0:e.array,i=t==null?void 0:t.array;if(s&&i){let o=Math.min(s.length,i.length);for(let a=0;a<o;a++)i[a]=s[a];n&&(t.needsUpdate=!0)}}static attribSizeFromValue(e){if(q.isString(e)||q.isNumber(e))return Ma.FLOAT;if(q.isArray(e))return e.length;switch(e.constructor){case G:return Ma.VECTOR2;case A:return Ma.VECTOR3;case Se:return Ma.VECTOR4}return 0}static attribNamesMatchingMask(e,t){let n=Ae.attribNames(e),s=[];for(let i of n)for(let o of t)if(Ae.matchMask(o,i))s.push(o);else{let a=bt.remapName(i);o==a&&s.push(o)}return Ce.uniq(s)}};var Xi=class{constructor(e){this._index=e}index(){return this._index}};var fd={POSITION:"position",NORMAL:"normal"};var WW={x:0,y:1,z:2,w:3,r:0,g:1,b:2},jW=".",xs=class extends Xi{constructor(e,t){super(t);this._coreGeometry=e,this._geometry=this._coreGeometry.geometry()}applyMatrix4(e){this.position().applyMatrix4(e)}coreGeometry(){return this._coreGeometry}geometry(){return this._geometry=this._geometry||this._coreGeometry.geometry()}attribSize(e){return e=bt.remapName(e),this._geometry.getAttribute(e).itemSize}hasAttrib(e){let t=bt.remapName(e);return this._coreGeometry.hasAttrib(t)}attribValue(e,t){if(e===Or.POINT_INDEX)return this.index();{let n=null,s=null;e[e.length-2]===jW&&(n=e[e.length-1],s=WW[n],e=e.substring(0,e.length-2));let i=bt.remapName(e),o=this._geometry.getAttribute(i);if(o){let{array:a}=o;if(this._coreGeometry.isAttribIndexed(i))return this.indexedAttribValue(i);{let c=o.itemSize,l=this._index*c;if(s==null)switch(c){case 1:return a[l];case 2:return t=t||new G,t.fromArray(a,l),t;break;case 3:return t=t||new A,t.fromArray(a,l),t;break;case 4:return t=t||new Se,t.fromArray(a,l),t;break;default:throw`size not valid (${c})`}else switch(c){case 1:return a[l];default:return a[l+s]}}}else{let a=`attrib ${e} not found. availables are: ${Object.keys(this._geometry.attributes||{}).join(",")}`;throw console.warn(a),a}}}attribValueNumber(e){let t=bt.remapName(e);return this._geometry.getAttribute(t).array[this._index]}attribValueVector2(e,t){let n=bt.remapName(e),s=this._geometry.getAttribute(n);return t.fromArray(s.array,this._index*2),t}attribValueVector3(e,t){let n=bt.remapName(e),s=this._geometry.getAttribute(n);return t.fromArray(s.array,this._index*3),t}attribValueVector4(e,t){let n=bt.remapName(e),s=this._geometry.getAttribute(n);return t.fromArray(s.array,this._index*4),t}indexedAttribValue(e){let t=this.attribValueIndex(e);return this._coreGeometry.userDataAttrib(e)[t]}stringAttribValue(e){return this.indexedAttribValue(e)}attribValueIndex(e){return this._coreGeometry.isAttribIndexed(e)?this._geometry.getAttribute(e).array[this._index]:-1}isAttribIndexed(e){return this._coreGeometry.isAttribIndexed(e)}position(){return this._position||(this._position=this.getPosition(new A))}getPosition(e){let{array:t}=this._geometry.getAttribute(fd.POSITION);return e.fromArray(t,this._index*3)}setPosition(e){this.setAttribValueFromVector3(fd.POSITION,e)}normal(){return this._normal=this._normal||this.getNormal(new A)}getNormal(e){let{array:t}=this._geometry.getAttribute(fd.NORMAL);return e.fromArray(t,this._index*3)}setNormal(e){return this.setAttribValueFromVector3(fd.NORMAL,e)}setAttribValue(e,t){let n=this._geometry.getAttribute(e),s=n.array,i=n.itemSize;if(q.isArray(t)){for(let o=0;o<i;o++)s[this._index*i+o]=t[o];return}switch(i){case 1:s[this._index]=t;break;case 2:let o=t,a=this._index*2;s[a+0]=o.x,s[a+1]=o.y;break;case 3:let c=t.r!=null,l=this._index*3;if(c){let d=t;s[l+0]=d.r,s[l+1]=d.g,s[l+2]=d.b}else{let d=t;s[l+0]=d.x,s[l+1]=d.y,s[l+2]=d.z}break;case 4:let u=t,h=this._index*4;s[h+0]=u.x,s[h+1]=u.y,s[h+2]=u.z,s[h+3]=u.w;break;default:throw console.warn(`Point.set_attrib_value does not yet allow attrib size ${i}`),`attrib size ${i} not implemented`}}setAttribValueFromNumber(e,t){let s=this._geometry.getAttribute(e).array;s[this._index]=t}setAttribValueFromVector2(e,t){let n=this._geometry.getAttribute(e);t.toArray(n.array,this._index*2)}setAttribValueFromVector3(e,t){let n=this._geometry.getAttribute(e);t.toArray(n.array,this._index*3)}setAttribValueFromVector4(e,t){let n=this._geometry.getAttribute(e);t.toArray(n.array,this._index*4)}setAttribIndex(e,t){let n=this._geometry.getAttribute(e).array;return n[this._index]=t}};var md=function(r){return function(e){return Math.pow(e,r)}},_d=function(r){return function(e){return 1-Math.abs(Math.pow(e-1,r))}},rg=function(r){return function(e){return e<.5?md(r)(e*2)/2:_d(r)(e*2-1)/2+.5}};var gd={easeI2:md(2),easeO2:_d(2),easeIO2:rg(2),easeI3:md(3),easeO3:_d(3),easeIO3:rg(3),easeI4:md(4),easeO4:_d(4),easeIO4:rg(4),easeSinI:function(r){return 1+Math.sin(Math.PI/2*r-Math.PI/2)},easeSinO:function(r){return Math.sin(Math.PI/2*r)},easeSinIO:function(r){return(1+Math.sin(Math.PI*r-Math.PI/2))/2},easeElasticI:function(r){return r==0?0:(.04-.04/r)*Math.sin(25*r)+1},easeElasticO:function(r){return r==1?1:.04*r/--r*Math.sin(25*r)},easeElasticIO:function(r){return r==.5?0:(r-=.5)<0?(.02+.01/r)*Math.sin(50*r):(.02-.01/r)*Math.sin(50*r)+1}};var jC=Math.PI/180,$W=12.9898,XW=78.233,YW=43758.5453,Ir=class{static clamp(e,t,n){return e<t?t:e>n?n:e}static fit01(e,t,n){return this.fit(e,0,1,t,n)}static fit(e,t,n,s,i){let o=n-t,a=i-s;return(e-t)/o*a+s}static blend(e,t,n){return(1-n)*e+n*t}static degrees_to_radians(e){return e*jC}static radians_to_degrees(e){return e/jC}static deg2rad(e){return this.degrees_to_radians(e)}static rad2deg(e){return this.radians_to_degrees(e)}static rand(e){return q.isNumber(e)?this.randFloat(e):this.randVec2(e)}static round(e,t){let n=e/t;return(e<0?Math.ceil(n):Math.floor(n))*t}static highest_even(e){return 2*Math.ceil(e*.5)}static randFloat(e,t=136574){return this._vec.x=e,this._vec.y=t,this.randVec2(this._vec)}static randVec2(e){let n=(e.x*$W+e.y*XW)%Math.PI;return this.fract(Math.sin(n)*YW)}static geodesic_distance(e,t){var n=6371e3,s=this.deg2rad(e.lat),i=this.deg2rad(t.lat),o=this.deg2rad(t.lat-e.lat),a=this.deg2rad(t.lng-e.lng),c=Math.sin(o/2)*Math.sin(o/2)+Math.cos(s)*Math.cos(i)*Math.sin(a/2)*Math.sin(a/2),l=2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),u=n*l;return u}static expand_triangle(e,t){e.getMidpoint(this._triangle_mid),this._triangle_mid_to_corner.copy(e.a).sub(this._triangle_mid),this._triangle_mid_to_corner.normalize().multiplyScalar(t),e.a.add(this._triangle_mid_to_corner),this._triangle_mid_to_corner.copy(e.b).sub(this._triangle_mid),this._triangle_mid_to_corner.normalize().multiplyScalar(t),e.b.add(this._triangle_mid_to_corner),this._triangle_mid_to_corner.copy(e.c).sub(this._triangle_mid),this._triangle_mid_to_corner.normalize().multiplyScalar(t),e.c.add(this._triangle_mid_to_corner)}static nearestPower2(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))}static pow2Inverse(e){return Math.log(e)/Math.log(2)}};Ir.Easing=gd;Ir.fract=r=>r-Math.floor(r);Ir._vec={x:0,y:136574};Ir._triangle_mid=new A;Ir._triangle_mid_to_corner=new A;var sg=class{constructor(e,t){this._coreGeometry=e,this._index=t,this._geometry=this._coreGeometry.geometry()}index(){return this._index}points(){return this._points=this._points||this._get_points()}applyMatrix4(e){for(let t of this.points())t.applyMatrix4(e)}_get_points(){var e;let t=((e=this._geometry.index)==null?void 0:e.array)||[],n=this._index*3;return[new xs(this._coreGeometry,t[n+0]),new xs(this._coreGeometry,t[n+1]),new xs(this._coreGeometry,t[n+2])]}positions(){return this._positions=this._positions||this._getPositions()}_getPositions(){let e=this.points();return[e[0].position(),e[1].position(),e[2].position()]}triangle(){return this._triangle=this._triangle||this._get_triangle()}_get_triangle(){let e=this.positions();return new Ct(e[0],e[1],e[2])}deltas(){return this._deltas=this._deltas||this._getDeltas()}_getDeltas(){let e=this.positions();return[e[1].clone().sub(e[0]),e[2].clone().sub(e[0])]}area(){return this.triangle().getArea()}center(e){let t=this.positions();return e.x=(t[0].x+t[1].x+t[2].x)/3,e.y=(t[0].y+t[1].y+t[2].y)/3,e.z=(t[0].z+t[1].z+t[2].z)/3,e}randomPosition(e){let t=[Ir.randFloat(e),Ir.randFloat(e*6541)];return t[0]+t[1]>1&&(t[0]=1-t[0],t[1]=1-t[1]),this.positions()[0].clone().add(this.deltas()[0].clone().multiplyScalar(t[0])).add(this.deltas()[1].clone().multiplyScalar(t[1]))}attribValueAtPosition(e,t){let n=new A;this.triangle().getBarycoord(t,n);let s=n.toArray(),o=this._geometry.attributes[e].itemSize,a=this.points().map(h=>h.attribValue(e)),c,l,u=0;switch(o){case 1:{l=0;for(let h of a)l+=h*s[u],u++;c=l;break}default:{for(let h of a){let d=h.multiplyScalar(s[u]);l?l.add(d):l=d,u++}c=l}}return c}static interpolatedValue(e,t,n,s){let i=[t.a,t.b,t.c],a=e.getAttribute("position").array,c=i.map(g=>new A(a[g*3+0],a[g*3+1],a[g*3+2])),l=s.itemSize,u=s.array,h=[];switch(l){case 1:h=i.map(g=>u[g]);break;case 2:h=i.map(g=>new G(u[g*2+0],u[g*2+1]));break;case 3:h=i.map(g=>new A(u[g*3+0],u[g*3+1],u[g*3+2]));break}let d=i.map((g,x)=>n.distanceTo(c[x])),p=Ce.sum([d[0]*d[1],d[0]*d[2],d[1]*d[2]]),_=[d[1]*d[2]/p,d[0]*d[2]/p,d[0]*d[1]/p],f;switch(l){case 1:f=Ce.sum(i.map((g,x)=>_[x]*h[x]));break;default:var m=i.map((g,x)=>h[x].multiplyScalar(_[x]));f=null;for(let g of m)f?f.add(g):f=g}return f}};function ZW(){this.__data__=[],this.size=0}var $C=ZW;function JW(r,e){return r===e||r!==r&&e!==e}var yd=JW;function KW(r,e){for(var t=r.length;t--;)if(yd(r[t][0],e))return t;return-1}var ei=KW;var QW=Array.prototype,e8=QW.splice;function t8(r){var e=this.__data__,t=ei(e,r);if(t<0)return!1;var n=e.length-1;return t==n?e.pop():e8.call(e,t,1),--this.size,!0}var XC=t8;function n8(r){var e=this.__data__,t=ei(e,r);return t<0?void 0:e[t][1]}var YC=n8;function r8(r){return ei(this.__data__,r)>-1}var ZC=r8;function s8(r,e){var t=this.__data__,n=ei(t,r);return n<0?(++this.size,t.push([r,e])):t[n][1]=e,this}var JC=s8;function Pa(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Pa.prototype.clear=$C;Pa.prototype.delete=XC;Pa.prototype.get=YC;Pa.prototype.has=ZC;Pa.prototype.set=JC;var ti=Pa;function i8(){this.__data__=new ti,this.size=0}var KC=i8;function o8(r){var e=this.__data__,t=e.delete(r);return this.size=e.size,t}var QC=o8;function a8(r){return this.__data__.get(r)}var eS=a8;function c8(r){return this.__data__.has(r)}var tS=c8;var l8=typeof global=="object"&&global&&global.Object===Object&&global,xd=l8;var u8=typeof self=="object"&&self&&self.Object===Object&&self,h8=xd||u8||Function("return this")(),rn=h8;var d8=rn.Symbol,vs=d8;var nS=Object.prototype,p8=nS.hasOwnProperty,f8=nS.toString,bl=vs?vs.toStringTag:void 0;function m8(r){var e=p8.call(r,bl),t=r[bl];try{r[bl]=void 0;var n=!0}catch{}var s=f8.call(r);return n&&(e?r[bl]=t:delete r[bl]),s}var rS=m8;var _8=Object.prototype,g8=_8.toString;function y8(r){return g8.call(r)}var sS=y8;var x8="[object Null]",v8="[object Undefined]",iS=vs?vs.toStringTag:void 0;function b8(r){return r==null?r===void 0?v8:x8:iS&&iS in Object(r)?rS(r):sS(r)}var bs=b8;function w8(r){var e=typeof r;return r!=null&&(e=="object"||e=="function")}var jr=w8;var E8="[object AsyncFunction]",C8="[object Function]",S8="[object GeneratorFunction]",A8="[object Proxy]";function T8(r){if(!jr(r))return!1;var e=bs(r);return e==C8||e==S8||e==E8||e==A8}var Na=T8;var M8=rn["__core-js_shared__"],vd=M8;var oS=function(){var r=/[^.]+$/.exec(vd&&vd.keys&&vd.keys.IE_PROTO||"");return r?"Symbol(src)_1."+r:""}();function P8(r){return!!oS&&oS in r}var aS=P8;var N8=Function.prototype,R8=N8.toString;function O8(r){if(r!=null){try{return R8.call(r)}catch{}try{return r+""}catch{}}return""}var ws=O8;var I8=/[\\^$.*+?()[\]{}|]/g,D8=/^\[object .+?Constructor\]$/,L8=Function.prototype,B8=Object.prototype,k8=L8.toString,F8=B8.hasOwnProperty,U8=RegExp("^"+k8.call(F8).replace(I8,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function z8(r){if(!jr(r)||aS(r))return!1;var e=Na(r)?U8:D8;return e.test(ws(r))}var cS=z8;function V8(r,e){return r==null?void 0:r[e]}var lS=V8;function q8(r,e){var t=lS(r,e);return cS(t)?t:void 0}var jn=q8;var G8=jn(rn,"Map"),ni=G8;var H8=jn(Object,"create"),Es=H8;function W8(){this.__data__=Es?Es(null):{},this.size=0}var uS=W8;function j8(r){var e=this.has(r)&&delete this.__data__[r];return this.size-=e?1:0,e}var hS=j8;var $8="__lodash_hash_undefined__",X8=Object.prototype,Y8=X8.hasOwnProperty;function Z8(r){var e=this.__data__;if(Es){var t=e[r];return t===$8?void 0:t}return Y8.call(e,r)?e[r]:void 0}var dS=Z8;var J8=Object.prototype,K8=J8.hasOwnProperty;function Q8(r){var e=this.__data__;return Es?e[r]!==void 0:K8.call(e,r)}var pS=Q8;var ej="__lodash_hash_undefined__";function tj(r,e){var t=this.__data__;return this.size+=this.has(r)?0:1,t[r]=Es&&e===void 0?ej:e,this}var fS=tj;function Ra(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Ra.prototype.clear=uS;Ra.prototype.delete=hS;Ra.prototype.get=dS;Ra.prototype.has=pS;Ra.prototype.set=fS;var ig=Ra;function nj(){this.size=0,this.__data__={hash:new ig,map:new(ni||ti),string:new ig}}var mS=nj;function rj(r){var e=typeof r;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?r!=="__proto__":r===null}var _S=rj;function sj(r,e){var t=r.__data__;return _S(e)?t[typeof e=="string"?"string":"hash"]:t.map}var ri=sj;function ij(r){var e=ri(this,r).delete(r);return this.size-=e?1:0,e}var gS=ij;function oj(r){return ri(this,r).get(r)}var yS=oj;function aj(r){return ri(this,r).has(r)}var xS=aj;function cj(r,e){var t=ri(this,r),n=t.size;return t.set(r,e),this.size+=t.size==n?0:1,this}var vS=cj;function Oa(r){var e=-1,t=r==null?0:r.length;for(this.clear();++e<t;){var n=r[e];this.set(n[0],n[1])}}Oa.prototype.clear=mS;Oa.prototype.delete=gS;Oa.prototype.get=yS;Oa.prototype.has=xS;Oa.prototype.set=vS;var bS=Oa;var lj=200;function uj(r,e){var t=this.__data__;if(t instanceof ti){var n=t.__data__;if(!ni||n.length<lj-1)return n.push([r,e]),this.size=++t.size,this;t=this.__data__=new bS(n)}return t.set(r,e),this.size=t.size,this}var wS=uj;function Ia(r){var e=this.__data__=new ti(r);this.size=e.size}Ia.prototype.clear=KC;Ia.prototype.delete=QC;Ia.prototype.get=eS;Ia.prototype.has=tS;Ia.prototype.set=wS;var ES=Ia;function hj(r,e){for(var t=-1,n=r==null?0:r.length;++t<n&&e(r[t],t,r)!==!1;);return r}var CS=hj;var dj=function(){try{var r=jn(Object,"defineProperty");return r({},"",{}),r}catch{}}(),og=dj;function pj(r,e,t){e=="__proto__"&&og?og(r,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):r[e]=t}var bd=pj;var fj=Object.prototype,mj=fj.hasOwnProperty;function _j(r,e,t){var n=r[e];(!(mj.call(r,e)&&yd(n,t))||t===void 0&&!(e in r))&&bd(r,e,t)}var wd=_j;function gj(r,e,t,n){var s=!t;t||(t={});for(var i=-1,o=e.length;++i<o;){var a=e[i],c=n?n(t[a],r[a],a,t,r):void 0;c===void 0&&(c=r[a]),s?bd(t,a,c):wd(t,a,c)}return t}var si=gj;function yj(r,e){for(var t=-1,n=Array(r);++t<r;)n[t]=e(t);return n}var SS=yj;function xj(r){return r!=null&&typeof r=="object"}var $r=xj;var vj="[object Arguments]";function bj(r){return $r(r)&&bs(r)==vj}var ag=bj;var AS=Object.prototype,wj=AS.hasOwnProperty,Ej=AS.propertyIsEnumerable,Cj=ag(function(){return arguments}())?ag:function(r){return $r(r)&&wj.call(r,"callee")&&!Ej.call(r,"callee")},TS=Cj;var Sj=Array.isArray,Da=Sj;function Aj(){return!1}var MS=Aj;var RS=typeof exports=="object"&&exports&&!exports.nodeType&&exports,PS=RS&&typeof module=="object"&&module&&!module.nodeType&&module,Tj=PS&&PS.exports===RS,NS=Tj?rn.Buffer:void 0,Mj=NS?NS.isBuffer:void 0,Pj=Mj||MS,Ed=Pj;var Nj=9007199254740991,Rj=/^(?:0|[1-9]\d*)$/;function Oj(r,e){var t=typeof r;return e=e??Nj,!!e&&(t=="number"||t!="symbol"&&Rj.test(r))&&r>-1&&r%1==0&&r<e}var OS=Oj;var Ij=9007199254740991;function Dj(r){return typeof r=="number"&&r>-1&&r%1==0&&r<=Ij}var Cd=Dj;var Lj="[object Arguments]",Bj="[object Array]",kj="[object Boolean]",Fj="[object Date]",Uj="[object Error]",zj="[object Function]",Vj="[object Map]",qj="[object Number]",Gj="[object Object]",Hj="[object RegExp]",Wj="[object Set]",jj="[object String]",$j="[object WeakMap]",Xj="[object ArrayBuffer]",Yj="[object DataView]",Zj="[object Float32Array]",Jj="[object Float64Array]",Kj="[object Int8Array]",Qj="[object Int16Array]",e7="[object Int32Array]",t7="[object Uint8Array]",n7="[object Uint8ClampedArray]",r7="[object Uint16Array]",s7="[object Uint32Array]",Dt={};Dt[Zj]=Dt[Jj]=Dt[Kj]=Dt[Qj]=Dt[e7]=Dt[t7]=Dt[n7]=Dt[r7]=Dt[s7]=!0;Dt[Lj]=Dt[Bj]=Dt[Xj]=Dt[kj]=Dt[Yj]=Dt[Fj]=Dt[Uj]=Dt[zj]=Dt[Vj]=Dt[qj]=Dt[Gj]=Dt[Hj]=Dt[Wj]=Dt[jj]=Dt[$j]=!1;function i7(r){return $r(r)&&Cd(r.length)&&!!Dt[bs(r)]}var IS=i7;function o7(r){return function(e){return r(e)}}var La=o7;var DS=typeof exports=="object"&&exports&&!exports.nodeType&&exports,wl=DS&&typeof module=="object"&&module&&!module.nodeType&&module,a7=wl&&wl.exports===DS,cg=a7&&xd.process,c7=function(){try{var r=wl&&wl.require&&wl.require("util").types;return r||cg&&cg.binding&&cg.binding("util")}catch{}}(),Cs=c7;var LS=Cs&&Cs.isTypedArray,l7=LS?La(LS):IS,BS=l7;var u7=Object.prototype,h7=u7.hasOwnProperty;function d7(r,e){var t=Da(r),n=!t&&TS(r),s=!t&&!n&&Ed(r),i=!t&&!n&&!s&&BS(r),o=t||n||s||i,a=o?SS(r.length,String):[],c=a.length;for(var l in r)(e||h7.call(r,l))&&!(o&&(l=="length"||s&&(l=="offset"||l=="parent")||i&&(l=="buffer"||l=="byteLength"||l=="byteOffset")||OS(l,c)))&&a.push(l);return a}var Sd=d7;var p7=Object.prototype;function f7(r){var e=r&&r.constructor,t=typeof e=="function"&&e.prototype||p7;return r===t}var Ba=f7;function m7(r,e){return function(t){return r(e(t))}}var Ad=m7;var _7=Ad(Object.keys,Object),kS=_7;var g7=Object.prototype,y7=g7.hasOwnProperty;function x7(r){if(!Ba(r))return kS(r);var e=[];for(var t in Object(r))y7.call(r,t)&&t!="constructor"&&e.push(t);return e}var FS=x7;function v7(r){return r!=null&&Cd(r.length)&&!Na(r)}var Td=v7;function b7(r){return Td(r)?Sd(r):FS(r)}var ka=b7;function w7(r,e){return r&&si(e,ka(e),r)}var US=w7;function E7(r){var e=[];if(r!=null)for(var t in Object(r))e.push(t);return e}var zS=E7;var C7=Object.prototype,S7=C7.hasOwnProperty;function A7(r){if(!jr(r))return zS(r);var e=Ba(r),t=[];for(var n in r)n=="constructor"&&(e||!S7.call(r,n))||t.push(n);return t}var VS=A7;function T7(r){return Td(r)?Sd(r,!0):VS(r)}var Fa=T7;function M7(r,e){return r&&si(e,Fa(e),r)}var qS=M7;var jS=typeof exports=="object"&&exports&&!exports.nodeType&&exports,GS=jS&&typeof module=="object"&&module&&!module.nodeType&&module,P7=GS&&GS.exports===jS,HS=P7?rn.Buffer:void 0,WS=HS?HS.allocUnsafe:void 0;function N7(r,e){if(e)return r.slice();var t=r.length,n=WS?WS(t):new r.constructor(t);return r.copy(n),n}var $S=N7;function R7(r,e){var t=-1,n=r.length;for(e||(e=Array(n));++t<n;)e[t]=r[t];return e}var XS=R7;function O7(r,e){for(var t=-1,n=r==null?0:r.length,s=0,i=[];++t<n;){var o=r[t];e(o,t,r)&&(i[s++]=o)}return i}var YS=O7;function I7(){return[]}var Md=I7;var D7=Object.prototype,L7=D7.propertyIsEnumerable,ZS=Object.getOwnPropertySymbols,B7=ZS?function(r){return r==null?[]:(r=Object(r),YS(ZS(r),function(e){return L7.call(r,e)}))}:Md,Ua=B7;function k7(r,e){return si(r,Ua(r),e)}var JS=k7;function F7(r,e){for(var t=-1,n=e.length,s=r.length;++t<n;)r[s+t]=e[t];return r}var Pd=F7;var U7=Ad(Object.getPrototypeOf,Object),Nd=U7;var z7=Object.getOwnPropertySymbols,V7=z7?function(r){for(var e=[];r;)Pd(e,Ua(r)),r=Nd(r);return e}:Md,Rd=V7;function q7(r,e){return si(r,Rd(r),e)}var KS=q7;function G7(r,e,t){var n=e(r);return Da(r)?n:Pd(n,t(r))}var Od=G7;function H7(r){return Od(r,ka,Ua)}var QS=H7;function W7(r){return Od(r,Fa,Rd)}var eA=W7;var j7=jn(rn,"DataView"),Id=j7;var $7=jn(rn,"Promise"),Dd=$7;var X7=jn(rn,"Set"),Ld=X7;var Y7=jn(rn,"WeakMap"),Bd=Y7;var tA="[object Map]",Z7="[object Object]",nA="[object Promise]",rA="[object Set]",sA="[object WeakMap]",iA="[object DataView]",J7=ws(Id),K7=ws(ni),Q7=ws(Dd),e9=ws(Ld),t9=ws(Bd),Yi=bs;(Id&&Yi(new Id(new ArrayBuffer(1)))!=iA||ni&&Yi(new ni)!=tA||Dd&&Yi(Dd.resolve())!=nA||Ld&&Yi(new Ld)!=rA||Bd&&Yi(new Bd)!=sA)&&(Yi=function(r){var e=bs(r),t=e==Z7?r.constructor:void 0,n=t?ws(t):"";if(n)switch(n){case J7:return iA;case K7:return tA;case Q7:return nA;case e9:return rA;case t9:return sA}return e});var za=Yi;var n9=Object.prototype,r9=n9.hasOwnProperty;function s9(r){var e=r.length,t=new r.constructor(e);return e&&typeof r[0]=="string"&&r9.call(r,"index")&&(t.index=r.index,t.input=r.input),t}var oA=s9;var i9=rn.Uint8Array,lg=i9;function o9(r){var e=new r.constructor(r.byteLength);return new lg(e).set(new lg(r)),e}var Va=o9;function a9(r,e){var t=e?Va(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.byteLength)}var aA=a9;var c9=/\w*$/;function l9(r){var e=new r.constructor(r.source,c9.exec(r));return e.lastIndex=r.lastIndex,e}var cA=l9;var lA=vs?vs.prototype:void 0,uA=lA?lA.valueOf:void 0;function u9(r){return uA?Object(uA.call(r)):{}}var hA=u9;function h9(r,e){var t=e?Va(r.buffer):r.buffer;return new r.constructor(t,r.byteOffset,r.length)}var dA=h9;var d9="[object Boolean]",p9="[object Date]",f9="[object Map]",m9="[object Number]",_9="[object RegExp]",g9="[object Set]",y9="[object String]",x9="[object Symbol]",v9="[object ArrayBuffer]",b9="[object DataView]",w9="[object Float32Array]",E9="[object Float64Array]",C9="[object Int8Array]",S9="[object Int16Array]",A9="[object Int32Array]",T9="[object Uint8Array]",M9="[object Uint8ClampedArray]",P9="[object Uint16Array]",N9="[object Uint32Array]";function R9(r,e,t){var n=r.constructor;switch(e){case v9:return Va(r);case d9:case p9:return new n(+r);case b9:return aA(r,t);case w9:case E9:case C9:case S9:case A9:case T9:case M9:case P9:case N9:return dA(r,t);case f9:return new n;case m9:case y9:return new n(r);case _9:return cA(r);case g9:return new n;case x9:return hA(r)}}var pA=R9;var fA=Object.create,O9=function(){function r(){}return function(e){if(!jr(e))return{};if(fA)return fA(e);r.prototype=e;var t=new r;return r.prototype=void 0,t}}(),mA=O9;function I9(r){return typeof r.constructor=="function"&&!Ba(r)?mA(Nd(r)):{}}var _A=I9;var D9="[object Map]";function L9(r){return $r(r)&&za(r)==D9}var gA=L9;var yA=Cs&&Cs.isMap,B9=yA?La(yA):gA,xA=B9;var k9="[object Set]";function F9(r){return $r(r)&&za(r)==k9}var vA=F9;var bA=Cs&&Cs.isSet,U9=bA?La(bA):vA,wA=U9;var z9=1,V9=2,q9=4,EA="[object Arguments]",G9="[object Array]",H9="[object Boolean]",W9="[object Date]",j9="[object Error]",CA="[object Function]",$9="[object GeneratorFunction]",X9="[object Map]",Y9="[object Number]",SA="[object Object]",Z9="[object RegExp]",J9="[object Set]",K9="[object String]",Q9="[object Symbol]",e$="[object WeakMap]",t$="[object ArrayBuffer]",n$="[object DataView]",r$="[object Float32Array]",s$="[object Float64Array]",i$="[object Int8Array]",o$="[object Int16Array]",a$="[object Int32Array]",c$="[object Uint8Array]",l$="[object Uint8ClampedArray]",u$="[object Uint16Array]",h$="[object Uint32Array]",Ot={};Ot[EA]=Ot[G9]=Ot[t$]=Ot[n$]=Ot[H9]=Ot[W9]=Ot[r$]=Ot[s$]=Ot[i$]=Ot[o$]=Ot[a$]=Ot[X9]=Ot[Y9]=Ot[SA]=Ot[Z9]=Ot[J9]=Ot[K9]=Ot[Q9]=Ot[c$]=Ot[l$]=Ot[u$]=Ot[h$]=!0;Ot[j9]=Ot[CA]=Ot[e$]=!1;function kd(r,e,t,n,s,i){var o,a=e&z9,c=e&V9,l=e&q9;if(t&&(o=s?t(r,n,s,i):t(r)),o!==void 0)return o;if(!jr(r))return r;var u=Da(r);if(u){if(o=oA(r),!a)return XS(r,o)}else{var h=za(r),d=h==CA||h==$9;if(Ed(r))return $S(r,a);if(h==SA||h==EA||d&&!s){if(o=c||d?{}:_A(r),!a)return c?KS(r,qS(o,r)):JS(r,US(o,r))}else{if(!Ot[h])return s?r:{};o=pA(r,h,a)}}i||(i=new ES);var p=i.get(r);if(p)return p;i.set(r,o),wA(r)?r.forEach(function(m){o.add(kd(m,e,t,m,r,i))}):xA(r)&&r.forEach(function(m,g){o.set(g,kd(m,e,t,g,r,i))});var _=l?c?eA:QS:c?Fa:ka,f=u?void 0:_(r);return CS(f||r,function(m,g){f&&(g=m,m=r[g]),wd(o,g,kd(m,e,t,g,r,i))}),o}var Fd=kd;var d$=1,p$=4;function f$(r){return Fd(r,d$|p$)}var AA=f$;var m$=4;function _$(r){return Fd(r,m$)}var TA=_$;var pn=class{static isEqual(e,t){if(q.isBoolean(e)&&q.isBoolean(t)||q.isNumber(e)&&q.isNumber(t)||q.isString(e)&&q.isString(t))return e==t;if(q.isObject(e)&&q.isObject(t)){let n=Object.keys(e),s=Object.keys(t);return Ce.isEqual(n,s)?JSON.stringify(e)==JSON.stringify(t):!1}return!1}static merge(e,t){return Object.assign(e,t)}static clone(e){return TA(e)}static cloneDeep(e){return AA(e)}};var MA="isInstance",PA="indexed_attrib_values",Yt=class{constructor(e){this._geometry=e}dispose(){}geometry(){return this._geometry}uuid(){return this._geometry.uuid}boundingBox(){return this._bounding_box=this._bounding_box||this._create_bounding_box()}_create_bounding_box(){if(this._geometry.computeBoundingBox(),this._geometry.boundingBox)return this._geometry.boundingBox}markAsInstance(){this._geometry.userData[MA]=!0}static markedAsInstance(e){return e.userData[MA]===!0}markedAsInstance(){return Yt.markedAsInstance(this._geometry)}positionAttribName(){let e="position";return this.markedAsInstance()&&(e="instancePosition"),e}computeVertexNormals(){this._geometry.computeVertexNormals()}userDataAttribs(){return this._geometry.userData[PA]=this._geometry.userData[PA]||{}}indexedAttributeNames(){return Object.keys(this.userDataAttribs()||{})}userDataAttrib(e){return e=bt.remapName(e),this.userDataAttribs()[e]}isAttribIndexed(e){return e=bt.remapName(e),this.userDataAttrib(e)!=null}hasAttrib(e){return e===Or.POINT_INDEX?!0:(e=bt.remapName(e),this._geometry.attributes[e]!=null)}markAttribAsNeedsUpdate(e){e=bt.remapName(e);let t=this._geometry.attributes[e];t&&(t.needsUpdate=!0)}attribType(e){return this.isAttribIndexed(e)?fr.STRING:fr.NUMERIC}static attribNames(e){return Object.keys(e.attributes)}attribNames(){return Yt.attribNames(this._geometry)}static attribNamesMatchingMask(e,t){return bt.attribNamesMatchingMask(t,this.attribNames(e))}attribNamesMatchingMask(e){return Yt.attribNamesMatchingMask(this._geometry,e)}attribSizes(){let e={};for(let t of this.attribNames())e[t]=this._geometry.attributes[t].itemSize;return e}attribSize(e){let t;return e=bt.remapName(e),(t=this._geometry.attributes[e])!=null?t.itemSize:e===Or.POINT_INDEX?1:0}setIndexedAttributeValues(e,t){this.userDataAttribs()[e]=t}setIndexedAttribute(e,t,n){this.setIndexedAttributeValues(e,t),this._geometry.setAttribute(e,new Gm(n,1)),this._geometry.getAttribute(e).needsUpdate=!0}addNumericAttrib(e,t=1,n=0){let s=[],i=!1;if(q.isNumber(n)){for(let o=0;o<this.pointsCount();o++)for(let a=0;a<t;a++)s.push(n);i=!0}else if(t>1)if(q.isArray(n)){for(let o=0;o<this.pointsCount();o++)for(let a=0;a<t;a++)s.push(n[a]);i=!0}else{let o=n;if(t==2&&o.x!=null&&o.y!=null){for(let u=0;u<this.pointsCount();u++)s.push(o.x),s.push(o.y);i=!0}let a=n;if(t==3&&a.x!=null&&a.y!=null&&a.z!=null){for(let u=0;u<this.pointsCount();u++)s.push(a.x),s.push(a.y),s.push(a.z);i=!0}let c=n;if(t==3&&c.r!=null&&c.g!=null&&c.b!=null){for(let u=0;u<this.pointsCount();u++)s.push(c.r),s.push(c.g),s.push(c.b);i=!0}let l=n;if(t==4&&l.x!=null&&l.y!=null&&l.z!=null&&l.w!=null){for(let u=0;u<this.pointsCount();u++)s.push(l.x),s.push(l.y),s.push(l.z),s.push(l.w);i=!0}}if(i)this._geometry.setAttribute(e.trim(),new Je(s,t));else throw console.warn(n),`CoreGeometry.add_numeric_attrib error: no other default value allowed for now in add_numeric_attrib (default given: ${n})`}initPositionAttribute(e,t){let n=[];t==null&&(t=new A);for(let s=0;s<e;s++)n.push(t.x),n.push(t.y),n.push(t.z);return this._geometry.setAttribute("position",new Je(n,3))}addAttribute(e,t){switch(t.type()){case fr.STRING:return console.log("TODO: to implement");case fr.NUMERIC:return this.addNumericAttrib(e,t.size())}}renameAttrib(e,t){this.isAttribIndexed(e)&&(this.userDataAttribs()[t]=pn.clone(this.userDataAttribs()[e]),delete this.userDataAttribs()[e]);let n=this._geometry.getAttribute(e);return this._geometry.setAttribute(t.trim(),new Je(n.array,n.itemSize)),this._geometry.deleteAttribute(e)}deleteAttribute(e){return this.isAttribIndexed(e)&&delete this.userDataAttribs()[e],this._geometry.deleteAttribute(e)}clone(){return Yt.clone(this._geometry)}static clone(e){let t=e.clone();return e.userData&&(t.userData=pn.cloneDeep(e.userData)),t}pointsCount(){return Yt.pointsCount(this._geometry)}static pointsCount(e){let t,n=0,s=new this(e),i="position";if(s.markedAsInstance()&&(i="instancePosition"),(t=e.getAttribute(i))!=null){let o;(o=t.array)!=null&&(n=o.length/3)}return n}points(){return this.pointsFromGeometry()}pointsFromGeometry(){let e=[],t=this._geometry.getAttribute(this.positionAttribName());if(t!=null){let n=t.array.length/3;for(let s=0;s<n;s++){let i=new xs(this,s);e.push(i)}}return e}segments(){var e;let t=((e=this.geometry().index)==null?void 0:e.array)||[];return Ce.chunk(t,2)}faces(){return this.facesFromGeometry()}facesFromGeometry(){var e;let n=(((e=this.geometry().index)==null?void 0:e.array)||[]).length/3;return Ce.range(n).map(s=>new sg(this,s))}};var U=(r=>(r.BOOLEAN="boolean",r.BUTTON="button",r.COLOR="color",r.FLOAT="float",r.FOLDER="folder",r.INTEGER="integer",r.PARAM_PATH="param_path",r.NODE_PATH="node_path",r.RAMP="ramp",r.STRING="string",r.VECTOR2="vector2",r.VECTOR3="vector3",r.VECTOR4="vector4",r))(U||{});var El=class{constructor(e,t,n){if(this._type=e,this._name=t,this._defaultValue=n,t==""||t==null)throw new Error("name must not be an empty string")}static fromParam(e){return new El(e.type(),e.name(),e.defaultValue())}type(){return this._type}name(){return this._name}defaultValue(){return this._defaultValue}paramOptions(){let e=this._callback.bind(this);switch(this._type){case U.NODE_PATH:return{callback:e,nodeSelection:{context:se.COP}};default:return{callback:e}}}applyToNode(e){if(!e.params.has(this._name))return;let t=e.params.get(this._name);if(!t)return;let n=this.paramOptions(),s=Object.keys(n);for(let i of s)t.options.setOption(i,n[i]);this.executeCallback(e,t),t.type()==U.NODE_PATH&&setTimeout(async()=>{t.isDirty()&&await t.compute(),t.options.executeCallback()},200)}executeCallback(e,t){this._callback(e,t)}_callback(e,t){}};var ii=class extends El{constructor(e,t,n,s){super(e,t,n);this._uniformName=s}toJSON(){return{type:this._type,name:this._name,defaultValue:this._defaultValue,uniformName:this._uniformName}}static fromJSON(e){return new ii(e.type,e.name,e.defaultValue,e.uniformName)}uniformName(){return this._uniformName}uniform(){return this._uniform=this._uniform||this._createUniform()}_createUniform(){return ii.uniformByType(this._type)}_callback(e,t){ii.callback(t,this.uniform())}static callback(e,t){switch(e.type()){case U.RAMP:t.value=e.rampTexture();return;case U.NODE_PATH:ii.set_uniform_value_from_texture_from_node_path_param(e,t);return;default:t.value=e.value}}static uniformByType(e){switch(e){case U.BOOLEAN:return{value:0};case U.BUTTON:return{value:0};case U.COLOR:return{value:new ae(0,0,0)};case U.FLOAT:return{value:0};case U.FOLDER:return{value:0};case U.INTEGER:return{value:0};case U.NODE_PATH:return{value:0};case U.PARAM_PATH:return{value:0};case U.RAMP:return{value:null};case U.STRING:return{value:null};case U.VECTOR2:return{value:new G(0,0)};case U.VECTOR3:return{value:new A(0,0,0)};case U.VECTOR4:return{value:new Se(0,0,0,0)}}Bn.unreachable(e)}static async set_uniform_value_from_texture_from_node_path_param(e,t){e.isDirty()&&await e.compute();let n=e.value.nodeWithContext(se.COP);if(n)if(n.isDirty())n.compute().then(s=>{let i=s.texture();t.value=i});else{let i=n.containerController.container().texture();t.value=i}else t.value=null}set_uniform_value_from_ramp(e,t){t.value=e.rampTexture()}};function NA(r,e,t){let n=hg.getUniforms(r);if(n){let s=n[e];s?s.value=t.value:n[e]=t}else Cl.addAdditionalTexture(r,e,t)}var hg=class{static getUniforms(e){var t;return(t=e.userData)==null?void 0:t.uniforms}static setUniforms(e,t){e.userData.uniforms=t}static removeUniforms(e){let t=this.getUniforms(e);if(t){let n=e.userData;delete n.uniforms}return t}};function g$(r,e,t){Cl.setData(e,t),e.onBeforeCompile=y$(r,e);let n=`${e.uuid}:${performance.now()}`;e.customProgramCacheKey=()=>n}function RA(r,e){let{src:t,dest:n,shareCustomUniforms:s}=e,i=Cl.getData(t);if(i){let a=s?i:function(c){let l=ug.toJSON(c);return ug.fromJSON(l)}(i);g$(r,n,a)}}function y$(r,e){return n=>{let s=Cl.getData(e);if(!s)return;let{vertexShader:i,fragmentShader:o,paramConfigs:a,additionalTextureUniforms:c,timeDependent:l,resolutionDependent:u}=s;n.vertexShader=i,n.fragmentShader=o,r.uniformsController.addUniforms(n.uniforms,{paramConfigs:a,additionalTextureUniforms:c,timeDependent:l,resolutionDependent:u});let h=e;h.vertexShader=n.vertexShader,h.fragmentShader=n.fragmentShader,hg.setUniforms(e,n.uniforms)}}var Cl=class{static setData(e,t){e.userData.onBeforeCompileData=t}static addAdditionalTexture(e,t,n){let s=this.getData(e);s?s.additionalTextureUniforms[t]==null&&(s.additionalTextureUniforms[t]=n):console.warn("no data found on material",e)}static getData(e){return e.userData.onBeforeCompileData}static removeData(e){let t=this.getData(e);if(t){let n=e.userData;delete n.onBeforeCompileData}return t}},ug=class{static toJSON(e){return{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,timeDependent:e.timeDependent,resolutionDependent:e.resolutionDependent,paramConfigs:e.paramConfigs.map(n=>n.toJSON())}}static fromJSON(e){return{...e,additionalTextureUniforms:{},paramConfigs:e.paramConfigs.map(n=>ii.fromJSON(n))}}};var OA="POLY_render_hook",x$=(r,e,t,n,s,i)=>{},dg=class{static node(e,t){return e.node(t.name)}static clone(e,t,n){let s=t.clone(),i=t.uniforms;return i&&(s.uniforms=Wm.clone(i)),RA(e,{src:t,dest:s,shareCustomUniforms:n.shareCustomUniforms}),s}static add_user_data_render_hook(e,t){e.userData[OA]=t}static apply_render_hook(e,t){if(t.userData){let n=t.userData[OA];if(n){e.onBeforeRender=(s,i,o,a,c,l)=>{n(s,i,o,a,c,l,e)};return}}e.onBeforeRender=x$}static applyCustomMaterials(e,t){let n=t;if(n.customMaterials)for(let s of Object.keys(n.customMaterials)){let i=s,o=n.customMaterials[i];o&&(e[i]=o,o.needsUpdate=!0)}}static assignUniforms(e,t,n,s){NA(e,t,n),s&&this.assignUniformForOnBeforeCompile(e,t,n,s)}static assignUniformForOnBeforeCompile(e,t,n,s){s.addAdditionalTextureUniforms(t,n)}};var IA=Math.pow(2,-24);var qa=class{constructor(){}};function mr(r,e,t){return t.min.x=e[r],t.min.y=e[r+1],t.min.z=e[r+2],t.max.x=e[r+3],t.max.y=e[r+4],t.max.z=e[r+5],t}function pg(r){let e=-1,t=-1/0;for(let n=0;n<3;n++){let s=r[n+3]-r[n];s>t&&(t=s,e=n)}return e}function fg(r,e){e.set(r)}function mg(r,e,t){let n,s;for(let i=0;i<3;i++){let o=i+3;n=r[i],s=e[i],t[i]=n<s?n:s,n=r[o],s=e[o],t[o]=n>s?n:s}}function Sl(r,e,t){for(let n=0;n<3;n++){let s=e[r+2*n],i=e[r+2*n+1],o=s-i,a=s+i;o<t[n]&&(t[n]=o),a>t[n+3]&&(t[n+3]=a)}}function Ga(r){let e=r[3]-r[0],t=r[4]-r[1],n=r[5]-r[2];return 2*(e*t+t*n+n*e)}function w$(r,e){if(!r.index){let t=r.attributes.position.count,n=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer,s;t>65535?s=new Uint32Array(new n(4*t)):s=new Uint16Array(new n(2*t)),r.setIndex(new xt(s,1));for(let i=0;i<t;i++)s[i]=i}}function E$(r){if(!r.groups||!r.groups.length)return[{offset:0,count:r.index.count/3}];let e=[],t=new Set;for(let s of r.groups)t.add(s.start),t.add(s.start+s.count);let n=Array.from(t.values()).sort((s,i)=>s-i);for(let s=0;s<n.length-1;s++){let i=n[s],o=n[s+1];e.push({offset:i/3,count:(o-i)/3})}return e}function gg(r,e,t,n,s=null){let i=1/0,o=1/0,a=1/0,c=-1/0,l=-1/0,u=-1/0,h=1/0,d=1/0,p=1/0,_=-1/0,f=-1/0,m=-1/0,g=s!==null;for(let x=e*6,b=(e+t)*6;x<b;x+=6){let v=r[x+0],y=r[x+1],E=v-y,C=v+y;E<i&&(i=E),C>c&&(c=C),g&&v<h&&(h=v),g&&v>_&&(_=v);let M=r[x+2],R=r[x+3],N=M-R,w=M+R;N<o&&(o=N),w>l&&(l=w),g&&M<d&&(d=M),g&&M>f&&(f=M);let T=r[x+4],F=r[x+5],L=T-F,V=T+F;L<a&&(a=L),V>u&&(u=V),g&&T<p&&(p=T),g&&T>m&&(m=T)}n[0]=i,n[1]=o,n[2]=a,n[3]=c,n[4]=l,n[5]=u,g&&(s[0]=h,s[1]=d,s[2]=p,s[3]=_,s[4]=f,s[5]=m)}function C$(r,e,t,n){let s=1/0,i=1/0,o=1/0,a=-1/0,c=-1/0,l=-1/0;for(let u=e*6,h=(e+t)*6;u<h;u+=6){let d=r[u+0];d<s&&(s=d),d>a&&(a=d);let p=r[u+2];p<i&&(i=p),p>c&&(c=p);let _=r[u+4];_<o&&(o=_),_>l&&(l=_)}n[0]=s,n[1]=i,n[2]=o,n[3]=a,n[4]=c,n[5]=l}function S$(r,e,t,n,s){let i=t,o=t+n-1,a=s.pos,c=s.axis*2;for(;;){for(;i<=o&&e[i*6+c]<a;)i++;for(;i<=o&&e[o*6+c]>=a;)o--;if(i<o){for(let l=0;l<3;l++){let u=r[i*3+l];r[i*3+l]=r[o*3+l],r[o*3+l]=u;let h=e[i*6+l*2+0];e[i*6+l*2+0]=e[o*6+l*2+0],e[o*6+l*2+0]=h;let d=e[i*6+l*2+1];e[i*6+l*2+1]=e[o*6+l*2+1],e[o*6+l*2+1]=d}i++,o--}else return i}}var Ss=32,A$=(r,e)=>r.candidate-e.candidate,oi=new Array(Ss).fill().map(()=>({count:0,bounds:new Float32Array(6),rightCacheBounds:new Float32Array(6),leftCacheBounds:new Float32Array(6),candidate:0})),Ud=new Float32Array(6);function T$(r,e,t,n,s,i){let o=-1,a=0;if(i===0)o=pg(e),o!==-1&&(a=(e[o]+e[o+3])/2);else if(i===1)o=pg(r),o!==-1&&(a=M$(t,n,s,o));else if(i===2){let c=Ga(r),l=1.25*s,u=n*6,h=(n+s)*6;for(let d=0;d<3;d++){let p=e[d],m=(e[d+3]-p)/Ss;if(s<Ss/4){let g=[...oi];g.length=s;let x=0;for(let v=u;v<h;v+=6,x++){let y=g[x];y.candidate=t[v+2*d],y.count=0;let{bounds:E,leftCacheBounds:C,rightCacheBounds:M}=y;for(let R=0;R<3;R++)M[R]=1/0,M[R+3]=-1/0,C[R]=1/0,C[R+3]=-1/0,E[R]=1/0,E[R+3]=-1/0;Sl(v,t,E)}g.sort(A$);let b=s;for(let v=0;v<b;v++){let y=g[v];for(;v+1<b&&g[v+1].candidate===y.candidate;)g.splice(v+1,1),b--}for(let v=u;v<h;v+=6){let y=t[v+2*d];for(let E=0;E<b;E++){let C=g[E];y>=C.candidate?Sl(v,t,C.rightCacheBounds):(Sl(v,t,C.leftCacheBounds),C.count++)}}for(let v=0;v<b;v++){let y=g[v],E=y.count,C=s-y.count,M=y.leftCacheBounds,R=y.rightCacheBounds,N=0;E!==0&&(N=Ga(M)/c);let w=0;C!==0&&(w=Ga(R)/c);let T=1+1.25*(N*E+w*C);T<l&&(o=d,l=T,a=y.candidate)}}else{for(let b=0;b<Ss;b++){let v=oi[b];v.count=0,v.candidate=p+m+b*m;let y=v.bounds;for(let E=0;E<3;E++)y[E]=1/0,y[E+3]=-1/0}for(let b=u;b<h;b+=6){let E=~~((t[b+2*d]-p)/m);E>=Ss&&(E=Ss-1);let C=oi[E];C.count++,Sl(b,t,C.bounds)}let g=oi[Ss-1];fg(g.bounds,g.rightCacheBounds);for(let b=Ss-2;b>=0;b--){let v=oi[b],y=oi[b+1];mg(v.bounds,y.rightCacheBounds,v.rightCacheBounds)}let x=0;for(let b=0;b<Ss-1;b++){let v=oi[b],y=v.count,E=v.bounds,M=oi[b+1].rightCacheBounds;y!==0&&(x===0?fg(E,Ud):mg(E,Ud,Ud)),x+=y;let R=0,N=0;x!==0&&(R=Ga(Ud)/c);let w=s-x;w!==0&&(N=Ga(M)/c);let T=1+1.25*(R*x+N*w);T<l&&(o=d,l=T,a=v.candidate)}}}}else console.warn(`MeshBVH: Invalid build strategy value ${i} used.`);return{axis:o,pos:a}}function M$(r,e,t,n){let s=0;for(let i=e,o=e+t;i<o;i++)s+=r[i*6+n*2];return s/t}function P$(r,e){let t=r.attributes.position,n=t.array,s=r.index.array,i=s.length/3,o=new Float32Array(i*6),a=t.offset||0,c=3;t.isInterleavedBufferAttribute&&(c=t.data.stride);for(let l=0;l<i;l++){let u=l*3,h=l*6,d=s[u+0]*c+a,p=s[u+1]*c+a,_=s[u+2]*c+a;for(let f=0;f<3;f++){let m=n[d+f],g=n[p+f],x=n[_+f],b=m;g<b&&(b=g),x<b&&(b=x);let v=m;g>v&&(v=g),x>v&&(v=x);let y=(v-b)/2,E=f*2;o[h+E+0]=b+y,o[h+E+1]=y+(Math.abs(b)+y)*IA,b<e[f]&&(e[f]=b),v>e[f+3]&&(e[f+3]=v)}}return o}function N$(r,e){function t(g){d&&d(g/p)}function n(g,x,b,v=null,y=0){if(!_&&y>=c&&(_=!0,l&&(console.warn(`MeshBVH: Max depth of ${c} reached when generating BVH. Consider increasing maxDepth.`),console.warn(r))),b<=u||y>=c)return t(x+b),g.offset=x,g.count=b,g;let E=T$(g.boundingData,v,o,x,b,h);if(E.axis===-1)return t(x+b),g.offset=x,g.count=b,g;let C=S$(a,o,x,b,E);if(C===x||C===x+b)t(x+b),g.offset=x,g.count=b;else{g.splitAxis=E.axis;let M=new qa,R=x,N=C-x;g.left=M,M.boundingData=new Float32Array(6),gg(o,R,N,M.boundingData,i),n(M,R,N,i,y+1);let w=new qa,T=C,F=b-N;g.right=w,w.boundingData=new Float32Array(6),gg(o,T,F,w.boundingData,i),n(w,T,F,i,y+1)}return g}w$(r,e);let s=new Float32Array(6),i=new Float32Array(6),o=P$(r,s),a=r.index.array,c=e.maxDepth,l=e.verbose,u=e.maxLeafTris,h=e.strategy,d=e.onProgress,p=r.index.count/3,_=!1,f=[],m=E$(r);if(m.length===1){let g=m[0],x=new qa;x.boundingData=s,C$(o,g.offset,g.count,i),n(x,g.offset,g.count,i),f.push(x)}else for(let g of m){let x=new qa;x.boundingData=new Float32Array(6),gg(o,g.offset,g.count,x.boundingData,i),n(x,g.offset,g.count,i),f.push(x)}return f}function BA(r,e){let t=N$(r,e),n,s,i,o=[],a=e.useSharedArrayBuffer?SharedArrayBuffer:ArrayBuffer;for(let u=0;u<t.length;u++){let h=t[u],d=c(h),p=new a(32*d);n=new Float32Array(p),s=new Uint32Array(p),i=new Uint16Array(p),l(0,h),o.push(p)}return o;function c(u){return u.count?1:1+c(u.left)+c(u.right)}function l(u,h){let d=u/4,p=u/2,_=!!h.count,f=h.boundingData;for(let m=0;m<6;m++)n[d+m]=f[m];if(_){let m=h.offset,g=h.count;return s[d+6]=m,i[p+14]=g,i[p+15]=65535,u+32}else{let m=h.left,g=h.right,x=h.splitAxis,b;if(b=l(u+32,m),b/4>Math.pow(2,32))throw new Error("MeshBVH: Cannot store child pointer greater than 32 bits.");return s[d+6]=b/4,b=l(b,g),s[d+7]=x,b}}}var ir=class{constructor(){this.min=1/0,this.max=-1/0}setFromPointsField(e,t){let n=1/0,s=-1/0;for(let i=0,o=e.length;i<o;i++){let c=e[i][t];n=c<n?c:n,s=c>s?c:s}this.min=n,this.max=s}setFromPoints(e,t){let n=1/0,s=-1/0;for(let i=0,o=t.length;i<o;i++){let a=t[i],c=e.dot(a);n=c<n?c:n,s=c>s?c:s}this.min=n,this.max=s}isSeparated(e){return this.min>e.max||e.min>this.max}};ir.prototype.setFromBox=function(){let r=new A;return function(t,n){let s=n.min,i=n.max,o=1/0,a=-1/0;for(let c=0;c<=1;c++)for(let l=0;l<=1;l++)for(let u=0;u<=1;u++){r.x=s.x*c+i.x*(1-c),r.y=s.y*l+i.y*(1-l),r.z=s.z*u+i.z*(1-u);let h=t.dot(r);o=Math.min(h,o),a=Math.max(h,a)}this.min=o,this.max=a}}();var Dbe=function(){let r=new ir;return function(t,n){let s=t.points,i=t.satAxes,o=t.satBounds,a=n.points,c=n.satAxes,l=n.satBounds;for(let u=0;u<3;u++){let h=o[u],d=i[u];if(r.setFromPoints(d,a),h.isSeparated(r))return!1}for(let u=0;u<3;u++){let h=l[u],d=c[u];if(r.setFromPoints(d,s),h.isSeparated(r))return!1}}}();var R$=function(){let r=new A,e=new A,t=new A;return function(s,i,o){let a=s.start,c=r,l=i.start,u=e;t.subVectors(a,l),r.subVectors(s.end,i.start),e.subVectors(i.end,i.start);let h=t.dot(u),d=u.dot(c),p=u.dot(u),_=t.dot(c),m=c.dot(c)*p-d*d,g,x;m!==0?g=(h*d-_*p)/m:g=0,x=(h+g*d)/p,o.x=g,o.y=x}}(),Al=function(){let r=new G,e=new A,t=new A;return function(s,i,o,a){R$(s,i,r);let c=r.x,l=r.y;if(c>=0&&c<=1&&l>=0&&l<=1){s.at(c,o),i.at(l,a);return}else if(c>=0&&c<=1){l<0?i.at(0,a):i.at(1,a),s.closestPointToPoint(a,!0,o);return}else if(l>=0&&l<=1){c<0?s.at(0,o):s.at(1,o),i.closestPointToPoint(o,!0,a);return}else{let u;c<0?u=s.start:u=s.end;let h;l<0?h=i.start:h=i.end;let d=e,p=t;if(s.closestPointToPoint(h,!0,e),i.closestPointToPoint(u,!0,t),d.distanceToSquared(h)<=p.distanceToSquared(u)){o.copy(d),a.copy(h);return}else{o.copy(u),a.copy(p);return}}}}(),kA=function(){let r=new A,e=new A,t=new qn,n=new Hn;return function(i,o){let{radius:a,center:c}=i,{a:l,b:u,c:h}=o;if(n.start=l,n.end=u,n.closestPointToPoint(c,!0,r).distanceTo(c)<=a||(n.start=l,n.end=h,n.closestPointToPoint(c,!0,r).distanceTo(c)<=a)||(n.start=u,n.end=h,n.closestPointToPoint(c,!0,r).distanceTo(c)<=a))return!0;let f=o.getPlane(t);if(Math.abs(f.distanceToPoint(c))<=a){let g=f.projectPoint(c,e);if(o.containsPoint(g))return!0}return!1}}();var $n=class extends Ct{constructor(...e){super(...e);this.isExtendedTriangle=!0,this.satAxes=new Array(4).fill().map(()=>new A),this.satBounds=new Array(4).fill().map(()=>new ir),this.points=[this.a,this.b,this.c],this.sphere=new fs,this.plane=new qn,this.needsUpdate=!1}intersectsSphere(e){return kA(e,this)}update(){let e=this.a,t=this.b,n=this.c,s=this.points,i=this.satAxes,o=this.satBounds,a=i[0],c=o[0];this.getNormal(a),c.setFromPoints(a,s);let l=i[1],u=o[1];l.subVectors(e,t),u.setFromPoints(l,s);let h=i[2],d=o[2];h.subVectors(t,n),d.setFromPoints(h,s);let p=i[3],_=o[3];p.subVectors(n,e),_.setFromPoints(p,s),this.sphere.setFromPoints(this.points),this.plane.setFromNormalAndCoplanarPoint(a,e),this.needsUpdate=!1}};$n.prototype.closestPointToSegment=function(){let r=new A,e=new A,t=new Hn;return function(s,i=null,o=null){let{start:a,end:c}=s,l=this.points,u,h=1/0;for(let d=0;d<3;d++){let p=(d+1)%3;t.start.copy(l[d]),t.end.copy(l[p]),Al(t,s,r,e),u=r.distanceToSquared(e),u<h&&(h=u,i&&i.copy(r),o&&o.copy(e))}return this.closestPointToPoint(a,r),u=a.distanceToSquared(r),u<h&&(h=u,i&&i.copy(r),o&&o.copy(a)),this.closestPointToPoint(c,r),u=c.distanceToSquared(r),u<h&&(h=u,i&&i.copy(r),o&&o.copy(c)),Math.sqrt(h)}}();$n.prototype.intersectsTriangle=function(){let r=new $n,e=new Array(3),t=new Array(3),n=new ir,s=new ir,i=new A,o=new A,a=new A,c=new A,l=new Hn,u=new Hn,h=new Hn;return function(p,_=null){this.needsUpdate&&this.update(),p.isExtendedTriangle?p.needsUpdate&&p.update():(r.copy(p),r.update(),p=r);let f=this.plane,m=p.plane;if(Math.abs(f.normal.dot(m.normal))>1-1e-10){let g=this.satBounds,x=this.satAxes;t[0]=p.a,t[1]=p.b,t[2]=p.c;for(let y=0;y<4;y++){let E=g[y],C=x[y];if(n.setFromPoints(C,t),E.isSeparated(n))return!1}let b=p.satBounds,v=p.satAxes;e[0]=this.a,e[1]=this.b,e[2]=this.c;for(let y=0;y<4;y++){let E=b[y],C=v[y];if(n.setFromPoints(C,e),E.isSeparated(n))return!1}for(let y=0;y<4;y++){let E=x[y];for(let C=0;C<4;C++){let M=v[C];if(i.crossVectors(E,M),n.setFromPoints(i,e),s.setFromPoints(i,t),n.isSeparated(s))return!1}}return _&&(console.warn("ExtendedTriangle.intersectsTriangle: Triangles are coplanar which does not support an output edge. Setting edge to 0, 0, 0."),_.start.set(0,0,0),_.end.set(0,0,0)),!0}else{let g=this.points,x=!1,b=0;for(let F=0;F<3;F++){let L=g[F],V=g[(F+1)%3];if(l.start.copy(L),l.end.copy(V),l.delta(o),m.normal.dot(o)===0&&m.distanceToPoint(l.start)===0){u.copy(l),b=2;break}else if(m.intersectLine(l,x?u.start:u.end)){if(b++,x)break;x=!0}}if(b!==2)return!1;let v=p.points,y=!1,E=0;for(let F=0;F<3;F++){let L=v[F],V=v[(F+1)%3];if(l.start.copy(L),l.end.copy(V),l.delta(a),f.normal.dot(a)===0&&f.distanceToPoint(l.start)===0){h.copy(l),E=2;break}else if(f.intersectLine(l,y?h.start:h.end)){if(E++,y)break;y=!0}}if(E!==2)return!1;if(u.delta(o),h.delta(a),o.dot(a)<0){let F=h.start;h.start=h.end,h.end=F}let C=u.start.dot(o),M=u.end.dot(o),R=h.start.dot(o),N=h.end.dot(o),w=M<R,T=C<N;return C!==N&&R!==M&&w===T?!1:(_&&(c.subVectors(u.start,h.start),c.dot(o)>0?_.start.copy(u.start):_.start.copy(h.start),c.subVectors(u.end,h.end),c.dot(o)<0?_.end.copy(u.end):_.end.copy(h.end)),!0)}}}();$n.prototype.distanceToPoint=function(){let r=new A;return function(t){return this.closestPointToPoint(t,r),t.distanceTo(r)}}();$n.prototype.distanceToTriangle=function(){let r=new A,e=new A,t=["a","b","c"],n=new Hn,s=new Hn;return function(o,a=null,c=null){let l=a||c?n:null;if(this.intersectsTriangle(o,l))return(a||c)&&(a&&l.getCenter(a),c&&l.getCenter(c)),0;let u=1/0;for(let h=0;h<3;h++){let d,p=t[h],_=o[p];this.closestPointToPoint(_,r),d=_.distanceToSquared(r),d<u&&(u=d,a&&a.copy(r),c&&c.copy(_));let f=this[p];o.closestPointToPoint(f,r),d=f.distanceToSquared(r),d<u&&(u=d,a&&a.copy(f),c&&c.copy(r))}for(let h=0;h<3;h++){let d=t[h],p=t[(h+1)%3];n.set(this[d],this[p]);for(let _=0;_<3;_++){let f=t[_],m=t[(_+1)%3];s.set(o[f],o[m]),Al(n,s,r,e);let g=r.distanceToSquared(e);g<u&&(u=g,a&&a.copy(r),c&&c.copy(e))}}return Math.sqrt(u)}}();var or=class extends Ut{constructor(...e){super(...e);this.isOrientedBox=!0,this.matrix=new pe,this.invMatrix=new pe,this.points=new Array(8).fill().map(()=>new A),this.satAxes=new Array(3).fill().map(()=>new A),this.satBounds=new Array(3).fill().map(()=>new ir),this.alignedSatBounds=new Array(3).fill().map(()=>new ir),this.needsUpdate=!1}set(e,t,n){super.set(e,t),this.matrix.copy(n),this.needsUpdate=!0}copy(e){super.copy(e),this.matrix.copy(e.matrix),this.needsUpdate=!0}};or.prototype.update=function(){return function(){let e=this.matrix,t=this.min,n=this.max,s=this.points;for(let l=0;l<=1;l++)for(let u=0;u<=1;u++)for(let h=0;h<=1;h++){let d=1*l|2*u|4*h,p=s[d];p.x=l?n.x:t.x,p.y=u?n.y:t.y,p.z=h?n.z:t.z,p.applyMatrix4(e)}let i=this.satBounds,o=this.satAxes,a=s[0];for(let l=0;l<3;l++){let u=o[l],h=i[l],d=1<<l,p=s[d];u.subVectors(a,p),h.setFromPoints(u,s)}let c=this.alignedSatBounds;c[0].setFromPointsField(s,"x"),c[1].setFromPointsField(s,"y"),c[2].setFromPointsField(s,"z"),this.invMatrix.copy(this.matrix).invert(),this.needsUpdate=!1}}();or.prototype.intersectsBox=function(){let r=new ir;return function(t){this.needsUpdate&&this.update();let n=t.min,s=t.max,i=this.satBounds,o=this.satAxes,a=this.alignedSatBounds;if(r.min=n.x,r.max=s.x,a[0].isSeparated(r)||(r.min=n.y,r.max=s.y,a[1].isSeparated(r))||(r.min=n.z,r.max=s.z,a[2].isSeparated(r)))return!1;for(let c=0;c<3;c++){let l=o[c],u=i[c];if(r.setFromBox(l,t),u.isSeparated(r))return!1}return!0}}();or.prototype.intersectsTriangle=function(){let r=new $n,e=new Array(3),t=new ir,n=new ir,s=new A;return function(o){this.needsUpdate&&this.update(),o.isExtendedTriangle?o.needsUpdate&&o.update():(r.copy(o),r.update(),o=r);let a=this.satBounds,c=this.satAxes;e[0]=o.a,e[1]=o.b,e[2]=o.c;for(let d=0;d<3;d++){let p=a[d],_=c[d];if(t.setFromPoints(_,e),p.isSeparated(t))return!1}let l=o.satBounds,u=o.satAxes,h=this.points;for(let d=0;d<3;d++){let p=l[d],_=u[d];if(t.setFromPoints(_,h),p.isSeparated(t))return!1}for(let d=0;d<3;d++){let p=c[d];for(let _=0;_<4;_++){let f=u[_];if(s.crossVectors(p,f),t.setFromPoints(s,e),n.setFromPoints(s,h),t.isSeparated(n))return!1}}return!0}}();or.prototype.closestPointToPoint=function(){return function(e,t){return this.needsUpdate&&this.update(),t.copy(e).applyMatrix4(this.invMatrix).clamp(this.min,this.max).applyMatrix4(this.matrix),t}}();or.prototype.distanceToPoint=function(){let r=new A;return function(t){return this.closestPointToPoint(t,r),t.distanceTo(r)}}();or.prototype.distanceToBox=function(){let r=["x","y","z"],e=new Array(12).fill().map(()=>new Hn),t=new Array(12).fill().map(()=>new Hn),n=new A,s=new A;return function(o,a=0,c=null,l=null){if(this.needsUpdate&&this.update(),this.intersectsBox(o))return(c||l)&&(o.getCenter(s),this.closestPointToPoint(s,n),o.closestPointToPoint(n,s),c&&c.copy(n),l&&l.copy(s)),0;let u=a*a,h=o.min,d=o.max,p=this.points,_=1/0;for(let m=0;m<8;m++){let g=p[m];s.copy(g).clamp(h,d);let x=g.distanceToSquared(s);if(x<_&&(_=x,c&&c.copy(g),l&&l.copy(s),x<u))return Math.sqrt(x)}let f=0;for(let m=0;m<3;m++)for(let g=0;g<=1;g++)for(let x=0;x<=1;x++){let b=(m+1)%3,v=(m+2)%3,y=g<<b|x<<v,E=1<<m|g<<b|x<<v,C=p[y],M=p[E];e[f].set(C,M);let N=r[m],w=r[b],T=r[v],F=t[f],L=F.start,V=F.end;L[N]=h[N],L[w]=g?h[w]:d[w],L[T]=x?h[T]:d[w],V[N]=d[N],V[w]=g?h[w]:d[w],V[T]=x?h[T]:d[w],f++}for(let m=0;m<=1;m++)for(let g=0;g<=1;g++)for(let x=0;x<=1;x++){s.x=m?d.x:h.x,s.y=g?d.y:h.y,s.z=x?d.z:h.z,this.closestPointToPoint(s,n);let b=s.distanceToSquared(n);if(b<_&&(_=b,c&&c.copy(n),l&&l.copy(s),b<u))return Math.sqrt(b)}for(let m=0;m<12;m++){let g=e[m];for(let x=0;x<12;x++){let b=t[x];Al(g,b,n,s);let v=n.distanceToSquared(s);if(v<_&&(_=v,c&&c.copy(n),l&&l.copy(s),v<u))return Math.sqrt(v)}}return Math.sqrt(_)}}();var Vd=new A,qd=new A,Gd=new A,FA=new G,UA=new G,zA=new G,VA=new A;function O$(r,e,t,n,s,i){let o;return i===er?o=r.intersectTriangle(n,t,e,!0,s):o=r.intersectTriangle(e,t,n,i!==Zs,s),o===null?null:{distance:r.origin.distanceTo(s),point:s.clone()}}function I$(r,e,t,n,s,i,o){Vd.fromBufferAttribute(e,n),qd.fromBufferAttribute(e,s),Gd.fromBufferAttribute(e,i);let a=O$(r,Vd,qd,Gd,VA,o);if(a){t&&(FA.fromBufferAttribute(t,n),UA.fromBufferAttribute(t,s),zA.fromBufferAttribute(t,i),a.uv=Ct.getUV(VA,Vd,qd,Gd,FA,UA,zA,new G));let c={a:n,b:s,c:i,normal:new A,materialIndex:0};Ct.getNormal(Vd,qd,Gd,c.normal),a.face=c,a.faceIndex=n}return a}function xg(r,e,t,n,s){let i=n*3,o=r.index.getX(i),a=r.index.getX(i+1),c=r.index.getX(i+2),l=I$(t,r.attributes.position,r.attributes.uv,o,a,c,e);return l?(l.faceIndex=n,s&&s.push(l),l):null}function qA(r,e,t,n,s,i){for(let o=n,a=n+s;o<a;o++)xg(r,e,t,o,i)}function GA(r,e,t,n,s){let i=1/0,o=null;for(let a=n,c=n+s;a<c;a++){let l=xg(r,e,t,a);l&&l.distance<i&&(o=l,i=l.distance)}return o}function Ha(r,e,t){return r===null||(r.point.applyMatrix4(e.matrixWorld),r.distance=r.point.distanceTo(t.ray.origin),r.object=e,r.distance<t.near||r.distance>t.far)?null:r}function _r(r,e,t,n){let s=r.a,i=r.b,o=r.c,a=e,c=e+1,l=e+2;t&&(a=t.getX(e),c=t.getX(e+1),l=t.getX(e+2)),s.x=n.getX(a),s.y=n.getY(a),s.z=n.getZ(a),i.x=n.getX(c),i.y=n.getY(c),i.z=n.getZ(c),o.x=n.getX(l),o.y=n.getY(l),o.z=n.getZ(l)}function vg(r,e,t,n,s,i,o){let a=t.index,c=t.attributes.position;for(let l=r,u=e+r;l<u;l++)if(_r(o,l*3,a,c),o.needsUpdate=!0,n(o,l,s,i))return!0;return!1}var Tl=class{constructor(e){this._getNewPrimitive=e,this._primitives=[]}getPrimitive(){let e=this._primitives;return e.length===0?this._getNewPrimitive():e.pop()}releasePrimitive(e){this._primitives.push(e)}};function As(r,e){return e[r+15]===65535}function Zi(r,e){return e[r+6]}function Wa(r,e){return e[r+14]}function ja(r){return r+8}function $a(r,e){return e[r+6]}function HA(r,e){return e[r+7]}var Xa=new Ut,Wd=new A,L$=["x","y","z"];function jd(r,e,t,n,s){let i=r*2,o=Ya,a=ai,c=ci;if(As(i,a)){let u=Zi(r,c),h=Wa(i,a);qA(e,t,n,u,h,s)}else{let u=ja(r);Xd(u,o,n,Wd)&&jd(u,e,t,n,s);let h=$a(r,c);Xd(h,o,n,Wd)&&jd(h,e,t,n,s)}}function $d(r,e,t,n){let s=r*2,i=Ya,o=ai,a=ci;if(As(s,o)){let l=Zi(r,a),u=Wa(s,o);return GA(e,t,n,l,u)}else{let l=HA(r,a),u=L$[l],d=n.direction[u]>=0,p,_;d?(p=ja(r),_=$a(r,a)):(p=$a(r,a),_=ja(r));let m=Xd(p,i,n,Wd)?$d(p,e,t,n):null;if(m){let b=m.point[u];if(d?b<=i[_+l]:b>=i[_+l+3])return m}let x=Xd(_,i,n,Wd)?$d(_,e,t,n):null;return m&&x?m.distance<=x.distance?m:x:m||x||null}}var WA=function(){let r,e,t=[],n=new Tl(()=>new Ut);return function(...o){r=n.getPrimitive(),e=n.getPrimitive(),t.push(r,e);let a=s(...o);n.releasePrimitive(r),n.releasePrimitive(e),t.pop(),t.pop();let c=t.length;return c>0&&(e=t[c-1],r=t[c-2]),a};function s(i,o,a,c,l=null,u=0,h=0){function d(b){let v=b*2,y=ai,E=ci;for(;!As(v,y);)b=ja(b),v=b*2;return Zi(b,E)}function p(b){let v=b*2,y=ai,E=ci;for(;!As(v,y);)b=$a(b,E),v=b*2;return Zi(b,E)+Wa(v,y)}let _=i*2,f=Ya,m=ai,g=ci;if(As(_,m)){let b=Zi(i,g),v=Wa(_,m);return mr(i,f,r),c(b,v,!1,h,u+i,r)}else{let b=ja(i),v=$a(i,g),y=b,E=v,C,M,R,N;if(l&&(R=r,N=e,mr(y,f,R),mr(E,f,N),C=l(R),M=l(N),M<C)){y=v,E=b;let H=C;C=M,M=H,R=N}R||(R=r,mr(y,f,R));let w=As(y*2,m),T=a(R,w,C,h+1,u+y),F;if(T===2){let H=d(y),X=p(y)-H;F=c(H,X,!0,h+1,u+y,R)}else F=T&&s(y,o,a,c,l,u,h+1);if(F)return!0;N=e,mr(E,f,N);let L=As(E*2,m),V=a(N,L,M,h+1,u+E),B;if(V===2){let H=d(E),X=p(E)-H;B=c(H,X,!0,h+1,u+E,N)}else B=V&&s(E,o,a,c,l,u,h+1);return!!B}}}(),jA=function(){let r=new $n,e=new $n,t=new pe,n=new or,s=new or;return function i(o,a,c,l,u=null){let h=o*2,d=Ya,p=ai,_=ci;if(u===null&&(c.boundingBox||c.computeBoundingBox(),n.set(c.boundingBox.min,c.boundingBox.max,l),u=n),As(h,p)){let m=a,g=m.index,x=m.attributes.position,b=c.index,v=c.attributes.position,y=Zi(o,_),E=Wa(h,p);if(t.copy(l).invert(),c.boundsTree)return mr(o,d,s),s.matrix.copy(t),s.needsUpdate=!0,c.boundsTree.shapecast({intersectsBounds:M=>s.intersectsBox(M),intersectsTriangle:M=>{M.a.applyMatrix4(l),M.b.applyMatrix4(l),M.c.applyMatrix4(l),M.needsUpdate=!0;for(let R=y*3,N=(E+y)*3;R<N;R+=3)if(_r(e,R,g,x),e.needsUpdate=!0,M.intersectsTriangle(e))return!0;return!1}});for(let C=y*3,M=E+y*3;C<M;C+=3){_r(r,C,g,x),r.a.applyMatrix4(t),r.b.applyMatrix4(t),r.c.applyMatrix4(t),r.needsUpdate=!0;for(let R=0,N=b.count;R<N;R+=3)if(_r(e,R,b,v),e.needsUpdate=!0,r.intersectsTriangle(e))return!0}}else{let m=o+8,g=_[o+6];return mr(m,d,Xa),!!(u.intersectsBox(Xa)&&i(m,a,c,l,u)||(mr(g,d,Xa),u.intersectsBox(Xa)&&i(g,a,c,l,u)))}}}();function Xd(r,e,t,n){return mr(r,e,Xa),t.intersectBox(Xa,n)}var bg=[],Hd,Ya,ai,ci;function Za(r){Hd&&bg.push(Hd),Hd=r,Ya=new Float32Array(r),ai=new Uint16Array(r),ci=new Uint32Array(r)}function Ml(){Hd=null,Ya=null,ai=null,ci=null,bg.length&&Za(bg.pop())}var wg=Symbol("skip tree generation"),Eg=new Ut,Cg=new Ut,Ja=new pe,Ji=new or,Pl=new or,Nl=new A,Yd=new A,B$=new A,k$=new A,F$=new A,$A=new Ut,Xr=new Tl(()=>new $n),Zt=class{static serialize(e,t={}){if(t.isBufferGeometry)return console.warn("MeshBVH.serialize: The arguments for the function have changed. See documentation for new signature."),Zt.serialize(arguments[0],{cloneBuffers:arguments[2]===void 0?!0:arguments[2]});t={cloneBuffers:!0,...t};let n=e.geometry,s=e._roots,i=n.getIndex(),o;return t.cloneBuffers?o={roots:s.map(a=>a.slice()),index:i.array.slice()}:o={roots:s,index:i.array},o}static deserialize(e,t,n={}){if(typeof n=="boolean")return console.warn("MeshBVH.deserialize: The arguments for the function have changed. See documentation for new signature."),Zt.deserialize(arguments[0],arguments[1],{setIndex:arguments[2]===void 0?!0:arguments[2]});n={setIndex:!0,...n};let{index:s,roots:i}=e,o=new Zt(t,{...n,[wg]:!0});if(o._roots=i,n.setIndex){let a=t.getIndex();if(a===null){let c=new xt(e.index,1,!1);t.setIndex(c)}else a.array!==s&&(a.array.set(s),a.needsUpdate=!0)}return o}constructor(e,t={}){if(e.isBufferGeometry){if(e.index&&e.index.isInterleavedBufferAttribute)throw new Error("MeshBVH: InterleavedBufferAttribute is not supported for the index attribute.")}else throw new Error("MeshBVH: Only BufferGeometries are supported.");if(t=Object.assign({strategy:0,maxDepth:40,maxLeafTris:10,verbose:!0,useSharedArrayBuffer:!1,setBoundingBox:!0,onProgress:null,[wg]:!1},t),t.useSharedArrayBuffer&&typeof SharedArrayBuffer>"u")throw new Error("MeshBVH: SharedArrayBuffer is not available.");this._roots=null,t[wg]||(this._roots=BA(e,t),!e.boundingBox&&t.setBoundingBox&&(e.boundingBox=this.getBoundingBox(new Ut))),this.geometry=e}refit(e=null){e&&Array.isArray(e)&&(e=new Set(e));let t=this.geometry,n=t.index.array,s=t.attributes.position,i=s.array,o=s.offset||0,a=3;s.isInterleavedBufferAttribute&&(a=s.data.stride);let c,l,u,h,d=0,p=this._roots;for(let f=0,m=p.length;f<m;f++)c=p[f],l=new Uint32Array(c),u=new Uint16Array(c),h=new Float32Array(c),_(0,d),d+=c.byteLength;function _(f,m,g=!1){let x=f*2;if(u[x+15]===65535){let v=l[f+6],y=u[x+14],E=1/0,C=1/0,M=1/0,R=-1/0,N=-1/0,w=-1/0;for(let T=3*v,F=3*(v+y);T<F;T++){let L=n[T]*a+o,V=i[L+0],B=i[L+1],H=i[L+2];V<E&&(E=V),V>R&&(R=V),B<C&&(C=B),B>N&&(N=B),H<M&&(M=H),H>w&&(w=H)}return h[f+0]!==E||h[f+1]!==C||h[f+2]!==M||h[f+3]!==R||h[f+4]!==N||h[f+5]!==w?(h[f+0]=E,h[f+1]=C,h[f+2]=M,h[f+3]=R,h[f+4]=N,h[f+5]=w,!0):!1}else{let v=f+8,y=l[f+6],E=v+m,C=y+m,M=g,R=!1,N=!1;e?M||(R=e.has(E),N=e.has(C),M=!R&&!N):(R=!0,N=!0);let w=M||R,T=M||N,F=!1;w&&(F=_(v,m,M));let L=!1;T&&(L=_(y,m,M));let V=F||L;if(V)for(let B=0;B<3;B++){let H=v+B,z=y+B,X=h[H],ee=h[H+3],le=h[z],re=h[z+3];h[f+B]=X<le?X:le,h[f+B+3]=ee>re?ee:re}return V}}}traverse(e,t=0){let n=this._roots[t],s=new Uint32Array(n),i=new Uint16Array(n);o(0);function o(a,c=0){let l=a*2,u=i[l+15]===65535;if(u){let h=s[a+6],d=i[l+14];e(c,u,new Float32Array(n,a*4,6),h,d)}else{let h=a+32/4,d=s[a+6],p=s[a+7];e(c,u,new Float32Array(n,a*4,6),p)||(o(h,c+1),o(d,c+1))}}}raycast(e,t=tr){let n=this._roots,s=this.geometry,i=[],o=t.isMaterial,a=Array.isArray(t),c=s.groups,l=o?t.side:t;for(let u=0,h=n.length;u<h;u++){let d=a?t[c[u].materialIndex].side:l,p=i.length;if(Za(n[u]),jd(0,s,d,e,i),Ml(),a){let _=c[u].materialIndex;for(let f=p,m=i.length;f<m;f++)i[f].face.materialIndex=_}}return i}raycastFirst(e,t=tr){let n=this._roots,s=this.geometry,i=t.isMaterial,o=Array.isArray(t),a=null,c=s.groups,l=i?t.side:t;for(let u=0,h=n.length;u<h;u++){let d=o?t[c[u].materialIndex].side:l;Za(n[u]);let p=$d(0,s,d,e);Ml(),p!=null&&(a==null||p.distance<a.distance)&&(a=p,o&&(p.face.materialIndex=c[u].materialIndex))}return a}intersectsGeometry(e,t){let n=this.geometry,s=!1;for(let i of this._roots)if(Za(i),s=jA(0,n,e,t),Ml(),s)break;return s}shapecast(e,t,n){let s=this.geometry;if(e instanceof Function){if(t){let d=t;t=(p,_,f,m)=>{let g=_*3;return d(p,g,g+1,g+2,f,m)}}e={boundsTraverseOrder:n,intersectsBounds:e,intersectsTriangle:t,intersectsRange:null},console.warn("MeshBVH: Shapecast function signature has changed and now takes an object of callbacks as a second argument. See docs for new signature.")}let i=Xr.getPrimitive(),{boundsTraverseOrder:o,intersectsBounds:a,intersectsRange:c,intersectsTriangle:l}=e;if(c&&l){let d=c;c=(p,_,f,m,g)=>d(p,_,f,m,g)?!0:vg(p,_,s,l,f,m,i)}else c||(l?c=(d,p,_,f)=>vg(d,p,s,l,_,f,i):c=(d,p,_)=>_);let u=!1,h=0;for(let d of this._roots){if(Za(d),u=WA(0,s,a,c,o,h),Ml(),u)break;h+=d.byteLength}return Xr.releasePrimitive(i),u}bvhcast(e,t,n){let{intersectsRanges:s,intersectsTriangles:i}=n,o=this.geometry.index,a=this.geometry.attributes.position,c=e.geometry.index,l=e.geometry.attributes.position;Ja.copy(t).invert();let u=Xr.getPrimitive(),h=Xr.getPrimitive();if(i){let p=function(_,f,m,g,x,b,v,y){for(let E=m,C=m+g;E<C;E++){_r(h,E*3,c,l),h.a.applyMatrix4(t),h.b.applyMatrix4(t),h.c.applyMatrix4(t),h.needsUpdate=!0;for(let M=_,R=_+f;M<R;M++)if(_r(u,M*3,o,a),u.needsUpdate=!0,i(u,h,M,E,x,b,v,y))return!0}return!1};if(s){let _=s;s=function(f,m,g,x,b,v,y,E){return _(f,m,g,x,b,v,y,E)?!0:p(f,m,g,x,b,v,y,E)}}else s=p}this.getBoundingBox(Cg),Cg.applyMatrix4(t);let d=this.shapecast({intersectsBounds:p=>Cg.intersectsBox(p),intersectsRange:(p,_,f,m,g,x)=>(Eg.copy(x),Eg.applyMatrix4(Ja),e.shapecast({intersectsBounds:b=>Eg.intersectsBox(b),intersectsRange:(b,v,y,E,C)=>s(p,_,b,v,m,g,E,C)}))});return Xr.releasePrimitive(u),Xr.releasePrimitive(h),d}intersectsBox(e,t){return Ji.set(e.min,e.max,t),Ji.needsUpdate=!0,this.shapecast({intersectsBounds:n=>Ji.intersectsBox(n),intersectsTriangle:n=>Ji.intersectsTriangle(n)})}intersectsSphere(e){return this.shapecast({intersectsBounds:t=>e.intersectsBox(t),intersectsTriangle:t=>t.intersectsSphere(e)})}closestPointToGeometry(e,t,n={},s={},i=0,o=1/0){e.boundingBox||e.computeBoundingBox(),Ji.set(e.boundingBox.min,e.boundingBox.max,t),Ji.needsUpdate=!0;let a=this.geometry,c=a.attributes.position,l=a.index,u=e.attributes.position,h=e.index,d=Xr.getPrimitive(),p=Xr.getPrimitive(),_=Yd,f=B$,m=null,g=null;s&&(m=k$,g=F$);let x=1/0,b=null,v=null;return Ja.copy(t).invert(),Pl.matrix.copy(Ja),this.shapecast({boundsTraverseOrder:y=>Ji.distanceToBox(y),intersectsBounds:(y,E,C)=>C<x&&C<o?(E&&(Pl.min.copy(y.min),Pl.max.copy(y.max),Pl.needsUpdate=!0),!0):!1,intersectsRange:(y,E)=>{if(e.boundsTree)return e.boundsTree.shapecast({boundsTraverseOrder:C=>Pl.distanceToBox(C),intersectsBounds:(C,M,R)=>R<x&&R<o,intersectsRange:(C,M)=>{for(let R=C*3,N=(C+M)*3;R<N;R+=3){_r(p,R,h,u),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let w=y*3,T=(y+E)*3;w<T;w+=3){_r(d,w,l,c),d.needsUpdate=!0;let F=d.distanceToTriangle(p,_,m);if(F<x&&(f.copy(_),g&&g.copy(m),x=F,b=w/3,v=R/3),F<i)return!0}}}});{let C=h?h.count:u.count;for(let M=0,R=C;M<R;M+=3){_r(p,M,h,u),p.a.applyMatrix4(t),p.b.applyMatrix4(t),p.c.applyMatrix4(t),p.needsUpdate=!0;for(let N=y*3,w=(y+E)*3;N<w;N+=3){_r(d,N,l,c),d.needsUpdate=!0;let T=d.distanceToTriangle(p,_,m);if(T<x&&(f.copy(_),g&&g.copy(m),x=T,b=N/3,v=M/3),T<i)return!0}}}}}),Xr.releasePrimitive(d),Xr.releasePrimitive(p),x===1/0?null:(n.point?n.point.copy(f):n.point=f.clone(),n.distance=x,n.faceIndex=b,s&&(s.point?s.point.copy(g):s.point=g.clone(),s.point.applyMatrix4(Ja),f.applyMatrix4(Ja),s.distance=f.sub(s.point).length(),s.faceIndex=v),n)}closestPointToPoint(e,t={},n=0,s=1/0){let i=n*n,o=s*s,a=1/0,c=null;if(this.shapecast({boundsTraverseOrder:u=>(Nl.copy(e).clamp(u.min,u.max),Nl.distanceToSquared(e)),intersectsBounds:(u,h,d)=>d<a&&d<o,intersectsTriangle:(u,h)=>{u.closestPointToPoint(e,Nl);let d=e.distanceToSquared(Nl);return d<a&&(Yd.copy(Nl),a=d,c=h),d<i}}),a===1/0)return null;let l=Math.sqrt(a);return t.point?t.point.copy(Yd):t.point=Yd.clone(),t.distance=l,t.faceIndex=c,t}getBoundingBox(e){return e.makeEmpty(),this._roots.forEach(n=>{mr(0,new Float32Array(n),$A),e.union($A)}),e}},XA=Zt.prototype.raycast;Zt.prototype.raycast=function(...r){if(r[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycast" has changed. See docs for new signature.');let[e,t,n,s]=r;return XA.call(this,n,e.material).forEach(o=>{o=Ha(o,e,t),o&&s.push(o)}),s}else return XA.apply(this,r)};var YA=Zt.prototype.raycastFirst;Zt.prototype.raycastFirst=function(...r){if(r[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "raycastFirst" has changed. See docs for new signature.');let[e,t,n]=r;return Ha(YA.call(this,n,e.material),e,t)}else return YA.apply(this,r)};var ZA=Zt.prototype.closestPointToPoint;Zt.prototype.closestPointToPoint=function(...r){if(r[0].isMesh){console.warn('MeshBVH: The function signature and results frame for "closestPointToPoint" has changed. See docs for new signature.'),r.unshift();let e=r[1],t={};return r[1]=t,ZA.apply(this,r),e&&e.copy(t.point),t.distance}else return ZA.apply(this,r)};var JA=Zt.prototype.closestPointToGeometry;Zt.prototype.closestPointToGeometry=function(...r){let e=r[2],t=r[3];if(e&&e.isVector3||t&&t.isVector3){console.warn('MeshBVH: The function signature and results frame for "closestPointToGeometry" has changed. See docs for new signature.');let n={},s={},i=r[1];return r[2]=n,r[3]=s,JA.apply(this,r),e&&e.copy(n.point),t&&t.copy(s.point).applyMatrix4(i),n.distance}else return JA.apply(this,r)};var KA=Zt.prototype.refit;Zt.prototype.refit=function(...r){let e=r[0],t=r[1];if(t&&(t instanceof Set||Array.isArray(t))){console.warn('MeshBVH: The function signature for "refit" has changed. See docs for new signature.');let n=new Set;t.forEach(s=>n.add(s)),e&&e.forEach(s=>n.add(s)),KA.call(this,n)}else KA.apply(this,r)};["intersectsGeometry","shapecast","intersectsBox","intersectsSphere"].forEach(r=>{let e=Zt.prototype[r];Zt.prototype[r]=function(...t){return(t[0]===null||t[0].isMesh)&&(t.shift(),console.warn(`MeshBVH: The function signature for "${r}" has changed and no longer takes Mesh. See docs for new signature.`)),e.apply(this,t)}});var Sg=new Wr,QA=new pe,U$=St.prototype.raycast;function Rl(r,e){if(this.geometry.boundsTree){if(this.material===void 0)return;QA.copy(this.matrixWorld).invert(),Sg.copy(r.ray).applyMatrix4(QA);let t=this.geometry.boundsTree;if(r.firstHitOnly===!0){let n=Ha(t.raycastFirst(Sg,this.material),this,r);n&&e.push(n)}else{let n=t.raycast(Sg,this.material);for(let s=0,i=n.length;s<i;s++){let o=Ha(n[s],this,r);o&&e.push(o)}}}else U$.call(this,r,e)}var Ag=class{static assignBVH(e,t){e.raycast=Rl,t=t||new Zt(e.geometry,{verbose:!1}),e.geometry.boundsTree=t}static copyBVH(e,t){let n=t.geometry.boundsTree;n&&(e.raycast=Rl,this.assignBVH(e,n))}};var Ki=class{static block(){this._blocked=!0}static runOrEnqueue(e){this._blocked?this._lastCallback=e:e()}static unblock(){this._blocked=!1,this._lastCallback&&(this._lastCallback(),this._lastCallback=void 0)}};Ki._blocked=!0;function Ka(r,e,t,n){let s=De.attributesDictionary(r),i=De.attributesPreviousValuesDictionary(r),o={value:s[e].clone(),previousValue:s[e]},a=s[e];for(let c of t)Object.defineProperties(a,{[c]:{get:function(){return o.value[c]},set:function(l){if(l!=o.value[c]){o.previousValue=o.value,o.value[c]=l;let u=function(){n(o)};Ki.runOrEnqueue(u)}return l},configurable:!0}});Object.defineProperties(i,{[e]:{get:function(){return o.previousValue},configurable:!0}})}var q$=["x","y","z","w"];function eT(r,e,t){let n=De.attributesDictionary(r);n[e]==null&&(n[e]=new Se),Ka(r,e,q$,t)}var G$=["x","y","z"];function tT(r,e,t){let n=De.attributesDictionary(r);n[e]==null&&(n[e]=new A),Ka(r,e,G$,t)}var H$=["x","y"];function nT(r,e,t){let n=De.attributesDictionary(r);n[e]==null&&(n[e]=new G),Ka(r,e,H$,t)}function rT(r,e,t){let n=De.attributesDictionary(r),s=De.attributesPreviousValuesDictionary(r);n[e]==null&&(n[e]=0);let i={value:n[e],previousValue:n[e]};Object.defineProperties(n,{[e]:{get:function(){return i.value},set:function(o){return o!=i.value&&(i.previousValue=i.value,i.value=o,t(i)),i.value},configurable:!0}}),Object.defineProperties(s,{[e]:{get:function(){return i.previousValue},configurable:!0}})}var Tg="attributes",Mg="attributesPreviousValues";function W$(r){switch(r.length){case 1:return r[0];case 2:return new G(r[0],r[1]);case 3:return new A(r[0],r[1],r[2]);case 4:return new Se(r[0],r[1],r[2],r[3])}}var De=class extends Xi{constructor(e,t){super(t);this._object=e}dispose(){}object(){return this._object}geometry(){return this._object.geometry}coreGeometry(){let e=this.geometry();return e?new Yt(e):null}points(){var e;return((e=this.coreGeometry())==null?void 0:e.points())||[]}pointsFromGroup(e){if(e){let t=Ae.indices(e);if(t){let n=this.points();return Ce.compact(t.map(s=>n[s]))}else return[]}else return this.points()}static isInGroup(e,t){let n=e.trim();if(n.length==0||t.object.name==n||Ae.matchMask(e,t.name()))return!0;let s=n.split("="),i=s[0];if(i[0]=="@"){let o=i.substring(1),a=s[1],c=t.attribValue(o);return a==c}return!1}computeVertexNormals(){var e;(e=this.coreGeometry())==null||e.computeVertexNormals()}static setAttribute(e,t,n){this.addAttribute(e,t,n)}static addAttribute(e,t,n){if(q.isArray(n)&&!W$(n)){let a="attribute_value invalid";throw console.error(a,n),new Error(a)}let s=this.attributesDictionary(e),i=s[t];if(i!=null&&q.isVector(i)&&q.isVector(n)){Ki.block(),i instanceof G&&n instanceof G&&i.copy(n),i instanceof A&&n instanceof A&&i.copy(n),i instanceof Se&&n instanceof Se&&i.copy(n),Ki.unblock();return}q.isVector(n)?s[t]=n.clone():s[t]=n}addAttribute(e,t){De.addAttribute(this._object,e,t)}addNumericAttrib(e,t){this.addAttribute(e,t)}setAttribValue(e,t){this.addAttribute(e,t)}addNumericVertexAttrib(e,t,n){var s;n==null&&(n=bt.default_value(t)),(s=this.coreGeometry())==null||s.addNumericAttrib(e,t,n)}static attributesDictionary(e){return e.userData[Tg]||this._createAttributesDictionaryIfNone(e)}static attributesPreviousValuesDictionary(e){return e.userData[Mg]||this._createAttributesPreviousValuesDictionaryIfNone(e)}static _createAttributesDictionaryIfNone(e){if(!e.userData[Tg])return e.userData[Tg]={}}static _createAttributesPreviousValuesDictionaryIfNone(e){if(!e.userData[Mg])return e.userData[Mg]={}}_attributesDictionary(){return De.attributesDictionary(this._object)}attributeNames(){return Object.keys(this._attributesDictionary())}attribNames(){return this.attributeNames()}hasAttrib(e){return this.attributeNames().includes(e)}renameAttrib(e,t){let n=this.attribValue(e);n!=null?(this.addAttribute(t,n),this.deleteAttribute(e)):console.warn(`attribute ${e} not found`)}deleteAttribute(e){delete this._attributesDictionary()[e]}static deleteAttribute(e,t){delete this.attributesDictionary(e)[t]}static attribValue(e,t,n=0,s){function i(){if(t=="name")return e.name;if(t=="position")return e.position.toArray()}if(t===Or.OBJECT_INDEX)return n;if(e.userData){let a=this.attributesDictionary(e)[t];return a==null?i():q.isArray(a)&&s?(s.fromArray(a),s):a}return i()}static previousAttribValue(e,t){return this.attributesPreviousValuesDictionary(e)[t]}static stringAttribValue(e,t,n=0){let s=this.attribValue(e,t,n);if(s!=null)return q.isString(s)?s:`${s}`}static makeAttribReactive(e,t,n){let i=this.attributesDictionary(e)[t];return i instanceof Se?eT(e,t,n):i instanceof A?tT(e,t,n):i instanceof G?nT(e,t,n):rT(e,t,n)}attribValue(e,t){return De.attribValue(this._object,e,this._index,t)}stringAttribValue(e){return De.stringAttribValue(this._object,e,this._index)}name(){return this.attribValue("name")}humanType(){return $i.CONSTRUCTOR_NAMES_BY_CONSTRUCTOR_NAME[this._object.constructor.name]}attribTypes(){let e={};for(let t of this.attribNames()){let n=this.attribType(t);n!=null&&(e[t]=n)}return e}attribType(e){let t=this.attribValue(e);return q.isString(t)?fr.STRING:fr.NUMERIC}attribSizes(){let e={};for(let t of this.attribNames()){let n=this.attribSize(t);n!=null&&(e[t]=n)}return e}attribSize(e){let t=this.attribValue(e);return t==null?null:bt.attribSizeFromValue(t)}clone(){return De.clone(this._object)}static clone(e){let t=e.clone();var n=new Map,s=new Map;return De.parallelTraverse(e,t,function(i,o){n.set(o,i),s.set(i,o)}),t.traverse(function(i){let o=n.get(i),a=i;if(a.geometry&&o&&o.geometry){let h=o.geometry;a.geometry=Yt.clone(h),Ag.copyBVH(a,o)}if(a.material){dg.applyCustomMaterials(i,a.material);let h=a.material;h.color==null&&(h.color=new ae(1,1,1))}if(o){o.userData&&(i.userData=pn.cloneDeep(o.userData));let h=o;h.animations&&(i.animations=h.animations.map(p=>p.clone()));let d=i;if(d.isSkinnedMesh){var c=d,l=o,u=l.skeleton.bones;c.skeleton=l.skeleton.clone(),c.bindMatrix.copy(l.bindMatrix);let p=u.map(function(_){return s.get(_)});c.skeleton.bones=p,c.bind(c.skeleton,c.bindMatrix)}}}),t}static parallelTraverse(e,t,n){n(e,t);for(var s=0;s<e.children.length;s++){let i=e.children[s],o=t.children[s];i&&o&&this.parallelTraverse(i,o,n)}}};var Pg=class extends Mt{coreContentCloned(){if(this._content)return this._content.clone()}set_content(e){super.set_content(e)}firstObject(){if(this._content)return this._content.objects()[0]}firstCoreObject(){let e=this.firstObject();if(e)return new De(e,0)}firstGeometry(){let e=this.firstObject();return e?e.geometry:null}objectsCount(){return this._content?this._content.objects().length:0}objectsVisibleCount(){let e=0;if(this._content){let t=this._content.objects();for(let n of t)n.visible&&e++}return e}objectsCountByType(){let e={},t=this._content;if(this._content&&t)for(let n of t.coreObjects()){let s=n.humanType();e[s]==null&&(e[s]=0),e[s]+=1}return e}objectsNamesByType(){let e={},t=this._content;if(this._content&&t)for(let n of t.coreObjects()){let s=n.humanType();e[s]=e[s]||[],e[s].push(n.name())}return e}pointAttributeNames(){let e=[],t=this.firstGeometry();return t&&(e=Object.keys(t.attributes)),e}pointAttributeSizesByName(){let e={},t=this.firstGeometry();return t&&Object.keys(t.attributes).forEach(n=>{let s=t.attributes[n];e[n]=s.itemSize}),e}objectAttributeSizesByName(){let e={},t=this.firstCoreObject();if(t){let n=t.attribNames();for(let s of n){let i=t.attribSize(s);i!=null&&(e[s]=i)}}return e}coreGroupAttributeSizesByName(){let e={},t=this._content,n=t.attribNames();for(let s of n){let i=t.attribSize(s);i!=null&&(e[s]=i)}return e}pointAttributeTypesByName(){let e={},t=this.firstGeometry();if(t){let n=new Yt(t);Object.keys(t.attributes).forEach(s=>{e[s]=n.attribType(s)})}return e}objectAttributeTypesByName(){let e={},t=this.firstCoreObject();if(t)for(let n of t.attribNames())e[n]=t.attribType(n);return e}coreGroupAttributeTypesByName(){let e={},t=this._content;for(let n of t.attribNames())e[n]=t.attribType(n);return e}coreGroupAttributeValuesByName(){let e={},t=this._content;for(let n of t.attribNames())e[n]=t.attribValue(n);return e}objectAttributeNames(){let e=[],t=this.firstObject();return t&&(e=Object.keys(t.userData.attributes||{})),e}pointsCount(){return this._content?this._content.pointsCount():0}totalPointsCount(){return this._content?this._content.totalPointsCount():0}objectsData(){return this._content?this._content.objectsData():[]}boundingBox(e=!1){return this._content.boundingBox(e)}center(){return this._content.center()}size(){return this._content.size()}};var Ng=class extends Mt{object(){return this._content}};var Rg=class extends Mt{object(){return this._content}};var Og=class extends Mt{set_content(e){super.set_content(e)}};var Ig=class extends Mt{set_content(e){super.set_content(e)}set_material(e){this._content!=null&&this._content.dispose(),this.set_content(e)}has_material(){return this.has_content()}material(){return this.content()}};var Dg=class extends Mt{set_content(e){super.set_content(e)}set_object(e){return this.set_content(e)}has_object(){return this.has_content()}object(){return this.content()}};var Lg=class extends Mt{set_content(e){super.set_content(e)}texture(){return this._content}coreContent(){return this._content}coreContentCloned(){var e;let t=(e=this._content)==null?void 0:e.clone();return t&&(t.needsUpdate=!0),t}object(){return this.texture()}infos(){if(this._content!=null)return[this._content]}resolution(){function e(t){return[t.videoWidth,t.videoHeight]}if(this._content){let t=this._content.image;if(t){if(t instanceof HTMLImageElement||t instanceof Image||t instanceof ImageData||t instanceof HTMLCanvasElement)return[t.width,t.height];if(t instanceof HTMLVideoElement)return e(t);if(q.isNumber(t.width)&&q.isNumber(t.height))return[t.width,t.height]}let n=this._content.source;if(n){if(n instanceof HTMLVideoElement)return e(n);let s=n.data;if(s&&q.isNumber(s.width)&&q.isNumber(s.height))return[s.width,s.height]}}return[-1,-1]}};var Bg=class extends Mt{set_content(e){super.set_content(e)}render_pass(){return this._content}object(e={}){return this.render_pass()}};var kg=class extends Mt{set_content(e){super.set_content(e)}renderer(){return this._content}};var $p=n4(cU());var Os=class extends Xi{constructor(){super(0);this._objects=[],this._objects_with_geo=[],this._attributes={},this.touch()}dispose(){if(this._objects=[],this._objects_with_geo=[],this._core_objects){for(let e of this._core_objects)e.dispose();this._core_objects=void 0}if(this._core_geometries){for(let e of this._core_geometries)e.dispose();this._core_geometries=void 0}}timestamp(){return this._timestamp}touch(){let e=ie.performance.performanceManager();this._timestamp=e.now(),this.reset()}reset(){this._bounding_box=void 0,this._core_geometries=void 0,this._core_objects=void 0}clone(){let e=new Os;if(this._objects){let n=[];for(let s of this._objects)n.push(De.clone(s));e.setObjects(n)}let t=this.attribNames();for(let n of t){let s=this.attribValue(n);e.addAttribute(n,s)}return e}setObjects(e){this._objects=e,this._objects_with_geo=e.filter(t=>t.geometry!=null),this.touch()}objects(){return this._objects}objectsWithGeo(){return this._objects_with_geo}coreObjects(){return this._core_objects=this._core_objects||this._create_core_objects()}_create_core_objects(){return this._objects?this._objects.map((e,t)=>new De(e,t)):[]}objectsData(){return this._objects?this._objects.map(e=>this._objectData(e)):[]}_objectData(e){let t=0;return e.geometry&&(t=Yt.pointsCount(e.geometry)),{type:pd(e.constructor),name:e.name,children_count:e.children.length,points_count:t}}geometries(){let e=[];for(let t of this.coreObjects()){let n=t.object().geometry;n&&e.push(n)}return e}coreGeometries(){return this._core_geometries=this._core_geometries||this._createCoreGeometries()}_createCoreGeometries(){let e=[];for(let t of this.geometries())e.push(new Yt(t));return e}static geometryFromObject(e){return e.isMesh||e.isLine||e.isPoints?e.geometry:null}faces(){let e=[];for(let t of this.objectsWithGeo())if(t.geometry){let s=new Yt(t.geometry).faces();for(let i of s)i.applyMatrix4(t.matrix),e.push(i)}return e}points(){return this.coreGeometries().map(e=>e.points()).flat()}pointsCount(){return Ce.sum(this.coreGeometries().map(e=>e.pointsCount()))}totalPointsCount(){if(this._objects){let e=0;for(let t of this._objects)t.traverse(n=>{let s=n.geometry;s&&(e+=Yt.pointsCount(s))});return e}else return 0}pointsFromGroup(e){if(e){let t=Ae.indices(e),n=this.points();return Ce.compact(t.map(s=>n[s]))}else return this.points()}static _fromObjects(e){let t=new Os;return t.setObjects(e),t}objectsFromGroup(e){return this.coreObjectsFromGroup(e).map(t=>t.object())}coreObjectsFromGroup(e){if(e=e.trim(),e!==""){let t=parseInt(e);return q.isNaN(t)?this.coreObjects().filter(n=>De.isInGroup(e,n)):Ce.compact([this.coreObjects()[t]])}else return this.coreObjects()}boundingBox(e=!1){return e?this._bounding_box=this._computeBoundingBox():this._bounding_box=this._bounding_box||this._computeBoundingBox()}center(){let e=new A;return this.boundingBox().getCenter(e),e}size(){let e=new A;return this.boundingBox().getSize(e),e}_computeBoundingBox(){let e;if(this._objects)for(let t of this._objects){let n=t.geometry;n&&(n.computeBoundingBox(),e?e.expandByObject(t):n.boundingBox&&(e=n.boundingBox.clone()))}return e=e||new Ut(new A(-1,-1,-1),new A(1,1,1)),e}computeVertexNormals(){for(let e of this.coreObjects())e.computeVertexNormals()}hasAttrib(e){let t;return(t=this.coreGeometries()[0])!=null?t.hasAttrib(e):!1}geoAttribType(e){let t=this.coreGeometries()[0];return t!=null?t.attribType(e):null}objectAttribType(e){let t=this.coreObjects()[0];return t!=null?t.attribType(e):null}renameAttrib(e,t,n){switch(n){case $i.ATTRIB_CLASS.VERTEX:if(this.hasAttrib(e)&&this._objects)for(let s of this._objects)s.traverse(i=>{let o=Os.geometryFromObject(i);o&&new Yt(o).renameAttrib(e,t)});break;case $i.ATTRIB_CLASS.OBJECT:if(this.hasAttrib(e)&&this._objects)for(let s of this._objects)s.traverse(i=>{new De(i,0).renameAttrib(e,t)});break}}geoAttribNames(){let e=this.coreGeometries()[0];return e?e.attribNames():[]}objectAttribNames(){let e=this.coreObjects()[0];return e?e.attribNames():[]}geoAttribNamesMatchingMask(e){return bt.attribNamesMatchingMask(e,this.geoAttribNames())}objectAttribNamesMatchingMask(e){return bt.attribNamesMatchingMask(e,this.objectAttribNames())}attribNamesMatchingMask(e){return bt.attribNamesMatchingMask(e,this.attribNames())}geoAttribSizes(){let e=this.coreGeometries()[0];return e?e.attribSizes():{}}objectAttribSizes(){let e=this.coreObjects()[0];return e?e.attribSizes():{}}geoAttribSize(e){let t=this.coreGeometries()[0];return t?t.attribSize(e):0}addGeoNumericVertexAttrib(e,t,n){n==null&&(n=bt.default_value(t));for(let s of this.coreGeometries())s.addNumericAttrib(e,t,n)}addAttribute(e,t){this._attributesDictionary()[e]=t}deleteAttribute(e){delete this._attributesDictionary()[e]}attribValue(e){return this._attributes&&this._attributes[e]}attribNames(){return this._attributes?Object.keys(this._attributes):[]}attribType(e){let t=this.attribValue(e);return q.isString(t)?fr.STRING:fr.NUMERIC}attribSizes(){let e={};for(let t of this.attribNames()){let n=this.attribSize(t);n!=null&&(e[t]=n)}return e}attribSize(e){let t=this.attribValue(e);return t==null?null:bt.attribSizeFromValue(t)}_attributesDictionary(){return this._attributes||this._createAttributesDictionaryIfNone()}_createAttributesDictionaryIfNone(){return this._attributes||(this._attributes={}),this._attributes}setAttribValue(e,t){this.addAttribute(e,t)}stringAttribValue(e){return this.attribValue(e)}};var lU="operationsComposer",uu=class{constructor(e,t,n){this._scene=e,this.states=t,this._node=n}static type(){throw"type to be overriden"}type(){return this.constructor.type()}static context(){throw console.error("operation has no node_context",this),"context requires override"}context(){return this.constructor.context()}scene(){return this._scene}cook(e,t){}convertExportParamData(e){let{params:t,paramName:n,paramData:s}=e,i=t[n];if(q.isBoolean(s))return s;if(q.isNumber(s))return q.isBoolean(i)?s>=1:s;if(q.isString(s))return i&&(i instanceof Rr||i instanceof Wi)?i.setPath(s):s;q.isArray(s)&&t[n].fromArray(s)}};uu.DEFAULT_PARAMS={};uu.INPUT_CLONED_STATE=[];var Iue="position",hu=class{static createIndexIfNone(e){if(!e.index){let t=e.getAttribute(Iue);if(t){let n=t.array;e.setIndex(Ce.range(n.length/3))}}}};var zt=class extends uu{static context(){return se.SOP}cook(e,t){}createCoreGroupFromObjects(e){let t=new Os;return t.setObjects(e),t}createCoreGroupFromGeometry(e,t=kn.MESH){let n=zt.createObject(e,t);return this.createCoreGroupFromObjects([n])}createObject(e,t,n){return zt.createObject(e,t,n)}static createObject(e,t,n){this.createIndexIfNone(e);let s=WC[t];n=n||$i.MATERIALS[t].clone();let i=new s(e,n);return this.applyObjectDefault(i),i}static applyObjectDefault(e){e.castShadow=!0,e.receiveShadow=!0,e.frustumCulled=!1,e.matrixAutoUpdate=!1}createIndexIfNone(e){zt.createIndexIfNone(e)}static createIndexIfNone(e){hu.createIndexIfNone(e)}};var ix={[kn.MESH]:new _s({color:16777215,vertexColors:!0,side:tr,metalness:0,roughness:.9}),[kn.LINE_SEGMENTS]:new Ln({color:16777215,linewidth:1,vertexColors:!0})};var V2e=new pe,q2e=new A,G2e=new dt,H2e=new A;var Z2e=new pe,J2e=new A,K2e=new dt,Q2e=new A;function uU(r){return $p.default.geometries.geom3.isA(r)?"geom3":$p.default.geometries.geom2.isA(r)?"geom2":$p.default.geometries.path2.isA(r)?"path2":"unknown"}var ox=class extends Mt{coreContentCloned(){if(this._content)return this._content.clone()}set_content(e){super.set_content(e)}objectTypes(){return this._content.objects().map(e=>uU(e))}};var hU={[se.ACTOR]:hd,[se.ANIM]:hd,[se.AUDIO]:tg,[se.COP]:Lg,[se.CSG]:ox,[se.EVENT]:ng,[se.GL]:Ng,[se.JS]:Rg,[se.MANAGER]:Og,[se.MAT]:Ig,[se.OBJ]:Dg,[se.POST]:Bg,[se.ROP]:kg,[se.SOP]:Pg};var ax=class{constructor(e){this.node=e,this._callbacks=[],this._callbacksTmp=[],this._container=this._createContainer()}container(){return this._container}_createContainer(){let e=hU[this.node.context()];return new e(this.node)}containerUnlessBypassed(){var e,t;if((t=(e=this.node.flags)==null?void 0:e.bypass)==null?void 0:t.active()){this.node.states.error.clear();let n=this.node.io.inputs.input(0);return n?n.containerController.containerUnlessBypassed():this._createContainer()}else return this.container()}async compute(){var e,t;if((t=(e=this.node.flags)==null?void 0:e.bypass)==null?void 0:t.active())if(this.node.states.error.clear(),this.node.io.inputs.input(0)){let s=await this.requestInputContainer(0)||this._container;return this.node.cookController.endCook(),s}else return this._createContainer();return this.node.isDirty()?new Promise((n,s)=>{var i,o;if(this._callbacks.push(n),(o=(i=this.node.flags)==null?void 0:i.bypass)==null?void 0:o.active())throw"we should not be here";this.node.cookController.cookMain()}):this._container}async requestInputContainer(e){let t=this.node.io.inputs.input(e);return t?await t.compute():(this.node.states.error.set(`input ${e} required`),this.notifyRequesters(),null)}notifyRequesters(e){this._callbacksTmp=this._callbacks.slice(),this._callbacks.splice(0,this._callbacks.length),e||(e=this.node.containerController.container());let t;for(;t=this._callbacksTmp.pop();)t(e);this.node.scene().cookController.removeNode(this.node)}};var Ec=ie.performance.performanceManager(),cx=class{constructor(e){this.cookController=e,this._inputsStart=0,this._inputsTime=0,this._paramsStart=0,this._paramsTime=0,this._cookStart=0,this._cookTime=0,this._cooksCount=0,this._data={inputsTime:0,paramsTime:0,cookTime:0}}cooksCount(){return this._cooksCount}data(){return this._data.inputsTime=this._inputsTime,this._data.paramsTime=this._paramsTime,this._data.cookTime=this._cookTime,this._data}active(){return this.cookController.performanceRecordStarted()}recordInputsStart(){this.active()&&(this._inputsStart=Ec.now())}recordInputsEnd(){this.active()&&(this._inputsTime=Ec.now()-this._inputsStart)}recordParamsStart(){this.active()&&(this._paramsStart=Ec.now())}recordParamsEnd(){this.active()&&(this._paramsTime=Ec.now()-this._paramsStart)}recordCookStart(){this.active()&&(this._cookStart=Ec.now())}recordCookEnd(){this.active()&&(this._cookTime=Ec.now()-this._cookStart,this._cooksCount+=1)}};var lx=class{constructor(e){this.node=e,this._cooking=!1,this._performanceController=new cx(this),this._inputsEvaluationRequired=!0,this._corePerformance=this.node.scene().performance}performanceRecordStarted(){return this._corePerformance.started()}dispose(){this._clearHooks()}disallowInputsEvaluation(){this._inputsEvaluationRequired=!1}isCooking(){return this._cooking===!0}_startCookIfNoErrors(e){if(this.node.states.error.active())this.endCook();else try{this._performanceController.recordCookStart(),this.node.cook(e||[])}catch(t){this.node.states.error.set(`node internal error: '${t}'.`),ie.warn(t),this.endCook()}}async cookMain(){if(!this.isCooking()){this._initCookingState(),this.node.states.error.clear(),this.node.scene().cookController.addNode(this.node);try{let e=this._inputsEvaluationRequired?await this._evaluateInputs():void 0;this.node.params.paramsEvalRequired()&&await this._evaluateParams(),this._startCookIfNoErrors(e)}catch(e){this.node.states.error.set(`node inputs error: '${e}'.`),ie.warn(e),this.endCook()}}}async cookMainWithoutInputs(){if(this.node.scene().cookController.addNode(this.node),this.isCooking()){ie.warn("cook_main_without_inputs already cooking",this.node.path());return}this._initCookingState(),this.node.states.error.clear(),this.node.params.paramsEvalRequired()&&await this._evaluateParams(),this._startCookIfNoErrors(void 0)}endCook(e){var t,n;this._finalizeCookPerformance();let s=this.node.dirtyController.dirtyTimestamp();if(s==null||s===this._cookingDirtyTimestamp)this.node.removeDirtyState(),this._terminateCookProcess();else{if((n=(t=this.node.flags)==null?void 0:t.bypass)==null?void 0:n.active())return;ie.log("COOK AGAIN",s,this._cookingDirtyTimestamp,this.node.path()),this._cooking=!1,this.cookMain()}}_initCookingState(){this._cooking=!0,this._cookingDirtyTimestamp=this.node.dirtyController.dirtyTimestamp()}_terminateCookProcess(){this.isCooking()&&(this._cooking=!1,this.node.containerController.notifyRequesters(),this._runOnCookCompleteHooks())}async _evaluateInputs(){this._performanceController.recordInputsStart();let e=this.node.io.inputs,t=this._inputsEvaluationRequired?e.isGraphNodeDirty()?await e.evalRequiredInputs():e.containersWithoutEvaluation():[],n=e.inputs(),s=[],i;for(let o=0;o<n.length;o++)i=t[o],i&&(e.cloneRequired(o)?s[o]=i.coreContentCloned():s[o]=i.coreContent());return this._performanceController.recordInputsEnd(),s}async _evaluateParams(){this._performanceController.recordParamsStart(),await this.node.params.evalAll(),this._performanceController.recordParamsEnd()}cooksCount(){return this._performanceController.cooksCount()}cookTime(){return this._performanceController.data().cookTime}_finalizeCookPerformance(){!this._corePerformance.started()||(this._performanceController.recordCookEnd(),this._corePerformance.recordNodeCookData(this.node,this._performanceController.data()))}registerOnCookEnd(e,t){this._onCookCompleteHookNames=this._onCookCompleteHookNames||[],this._onCookCompleteHooks=this._onCookCompleteHooks||[],this._onCookCompleteHookNames.push(e),this._onCookCompleteHooks.push(t)}_clearHooks(){if(!(!this._onCookCompleteHookNames||!this._onCookCompleteHooks))for(let e of this._onCookCompleteHookNames)this.deregisterOnCookEnd(e)}deregisterOnCookEnd(e){var t;if(!this._onCookCompleteHookNames||!this._onCookCompleteHooks)return;let n=(t=this._onCookCompleteHookNames)==null?void 0:t.indexOf(e);this._onCookCompleteHookNames.splice(n,1),this._onCookCompleteHooks.splice(n,1),this._onCookCompleteHookNames.length==0&&(this._onCookCompleteHookNames=void 0),this._onCookCompleteHooks.length==0&&(this._onCookCompleteHooks=void 0)}_runOnCookCompleteHooks(){if(this._onCookCompleteHooks){let e=[...this._onCookCompleteHooks];for(let t of e)t()}}onCookEndCallbackNames(){return this._onCookCompleteHookNames}};var du=class{constructor(e){this.node=e}dispose(){}toJSON(e=!1){var t,n,s,i,o,a;let c={name:this.node.name(),type:this.node.type(),graph_node_id:this.node.graphNodeId(),is_dirty:this.node.isDirty(),ui_data_json:this.node.uiData.toJSON(),error_message:this.node.states.error.message(),children:this.childrenIds(),maxInputsCount:this.maxInputsCount(),inputs:this.inputIds(),input_connection_output_indices:this.inputConnectionOutputIndices(),named_input_connection_points:this.namedInputConnectionPoints(),named_output_connection_points:this.namedOutputConnectionPoints(),param_ids:this.to_json_params(e),override_cloned_state_allowed:this.node.io.inputs.overrideClonedStateAllowed(),inputs_clone_required_states:this.node.io.inputs.cloneRequiredStates(),flags:{display:(n=(t=this.node.flags)==null?void 0:t.display)==null?void 0:n.active(),bypass:(i=(s=this.node.flags)==null?void 0:s.bypass)==null?void 0:i.active(),optimize:(a=(o=this.node.flags)==null?void 0:o.optimize)==null?void 0:a.active()},selection:void 0};return this.node.childrenAllowed()&&this.node.childrenController&&(c.selection=this.node.childrenController.selection.toJSON()),c}childrenIds(){return this.node.children().map(e=>e.graphNodeId())}maxInputsCount(){return this.node.io.inputs.maxInputsCount()}inputIds(){return this.node.io.inputs.inputs().map(e=>e!=null?e.graphNodeId():void 0)}inputConnectionOutputIndices(){var e;return(e=this.node.io.connections.inputConnections())==null?void 0:e.map(t=>t!=null?t.output_index:void 0)}namedInputConnectionPoints(){return this.node.io.inputs.namedInputConnectionPoints().map(e=>e.toJSON())}namedOutputConnectionPoints(){return this.node.io.outputs.namedOutputConnectionPoints().map(e=>e.toJSON())}to_json_params_from_names(e,t=!1){return e.map(n=>this.node.params.get(n).graphNodeId())}to_json_params(e=!1){return this.to_json_params_from_names(this.node.params.names,e)}};var It=(r=>(r.VISIBLE_UPDATED="param_visible_updated",r.EDITABLE_UPDATED="param_editable_updated",r.RAW_INPUT_UPDATED="raw_input_updated",r.VALUE_UPDATED="param_value_updated",r.EXPRESSION_UPDATED="param_expression_update",r.ERROR_UPDATED="param_error_updated",r.DELETED="param_deleted",r))(It||{});var pu="callback",ux="callbackString",Due="computeOnDirty",Lue="cook",Bue="fileBrowse",kue="extensions",Fue="expression",Uue="forEntities",zue="label",dU="hideLabel",Vue="level",que="menu",Gue="menuString",Hue="entries",Wue="multiline",jue="language",$ue="nodeSelection",Xue="context",Yue="types",Zue="objectMask",pU="dependentOnFoundNode",fU="dependentOnFoundParam",Jue="range",Kue="rangeLocked",Que="step",ehe="spare",the="texture",nhe="env",mU="hidden",rhe="field",hx="visibleIf",she="conversion",ihe="separatorBefore",ohe="separatorAfter",ahe="joinToPreviousParam";var Xp="editable";var che=[Xp],Yp=class{constructor(e){this._param=e,this._programatic_visible_state=!0,this._callbackAllowed=!1,this._updateVisibilityAndRemoveDirtyBound=this.updateVisibilityAndRemoveDirty.bind(this),this._ui_data_dependency_set=!1}dispose(){var e;try{this._options[pu]=void 0,this._options[ux]=void 0}catch{}(e=this._visibility_graph_node)==null||e.dispose()}set(e){q.isString(e)&&console.warn("options input invalid",e,typeof e),this._default_options=e,this._options=pn.cloneDeep(this._default_options),this.post_set_options()}copy(e){this._default_options=pn.cloneDeep(e.default()),this._options=pn.cloneDeep(e.current()),this.post_set_options()}setOption(e,t){if(!!this._validateOption(e,t)&&(this._options[e]=t,this._param.components))for(let n of this._param.components)n.options.setOption(e,t)}_validateOption(e,t){return e==pu?Na(t):!0}post_set_options(){this._handleComputeOnDirty()}param(){return this._param}node(){return this._param.node}default(){return this._default_options}current(){return this._options}hasOptionsOverridden(){return!pn.isEqual(this._options,this._default_options)}overriddenOptions(){let e={},t=Object.keys(this._options),n=Ce.difference(t,che);for(let s of n)if(!pn.isEqual(this._options[s],this._default_options[s])){let i=pn.cloneDeep(this._options[s]);Object.assign(e,{[s]:i})}return e}overriddenOptionNames(){return Object.keys(this.overriddenOptions())}computeOnDirty(){return this._options[Due]||!1}_handleComputeOnDirty(){this.computeOnDirty()&&(this._computeOnDirty_callback_added||(this.param().addPostDirtyHook("computeOnDirty",this._computeParam.bind(this)),this._computeOnDirty_callback_added=!0))}async _computeParam(){await this.param().compute()}hasCallback(){return this._options[pu]!=null||this._options[ux]!=null}allowCallback(){this._callbackAllowed=!0}async executeCallback(){if(!this._callbackAllowed||!this.node())return;let e=this.getCallback();if(!e||!this.node().scene().loadingController.loaded())return;let t=this.param().parentParam();t?t.options.executeCallback():await e(this.node(),this.param())}getCallback(){if(this.hasCallback())return this._options[pu]=this._options[pu]||this.createCallbackFromString()}createCallbackFromString(){let e=this._options[ux];if(e){let t=new Function("node","scene","window","location",e);return()=>{t(this.node(),this.node().scene(),null,null)}}}colorConversion(){return this._options[she]}makesNodeDirtyWhenDirty(){if(this.param().parentParam()!=null)return!1;let e=this._options[Lue];return e??!0}fileBrowseOption(){return this._options[Bue]}fileBrowseAllowed(){return this.fileBrowseOption()!=null}fileBrowseExtensions(){let e=this.fileBrowseOption();return e?e[kue]:null}separatorBefore(){return this._options[ihe]}separatorAfter(){return this._options[ohe]}joinToPreviousParam(){return this._options[ahe]}setEditableState(e){let t=this._options[Xp],n=this.param();if(t!=e&&(this._options[Xp]=e,n.emit(It.EDITABLE_UPDATED)),n.components)for(let s of n.components)s.options.setEditableState(e)}editable(){let e=this._options[Xp];return e??!0}isExpressionForEntities(){let e=this._options[Fue];return e&&e[Uue]||!1}level(){return this._options[Vue]||0}hasMenu(){return this.menuOptions()!=null||this.menuStringOptions()!=null}menuOptions(){return this._options[que]}menuStringOptions(){return this._options[Gue]}menuEntries(){let e=this.menuOptions()||this.menuStringOptions();return e?e[Hue]:[]}isMultiline(){return this._options[Wue]===!0}language(){return this._options[jue]}isCode(){return this.language()!=null}nodeSelectionOptions(){return this._options[$ue]}nodeSelectionContext(){let e=this.nodeSelectionOptions();if(e)return e[Xue]}nodeSelectionTypes(){let e=this.nodeSelectionOptions();if(e)return e[Yue]}objectMask(){return this._options[Zue]==!0}dependentOnFoundNode(){return pU in this._options?this._options[pU]:!0}dependentOnFoundParam(){return fU in this._options?this._options[fU]:!0}isSelectingParam(){return this.param().type()==U.PARAM_PATH}range(){return this._options[Jue]||[0,1]}step(){return this._options[Que]}rangeLocked(){return this._options[Kue]||[!1,!1]}ensureInRange(e){let t=this.range();return e>=t[0]&&e<=t[1]?e:e<t[0]?this.rangeLocked()[0]===!0?t[0]:e:this.rangeLocked()[1]===!0?t[1]:e}isSpare(){return this._options[ehe]||!1}textureOptions(){return this._options[the]}textureAsEnv(){let e=this.textureOptions();return e!=null?e[nhe]===!0:!1}isHidden(){return this._options[mU]===!0||this._programatic_visible_state===!1}isVisible(){return!this.isHidden()}setVisibleState(e){this._options[mU]=!e,this.param().emit(It.VISIBLE_UPDATED)}label(){return this._options[zue]}isLabelHidden(){switch(this.param().type()){case U.BUTTON:return!0;case U.BOOLEAN:return this.isFieldHidden();case U.RAMP:return this._options[dU]||!1;case U.STRING:return this.isCode()&&this._options[dU]||!1}return!1}isFieldHidden(){return this._options[rhe]===!1}uiDataDependsOnOtherParams(){return hx in this._options}visibilityPredecessors(){let e=this._options[hx];if(!e)return[];let t=[];q.isArray(e)?t=Ce.uniq(e.map(s=>Object.keys(s)).flat()):t=Object.keys(e);let n=this.param().node;return Ce.compact(t.map(s=>{let i=n.params.get(s);if(i)return i;console.error(`param ${s} not found as visibility condition for ${this.param().name()} in node ${this.param().node.type()}`)}))}setUiDataDependency(){if(this._ui_data_dependency_set)return;this._ui_data_dependency_set=!0;let e=this.visibilityPredecessors();if(e.length>0){this._visibility_graph_node=new Rt(this.param().scene(),"param_visibility");for(let t of e)this._visibility_graph_node.addGraphInput(t);this._visibility_graph_node.addPostDirtyHook("_update_visibility_and_remove_dirty",this._updateVisibilityAndRemoveDirtyBound)}}updateVisibilityAndRemoveDirty(){this.updateVisibility(),this.param().removeDirtyState()}async updateVisibility(){let e=this._options[hx];if(e){let t=this.visibilityPredecessors(),n=t.map(s=>{if(s.isDirty())return s.compute()});if(this._programatic_visible_state=!1,await Promise.all(n),q.isArray(e))for(let s of e)t.filter(o=>o.value==s[o.name()]).length==t.length&&(this._programatic_visible_state=!0);else{let s=t.filter(i=>i.value==e[i.name()]);this._programatic_visible_state=s.length==t.length}this.param().emit(It.VISIBLE_UPDATED)}}};var Zp=class{constructor(e){this.param=e,this._blockedEmit=!1,this._blockedParentEmit=!1,this._countByEventName=new Map}emitAllowed(){return this._blockedEmit===!0||this.param.scene().loadingController.isLoading()?!1:this.param.scene().dispatchController.emitAllowed()}blockEmit(){if(this._blockedEmit=!0,this.param.isMultiple()&&this.param.components)for(let e of this.param.components)e.emitController.blockEmit();return!0}unblockEmit(){if(this._blockedEmit=!1,this.param.isMultiple()&&this.param.components)for(let e of this.param.components)e.emitController.unblockEmit();return!0}blockParentEmit(){return this._blockedParentEmit=!0,!0}unblockParentEmit(){return this._blockedParentEmit=!1,!0}incrementCount(e){let t=(this._countByEventName.get(e)||0)+1;this._countByEventName.set(e,t)}eventsCount(e){return this._countByEventName.get(e)||0}emit(e){if(this.emitAllowed()){this.param.emit(e);let t=this.param.parentParam();t!=null&&this._blockedParentEmit!==!0&&t.emit(e)}}};var dx=class{constructor(e){this.param=e}toJSON(){let e={name:this.param.name(),type:this.param.type(),raw_input:this.rawInput(),value:this.value(),value_pre_conversion:this.value_pre_conversion(),expression:this.expression(),graph_node_id:this.param.graphNodeId(),error_message:this.error_message(),is_visible:this.is_visible(),editable:this.editable(),components:void 0};return this.param.isMultiple()&&this.param.components&&(e.components=this.param.components.map(t=>t.graphNodeId())),e}rawInput(){return this.param.rawInputSerialized()}value(){return this.param.valueSerialized()}value_pre_conversion(){return this.param.valuePreConversionSerialized()}expression(){var e;return this.param.hasExpression()?(e=this.param.expressionController)==null?void 0:e.expression():void 0}error_message(){return this.param.states.error.message()}is_visible(){return this.param.options.isVisible()}editable(){return this.param.options.editable()}};var px=class{constructor(e){this.param=e}active(){let e=this.param.scene().timeController.graphNode.graphNodeId();return this.param.graphPredecessorIds().includes(e)}};var fx=class{constructor(e){this.param=e}set(e){this._message!=e&&(this._message=e,this._message&&ie.warn(this.param.path(),this._message),this.param.emitController.emit(It.ERROR_UPDATED))}message(){return this._message}clear(){this.set(void 0)}active(){return this._message!=null}};var mx=class{constructor(e){this.param=e,this.timeDependent=new px(this.param),this.error=new fx(this.param)}};var ho=class extends Rt{constructor(e,t,n){super(e.scene(),"MethodDependency");this.param=e,this.path_argument=t,this.decomposed_path=n,this._update_from_name_change_bound=this._update_from_name_change.bind(this);var s;(s=e.expressionController)==null||s.registerMethodDependency(this),this.addPostDirtyHook("_update_from_name_change",this._update_from_name_change_bound)}_update_from_name_change(e){if(e&&this.decomposed_path){let t=e;this.decomposed_path.update_from_name_change(t);let n=this.decomposed_path.to_path(),s=this.jsep_node;s&&(s.value=`${s.value}`.replace(`${this.path_argument}`,n),s.raw=s.raw.replace(`${this.path_argument}`,n)),this.param.expressionController&&this.param.expressionController.updateFromMethodDependencyNameChange()}}reset(){this.graphDisconnectPredecessors()}listen_for_name_changes(){if(this.jsep_node&&this.decomposed_path){for(let e of this.decomposed_path.named_nodes())if(e){let t=e;t.nameController&&this.addGraphInput(t.nameController.graphNode())}}}set_jsep_node(e){this.jsep_node=e}set_resolved_graph_node(e){this.resolved_graph_node=e}set_unresolved_path(e){this.unresolved_path=e}static create(e,t,n,s){let i=q.isNumber(t),o=new ho(e,t,s);if(n)o.set_resolved_graph_node(n);else if(!i){let a=t;o.set_unresolved_path(a)}return o}};var lhe=[],Sn=class extends Rt{constructor(e,t){super(e,"BaseParam");this._options=new Yp(this),this._emitController=new Zp(this),this._isComputing=!1,this._node=t,this._initializeParam()}get options(){return this._options=this._options||new Yp(this)}get emitController(){return this._emitController=this._emitController||new Zp(this)}get expressionController(){return this._expression_controller}get serializer(){return this._serializer=this._serializer||new dx(this)}get states(){return this._states=this._states||new mx(this)}dispose(){var e,t;let n=this.graphPredecessors();for(let i of n)i instanceof ho&&i.dispose();let s=this.graphSuccessors();for(let i of s)if(i instanceof Sn){let o=i.rawInputSerialized();i.set(i.defaultValue()),i.set(o)}else i.setDirty();this.scene().missingExpressionReferencesController.deregisterParam(this),(e=this._expression_controller)==null||e.dispose(),super.dispose(),(t=this._options)==null||t.dispose(),this._node=void 0,this._parent_param=void 0,this._runOnDisposeCallbacks()}_initializeParam(){}static type(){return U.FLOAT}type(){return this.constructor.type()}isNumeric(){return!1}setName(e){super.setName(e)}get value(){return this._value}copyValue(e){e.type()==this.type()?this._copyValue(e):console.warn(`cannot copy value from ${e.type()} to ${this.type()}`)}_copyValue(e){throw"abstract method param._copy_value"}valuePreConversionSerialized(){}convert(e){return null}static areRawInputEqual(e,t){return!1}isRawInputEqual(e){return this.constructor.areRawInputEqual(this._raw_input,e)}static areValuesEqual(e,t){return!1}isValueEqual(e){return this.constructor.areValuesEqual(this.value,e)}_cloneRawInput(e){return e}set(e){this._raw_input=this._cloneRawInput(this._prefilterInvalidRawInput(e)),this.emitController.emit(It.RAW_INPUT_UPDATED),this.processRawInput()}_prefilterInvalidRawInput(e){return e}defaultValue(){return this._default_value}isDefault(){return this._raw_input==this._default_value}rawInput(){return this._raw_input}processRawInput(){}isComputing(){return this._isComputing}async compute(){if(this.scene().loadingController.isLoading()&&ie.warn(`param attempt to compute ${this.path()} while scene is loading`),this.isDirty()){if(this._isComputing)return new Promise((e,t)=>{this._computeResolves=this._computeResolves||[],this._computeResolves.push(e)});if(this._isComputing=!0,await this.processComputation(),this._isComputing=!1,this._computeResolves){let e=[...this._computeResolves];this._computeResolves=void 0;for(let t of e)t()}}}async processComputation(){}setInitValue(e){this._default_value=this._cloneRawInput(this._prefilterInvalidRawInput(e))}_setupNodeDependencies(e){var t,n;if(e?(this.options.allowCallback(),this.parentParam()||(this.options.makesNodeDirtyWhenDirty()?(n=e.params.params_node)==null||n.addGraphInput(this,!1):this.dirtyController.addPostDirtyHook("run callback",async()=>{await this.compute(),this.options.executeCallback()}))):this._node&&((t=this._node.params.params_node)==null||t.removeGraphInput(this)),this.components)for(let s of this.components)s._setupNodeDependencies(e)}get node(){return this._node}parent(){return this.node}set_parent_param(e){e.addGraphInput(this,!1),this._parent_param=e}parentParam(){return this._parent_param}has_parent_param(){return this._parent_param!=null}path(){var e;return((e=this.node)==null?void 0:e.path())+"/"+this.name()}pathRelativeTo(e){if(!this._node)return this.name();let t=Qe.relativePath(e,this._node);return t.length>0?Qe.sanitizePath(`${t}${Qe.SEPARATOR}${this.name()}`):this.name()}emit(e){this.emitController.emitAllowed()&&(this.emitController.incrementCount(e),this.scene().dispatchController.dispatch(this,e))}get components(){return this._components}componentNames(){return lhe}isMultiple(){return this.componentNames().length>0}initComponents(){}hasExpression(){return this.expressionController!=null&&this.expressionController.active()}toJSON(){return this.serializer.toJSON()}onDispose(e){this._onDisposeCallbacks=this._onDisposeCallbacks||new Set,this._onDisposeCallbacks.add(e)}deregisterOnDispose(e){this._onDisposeCallbacks&&this._onDisposeCallbacks.delete(e)}_runOnDisposeCallbacks(){this._onDisposeCallbacks&&(this._onDisposeCallbacks.forEach(e=>{e()}),this._onDisposeCallbacks.clear(),this._onDisposeCallbacks=void 0)}};var gU=class{add(e,t,n){if(typeof arguments[0]!="string")for(let s in arguments[0])this.add(s,arguments[0][s],arguments[1]);else(Array.isArray(e)?e:[e]).forEach(function(s){this[s]=this[s]||[],t&&this[s][n?"unshift":"push"](t)},this)}run(e,t){this[e]=this[e]||[],this[e].forEach(function(n){n.call(t&&t.context?t.context:t,t)})}},yU=class{constructor(e){this.jsep=e,this.registered={}}register(...e){e.forEach(t=>{if(typeof t!="object"||!t.name||!t.init)throw new Error("Invalid JSEP plugin format");this.registered[t.name]||(t.init(this.jsep),this.registered[t.name]=t)})}},J=class{static get version(){return"1.0.2"}static toString(){return"JavaScript Expression Parser (JSEP) v"+J.version}static addUnaryOp(e){return J.max_unop_len=Math.max(e.length,J.max_unop_len),J.unary_ops[e]=1,J}static addBinaryOp(e,t){return J.max_binop_len=Math.max(e.length,J.max_binop_len),J.binary_ops[e]=t,J}static addIdentifierChar(e){return J.additional_identifier_chars.add(e),J}static addLiteral(e,t){return J.literals[e]=t,J}static removeUnaryOp(e){return delete J.unary_ops[e],e.length===J.max_unop_len&&(J.max_unop_len=J.getMaxKeyLen(J.unary_ops)),J}static removeAllUnaryOps(){return J.unary_ops={},J.max_unop_len=0,J}static removeIdentifierChar(e){return J.additional_identifier_chars.delete(e),J}static removeBinaryOp(e){return delete J.binary_ops[e],e.length===J.max_binop_len&&(J.max_binop_len=J.getMaxKeyLen(J.binary_ops)),J}static removeAllBinaryOps(){return J.binary_ops={},J.max_binop_len=0,J}static removeLiteral(e){return delete J.literals[e],J}static removeAllLiterals(){return J.literals={},J}get char(){return this.expr.charAt(this.index)}get code(){return this.expr.charCodeAt(this.index)}constructor(e){this.expr=e,this.index=0}static parse(e){return new J(e).parse()}static getMaxKeyLen(e){return Math.max(0,...Object.keys(e).map(t=>t.length))}static isDecimalDigit(e){return e>=48&&e<=57}static binaryPrecedence(e){return J.binary_ops[e]||0}static isIdentifierStart(e){return e>=65&&e<=90||e>=97&&e<=122||e>=128&&!J.binary_ops[String.fromCharCode(e)]||J.additional_identifier_chars.has(String.fromCharCode(e))}static isIdentifierPart(e){return J.isIdentifierStart(e)||J.isDecimalDigit(e)}throwError(e){let t=new Error(e+" at character "+this.index);throw t.index=this.index,t.description=e,t}runHook(e,t){if(J.hooks[e]){let n={context:this,node:t};return J.hooks.run(e,n),n.node}return t}searchHook(e){if(J.hooks[e]){let t={context:this};return J.hooks[e].find(function(n){return n.call(t.context,t),t.node}),t.node}}gobbleSpaces(){let e=this.code;for(;e===J.SPACE_CODE||e===J.TAB_CODE||e===J.LF_CODE||e===J.CR_CODE;)e=this.expr.charCodeAt(++this.index);this.runHook("gobble-spaces")}parse(){this.runHook("before-all");let e=this.gobbleExpressions(),t=e.length===1?e[0]:{type:J.COMPOUND,body:e};return this.runHook("after-all",t)}gobbleExpressions(e){let t=[],n,s;for(;this.index<this.expr.length;)if(n=this.code,n===J.SEMCOL_CODE||n===J.COMMA_CODE)this.index++;else if(s=this.gobbleExpression())t.push(s);else if(this.index<this.expr.length){if(n===e)break;this.throwError('Unexpected "'+this.char+'"')}return t}gobbleExpression(){let e=this.searchHook("gobble-expression")||this.gobbleBinaryExpression();return this.gobbleSpaces(),this.runHook("after-expression",e)}gobbleBinaryOp(){this.gobbleSpaces();let e=this.expr.substr(this.index,J.max_binop_len),t=e.length;for(;t>0;){if(J.binary_ops.hasOwnProperty(e)&&(!J.isIdentifierStart(this.code)||this.index+e.length<this.expr.length&&!J.isIdentifierPart(this.expr.charCodeAt(this.index+e.length))))return this.index+=t,e;e=e.substr(0,--t)}return!1}gobbleBinaryExpression(){let e,t,n,s,i,o,a,c,l;if(o=this.gobbleToken(),!o||(t=this.gobbleBinaryOp(),!t))return o;for(i={value:t,prec:J.binaryPrecedence(t)},a=this.gobbleToken(),a||this.throwError("Expected expression after "+t),s=[o,i,a];t=this.gobbleBinaryOp();){if(n=J.binaryPrecedence(t),n===0){this.index-=t.length;break}for(i={value:t,prec:n},l=t;s.length>2&&n<=s[s.length-2].prec;)a=s.pop(),t=s.pop().value,o=s.pop(),e={type:J.BINARY_EXP,operator:t,left:o,right:a},s.push(e);e=this.gobbleToken(),e||this.throwError("Expected expression after "+l),s.push(i,e)}for(c=s.length-1,e=s[c];c>1;)e={type:J.BINARY_EXP,operator:s[c-1].value,left:s[c-2],right:e},c-=2;return e}gobbleToken(){let e,t,n,s;if(this.gobbleSpaces(),s=this.searchHook("gobble-token"),s)return this.runHook("after-token",s);if(e=this.code,J.isDecimalDigit(e)||e===J.PERIOD_CODE)return this.gobbleNumericLiteral();if(e===J.SQUOTE_CODE||e===J.DQUOTE_CODE)s=this.gobbleStringLiteral();else if(e===J.OBRACK_CODE)s=this.gobbleArray();else{for(t=this.expr.substr(this.index,J.max_unop_len),n=t.length;n>0;){if(J.unary_ops.hasOwnProperty(t)&&(!J.isIdentifierStart(this.code)||this.index+t.length<this.expr.length&&!J.isIdentifierPart(this.expr.charCodeAt(this.index+t.length)))){this.index+=n;let i=this.gobbleToken();return i||this.throwError("missing unaryOp argument"),this.runHook("after-token",{type:J.UNARY_EXP,operator:t,argument:i,prefix:!0})}t=t.substr(0,--n)}J.isIdentifierStart(e)?(s=this.gobbleIdentifier(),J.literals.hasOwnProperty(s.name)?s={type:J.LITERAL,value:J.literals[s.name],raw:s.name}:s.name===J.this_str&&(s={type:J.THIS_EXP})):e===J.OPAREN_CODE&&(s=this.gobbleGroup())}return s?(s=this.gobbleTokenProperty(s),this.runHook("after-token",s)):this.runHook("after-token",!1)}gobbleTokenProperty(e){this.gobbleSpaces();let t=this.code;for(;t===J.PERIOD_CODE||t===J.OBRACK_CODE||t===J.OPAREN_CODE;)this.index++,t===J.PERIOD_CODE?(this.gobbleSpaces(),e={type:J.MEMBER_EXP,computed:!1,object:e,property:this.gobbleIdentifier()}):t===J.OBRACK_CODE?(e={type:J.MEMBER_EXP,computed:!0,object:e,property:this.gobbleExpression()},this.gobbleSpaces(),t=this.code,t!==J.CBRACK_CODE&&this.throwError("Unclosed ["),this.index++):t===J.OPAREN_CODE&&(e={type:J.CALL_EXP,arguments:this.gobbleArguments(J.CPAREN_CODE),callee:e}),this.gobbleSpaces(),t=this.code;return e}gobbleNumericLiteral(){let e="",t,n;for(;J.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(this.code===J.PERIOD_CODE)for(e+=this.expr.charAt(this.index++);J.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);if(t=this.char,t==="e"||t==="E"){for(e+=this.expr.charAt(this.index++),t=this.char,(t==="+"||t==="-")&&(e+=this.expr.charAt(this.index++));J.isDecimalDigit(this.code);)e+=this.expr.charAt(this.index++);J.isDecimalDigit(this.expr.charCodeAt(this.index-1))||this.throwError("Expected exponent ("+e+this.char+")")}return n=this.code,J.isIdentifierStart(n)?this.throwError("Variable names cannot start with a number ("+e+this.char+")"):(n===J.PERIOD_CODE||e.length===1&&e.charCodeAt(0)===J.PERIOD_CODE)&&this.throwError("Unexpected period"),{type:J.LITERAL,value:parseFloat(e),raw:e}}gobbleStringLiteral(){let e="",t=this.expr.charAt(this.index++),n=!1;for(;this.index<this.expr.length;){let s=this.expr.charAt(this.index++);if(s===t){n=!0;break}else if(s==="\\")switch(s=this.expr.charAt(this.index++),s){case"n":e+=`
`;break;case"r":e+="\r";break;case"t":e+="	";break;case"b":e+="\b";break;case"f":e+="\f";break;case"v":e+="\v";break;default:e+=s}else e+=s}return n||this.throwError('Unclosed quote after "'+e+'"'),{type:J.LITERAL,value:e,raw:t+e+t}}gobbleIdentifier(){let e=this.code,t=this.index;for(J.isIdentifierStart(e)?this.index++:this.throwError("Unexpected "+this.char);this.index<this.expr.length&&(e=this.code,J.isIdentifierPart(e));)this.index++;return{type:J.IDENTIFIER,name:this.expr.slice(t,this.index)}}gobbleArguments(e){let t=[],n=!1,s=0;for(;this.index<this.expr.length;){this.gobbleSpaces();let i=this.code;if(i===e){n=!0,this.index++,e===J.CPAREN_CODE&&s&&s>=t.length&&this.throwError("Unexpected token "+String.fromCharCode(e));break}else if(i===J.COMMA_CODE){if(this.index++,s++,s!==t.length){if(e===J.CPAREN_CODE)this.throwError("Unexpected token ,");else if(e===J.CBRACK_CODE)for(let o=t.length;o<s;o++)t.push(null)}}else if(t.length!==s&&s!==0)this.throwError("Expected comma");else{let o=this.gobbleExpression();(!o||o.type===J.COMPOUND)&&this.throwError("Expected comma"),t.push(o)}}return n||this.throwError("Expected "+String.fromCharCode(e)),t}gobbleGroup(){this.index++;let e=this.gobbleExpressions(J.CPAREN_CODE);if(this.code===J.CPAREN_CODE)return this.index++,e.length===1?e[0]:e.length?{type:J.SEQUENCE_EXP,expressions:e}:!1;this.throwError("Unclosed (")}gobbleArray(){return this.index++,{type:J.ARRAY_EXP,elements:this.gobbleArguments(J.CBRACK_CODE)}}},uhe=new gU;Object.assign(J,{hooks:uhe,plugins:new yU(J),COMPOUND:"Compound",SEQUENCE_EXP:"SequenceExpression",IDENTIFIER:"Identifier",MEMBER_EXP:"MemberExpression",LITERAL:"Literal",THIS_EXP:"ThisExpression",CALL_EXP:"CallExpression",UNARY_EXP:"UnaryExpression",BINARY_EXP:"BinaryExpression",ARRAY_EXP:"ArrayExpression",TAB_CODE:9,LF_CODE:10,CR_CODE:13,SPACE_CODE:32,PERIOD_CODE:46,COMMA_CODE:44,SQUOTE_CODE:39,DQUOTE_CODE:34,OPAREN_CODE:40,CPAREN_CODE:41,OBRACK_CODE:91,CBRACK_CODE:93,QUMARK_CODE:63,SEMCOL_CODE:59,COLON_CODE:58,unary_ops:{"-":1,"!":1,"~":1,"+":1},binary_ops:{"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},additional_identifier_chars:new Set(["$","_"]),literals:{true:!0,false:!1,null:null},this_str:"this"});J.max_unop_len=J.getMaxKeyLen(J.unary_ops);J.max_binop_len=J.getMaxKeyLen(J.binary_ops);var Is=r=>new J(r).parse(),hhe=Object.getOwnPropertyNames(J);hhe.forEach(r=>{Is[r]===void 0&&r!=="prototype"&&(Is[r]=J[r])});Is.Jsep=J;var _U="ConditionalExpression",dhe={name:"ternary",init(r){r.hooks.add("after-expression",function(t){if(t.node&&this.code===r.QUMARK_CODE){this.index++;let n=t.node,s=this.gobbleExpression();if(s||this.throwError("Expected expression"),this.gobbleSpaces(),this.code===r.COLON_CODE){this.index++;let i=this.gobbleExpression();i||this.throwError("Expected expression"),t.node={type:_U,test:n,consequent:s,alternate:i}}else s.operator===":"?t.node={type:_U,test:n,consequent:s.left,alternate:s.right}:this.throwError("Expected :")}})}};Is.plugins.register(dhe);Is.addUnaryOp("@");var phe=10;Is.addBinaryOp("**",phe);var fhe="Identifier",mhe="Literal",_he="CallExpression",ghe="`",yi=class{constructor(){}parse_expression(e){try{this.reset(),this.node=Is(e)}catch(t){let n=`could not parse the expression '${e}' (error: ${t})`;this.error_message=n}}parse_expression_for_string_param(e){try{this.reset();let t=yi.string_value_elements(e),n=[];for(let s=0;s<t.length;s++){let i=t[s],o;if(s%2==1)o=Is(i);else{let a=i.replace(/\'/g,"\\'");o={type:mhe,value:`'${a}'`,raw:`'${a}'`}}n.push(o)}this.node={type:_he,arguments:n,callee:{type:fhe,name:"strConcat"}}}catch(t){let n=`could not parse the expression '${e}' (error: ${t})`;this.error_message=n}}static string_value_elements(e){return e!=null?q.isString(e)?e.split(ghe):[]:[]}reset(){this.node=void 0,this.error_message=void 0}};var _x=class{static if(e){let t=e[0],n=e[1],s=e[2];return`(${t}) ? (${n}) : (${s})`}};var gx="$",fu=class{constructor(e){this.param=e,this._set_error_from_error_bound=this._set_error_from_error.bind(this)}clear_error(){this._error_message=void 0}set_error(e){this._error_message=this._error_message||e}_set_error_from_error(e){q.isString(e)?this._error_message=e:this._error_message=e.message}is_errored(){return this._error_message!=null}error_message(){return this._error_message}reset(){this._error_message=void 0}traverse_node(e){let t=`traverse_${e.type}`;if(this[t])return this[t](e);this.set_error(`expression unknown node type: ${e.type}`)}traverse_BinaryExpression(e){return`${this.traverse_node(e.left)} ${e.operator} ${this.traverse_node(e.right)}`}traverse_MemberExpression(e){return`${this.traverse_node(e.object)}.${this.traverse_node(e.property)}`}traverse_ConditionalExpression(e){return`(${this.traverse_node(e.test)}) ? (${this.traverse_node(e.consequent)}) : (${this.traverse_node(e.alternate)})`}traverse_Compound(e){let t=e.body,n=[];for(let s=0;s<t.length;s++){let i=t[s];i.type=="Identifier"?i.name[0]==gx?n.push("`${"+this.traverse_node(i)+"}`"):n.push(`'${i.name}'`):n.push("`${"+this.traverse_node(i)+"}`")}return n.join(" + ")}traverse_Literal(e){return`${e.raw}`}};var xU="coreGeometry",Br=class{constructor(){}reset(){this._attributeNames&&this._attributeNames.clear()}assignAttributesLines(){if(this._attributeNames){let e=[];for(let t of this._attributeNames)e.push(Br.assignAttributeLine(t));return e.join(`;
`)}else return""}assignArraysLines(){if(this._attributeNames){let e=[];if(this._attributeNames.size>0){let t=`const ${xU} = entities[0].coreGeometry();`;e.push(t)}for(let t of this._attributeNames)e.push(Br.assignItemSizeLine(t)),e.push(Br.assignArrayLine(t));return e.join(`;
`)}else return""}attributePresenceCheckLine(){if(this._attributeNames){let e=[];for(let t of this._attributeNames){let n=Br._varAttribute(t);e.push(n)}if(e.length>0)return e.join(" && ")}return"true"}add(e){this._attributeNames=this._attributeNames||new Set,this._attributeNames.add(e)}static assignAttributeLine(e){return`const ${this._varAttribute(e)} = getEntitiesAttribute(entities,'${e}')`}static assignItemSizeLine(e){let t=this._varAttribute(e);return`const ${this._varAttribSize(e)} = ${t}.itemSize`}static assignArrayLine(e){let t=this._varAttribute(e),n=this._varArray(e),s=`${xU}.isAttribIndexed('${e}')`,i=`entities.map(e=>e.indexedAttribValue('${e}'))`,o=`${t}.array`;return`const ${n} = ${s} ? ${i} : ${o}`}static _varAttribute(e){return`attrib_${e}`}static _varAttribSize(e){return`attrib_size_${e}`}static _varArray(e){return`array_${e}`}varAttributeSize(e){return Br._varAttribSize(e)}varArray(e){return Br._varArray(e)}};var yhe=["abs","acos","acosh","asin","asinh","atan","atan2","atanh","ceil","cos","cosh","exp","expm1","floor","log","log1p","log2","log10","max","min","pow","round","sign","sin","sinh","sqrt","tan","tanh"],xhe=["cbrt","hypot","log10","trunc"],vU={math_random:"random"},vhe=["fit","fit01","fract","deg2rad","rad2deg","rand","clamp"],bhe=Object.keys(gd),whe=["precision"],Ehe=["E","LN2","LN10","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],po={};yhe.forEach(r=>{po[r]=`Math.${r}`});xhe.forEach(r=>{po[r]=`Math.${r}`});Object.keys(vU).forEach(r=>{let e=vU[r];po[r]=`Math.${e}`});vhe.forEach(r=>{po[r]=`Core.Math.${r}`});bhe.forEach(r=>{po[r]=`Core.Math.Easing.${r}`});whe.forEach(r=>{po[r]=`Core.String.${r}`});var Che={if:_x.if},wU={};Ehe.forEach(r=>{wU[r]=`Math.${r}`});var Jp="'",bU=", ",She="@",Ahe={x:0,y:1,z:2,w:3,r:0,g:1,b:2},The={Math:Ir,String:Ae},yx=class extends fu{constructor(e){super(e);this.param=e,this._attribute_requirements_controller=new Br,this.methods=[],this.method_index=-1,this.methodDependencies=[],this.immutableDependencies=[]}parse_tree(e){if(this.reset(),e.error_message==null){try{if(this._attribute_requirements_controller=new Br,e.node){let t=this.traverse_node(e.node);t&&!this.is_errored()&&(this.function_main_string=t)}else console.warn("no parsed_tree.node")}catch(t){console.warn(`error in expression for param ${this.param.path()}`),console.warn(t)}if(this.function_main_string)try{let t=this._functionBody();this.function=new Function("CorePoint","Core","CoreType","param","methods","_set_error_from_error",`
					try {
						${t}
					} catch(e) {
						_set_error_from_error(e)
						return null;
					}`)}catch(t){console.warn(t),this.set_error("cannot generate function")}else this.set_error("cannot generate function body")}else this.set_error("cannot parse expression")}reset(){super.reset(),this.function_main_string=void 0,this.methods=[],this.method_index=-1,this.function=void 0,this.methodDependencies=[],this.immutableDependencies=[]}_functionBody(){return this.param.options.isExpressionForEntities()?`
			const entities = param.expressionController.entities();
			function getEntitiesAttribute(entities, attribName){
				const firstEntity = entities[0];
				if(firstEntity instanceof CorePoint){
					return firstEntity.geometry().attributes[attribName];
				} else {
					return entities.map(e=>e.attribValue(attribName));
				}
			}
			function getCorePointAttribValue(entity, attribName, array, attributeSize, propertyOffset){
				return array[entity.index()*attributeSize+propertyOffset];
			}
			function getCoreObjectAttribValue(entity, attribName, array, attributeSize, propertyOffset){
				const value = entity.attribValue(attribName);
				if(CoreType.isArray(value)){
					return value[propertyOffset]
				} else {
					return value
				}
			}
			if(entities){
				return new Promise( async (resolve, reject)=>{
					let entity;
					const entityCallback = param.expressionController.entityCallback();
					// assign_attributes_lines
					${this._attribute_requirements_controller.assignAttributesLines()}
					// check if attributes are present
					if( ${this._attribute_requirements_controller.attributePresenceCheckLine()} ){
						// assign function
						const getEntityAttribValue = (entities[0] instanceof CorePoint) ? getCorePointAttribValue : getCoreObjectAttribValue;
						// assign_arrays_lines
						${this._attribute_requirements_controller.assignArraysLines()}
						for(let index=0; index < entities.length; index++){
							entity = entities[index];
							result = ${this.function_main_string};
							entityCallback(entity, result);
						}
						resolve()
					} else {
						const error = new Error('attribute not found')
						_set_error_from_error(error)
						reject(error)
					}
				})
			}
			return []`:`
			return new Promise( async (resolve, reject)=>{
				try {
					const value = ${this.function_main_string}
					resolve(value)
				} catch(e) {
					_set_error_from_error(e)
					reject()
				}
			})
			`}evalAllowed(){return this.function!=null}evalFunction(){if(this.function)return this.clear_error(),this.function(xs,The,q,this.param,this.methods,this._set_error_from_error_bound)}traverse_CallExpression(e){let t=e.arguments.map(i=>this.traverse_node(i)),s=e.callee.name;if(s){let i=Che[s];if(i)return i(t);let o=`${t.join(bU)}`,a=po[s];if(a)return`${a}(${o})`;let c=ie.expressionsRegister;if(c.getMethod(s)){let u=e.arguments[0],h=`return ${t[0]}`,d,p;try{d=new Function(h),p=d()}catch{}return this._createMethodAndDependencies(s,p,u),`(await methods[${this.method_index}].processArguments([${o}]))`}else{let u=c.availableMethods().join(", "),h=`method not found (${s}), available methods are: ${u}`;ie.warn(h)}}this.set_error(`unknown method: ${s}`)}traverse_BinaryExpression(e){return`(${this.traverse_node(e.left)} ${e.operator} ${this.traverse_node(e.right)})`}traverse_UnaryExpression(e){if(e.operator===She){let t=e.argument,n,s;switch(t.type){case"Identifier":{n=t.name;break}case"MemberExpression":{let i=t,o=i.object,a=i.property;n=o.name,s=a.name;break}}if(n){if(n=bt.remapName(n),n==Or.POINT_INDEX||n==Or.OBJECT_INDEX)return"((entity != null) ? entity.index() : 0)";{let i=this._attribute_requirements_controller.varAttributeSize(n),o=this._attribute_requirements_controller.varArray(n);this._attribute_requirements_controller.add(n);let a=s?Ahe[s]:0;return a==null&&(a=0),`getEntityAttribValue(entity, '${n}', ${o}, ${i}, ${a})`}}else return console.warn("attribute not found"),""}else return`${e.operator}${this.traverse_node(e.argument)}`}traverse_Identifier(e){if(e.name[0]==gx){let n=e.name.substring(1),s=wU[n];if(s)return s;let i=`traverse_Identifier_${n}`;if(this[i])return this[i]();this.set_error(`identifier unknown: ${e.name}`)}else return e.name}traverse_Identifier_F(){return this.immutableDependencies.push(this.param.scene().timeController.graphNode),"param.scene().timeController.frame()"}traverse_Identifier_T(){return this.immutableDependencies.push(this.param.scene().timeController.graphNode),"param.scene().timeController.time()"}traverse_Identifier_OS(){let e=this.param.node.nameController.graphNode();return this.param.addGraphInput(e),"param.node.name()"}traverse_Identifier_CH(){return`${Jp}${this.param.name()}${Jp}`}traverse_Identifier_CEX(){return this._method_centroid("x")}traverse_Identifier_CEY(){return this._method_centroid("y")}traverse_Identifier_CEZ(){return this._method_centroid("z")}_method_centroid(e){let n=[0,`${Jp}${e}${Jp}`].join(bU);return this._createMethodAndDependencies("centroid",0),`(await methods[${this.method_index}].processArguments([${n}]))`}_createMethodAndDependencies(e,t,n){let s=ie.expressionsRegister,i=s.getMethod(e);if(!i){let a=s.availableMethods(),c=`method not found (${e}), available methods are: ${a.join(", ")}`;this.set_error(c),ie.warn(c);return}let o=new i(this.param);if(this.method_index+=1,this.methods[this.method_index]=o,o.requireDependency()&&t!=null){let a=o.findDependency(t);a?(n&&a.set_jsep_node(n),this.methodDependencies.push(a)):n&&q.isString(t)&&this.param.scene().missingExpressionReferencesController.register(this.param,t)}}};var Mhe=", ",xx=class extends fu{constructor(e){super(e);this.param=e}parse_tree(e){if(e.error_message==null&&e.node)try{return this.traverse_node(e.node)}catch{this.set_error("could not traverse tree")}else this.set_error("cannot parse tree")}traverse_CallExpression(e){let n=`${e.arguments.map(i=>this.traverse_node(i)).join(Mhe)}`;return`${e.callee.name}(${n})`}traverse_UnaryExpression(e){return`${e.operator}${this.traverse_node(e.argument)}`}traverse_Identifier(e){return`${e.name}`}};var vx=class{constructor(e){this.param=e,this._cyclicGraphDetected=!1,this.methodDependencies=[]}set_error(e){this.error_message=this.error_message||e}reset(){this.param.graphDisconnectPredecessors(),this.methodDependencies.forEach(e=>{e.reset()}),this.methodDependencies=[]}update(e){this._cyclicGraphDetected=!1,this._connectImmutableDependencies(e),this.methodDependencies=e.methodDependencies,this._handleMethodDependencies(),this._listenForNameChanges()}_connectImmutableDependencies(e){e.immutableDependencies.forEach(t=>{if(this._cyclicGraphDetected==!1&&this.param.addGraphInput(t)==!1){this._cyclicGraphDetected=!0,this.set_error("cannot create expression, infinite graph detected"),this.reset();return}})}_handleMethodDependencies(){this.methodDependencies.forEach(e=>{this._cyclicGraphDetected==!1&&this._handleMethodDependency(e)})}_handleMethodDependency(e){let t=e.resolved_graph_node;if(t&&!this.param.addGraphInput(t)){this._cyclicGraphDetected=!0,this.set_error("cannot create expression, infinite graph detected"),this.reset();return}}_listenForNameChanges(){this.methodDependencies.forEach(e=>{e.listen_for_name_changes()})}};var bx=class{constructor(e){this.param=e,this.parse_completed=!1,this.parse_started=!1,this.parsed_tree=new yi,this._functionGenerator=new yx(this.param),this.dependencies_controller=new vx(this.param)}parseExpression(e){if(this.parse_started)throw new Error(`parse in progress for param ${this.param.path()}`);this.parse_started=!0,this.parse_completed=!1,this.parsed_tree=this.parsed_tree||new yi,this.reset(),this.param.type()==U.STRING?this.parsed_tree.parse_expression_for_string_param(e):this.parsed_tree.parse_expression(e),this._functionGenerator.parse_tree(this.parsed_tree),this._functionGenerator.error_message()==null&&(this.dependencies_controller.update(this._functionGenerator),this.dependencies_controller.error_message?this.param.states.error.set(this.dependencies_controller.error_message):(this.parse_completed=!0,this.parse_started=!1))}async computeFunction(){if(this._computeAllowed())try{return await this._functionGenerator.evalFunction()}catch{}}reset(){this.parse_completed=!1,this.parse_started=!1,this.dependencies_controller.reset(),this._functionGenerator.reset()}is_errored(){return this._functionGenerator.is_errored()}error_message(){return this._functionGenerator.error_message()}_computeAllowed(){return this._functionGenerator.evalAllowed()}updateFromMethodDependencyNameChange(){this.expression_string_generator=this.expression_string_generator||new xx(this.param);let e=this.expression_string_generator.parse_tree(this.parsed_tree);e?this.param.set(e):console.warn("failed to regenerate expression")}};var mu=class{constructor(e){this.param=e}dispose(){this.param.scene().expressionsController.deregisterParam(this.param),this._resetMethodDependencies()}_resetMethodDependencies(){var e,t;(e=this._method_dependencies_by_graph_node_id)==null||e.forEach(n=>{n.dispose()}),(t=this._method_dependencies_by_graph_node_id)==null||t.clear()}registerMethodDependency(e){this._method_dependencies_by_graph_node_id=this._method_dependencies_by_graph_node_id||new Map,this._method_dependencies_by_graph_node_id.set(e.graphNodeId(),e)}active(){return this._expression!=null}expression(){return this._expression}is_errored(){return this._manager?this._manager.is_errored():!1}error_message(){return this._manager?this._manager.error_message():null}requires_entities(){return this.param.options.isExpressionForEntities()}set_expression(e,t=!0){var n;this.param.scene().missingExpressionReferencesController.deregisterParam(this.param),this.param.scene().expressionsController.deregisterParam(this.param),this._expression!=e&&(this._resetMethodDependencies(),this._expression=e,this._expression?(this._manager=this._manager||new bx(this.param),this._manager.parseExpression(this._expression)):(n=this._manager)==null||n.reset(),t&&this.param.setDirty())}updateFromMethodDependencyNameChange(){this._manager&&this.active()&&this._manager.updateFromMethodDependencyNameChange()}computeExpression(){if(this._manager&&this.active())return this._manager.computeFunction()}async computeExpressionForEntities(e,t){var n,s;this._setEntities(e,t),await this.computeExpression(),((n=this._manager)==null?void 0:n.error_message())&&this.param.node.states.error.set(`expression evalution error: ${(s=this._manager)==null?void 0:s.error_message()}`),this._resetEntities()}computeExpressionForPoints(e,t){return this.computeExpressionForEntities(e,t)}computeExpressionForObjects(e,t){return this.computeExpressionForEntities(e,t)}computeExpressionForCoreGroup(e,t){return this.computeExpressionForEntities([e],t)}entities(){return this._entities}entityCallback(){return this._entityCallback}_setEntities(e,t){this._entities=e,this._entityCallback=t}_resetEntities(){this._entities=void 0,this._entityCallback=void 0}};var Ds=class extends Sn{isNumeric(){return!0}isDefault(){return this._raw_input==this._default_value}_prefilterInvalidRawInput(e){return q.isArray(e)?e[0]:e}processRawInput(){this.states.error.clear();let e=this.convert(this._raw_input);e!=null?(this._expression_controller&&(this._expression_controller.set_expression(void 0,!1),this.emitController.emit(It.EXPRESSION_UPDATED)),e!=this._value&&(this._update_value(e),this.setSuccessorsDirty(this))):q.isString(this._raw_input)?(this._expression_controller=this._expression_controller||new mu(this),this._raw_input!=this._expression_controller.expression()&&(this._expression_controller.set_expression(this._raw_input),this.emitController.emit(It.EXPRESSION_UPDATED))):this.states.error.set(`param input is invalid (${this.path()})`)}async processComputation(){var e;if(((e=this.expressionController)==null?void 0:e.active())&&!this.expressionController.requires_entities()){let t=await this.expressionController.computeExpression();if(this.expressionController.is_errored())this.states.error.set(`expression error: "${this.expressionController.expression()}" (${this.expressionController.error_message()})`);else{let n=this.convert(t);n!=null?(this.states.error.active()&&this.states.error.clear(),this._update_value(n)):this.states.error.set(`expression returns an invalid type (${t}) (${this.expressionController.expression()})`)}}}_update_value(e){this._value=e;let t=this.parentParam();t&&t.set_value_from_components(),this.options.executeCallback(),this.emitController.emit(It.VALUE_UPDATED),this.removeDirtyState()}};var wx=class extends Ds{static type(){return U.BOOLEAN}defaultValueSerialized(){return q.isString(this._default_value)?this._default_value:this.convert(this._default_value)||!1}rawInputSerialized(){return this._raw_input}valueSerialized(){return this.value}_copyValue(e){this.set(e.value)}static areRawInputEqual(e,t){return e==t}static areValuesEqual(e,t){return e==t}convert(e){if(q.isBoolean(e))return e;if(q.isNumber(e))return e>=1;if(q.isString(e)){if(Ae.isBoolean(e))return Ae.toBoolean(e);if(Ae.isNumber(e))return parseFloat(e)>=1}return null}};var Ex=class extends Sn{static type(){return U.BUTTON}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return this._raw_input}valueSerialized(){return this.value}_copyValue(e){}static areRawInputEqual(e,t){return!0}static areValuesEqual(e,t){return!0}async pressButton(){(this.node.isDirty()||this.node.cookController.isCooking())&&await this.node.compute(),this.options.executeCallback()}};var fo=class extends Ds{static type(){return U.FLOAT}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return this._raw_input}valueSerialized(){return this.value}_copyValue(e){this.set(e.valueSerialized())}_prefilterInvalidRawInput(e){return q.isArray(e)?e[0]:q.isString(e)&&Ae.isNumber(e)?parseFloat(e):e}static areRawInputEqual(e,t){return e==t}static areValuesEqual(e,t){return e==t}static convert(e){if(q.isNumber(e))return e;if(q.isBoolean(e))return e?1:0;if(Ae.isNumber(e)){let t=parseFloat(e);if(q.isNumber(t))return t}return null}convert(e){let t=fo.convert(e);return t&&this.options.ensureInRange(t)}};var kr=class extends Sn{constructor(){super(...arguments);this._components_contructor=fo}get components(){return this._components}isNumeric(){return!0}isDefault(){for(let e of this.components)if(!e.isDefault())return!1;return!0}rawInput(){return this._components.map(e=>e.rawInput())}rawInputSerialized(){return this._components.map(e=>e.rawInputSerialized())}_copyValue(e){for(let t=0;t<this.components.length;t++){let n=this.components[t],s=e.components[t];n.copyValue(s)}}initComponents(){if(this._components!=null)return;let e=0;this._components=new Array(this.componentNames().length);for(let t of this.componentNames()){let n=new this._components_contructor(this.scene(),this.node),s;q.isArray(this._default_value)?s=this._default_value[e]:s=this._default_value[t],n.options.copy(this.options),n.setInitValue(s),n.setName(`${this.name()}${t}`),n.set_parent_param(this),this._components[e]=n,e++}}async processComputation(){await this.compute_components(),this.set_value_from_components()}set_value_from_components(){}hasExpression(){var e;for(let t of this.components)if((e=t.expressionController)==null?void 0:e.active())return!0;return!1}async compute_components(){let e=this.components,t=[];for(let n of e)n.isDirty()&&t.push(n.compute());await Promise.all(t),this.removeDirtyState()}_prefilterInvalidRawInput(e){if(q.isArray(e))return e;{let t=e;return this.componentNames().map(()=>t)}}processRawInput(){let e=this.scene().cooker;e.block();let t=this.components;for(let i of t)i.emitController.blockParentEmit();let n=this._raw_input,s=0;if(q.isArray(n))for(let i=0;i<t.length;i++){let o=n[i];o==null&&(o=s),t[i].set(o),s=o}else for(let i=0;i<t.length;i++){let o=this.componentNames()[i],a=n[o];a==null&&(a=s),t[i].set(a),s=a}e.unblock();for(let i=0;i<t.length;i++)t[i].emitController.unblockParentEmit();this.emitController.emit(It.VALUE_UPDATED)}};var Ls=(r=>(r.NONE="no conversion",r.SRGB_TO_LINEAR="sRGB -> linear",r.LINEAR_TO_SRGB="linear -> sRGB",r))(Ls||{});var Phe=["r","g","b"],EU=[0,0,0],Cx=class extends kr{constructor(){super(...arguments);this._value=new ae,this._value_pre_conversion=new ae,this._value_serialized_dirty=!1,this._value_serialized=[0,0,0],this._value_pre_conversion_serialized=[0,0,0],this._copied_value=[0,0,0]}static type(){return U.COLOR}componentNames(){return Phe}defaultValueSerialized(){return q.isArray(this._default_value)?this._default_value:this._default_value.toArray()}_prefilterInvalidRawInput(e){return e instanceof ae?(e.toArray(EU),EU):super._prefilterInvalidRawInput(e)}valueSerialized(){return this._update_value_serialized_if_required(),this._value_serialized}valuePreConversionSerialized(){return this._update_value_serialized_if_required(),this._value_pre_conversion_serialized}_copyValue(e){e.value.toArray(this._copied_value),this.set(this._copied_value)}_cloneRawInput(e){if(e instanceof ae)return e.clone();{let t=[e[0],e[1],e[2]];return t[0]==null&&(t[0]=t[0]||0),t[1]==null&&(t[1]=t[1]||t[0]),t[2]==null&&(t[2]=t[2]||t[1]),t}}static areRawInputEqual(e,t){return e instanceof ae?t instanceof ae?e.equals(t):e.r==t[0]&&e.g==t[1]&&e.b==t[2]:t instanceof ae?e[0]==t.r&&e[1]==t.g&&e[2]==t.b:e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]}static areValuesEqual(e,t){return e.equals(t)}initComponents(){super.initComponents(),this.r=this.components[0],this.g=this.components[1],this.b=this.components[2],this._value_serialized_dirty=!0}_update_value_serialized_if_required(){!this._value_serialized_dirty||(this._value_serialized[0]=this._value.r,this._value_serialized[1]=this._value.g,this._value_serialized[2]=this._value.b,this._value_pre_conversion_serialized[0]=this._value_pre_conversion.r,this._value_pre_conversion_serialized[1]=this._value_pre_conversion.g,this._value_pre_conversion_serialized[2]=this._value_pre_conversion.b)}valuePreConversion(){return this._value_pre_conversion}set_value_from_components(){this._value_pre_conversion.r=this.r.value,this._value_pre_conversion.g=this.g.value,this._value_pre_conversion.b=this.b.value,this._value.copy(this._value_pre_conversion);let e=this.options.colorConversion();if(e!=null&&e!=Ls.NONE){switch(e){case Ls.SRGB_TO_LINEAR:{this._value.convertSRGBToLinear();return}case Ls.LINEAR_TO_SRGB:{this._value.convertLinearToSRGB();return}}Bn.unreachable(e)}this._value_serialized_dirty=!0}};var Sx=class extends Sn{static type(){return U.FOLDER}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return this._raw_input}valueSerialized(){return this.value}_copyValue(e){}static areRawInputEqual(e,t){return!0}static areValuesEqual(e,t){return!0}};var _u=class extends Ds{static type(){return U.INTEGER}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return this._raw_input}valueSerialized(){return this.value}_copyValue(e){this.set(e.valueSerialized())}_prefilterInvalidRawInput(e){return q.isArray(e)?e[0]:q.isString(e)&&Ae.isNumber(e)?parseInt(e):e}static areRawInputEqual(e,t){return e==t}static areValuesEqual(e,t){return e==t}static convert(e){if(q.isNumber(e))return Math.round(e);if(q.isBoolean(e))return e?1:0;if(Ae.isNumber(e)){let t=parseInt(e);if(q.isNumber(t))return t}return null}convert(e){let t=_u.convert(e);return t&&this.options.ensureInRange(t)}};var mo=class{constructor(){this._index=-1,this._path_elements=[],this._named_nodes=[],this._graph_node_ids=[],this._node_element_by_graph_node_id=new Map}reset(){this._index=-1,this._path_elements=[],this._named_nodes=[],this._graph_node_ids=[],this._node_element_by_graph_node_id.clear()}add_node(e,t){this._index+=1,e==t.name()&&(this._named_nodes[this._index]=t),this._graph_node_ids[this._index]=t.graphNodeId(),this._node_element_by_graph_node_id.set(t.graphNodeId(),e)}add_path_element(e){this._index+=1,this._path_elements[this._index]=e}named_graph_nodes(){return this._named_nodes}named_nodes(){let e=[];for(let t of this._named_nodes)if(t){let n=t;n.nameController&&e.push(n)}return e}update_from_name_change(e){this._named_nodes.map(n=>n==null?void 0:n.graphNodeId()).includes(e.graphNodeId())&&this._node_element_by_graph_node_id.set(e.graphNodeId(),e.name())}to_path(){let e=new Array(this._index);for(let s=0;s<=this._index;s++){let i=this._named_nodes[s];if(i){let o=this._node_element_by_graph_node_id.get(i.graphNodeId());o&&(e[s]=o)}else{let o=this._path_elements[s];o&&(e[s]=o)}}let t=e.join(Qe.SEPARATOR),n=t[0];return n&&(Qe.NON_LETTER_PREFIXES.includes(n)||(t=`${Qe.SEPARATOR}${t}`)),t}};var gu=class extends Sn{constructor(){super(...arguments);this.decomposedPath=new mo}dispose(){this.scene().referencesController.resetReferenceFromParam(this),super.dispose()}_handleReferences(e,t){this.scene().referencesController.setNamedNodesFromParam(this),e?this.scene().referencesController.setReferenceFromParam(this,e):this.scene().missingExpressionReferencesController.register(this,t)}};var yu=class extends gu{constructor(){super(...arguments);this._onResolvedParamDisposeBound=this._onResolvedParamDispose.bind(this)}static type(){return U.PARAM_PATH}_initializeParam(){this._value=new Wi}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return`${this._raw_input}`}valueSerialized(){return`${this.value}`}_copyValue(e){this.set(e.valueSerialized())}static areRawInputEqual(e,t){return e==t}static areValuesEqual(e,t){return e==t}isDefault(){return this._raw_input==this._default_value}setParam(e){this.set(e.path())}processRawInput(){this._value.path()!=this._raw_input&&(this._value.setPath(this._raw_input),this.findTarget(),this.setDirty(),this.emitController.emit(It.VALUE_UPDATED))}async processComputation(){this.findTarget()}findTarget(){if(!this.node)return;let e=this._raw_input,t=null,n=e!=null&&e!=="";this.scene().referencesController.resetReferenceFromParam(this),this.decomposedPath.reset(),n&&(t=Qe.findParam(this.node,e,this.decomposedPath));let s=this._value.param(),i=t;if(i&&i.graphNodeId()==this.graphNodeId()){this.states.error.set("param cannot refer to itself");return}if(this._handleReferences(t,e),(s==null?void 0:s.graphNodeId())!==(i==null?void 0:i.graphNodeId())){let o=this.options.dependentOnFoundParam(),a=this._value.param();a&&(o&&this.removeGraphInput(a),a.deregisterOnDispose(this._onResolvedParamDisposeBound)),t?this._assignFoundParam(t):this._value.setParam(null),this.options.executeCallback()}this.removeDirtyState()}_assignFoundParam(e){let t=this.options.dependentOnFoundParam();this._value.setParam(e),t&&this.addGraphInput(e),e.onDispose(this._onResolvedParamDisposeBound)}notifyPathRebuildRequired(e){this.decomposedPath.update_from_name_change(e);let t=this.decomposedPath.to_path();this.set(t)}notifyTargetParamOwnerParamsUpdated(e){this.setDirty()}async _onResolvedParamDispose(){this.setDirty(),await this.compute()}};var _o=class extends gu{static type(){return U.NODE_PATH}_initializeParam(){this._value=new Rr}defaultValueSerialized(){return this._default_value}rawInputSerialized(){return`${this._raw_input}`}valueSerialized(){return`${this.value}`}_copyValue(e){this.set(e.valueSerialized())}static areRawInputEqual(e,t){return e==t}static areValuesEqual(e,t){return e==t}isDefault(){return this._raw_input==this._default_value}setNode(e,t){if((t==null?void 0:t.relative)==!0){let n=Qe.relativePath(this.node,e);this.set(n)}else this.set(e.path())}processRawInput(){this._value.path()!=this._raw_input&&(this._value.setPath(this._raw_input),this._findTarget(),this.setDirty(),this.emitController.emit(It.VALUE_UPDATED))}async processComputation(){this._findTarget()}_findTarget(){if(!this.node)return;let e=this._raw_input,t=null,n=e!=null&&e!=="";this.scene().referencesController.resetReferenceFromParam(this),this.decomposedPath.reset(),n&&(t=Qe.findNode(this.node,e,this.decomposedPath));let s=this._value.node(),i=t;if(i&&i.graphNodeId()==this.node.graphNodeId()){this.states.error.set("param cannot refer to its own node");return}if(this._handleReferences(t,e),(s==null?void 0:s.graphNodeId())!==(i==null?void 0:i.graphNodeId())){let o=this.options.dependentOnFoundNode(),a=this._value.node();a&&o&&this.removeGraphInput(a),t?this._assignFoundNode(t):this._value.setNode(null),this.options.executeCallback()}n&&!t&&this.scene().loadingController.loaded()&&n&&this.states.error.set(`no node found at path '${e}'`),this.removeDirtyState()}_assignFoundNode(e){let t=this.options.dependentOnFoundNode();this._isNodeExpectedContext(e)?this._isNodeExpectedType(e)?(this.states.error.clear(),this._value.setNode(e),t&&this.addGraphInput(e)):this.states.error.set(`node type is ${e.type()} but the params expects one of ${(this._expectedNodeTypes()||[]).join(", ")}`):this.states.error.set(`node context is ${e.context()} but the params expects a ${this._expectedContext()}`)}_expectedContext(){return this.options.nodeSelectionContext()}_isNodeExpectedContext(e){let t=this._expectedContext();return t==null?!0:t==e.context()}_expectedNodeTypes(){return this.options.nodeSelectionTypes()}_isNodeExpectedType(e){let t=this._expectedNodeTypes();return t==null?!0:t==null?void 0:t.includes(e.type())}notifyPathRebuildRequired(e){this.decomposedPath.update_from_name_change(e);let t=this.decomposedPath.to_path();this.set(t)}notifyTargetParamOwnerParamsUpdated(e){this.setDirty()}};var Qr=class{constructor(e=0,t=0){this._position=e,this._value=t}toJSON(){return{position:this._position,value:this._value}}position(){return this._position}value(){return this._value}copy(e){this._position=e.position(),this._value=e.value()}clone(){let e=new Qr;return e.copy(this),e}isEqual(e){return this._position==e.position()&&this._value==e.value()}isEqualJSON(e){return this._position==e.position&&this._value==e.value}fromJSON(e){this._position=e.position,this._value=e.value}static areEqualJSON(e,t){return e.position==t.position&&e.value==t.value}static fromJSON(e){return new Qr(e.position,e.value)}},Ax=(r=>(r.CUBIC="cubic",r))(Ax||{});var fn=class{constructor(e="cubic",t=[]){this._interpolation=e,this._points=t,this._uuid=dn.generateUUID()}uuid(){return this._uuid}interpolation(){return this._interpolation}points(){return this._points}static createInterpolantFromValues(e,t){let s=new Float32Array(1);return new td(e,t,1,s)}createInterpolant(){return fn.createInterpolant(this)}static createInterpolant(e){let t=e.points(),n=Ce.sortBy(t,a=>a.position()),s=new Float32Array(n.length),i=new Float32Array(n.length),o=0;for(let a of n)s[o]=a.position(),i[o]=a.value(),o++;return this.createInterpolantFromValues(s,i)}static fromJSON(e){let t=[];for(let s of e.points)t.push(Qr.fromJSON(s));let n=e.interpolation;return(n==null||n=="")&&(n="cubic"),new fn(n,t)}toJSON(){return{interpolation:this._interpolation,points:this._points.map(e=>e.toJSON())}}clone(){let e=new fn;return e.copy(this),e}copy(e){this._interpolation=e.interpolation();let t=e.points().length,n=this._points.length;if(n>t){let i=n-t,o=n-i;this._points.splice(o,i)}let s=0;for(let i of e.points()){let o=this._points[s];o?o.copy(i):this._points.push(i.clone()),s+=1}}isEqual(e){if(this._interpolation!=e.interpolation())return!1;let t=e.points();if(this._points.length!=t.length)return!1;let n=0;for(let s of this._points){let i=t[n];if(!s.isEqual(i))return!1;n+=1}return!0}isEqualJSON(e){if(this._interpolation!=e.interpolation||this._points.length!=e.points.length)return!1;let t=0;for(let n of this._points){let s=e.points[t];if(!n.isEqualJSON(s))return!1;t+=1}return!0}static are_json_equal(e,t){if(e.interpolation!=t.interpolation||e.points.length!=t.points.length)return!1;let n=0;for(let s of e.points){let i=t.points[n];if(!Qr.areEqualJSON(s,i))return!1;n+=1}return!0}fromJSON(e){this._interpolation=e.interpolation;let t=e.points.length,n=this._points.length;if(n>t){let i=n-t,o=n-i;this._points.splice(o,i)}let s=0;for(let i of e.points){let o=this._points[s];o?o.fromJSON(i):this._points.push(Qr.fromJSON(i)),s+=1}}};var CU=4,Tx=1024,AU=1,SU=Tx*AU,Nhe=1,TU=class extends Sn{constructor(){super(...arguments);this._textureData=new Float32Array(CU*SU),this._rampTexture=new jh(this._textureData,Tx,AU,Qn,hs)}static type(){return U.RAMP}defaultValueSerialized(){return this._default_value instanceof fn?this._default_value.toJSON():this._default_value}_cloneRawInput(r){return r instanceof fn?r.clone():fn.fromJSON(r).toJSON()}rawInputSerialized(){return this._raw_input instanceof fn?this._raw_input.toJSON():fn.fromJSON(this._raw_input).toJSON()}valueSerialized(){return this.value.toJSON()}_copyValue(r){this.set(r.valueSerialized())}static areRawInputEqual(r,e){return r instanceof fn?e instanceof fn?r.isEqual(e):r.isEqualJSON(e):e instanceof fn?e.isEqualJSON(r):fn.are_json_equal(r,e)}static areValuesEqual(r,e){return r.isEqual(e)}isDefault(){return this._default_value instanceof fn?this.value.isEqual(this._default_value):this.value.isEqualJSON(this._default_value)}processRawInput(){this._raw_input instanceof fn?this._value?this._value.copy(this._raw_input):this._value=this._raw_input:this._value?this._value.fromJSON(this._raw_input):this._value=fn.fromJSON(this._raw_input),this._resetRampInterpolant(),this._updateRampTexture(),this.options.executeCallback(),this.emitController.emit(It.VALUE_UPDATED),this.setSuccessorsDirty(this)}hasExpression(){return!1}_resetRampInterpolant(){this._rampInterpolant=void 0}rampTexture(){return this._rampTexture}_updateRampTexture(){this._updateRampTextureData(),this.rampTexture().needsUpdate=!0}_updateRampTextureData(){let r=0,e=0,t=0;for(var n=0;n<SU;n++)r=n*CU,e=n/Tx,t=this.valueAtPosition(e),this._textureData[r+0]=t*Nhe,this._textureData[r+1]=0,this._textureData[r+2]=0}interpolant(){return this._rampInterpolant=this._rampInterpolant||this._createInterpolant()}_createInterpolant(){return this.value.createInterpolant()}valueAtPosition(r){return this.interpolant().evaluate(r)[0]}},cr=TU;cr.DEFAULT_VALUE=new fn(Ax.CUBIC,[new Qr(0,0),new Qr(1,1)]);cr.DEFAULT_VALUE_JSON=TU.DEFAULT_VALUE.toJSON();var go=class extends Sn{static type(){return U.STRING}defaultValueSerialized(){return this._default_value}_cloneRawInput(e){return`${e}`}rawInputSerialized(){return`${this._raw_input}`}valueSerialized(){return`${this.value}`}_copyValue(e){this.set(e.value)}static areRawInputEqual(e,t){return e==t}static areValuesEqual(e,t){return e==t}isDefault(){return this._raw_input==this._default_value}convert(e){return q.isString(e)?e:`${e}`}rawInput(){return this._raw_input}processRawInput(){this.states.error.clear(),this._value_elements(this._raw_input).length>=3?(this._expression_controller=this._expression_controller||new mu(this),this._raw_input!=this._expression_controller.expression()&&(this._expression_controller.set_expression(this._raw_input),this.setDirty(),this.emitController.emit(It.EXPRESSION_UPDATED))):this._raw_input!=this._value&&(this._value=this._raw_input,this.removeDirtyState(),this.setSuccessorsDirty(this),this.emitController.emit(It.VALUE_UPDATED),this.options.executeCallback(),this._expression_controller&&(this._expression_controller.set_expression(void 0,!1),this.emitController.emit(It.EXPRESSION_UPDATED)))}async processComputation(){var e;if(((e=this.expressionController)==null?void 0:e.active())&&!this.expressionController.requires_entities()){let t=await this.expressionController.computeExpression();if(this.expressionController.is_errored())this.states.error.set(`expression error: ${this.expressionController.error_message()}`);else{let n=this.convert(t);n!=null?(this._value=n,this.emitController.emit(It.VALUE_UPDATED),this.options.executeCallback()):this.states.error.set(`expression returns an invalid type (${t})`),this.removeDirtyState()}}}_value_elements(e){return yi.string_value_elements(e)}};var Rhe=["x","y"],MU=[0,0],Mx=class extends kr{constructor(){super(...arguments);this._value=new G,this._copied_value=[0,0]}static type(){return U.VECTOR2}componentNames(){return Rhe}defaultValueSerialized(){return q.isArray(this._default_value)?this._default_value:this._default_value.toArray()}_prefilterInvalidRawInput(e){return e instanceof G?(e.toArray(MU),MU):super._prefilterInvalidRawInput(e)}valueSerialized(){return this.value.toArray()}_copyValue(e){e.value.toArray(this._copied_value),this.set(this._copied_value)}_cloneRawInput(e){if(e instanceof G)return e.clone();{let t=[e[0],e[1]];return t[0]==null&&(t[0]=t[0]||0),t[1]==null&&(t[1]=t[1]||t[0]),t}}static areRawInputEqual(e,t){return e instanceof G?t instanceof G?e.equals(t):e.x==t[0]&&e.y==t[1]:t instanceof G?e[0]==t.x&&e[1]==t.y:e[0]==t[0]&&e[1]==t[1]}static areValuesEqual(e,t){return e.equals(t)}initComponents(){super.initComponents(),this.x=this.components[0],this.y=this.components[1]}set_value_from_components(){this._value.x=this.x.value,this._value.y=this.y.value}};var Ohe=["x","y","z"],PU=[0,0,0],Px=class extends kr{constructor(){super(...arguments);this._value=new A,this._copied_value=[0,0,0]}static type(){return U.VECTOR3}componentNames(){return Ohe}defaultValueSerialized(){return q.isArray(this._default_value)?this._default_value:this._default_value.toArray()}_prefilterInvalidRawInput(e){return e instanceof A?(e.toArray(PU),PU):super._prefilterInvalidRawInput(e)}valueSerialized(){return this.value.toArray()}_copyValue(e){e.value.toArray(this._copied_value),this.set(this._copied_value)}_cloneRawInput(e){if(e instanceof A)return e.clone();{let t=[e[0],e[1],e[2]];return t[0]==null&&(t[0]=t[0]||0),t[1]==null&&(t[1]=t[1]||t[0]),t[2]==null&&(t[2]=t[2]||t[1]),t}}static areRawInputEqual(e,t){return e instanceof A?t instanceof A?e.equals(t):e.x==t[0]&&e.y==t[1]&&e.z==t[2]:t instanceof A?e[0]==t.x&&e[1]==t.y&&e[2]==t.z:e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]}static areValuesEqual(e,t){return e.equals(t)}initComponents(){super.initComponents(),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2]}set_value_from_components(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value}};var Ihe=["x","y","z","w"],NU=[0,0,0,0],Nx=class extends kr{constructor(){super(...arguments);this._value=new Se,this._copied_value=[0,0,0,0]}static type(){return U.VECTOR4}componentNames(){return Ihe}defaultValueSerialized(){return q.isArray(this._default_value)?this._default_value:this._default_value.toArray()}_prefilterInvalidRawInput(e){return e instanceof Se?(e.toArray(NU),NU):super._prefilterInvalidRawInput(e)}valueSerialized(){return this.value.toArray()}_copyValue(e){e.value.toArray(this._copied_value),this.set(this._copied_value)}_cloneRawInput(e){if(e instanceof Se)return e.clone();{let t=[e[0],e[1],e[2],e[3]];return t[0]==null&&(t[0]=t[0]||0),t[1]==null&&(t[1]=t[1]||t[0]),t[2]==null&&(t[2]=t[2]||t[1]),t[3]==null&&(t[3]=t[3]||t[2]),t}}static areRawInputEqual(e,t){return e instanceof Se?t instanceof Se?e.equals(t):e.x==t[0]&&e.y==t[1]&&e.z==t[2]&&e.w==t[3]:t instanceof Se?e[0]==t.x&&e[1]==t.y&&e[2]==t.z&&e[3]==t.w:e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2]&&e[3]==t[3]}static areValuesEqual(e,t){return e.equals(t)}initComponents(){super.initComponents(),this.x=this.components[0],this.y=this.components[1],this.z=this.components[2],this.w=this.components[3]}set_value_from_components(){this._value.x=this.x.value,this._value.y=this.y.value,this._value.z=this.z.value,this._value.w=this.w.value}};var RU={[U.BOOLEAN]:wx,[U.BUTTON]:Ex,[U.COLOR]:Cx,[U.FLOAT]:fo,[U.FOLDER]:Sx,[U.INTEGER]:_u,[U.PARAM_PATH]:yu,[U.NODE_PATH]:_o,[U.RAMP]:cr,[U.STRING]:go,[U.VECTOR2]:Mx,[U.VECTOR3]:Px,[U.VECTOR4]:Nx};var Dhe="params",Rx=class{constructor(e){this.node=e,this._param_create_mode=!1,this._params_created=!1,this._params_by_name={},this._params_list=[],this._param_names=[],this._non_spare_params=[],this._spare_params=[],this._non_spare_param_names=[],this._spare_param_names=[],this._params_added_since_last_params_eval=!1,this._promises=[]}dispose(){this._params_node&&this._params_node.dispose();for(let e of this.all)e.dispose();this._post_create_params_hook_names=void 0,this._post_create_params_hooks=void 0,this._on_scene_load_hooks=void 0,this._on_scene_load_hook_names=void 0}initDependencyNode(){this._params_node||(this._params_node=new Rt(this.node.scene(),Dhe),this.node.addGraphInput(this._params_node,!1))}init(){this.initDependencyNode(),this._param_create_mode=!0,this._initFromParamsConfig(),this.node.createParams(),this._postCreateParams()}_postCreateParams(){this._updateCaches(),this._initParamAccessors(),this._param_create_mode=!1,this._params_created=!0,this._runPostCreateParamsHooks()}postCreateSpareParams(){this._updateCaches(),this._initParamAccessors(),this.node.scene().referencesController.notifyParamsUpdated(this.node),this.node.emit(pt.PARAMS_UPDATED)}updateParams(e){let t=!1,n=!1,s=[];if(e.namesToDelete)for(let i of e.namesToDelete)this.has(i)&&(this._deleteParam(i),n=!0);if(e.toAdd)for(let i of e.toAdd){let o=this.addParam(i.type,i.name,i.initValue,i.options);o&&(i.rawInput!=null&&o.set(i.rawInput),t=!0,s.push(o))}(n||t)&&this.postCreateSpareParams();for(let i of s)this.node.scene().missingExpressionReferencesController.checkForMissingParamReferences(i)}_initFromParamsConfig(){var e;let t=this.node.paramsConfig,n=!1;if(t){let s=(e=this.node.createOptions)==null?void 0:e.paramsInitValueOverrides;for(let i of Object.keys(t)){let o=t[i],a;s&&(a=s[i],n=!0),this.addParam(o.type,i,o.init_value,o.options,a)}}n&&this.node.setDirty(),this.node.createOptions&&(this.node.createOptions.paramsInitValueOverrides=void 0)}_initParamAccessors(){let e=Object.getOwnPropertyNames(this.node.pv);this._removeUnneededAccessors(e),e=Object.getOwnPropertyNames(this.node.pv);for(let t of this.all){let n=t.options.isSpare();(!e.includes(t.name())||n)&&(Object.defineProperty(this.node.pv,t.name(),{get:()=>t.value,configurable:n}),Object.defineProperty(this.node.p,t.name(),{get:()=>t,configurable:n}))}}_removeUnneededAccessors(e){let t=this._param_names,n=[];for(let s of e)t.includes(s)||n.push(s);for(let s of n)Object.defineProperty(this.node.pv,s,{get:()=>{},configurable:!0}),Object.defineProperty(this.node.p,s,{get:()=>{},configurable:!0})}get params_node(){return this._params_node}get all(){return this._params_list}get non_spare(){return this._non_spare_params}get spare(){return this._spare_params}get names(){return this._param_names}get non_spare_names(){return this._non_spare_param_names}get spare_names(){return this._spare_param_names}set_with_type(e,t,n){let s=this.paramWithType(e,n);s?s.set(t):ie.warn(`param ${e} not found with type ${n}`)}set_float(e,t){this.set_with_type(e,t,U.FLOAT)}set_vector3(e,t){this.set_with_type(e,t,U.VECTOR3)}has_param(e){return this._params_by_name[e]!=null}has(e){return this.has_param(e)}get(e){return this.param(e)}paramWithType(e,t){let n=this.param(e);if(n&&n.type()==t)return n}getFloat(e){return this.paramWithType(e,U.FLOAT)}value(e){var t;return(t=this.param(e))==null?void 0:t.value}valueWithType(e,t){var n;return(n=this.paramWithType(e,t))==null?void 0:n.value}boolean(e){return this.valueWithType(e,U.BOOLEAN)}float(e){return this.valueWithType(e,U.FLOAT)}integer(e){return this.valueWithType(e,U.INTEGER)}string(e){return this.valueWithType(e,U.STRING)}vector2(e){return this.valueWithType(e,U.VECTOR2)}vector3(e){return this.valueWithType(e,U.VECTOR3)}color(e){return this.valueWithType(e,U.COLOR)}param(e){let t=this._params_by_name[e];return t??(ie.warn(`tried to access param '${e}' in node ${this.node.path()}, but existing params are: ${this.names} on node ${this.node.path()}`),null)}_deleteParam(e){let t=this._params_by_name[e];if(t){if(this._params_node&&this._params_node.removeGraphInput(this._params_by_name[e]),t._setupNodeDependencies(null),delete this._params_by_name[e],t.isMultiple()&&t.components)for(let n of t.components){let s=n.name();delete this._params_by_name[s]}t.dispose()}else throw new Error(`param '${e}' does not exist on node ${this.node.path()}`)}addParam(e,t,n,s={},i){let o=s.spare||!1;this._param_create_mode===!1&&!o&&ie.warn(`node ${this.node.path()} (${this.node.type()}) param '${t}' cannot be created outside of createParams`),this.node.scene()==null&&ie.warn(`node ${this.node.path()} (${this.node.type()}) has no scene assigned`);let a=RU[e];if(a!=null){let c=this._params_by_name[t];c&&(o?c.type()!=e&&this._deleteParam(c.name()):ie.warn(`a param named ${t} already exists`,this.node));let l=new a(this.node.scene(),this.node);if(l.options.set(s),l.setName(t),l.setInitValue(n),l.initComponents(),i==null)l.set(n);else if(l.options.isExpressionForEntities()&&l.set(n),i.raw_input!=null)l.set(i.raw_input);else if(i.simple_data!=null)l.set(i.simple_data);else if(i.complex_data!=null){let u=i.complex_data.raw_input;u?l.set(u):l.set(n);let h=i.complex_data.overriden_options;if(h!=null){let d=Object.keys(h);for(let p of d)l.options.setOption(p,h[p])}}if(l._setupNodeDependencies(this.node),this._params_by_name[l.name()]=l,l.isMultiple()&&l.components)for(let u of l.components)this._params_by_name[u.name()]=u;return this._params_added_since_last_params_eval=!0,l}}_updateCaches(){this._params_list=Object.values(this._params_by_name),this._param_names=Object.keys(this._params_by_name),this._non_spare_params=Object.values(this._params_by_name).filter(e=>!e.options.isSpare()),this._spare_params=Object.values(this._params_by_name).filter(e=>e.options.isSpare()),this._non_spare_param_names=Object.values(this._params_by_name).filter(e=>!e.options.isSpare()).map(e=>e.name()),this._spare_param_names=Object.values(this._params_by_name).filter(e=>e.options.isSpare()).map(e=>e.name())}async _evalParam(e){e.isDirty()&&(await e.compute(),e.states.error.active()&&this.node.states.error.set(`param '${e.name()}' error: ${e.states.error.message()}`))}async evalParams(e){let t=0;for(let s of e)s.isDirty()&&(t+=1);this._promises.length=t;let n=0;for(let s of e)s.isDirty()&&(this._promises[n]=this._evalParam(s),n+=1);await Promise.all(this._promises),this.node.states.error.active()&&this.node._setContainer(null)}paramsEvalRequired(){return this._params_node!=null&&(this._params_node.isDirty()||this._params_added_since_last_params_eval)}async evalAll(){var e;this.paramsEvalRequired()&&(await this.evalParams(this._params_list),(e=this._params_node)==null||e.removeDirtyState(),this._params_added_since_last_params_eval=!1)}onParamsCreated(e,t){if(this._params_created)t();else{if(this._post_create_params_hook_names&&this._post_create_params_hook_names.includes(e)){ie.error(`hook name ${e} already exists`);return}this._post_create_params_hook_names=this._post_create_params_hook_names||[],this._post_create_params_hook_names.push(e),this._post_create_params_hooks=this._post_create_params_hooks||[],this._post_create_params_hooks.push(t)}}addOnSceneLoadHook(e,t){this._on_scene_load_hook_names=this._on_scene_load_hook_names||[],this._on_scene_load_hooks=this._on_scene_load_hooks||[],this._on_scene_load_hook_names.includes(e)?ie.warn(`hook with name ${e} already exists`,this.node):(this._on_scene_load_hook_names.push(e),this._on_scene_load_hooks.push(t))}_runPostCreateParamsHooks(){if(this._post_create_params_hooks)for(let e of this._post_create_params_hooks)e()}runOnSceneLoadHooks(){if(this._on_scene_load_hooks)for(let e of this._on_scene_load_hooks)e()}};var Ox=class{constructor(){}};var Lhe="triggered",OU={type:Lhe},IU=class{constructor(r,e,t=0,n=0){if(this._node_src=r,this._node_dest=e,this._output_index=t,this._input_index=n,this._output_index==null)throw"bad output index";if(this._input_index==null)throw"bad input index";this._id=IU._next_id++,this._node_src.io.connections&&this._node_dest.io.connections&&(this._node_src.io.connections.addOutputConnection(this),this._node_dest.io.connections.addInputConnection(this))}get id(){return this._id}get node_src(){return this._node_src}get node_dest(){return this._node_dest}get output_index(){return this._output_index}get input_index(){return this._input_index}src_connection_point(){let r=this._node_src,e=this._output_index;return r.io.outputs.namedOutputConnectionPoints()[e]}dest_connection_point(){let r=this._node_dest,e=this._input_index;return r.io.inputs.namedInputConnectionPoints()[e]}disconnect(r={}){this._node_src.io.connections&&this._node_dest.io.connections&&(this._node_src.io.connections.removeOutputConnection(this),this._node_dest.io.connections.removeInputConnection(this)),r.setInput===!0&&this._node_dest.io.inputs.setInput(this._input_index,null)}_eventDispatcher(){return this.__eventDispatcher}eventDispatcher(){return this.__eventDispatcher=this.__eventDispatcher||new pr}},Ix=IU;Ix._next_id=0;var Dx=class{constructor(e){this.inputs_controller=e,this._cloneRequiredStates=[],this._overridden=!1,this.node=e.node}initInputsClonedState(e){q.isArray(e)?this._clonedStates=e:this._clonedState=e,this._updateCloneRequiredState()}overrideClonedStateAllowed(){if(this._clonedStates){for(let e of this._clonedStates)if(e==Tt.FROM_NODE)return!0}return this._clonedState?this._clonedState==Tt.FROM_NODE:!1}cloneRequiredState(e){return this._cloneRequiredStates[e]}cloneRequiredStates(){return this._cloneRequiredStates}_getCloneRequiredState(e){let t=this._clonedStates;if(t){let n=t[e];if(n!=null)return this._cloneRequiredFromState(n)}return this._clonedState?this._cloneRequiredFromState(this._clonedState):!0}_cloneRequiredFromState(e){switch(e){case Tt.ALWAYS:return!0;case Tt.NEVER:return!1;case Tt.FROM_NODE:return!this._overridden}return Bn.unreachable(e)}overrideClonedState(e){this._overridden=e,this._updateCloneRequiredState(),this.node.emit(pt.OVERRIDE_CLONABLE_STATE_UPDATE),this.node.setDirty()}overriden(){return this._overridden}_updateCloneRequiredState(){if(this._clonedStates){let e=[];for(let t=0;t<this._clonedStates.length;t++)e[t]=this._getCloneRequiredState(t);this._cloneRequiredStates=e}else if(this._clonedState){let e=this.inputs_controller.maxInputsCount(),t=[];for(let n=0;n<e;n++)t[n]=this._getCloneRequiredState(n);this._cloneRequiredStates=t}}};var Lx=0,Bx=class{constructor(e){this.node=e,this._graphNodeInputs=[],this._inputs=[],this._has_named_inputs=!1,this._minInputsCount=0,this._maxInputsCount=Lx,this._maxInputsCountOnInput=Lx,this._depends_on_inputs=!0}dispose(){this._graphNode&&this._graphNode.dispose();for(let e of this._graphNodeInputs)e&&e.dispose();this._on_update_hooks=void 0,this._on_update_hook_names=void 0}setDependsOnInputs(e){this._depends_on_inputs=e}setMinCount(e){this._minInputsCount=e}minCount(){return this._minInputsCount}setMaxCount(e){this._maxInputsCount==Lx&&(this._maxInputsCountOnInput=e),this._maxInputsCount=e,this._initGraphNodeInputs()}namedInputConnectionPointsByName(e){if(this._named_input_connection_points){for(let t of this._named_input_connection_points)if(t&&t.name()==e)return t}}setNamedInputConnectionPoints(e){var t;this._has_named_inputs=!0;let n=((t=this._named_input_connection_points)==null?void 0:t.filter(a=>a==null?void 0:a.inNodeDefinition()))||[],s=Ce.shallowClone(n),i=new Set;for(let a of n)a&&i.add(a.name());for(let a of e)a&&(i.has(a.name())||(i.add(a.name()),s.push(a)));let o=this.node.io.connections.inputConnections();if(o)for(let a of o)a&&a.input_index>=s.length&&a.disconnect({setInput:!0});this._named_input_connection_points=s,this.setMinCount(0),this.setMaxCount(this._named_input_connection_points.length),this._initGraphNodeInputs(),this.node.emit(pt.NAMED_INPUTS_UPDATED)}hasNamedInputs(){return this._has_named_inputs}namedInputConnectionPoints(){return this._named_input_connection_points||[]}_initGraphNodeInputs(){for(let e=0;e<this._maxInputsCount;e++)this._graphNodeInputs[e]=this._graphNodeInputs[e]||this._createGraphNodeInput(e)}_createGraphNodeInput(e){let t=new Rt(this.node.scene(),`input_${e}`);return this._graphNode||(this._graphNode=new Rt(this.node.scene(),"inputs"),this.node.addGraphInput(this._graphNode,!1)),this._graphNode.addGraphInput(t,!1),t}maxInputsCount(){return this._maxInputsCount||0}maxInputsCountOverriden(){return this._maxInputsCount!=this._maxInputsCountOnInput}inputGraphNode(e){return this._graphNodeInputs[e]}setCount(e,t){t==null&&(t=e),this.setMinCount(e),this.setMaxCount(t),this._initConnectionControllerInputs()}_initConnectionControllerInputs(){this.node.io.connections.initInputs()}isGraphNodeDirty(){var e;return((e=this._graphNode)==null?void 0:e.isDirty())||!1}_isAnyInputDirty(){for(let e of this._inputs)if(e&&e.isDirty())return!0;return!1}containersWithoutEvaluation(){let e=[];for(let t=0;t<this._inputs.length;t++){let n=this._inputs[t],s;n&&(s=n.containerController.containerUnlessBypassed()),e.push(s)}return e}_existingInputIndices(){let e=[];if(this._maxInputsCount>0)for(let t=0;t<this._inputs.length;t++)this._inputs[t]&&e.push(t);return e}async evalRequiredInputs(){var e;let t=[];if(this._maxInputsCount>0){let n=this._existingInputIndices();if(n.length<this._minInputsCount)this.node.states.error.set("inputs are missing");else if(n.length>0){let s=[],i;for(let o=0;o<this._inputs.length;o++)i=this._inputs[o],i&&s.push(this.evalRequiredInput(o));t=await Promise.all(s),this._isAnyInputDirty()||(e=this._graphNode)==null||e.removeDirtyState()}}return t}async evalRequiredInput(e){let t,n=this.input(e);if(n&&(t=await n.compute(),this._graphNodeInputs[e].removeDirtyState()),!(t&&t.coreContent())){if(n){let s=n.states.error.message();s&&this.node.states.error.set(`input ${e} is invalid (error: ${s})`)}}return t}getNamedInputIndex(e){var t;if(this._named_input_connection_points){for(let n=0;n<this._named_input_connection_points.length;n++)if(((t=this._named_input_connection_points[n])==null?void 0:t.name())==e)return n}return-1}getInputIndex(e){if(q.isString(e)){if(this.hasNamedInputs())return this.getNamedInputIndex(e);throw new Error(`node ${this.node.path()} has no named inputs`)}else return e}setInput(e,t,n,s){n==null&&(n=0);let i=(s==null?void 0:s.noExceptionOnInvalidInput)||!1,o=this.getInputIndex(e)||0;if(o<0){let d=`invalid input (${e}) for node ${this.node.path()}`;if(i)return;throw console.warn(d),new Error(d)}let a=0;if(t&&t.io.outputs.hasNamedOutputs()&&(a=t.io.outputs.getOutputIndex(n),a==null||a<0)){let p=t.io.outputs.namedOutputConnectionPoints().map(_=>_.name());console.warn(`node ${t.path()} does not have an output named ${n}. inputs are: ${p.join(", ")}`);return}let c=this._graphNodeInputs[o];if(c==null){let d=`graph_input_node not found at index ${o}`;throw console.warn(d),new Error(d)}if(t&&this.node.parent()!=t.parent())return;let l=this._inputs[o],u=null,h;this.node.io.connections&&(h=this.node.io.connections.inputConnection(o)),h&&(u=h.output_index),(t!==l||a!=u)&&(l!=null&&this._depends_on_inputs&&c.removeGraphInput(l),t!=null?c.addGraphInput(t)?(this._depends_on_inputs||c.removeGraphInput(t),h&&h.disconnect({setInput:!1}),this._inputs[o]=t,new Ix(t,this.node,a,o)):console.warn(`cannot connect ${t.path()} to ${this.node.path()}`):(this._inputs[o]=null,h&&h.disconnect({setInput:!1})),this._run_on_set_input_hooks(),c.setSuccessorsDirty(),this.node.emit(pt.INPUTS_UPDATED))}remove_input(e){let t=this.inputs(),n;for(let s=0;s<t.length;s++)n=t[s],n!=null&&e!=null&&n.graphNodeId()===e.graphNodeId()&&this.setInput(s,null)}input(e){return this._inputs[e]}named_input(e){if(this.hasNamedInputs()){let t=this.getInputIndex(e);return this._inputs[t]}else return null}named_input_connection_point(e){if(this.hasNamedInputs()&&this._named_input_connection_points){let t=this.getInputIndex(e);return this._named_input_connection_points[t]}}has_named_input(e){return this.getNamedInputIndex(e)>=0}hasInput(e){return this._inputs[e]!=null}inputs(){return this._inputs}initInputsClonedState(e){this._clonedStatesController||(this._clonedStatesController=new Dx(this),this._clonedStatesController.initInputsClonedState(e))}overrideClonedStateAllowed(){var e;return((e=this._clonedStatesController)==null?void 0:e.overrideClonedStateAllowed())||!1}overrideClonedState(e){var t;(t=this._clonedStatesController)==null||t.overrideClonedState(e)}clonedStateOverriden(){var e;return((e=this._clonedStatesController)==null?void 0:e.overriden())||!1}cloneRequired(e){var t;let n=(t=this._clonedStatesController)==null?void 0:t.cloneRequiredState(e);return n??!0}cloneRequiredStates(){var e;let t=(e=this._clonedStatesController)==null?void 0:e.cloneRequiredStates();return t??!0}add_on_set_input_hook(e,t){this._on_update_hooks=this._on_update_hooks||[],this._on_update_hook_names=this._on_update_hook_names||[],this._on_update_hook_names.includes(e)?console.warn(`hook with name ${e} already exists`,this.node):(this._on_update_hooks.push(t),this._on_update_hook_names.push(e))}_run_on_set_input_hooks(){if(this._on_update_hooks)for(let e of this._on_update_hooks)e()}};var kx=class{constructor(e){this.node=e,this._has_outputs=!1,this._has_named_outputs=!1,this._onPlayingStateChangeBound=this._onPlayingStateChange.bind(this),this._outputIndexCache=new Map,this.node.scene().timeController.onPlayingStateChange(this._onPlayingStateChangeBound)}_onPlayingStateChange(){this._clearCache()}_clearCache(){this._outputIndexCache.clear()}dispose(){this.node.scene().timeController.removeOnPlayingStateChange(this._onPlayingStateChangeBound),this._named_output_connection_points&&this._named_output_connection_points.splice(0,this._named_output_connection_points.length)}setHasOneOutput(){this._has_outputs=!0}setHasNoOutput(){this._has_outputs=!1}hasOutputs(){return this._has_outputs}hasNamedOutputs(){return this._has_named_outputs}hasNamedOutput(e){return this.getNamedOutputIndex(e)>=0}namedOutputConnectionPoints(){return this._named_output_connection_points||[]}namedOutputConnection(e){if(this._named_output_connection_points)return this._named_output_connection_points[e]}getNamedOutputIndex(e){if(this._named_output_connection_points){let t=0;for(let n of this._named_output_connection_points){if(n&&n.name()==e)return t;t++}}return-1}getOutputIndex(e){let t=this._outputIndexCache.get(e);return t==null&&(t=this._getOutputIndex(e),this._outputIndexCache.set(e,t)),t}_getOutputIndex(e){return e!=null?q.isString(e)?this.hasNamedOutputs()?this.getNamedOutputIndex(e):(console.warn(`node ${this.node.path()} has no named outputs`),-1):e:-1}namedOutputConnectionPointsByName(e){if(this._named_output_connection_points){for(let t of this._named_output_connection_points)if((t==null?void 0:t.name())==e)return t}}setNamedOutputConnectionPoints(e,t=!0){this._has_named_outputs=!0;let n=this.node.io.connections.outputConnections();if(n)for(let s of n)s&&s.output_index>=e.length&&s.disconnect({setInput:!0});this._named_output_connection_points=e,t&&this.node.scene()&&this.node.setDirty(this.node),this.node.emit(pt.NAMED_OUTPUTS_UPDATED)}used_output_names(){var e;let t=this.node.io.connections;if(t){let s=t.outputConnections().map(a=>a?a.output_index:null);s=Ce.uniq(s);let i=[];s.forEach(a=>{q.isNumber(a)&&i.push(a)});let o=[];for(let a of i){let c=(e=this.namedOutputConnectionPoints()[a])==null?void 0:e.name();c&&o.push(c)}return o}else return[]}};var Fx=class{constructor(e){this._node=e,this._outputConnections=new Map}initInputs(){let e=this._node.io.inputs.maxInputsCount();for(this._inputConnections=this._inputConnections||new Array(e);this._inputConnections.length<e;)this._inputConnections.push(void 0)}dispose(){this._inputConnections&&this._inputConnections.splice(0,this._inputConnections.length),this._outputConnections&&this._outputConnections.clear()}addInputConnection(e){this._inputConnections?this._inputConnections[e.input_index]=e:console.warn("input connections array not initialized")}removeInputConnection(e){if(this._inputConnections)if(e.input_index<this._inputConnections.length){this._inputConnections[e.input_index]=void 0;let t=!0;for(let n=e.input_index;n<this._inputConnections.length;n++)this._inputConnections[n]&&(t=!1);t&&(this._inputConnections=this._inputConnections.slice(0,e.input_index))}else console.warn(`attempt to remove an input connection at index ${e.input_index}`);else console.warn("input connections array not initialized")}inputConnection(e){if(this._inputConnections)return this._inputConnections[e]}firstInputConnection(){return this._inputConnections?Ce.compact(this._inputConnections)[0]:null}inputConnections(){return this._inputConnections}existingInputConnections(){let e=this._inputConnections;if(e)for(;e.length>1&&e[e.length-1]===void 0;)e.pop();return e}addOutputConnection(e){let t=e.output_index,n=e.id,s=this._outputConnections.get(t);s||(s=new Map,this._outputConnections.set(t,s)),s.set(n,e)}removeOutputConnection(e){let t=e.output_index,n=e.id,s=this._outputConnections.get(t);s&&s.delete(n)}outputConnectionsByOutputIndex(e){return this._outputConnections.get(e)}outputConnections(){let e=[];return this._outputConnections.forEach((t,n)=>{t.forEach((s,i)=>{s&&e.push(s)})}),e}};var Ux=class{constructor(e){this._node=e}set_in(e){this._in=e}set_out(e){this._out=e}clear(){this._in=void 0,this._out=void 0}in(){return this._in}out(){return this._out}};var Bs=class{constructor(e,t,n){this._name=e,this._type=t,this._init_value=n,this._inNodeDefinition=!1}get init_value(){return this._init_value}name(){return this._name}type(){return this._type}are_types_matched(e,t){return!0}inNodeDefinition(){return this._inNodeDefinition}toJSON(){return this._json=this._json||this._create_json()}_create_json(){return{name:this._name,type:this._type}}};var kt=(r=>(r.BOOL="bool",r.INT="int",r.FLOAT="float",r.VEC2="vec2",r.VEC3="vec3",r.VEC4="vec4",r.SAMPLER_2D="sampler2D",r.SAMPLER_CUBE="samplerCube",r.SSS_MODEL="SSSModel",r.SDF_CONTEXT="SDFContext",r.SDF_MATERIAL="SDFMaterial",r))(kt||{}),zx=["bool","int","float","vec2","vec3","vec4","sampler2D","SSSModel","SDFContext","SDFMaterial"],Bhe={bool:U.BOOLEAN,int:U.INTEGER,float:U.FLOAT,vec2:U.VECTOR2,vec3:U.VECTOR3,vec4:U.VECTOR4,sampler2D:U.RAMP,samplerCube:U.RAMP,SSSModel:U.STRING,SDFContext:U.STRING,SDFMaterial:U.STRING},DU={[U.BOOLEAN]:"bool",[U.COLOR]:"vec3",[U.INTEGER]:"int",[U.FLOAT]:"float",[U.FOLDER]:void 0,[U.VECTOR2]:"vec2",[U.VECTOR3]:"vec3",[U.VECTOR4]:"vec4",[U.BUTTON]:void 0,[U.PARAM_PATH]:void 0,[U.NODE_PATH]:void 0,[U.RAMP]:void 0,[U.STRING]:void 0},khe={bool:!1,int:0,float:0,vec2:[0,0],vec3:[0,0,0],vec4:[0,0,0,0],sampler2D:cr.DEFAULT_VALUE_JSON,samplerCube:cr.DEFAULT_VALUE_JSON,SSSModel:"SSSModel()",SDFContext:"DefaultSDFContext()",SDFMaterial:"DefaultSDFMaterial()"};var Vx=class extends Bs{constructor(e,t,n){super(e,t);this._name=e,this._type=t,this._init_value=n,this._init_value=this._init_value||khe[this._type]}type(){return this._type}are_types_matched(e,t){return e==t}get param_type(){return Bhe[this._type]}get init_value(){return this._init_value}toJSON(){return this._json=this._json||this._create_json()}_create_json(){return{name:this._name,type:this._type}}};var qx=(r=>(r.BOOL="bool",r.INT="int",r.FLOAT="float",r.VEC2="vec2",r.VEC3="vec3",r.VEC4="vec4",r))(qx||{});var Fhe={bool:U.BOOLEAN,int:U.INTEGER,float:U.FLOAT,vec2:U.VECTOR2,vec3:U.VECTOR3,vec4:U.VECTOR4},LU={[U.BOOLEAN]:"bool",[U.COLOR]:"vec3",[U.INTEGER]:"int",[U.FLOAT]:"float",[U.FOLDER]:void 0,[U.VECTOR2]:"vec2",[U.VECTOR3]:"vec3",[U.VECTOR4]:"vec4",[U.BUTTON]:void 0,[U.PARAM_PATH]:void 0,[U.NODE_PATH]:void 0,[U.RAMP]:void 0,[U.STRING]:void 0},Uhe={bool:!1,int:0,float:0,vec2:[0,0],vec3:[0,0,0],vec4:[0,0,0,0]};var Gx=class extends Bs{constructor(e,t){super(e,t);this._type=t,this._init_value=Uhe[this._type]}type(){return this._type}are_types_matched(e,t){return e==t}get param_type(){return Fhe[this._type]}get init_value(){return this._init_value}toJSON(){return this._json=this._json||this._create_json()}_create_json(){return{name:this._name,type:this._type}}};var yo=(r=>(r.BASE="base",r.DRAG="drag",r.KEYBOARD="keyboard",r.MOUSE="mouse",r.POINTER="pointer",r))(yo||{});var xo=class extends Bs{constructor(e,t,n){super(e,t);this._name=e,this._type=t,this._event_listener=n}type(){return this._type}get param_type(){return U.FLOAT}are_types_matched(e,t){return t=="base"?!0:e==t}get event_listener(){return this._event_listener}toJSON(){return this._json=this._json||this._create_json()}_create_json(){return{name:this._name,type:this._type,isArray:!1}}};var Hx=(r=>(r.ANIMATION_MIXER="AnimationMixer",r.ANIMATION_ACTION="AnimationAction",r.BOOLEAN="boolean",r.BOOLEAN_ARRAY="boolean[]",r.BOX3="Box3",r.CATMULL_ROM_CURVE3="CatmullRomCurve3",r.COLOR="Color",r.COLOR_ARRAY="Color[]",r.FLOAT="float",r.FLOAT_ARRAY="float[]",r.INTEGER="integer",r.INTEGER_ARRAY="integer[]",r.MATERIAL="Material",r.OBJECT_3D="Object3D",r.PLANE="Plane",r.RAY="Ray",r.SPHERE="Sphere",r.STRING="string",r.STRING_ARRAY="string[]",r.TRIGGER="trigger",r.VECTOR2="Vector2",r.VECTOR2_ARRAY="Vector2[]",r.VECTOR3="Vector3",r.VECTOR3_ARRAY="Vector3[]",r.VECTOR4="Vector4",r.VECTOR4_ARRAY="Vector4[]",r))(Hx||{});var zhe={AnimationMixer:U.BUTTON,AnimationAction:U.BUTTON,boolean:U.BOOLEAN,["boolean[]"]:U.BUTTON,Box3:U.BUTTON,CatmullRomCurve3:U.BUTTON,Color:U.COLOR,["Color[]"]:U.BUTTON,float:U.FLOAT,["float[]"]:U.BUTTON,integer:U.INTEGER,["integer[]"]:U.BUTTON,Material:U.BUTTON,Object3D:U.BUTTON,Plane:U.BUTTON,Ray:U.BUTTON,Sphere:U.BUTTON,string:U.STRING,["string[]"]:U.BUTTON,trigger:U.BUTTON,Vector2:U.VECTOR2,["Vector2[]"]:U.BUTTON,Vector3:U.VECTOR3,["Vector3[]"]:U.BUTTON,Vector4:U.VECTOR4,["Vector4[]"]:U.BUTTON},N3e={AnimationMixer:"AnimationMixer",AnimationAction:"AnimationAction",boolean:"boolean[]",["boolean[]"]:"boolean[]",Box3:"Box3",CatmullRomCurve3:"CatmullRomCurve3",Color:"Color[]",["Color[]"]:"Color[]",float:"float[]",["float[]"]:"float[]",integer:"integer[]",["integer[]"]:"integer[]",Material:"Material",Object3D:"Object3D",Plane:"Plane",Ray:"Ray",Sphere:"Sphere",string:"string[]",["string[]"]:"string[]",trigger:"trigger",Vector2:"Vector2[]",["Vector2[]"]:"Vector2[]",Vector3:"Vector3[]",["Vector3[]"]:"Vector3[]",Vector4:"Vector4[]",["Vector4[]"]:"Vector4[]"},Vhe=new Set(["boolean[]","Color[]","float[]","integer[]","string[]","Vector2[]","Vector3[]","Vector4[]"]),BU={[U.BOOLEAN]:"boolean",[U.BUTTON]:void 0,[U.COLOR]:"Color",[U.FLOAT]:"float",[U.FOLDER]:void 0,[U.INTEGER]:"integer",[U.PARAM_PATH]:void 0,[U.NODE_PATH]:void 0,[U.RAMP]:void 0,[U.STRING]:"string",[U.VECTOR2]:"Vector2",[U.VECTOR3]:"Vector3",[U.VECTOR4]:"Vector4"},qhe={AnimationMixer:null,AnimationAction:null,boolean:!1,["boolean[]"]:null,Box3:null,CatmullRomCurve3:null,Color:new ae,["Color[]"]:null,float:0,["float[]"]:null,integer:0,["integer[]"]:null,Material:null,Object3D:null,Plane:null,Ray:null,Sphere:null,string:"",["string[]"]:null,trigger:null,Vector2:new G,["Vector2[]"]:null,Vector3:new A,["Vector3[]"]:null,Vector4:new Se,["Vector4[]"]:null},R3e={AnimationMixer:1,AnimationAction:1,boolean:1,["boolean[]"]:1,Box3:1,CatmullRomCurve3:1,Color:3,["Color[]"]:1,float:1,["float[]"]:1,integer:1,["integer[]"]:1,Material:1,Object3D:1,Plane:1,Ray:1,Sphere:1,string:1,["string[]"]:1,trigger:1,Vector2:2,["Vector2[]"]:2,Vector3:3,["Vector3[]"]:3,Vector4:4,["Vector4[]"]:4};var Wx=class extends Bs{constructor(e,t,n){super(e,t);this._name=e,this._type=t,this._isArray=Vhe.has(t),n&&(this._inNodeDefinition=n.inNodeDefinition==!0,this._init_value=n.init_value),this._init_value=this._init_value||qhe[this._type],(q.isColor(this._init_value)||q.isVector(this._init_value))&&(this._init_value=this._init_value.clone())}type(){return this._type}get param_type(){let e=zhe[this._type];return e==U.BUTTON?null:e}get init_value(){return this._init_value}are_types_matched(e,t){return e==t}toJSON(){return this._json=this._json||this._create_json()}_create_json(){return{name:this._name,type:this._type,isArray:this._isArray}}};var kU={[se.ACTOR]:Hx.TRIGGER,[se.ANIM]:void 0,[se.AUDIO]:void 0,[se.COP]:void 0,[se.CSG]:void 0,[se.EVENT]:yo.BASE,[se.GL]:kt.FLOAT,[se.JS]:qx.FLOAT,[se.MANAGER]:void 0,[se.MAT]:void 0,[se.OBJ]:void 0,[se.POST]:void 0,[se.ROP]:void 0,[se.SOP]:void 0};function Kp(r,e,t){switch(r){case se.ACTOR:return new Wx(e,t);case se.EVENT:return new xo(e,t);case se.GL:return new Vx(e,t);case se.JS:return new Gx(e,t);default:return}}function FU(r){switch(r){case se.ACTOR:return BU;case se.EVENT:return;case se.GL:return DU;case se.JS:return LU;default:return}}var jx=class{constructor(e,t){this.node=e,this._context=t,this._raw_input_serialized_by_param_name=new Map,this._default_value_serialized_by_param_name=new Map,this._initialized=!1}initializeNode(){if(this._initialized){console.warn("already initialized",this.node);return}this._initialized=!0,this.node.params.onParamsCreated("createInputsFromParams",this._createInputsFromParams.bind(this))}initialized(){return this._initialized}_createInputsFromParams(){let e=FU(this._context);if(!e)return;let t=[];for(let n of this.node.params.names){let s=!0;if(this._inputless_param_names&&this._inputless_param_names.length>0&&this._inputless_param_names.includes(n)&&(s=!1),s&&this.node.params.has(n)){let i=this.node.params.get(n);if(i&&!i.parentParam()){let o=e[i.type()];if(o){let a=Kp(this._context,i.name(),o);a&&t.push(a)}}}}this.node.io.inputs.setNamedInputConnectionPoints(t)}setInputlessParamNames(e){return this._inputless_param_names=e}createSpareParameters(){if(this.node.scene().loadingController.isLoading())return;let e=this.node.params.spare_names,t={};for(let s of e)if(this.node.params.has(s)){let i=this.node.params.get(s);i&&(this._raw_input_serialized_by_param_name.set(s,i.rawInputSerialized()),this._default_value_serialized_by_param_name.set(s,i.defaultValueSerialized()),t.namesToDelete=t.namesToDelete||[],t.namesToDelete.push(s))}let n=0;for(let s of this.node.io.inputs.namedInputConnectionPoints()){if(s){let i=this.node.io.inputs.input(n)!=null,o=s.name(),a=s.param_type;if(a){let c=s.init_value,l=this._default_value_serialized_by_param_name.get(o),u=this.node.paramDefaultValue(o);if(u!=null?c=u:l!=null?c=l:c=s.init_value,q.isArray(s.init_value))if(q.isNumber(c)){let h=new Array(s.init_value.length);h.fill(c),c=h}else q.isArray(c)&&c.length==s.init_value.length&&l!=null&&(c=s.init_value);c!=null&&(t.toAdd=t.toAdd||[],t.toAdd.push({name:o,type:a,initValue:pn.clone(c),rawInput:pn.clone(c),options:{spare:!0,editable:!i}}))}}n++}this.node.params.updateParams(t);for(let s of this.node.params.spare)if(!s.parentParam()){let i=this._raw_input_serialized_by_param_name.get(s.name());i&&s.set(i)}}};function Qp(r,e){if(r.length!=e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!=e[t])return!1;return!0}var $x=class{constructor(e,t){this.node=e,this._context=t,this._create_spare_params_from_inputs=!0,this._functions_overridden=!1,this._input_name_function=n=>`in${n}`,this._output_name_function=n=>n==0?"val":`val${n}`,this._expected_input_types_function=()=>{let n=this.first_input_connection_type()||this.default_connection_type();return[n,n]},this._expected_output_types_function=()=>[this._expected_input_types_function()[0]],this._update_signature_if_required_bound=this.update_signature_if_required.bind(this),this._initialized=!1,this._spare_params_controller=new jx(this.node,this._context)}default_connection_type(){return kU[this._context]}create_connection_point(e,t){return Kp(this._context,e,t)}functions_overridden(){return this._functions_overridden}initialized(){return this._initialized}set_create_spare_params_from_inputs(e){this._create_spare_params_from_inputs=e}set_input_name_function(e){this._initialize_if_required(),this._input_name_function=e}set_output_name_function(e){this._initialize_if_required(),this._output_name_function=e}set_expected_input_types_function(e){this._initialize_if_required(),this._functions_overridden=!0,this._expected_input_types_function=e}set_expected_output_types_function(e){this._initialize_if_required(),this._functions_overridden=!0,this._expected_output_types_function=e}input_name(e){return this._wrapped_input_name_function(e)}output_name(e){return this._wrapped_output_name_function(e)}initializeNode(){if(this._initialized){console.warn("already initialized",this.node);return}this._initialized=!0,this.node.io.inputs.add_on_set_input_hook("_update_signature_if_required",this._update_signature_if_required_bound),this.node.params.addOnSceneLoadHook("_update_signature_if_required",this._update_signature_if_required_bound),this.node.params.onParamsCreated("_update_signature_if_required_bound",this._update_signature_if_required_bound),this.node.addPostDirtyHook("_update_signature_if_required",this._update_signature_if_required_bound),this._spare_params_controller.initialized()||this._spare_params_controller.initializeNode()}_initialize_if_required(){this._initialized||this.initializeNode()}get spare_params(){return this._spare_params_controller}update_signature_if_required(e){(!this.node.lifecycle.creationCompleted()||!this._inputsOutputsMatchExpectations())&&(this.update_connection_types(),this.node.removeDirtyState(),this.node.scene().loadingController.isLoading()||this.make_successors_update_signatures())}make_successors_update_signatures(){let e=this.node.graphAllSuccessors();if(this.node.childrenAllowed()){let t=this.node.nodesByType(Nn.INPUT),n=this.node.nodesByType(Nn.OUTPUT);for(let s of t)e.push(s);for(let s of n)e.push(s)}for(let t of e){let n=t;n.io&&n.io.has_connection_points_controller&&n.io.connection_points.initialized()&&n.io.connection_points.update_signature_if_required(this.node)}}update_connection_types(){let t=this._wrapped_expected_input_types_function(),n=this._wrapped_expected_output_types_function(),s=[];for(let o=0;o<t.length;o++){let a=t[o],c=this.create_connection_point(this._wrapped_input_name_function(o),a);s.push(c)}let i=[];for(let o=0;o<n.length;o++){let a=n[o],c=this.create_connection_point(this._wrapped_output_name_function(o),a);i.push(c)}this.node.io.inputs.setNamedInputConnectionPoints(s),this.node.io.outputs.setNamedOutputConnectionPoints(i,!1),this._create_spare_params_from_inputs&&this._spare_params_controller.createSpareParameters()}_inputsOutputsMatchExpectations(){let e=this.node.io.inputs.namedInputConnectionPoints(),t=this.node.io.outputs.namedOutputConnectionPoints(),n=Qp(e.filter(a=>!(a==null?void 0:a.inNodeDefinition())).map(a=>a==null?void 0:a.type()),this._wrapped_expected_input_types_function()),s=Qp(t.map(a=>a==null?void 0:a.type()),this._wrapped_expected_output_types_function()),i=Qp(e.filter(a=>!(a==null?void 0:a.inNodeDefinition())).map(a=>a==null?void 0:a.name()),e.filter(a=>!(a==null?void 0:a.inNodeDefinition())).map((a,c)=>this._wrapped_input_name_function(c))),o=Qp(t.map(a=>a==null?void 0:a.name()),t.map((a,c)=>this._wrapped_output_name_function(c)));return n&&s&&i&&o}_wrapped_expected_input_types_function(){if(this.node.scene().loadingController.isLoading()){let e=this.node.io.saved_connection_points_data.in();if(e)return e.map(t=>t.type)}return this._expected_input_types_function()}_wrapped_expected_output_types_function(){if(this.node.scene().loadingController.isLoading()){let e=this.node.io.saved_connection_points_data.out();if(e)return e.map(t=>t.type)}return this._expected_output_types_function()}_wrapped_input_name_function(e){if(this.node.scene().loadingController.isLoading()){let t=this.node.io.saved_connection_points_data.in();if(t)return t[e].name}return this._input_name_function(e)}_wrapped_output_name_function(e){if(this.node.scene().loadingController.isLoading()){let t=this.node.io.saved_connection_points_data.out();if(t)return t[e].name}return this._output_name_function(e)}first_input_connection_type(){return this.input_connection_type(0)}input_connection_type(e){let t=this.node.io.connections.inputConnections();if(t){let n=t[e];if(n)return n.src_connection_point().type()}}};var Xx=class{constructor(e){this.node=e,this._connections=new Fx(this.node)}dispose(){this.inputs.dispose(),this.outputs.dispose(),this.connections.dispose()}get connections(){return this._connections}get inputs(){return this._inputs=this._inputs||new Bx(this.node)}hasInputs(){return this._inputs!=null}get outputs(){return this._outputs=this._outputs||new kx(this.node)}has_outputs(){return this._outputs!=null}get connection_points(){return this._connection_points=this._connection_points||new $x(this.node,this.node.context())}get has_connection_points_controller(){return this._connection_points!=null}get saved_connection_points_data(){return this._saved_connection_points_data=this._saved_connection_points_data||new Ux(this.node)}clear_saved_connection_points_data(){this._saved_connection_points_data&&(this._saved_connection_points_data.clear(),this._saved_connection_points_data=void 0)}};var Yx=class{constructor(){}};var Gt=class extends Rt{constructor(e,t="BaseNode",n){super(e,t);this.createOptions=n,this.containerController=new ax(this),this.pv=new Ox,this.p=new Yx,this._initialized=!1}copy_param_values(e){let t=this.params.non_spare;for(let n of t){let s=e.params.get(n.name());s&&n.copyValue(s)}}get parentController(){return this._parent_controller=this._parent_controller||new j_(this)}static displayedInputNames(){return[]}childrenControllerContext(){return this._childrenControllerContext}_create_childrenController(){if(this._childrenControllerContext)return new K_(this,this._childrenControllerContext)}get childrenController(){return this._childrenController=this._childrenController||this._create_childrenController()}childrenAllowed(){return this._childrenControllerContext!=null}get uiData(){return this._uiData=this._uiData||new B_(this)}get states(){return this._states=this._states||new W_(this)}get lifecycle(){return this._lifecycle=this._lifecycle||new Q_(this)}get serializer(){return this._serializer=this._serializer||new du(this)}get cookController(){return this._cookController=this._cookController||new lx(this)}get io(){return this._io=this._io||new Xx(this)}get nameController(){return this._nameController=this._nameController||new xl(this)}setName(e){this.nameController.setName(e)}_setCoreName(e){this._name=e}get params(){return this._paramsController=this._paramsController||new Rx(this)}initializeBaseAndNode(){var e;this._initialized?console.warn("node already initialized"):(this._initialized=!0,(e=this.displayNodeController)==null||e.initializeNode(),this.initializeBaseNode(),this.initializeNode(),this.polyNodeController&&this.polyNodeController.initializeNode())}initializeBaseNode(){}initializeNode(){}static type(){throw"type to be overriden"}type(){return this.constructor.type()}static context(){throw console.error("node has no node_context",this),"context requires override"}context(){return this.constructor.context()}static require_webgl2(){return!1}require_webgl2(){return this.constructor.require_webgl2()}setParent(e){this.parentController.setParent(e)}parent(){return this.parentController.parent()}firstAncestorWithContext(e){return this.parentController.firstAncestorWithContext(e)}root(){return this._scene.root()}path(e){return this.parentController.path(e)}createParams(){}addParam(e,t,n,s){var i;return(i=this._paramsController)==null?void 0:i.addParam(e,t,n,s)}paramDefaultValue(e){return null}cook(e){return null}onCookEnd(e,t){this.cookController.registerOnCookEnd(e,t)}async compute(){var e,t;return this.isDirty()||((t=(e=this.flags)==null?void 0:e.bypass)==null?void 0:t.active())?await this.containerController.compute():this.containerController.container()}_setContainer(e,t=null){this.containerController.container().set_content(e),e!=null&&(e.name||(e.name=this.path()),e.node||(e.node=this)),this.cookController.endCook(t)}createNode(e,t){var n;return(n=this.childrenController)==null?void 0:n.createNode(e,t)}createOperationContainer(e,t,n){var s;return(s=this.childrenController)==null?void 0:s.createOperationContainer(e,t,n)}removeNode(e){var t;(t=this.childrenController)==null||t.removeNode(e)}dispose(){super.dispose(),this.setParent(null),this._nameController&&(this._nameController.dispose(),this._nameController=void 0),this._io&&(this._io.dispose(),this._io=void 0),this._lifecycle&&(this._lifecycle.dispose(),this._lifecycle=void 0),this.displayNodeController&&this.displayNodeController.dispose(),this._childrenController&&(this._childrenController.dispose(),this._childrenController=void 0),this._paramsController&&(this._paramsController.dispose(),this._paramsController=void 0),this._cookController&&(this._cookController.dispose(),this._cookController=void 0),this._serializer&&(this._serializer.dispose(),this._serializer=void 0),this._uiData&&(this._uiData.dispose(),this._uiData=void 0)}children(){var e;return((e=this.childrenController)==null?void 0:e.children())||[]}node(e){var t;return((t=this.parentController)==null?void 0:t.findNode(e))||null}nodeSibling(e){var t;let n=this.parent();if(n){let s=(t=n.childrenController)==null?void 0:t.childByName(e);if(s)return s}return null}nodesByType(e){var t;return((t=this.childrenController)==null?void 0:t.nodesByType(e))||[]}setInput(e,t,n,s){this.io.inputs.setInput(e,t,n,s)}emit(e,t=null){this.scene().dispatchController.dispatch(this,e,t)}toJSON(e=!1){return this.serializer.toJSON(e)}usedAssembler(){}integrationData(){}};var jt=(r=>(r.CURSOR="cursor",r.ON_CHILD_ATTRIBUTE_UPDATE="onChildAttributeUpdate",r.ON_KEYDOWN="onKeydown",r.ON_KEYPRESS="onKeypress",r.ON_KEYUP="onKeyup",r.ON_SCENE_RESET="onSceneReset",r.ON_SCENE_PLAY_STATE="onScenePlayState",r.ON_TICK="onTick",r.ON_OBJECT_ATTRIBUTE_UPDATE="onObjectAttributeUpdate",r.ON_OBJECT_CLICK="onObjectClick",r.ON_OBJECT_HOVER="onObjectHover",r.ON_OBJECT_POINTERDOWN="onObjectPointerdown",r.ON_OBJECT_POINTERUP="onObjectPointerup",r.ON_POINTERDOWN="onPointerdown",r.ON_POINTERUP="onPointerup",r.RAY_FROM_CURSOR="rayFromCursor",r))(jt||{});var Zx=class{constructor(e){this.actorsManager=e,this._scene=e.scene}runTriggers(){if(!this._triggered())return;let e=this._triggeredNodeParent();if(!e)return;let t=this._nodeToRunTriggerFrom,n=this._nodeToReceiveTrigger;this._reset();let s=e.graphNodeId();this._scene.threejsScene().traverse(i=>{let o=this.actorsManager.objectActorNodeIds(i);!o||!o.includes(s)||(t&&t.runTrigger({Object3D:i}),n&&n.receiveTrigger({Object3D:i}))})}setNodeToRunTriggerFrom(e){this._nodeToRunTriggerFrom=e}setNodeToReceiveTrigger(e){this._nodeToReceiveTrigger=e}_triggered(){return this._nodeToRunTriggerFrom!=null||this._nodeToReceiveTrigger!=null}_triggeredNodeParent(){let e=this._nodeToRunTriggerFrom||this._nodeToReceiveTrigger;if(!!e)return this.actorsManager.parentActorBuilderNode(e)}_reset(){this._nodeToRunTriggerFrom=void 0,this._nodeToReceiveTrigger=void 0}};var Jx=class{constructor(e){this.actorsManager=e,this._triggeredNodes=new Set,this._scene=e.scene}setTriggeredNodes(e){e.forEach(t=>{this._triggeredNodes.add(t)})}runTriggers(){this._triggeredNodes.forEach(e=>{let t=this._triggeredNodeParent(e);if(!t)return;let n=t.graphNodeId();this._scene.threejsScene().traverse(s=>{let i=this.actorsManager.objectActorNodeIds(s);!i||!i.includes(n)||e.receiveTrigger({Object3D:s})})}),this._triggeredNodes.clear()}_triggeredNodeParent(e){return this.actorsManager.parentActorBuilderNode(e)}};var Kx=class{constructor(e){this.actorsManager=e,this._scene=e.scene}runTriggers(){this._scene.threejsScene().traverse(e=>{let t=this.actorsManager.objectActorNodeIds(e);if(!!t)for(let n of t){let s=this._scene.graph.nodeFromId(n);if(s){let i=s.nodesByType(jt.ON_OBJECT_HOVER);for(let o of i)o.receiveTrigger({Object3D:e})}}})}};var Qx=class{constructor(e){this.actorsManager=e,this._triggeredNodes=new Set,this._scene=e.scene}setTriggeredNodes(e){e.forEach(t=>{this._triggeredNodes.add(t)})}runTriggers(){this._triggeredNodes.forEach(e=>{let t=this._triggeredNodeParent(e);if(!t)return;let n=t.graphNodeId();this._scene.threejsScene().traverse(s=>{let i=this.actorsManager.objectActorNodeIds(s);!i||!i.includes(n)||e.receiveTrigger({Object3D:s})})}),this._triggeredNodes.clear()}_triggeredNodeParent(e){return this.actorsManager.parentActorBuilderNode(e)}};var ev="actorBuilderNodeIds";var tv=class{constructor(e){this.scene=e,this._actorNodes=new Set,this._onEventTickBound=this._onEventTick.bind(this),this._onEventSceneResetBound=this._onEventSceneReset.bind(this),this._onEventScenePlayBound=this._onEventScenePlay.bind(this),this._onEventScenePauseBound=this._onEventScenePause.bind(this)}assignActorBuilder(e,t){let n=this.objectActorNodeIds(e);n||(n=[],e.userData[ev]=n);let s=t.graphNodeId();n.includes(s)||n.push(s),this._actorNodes.add(t)}objectActorNodeIds(e){return e.userData[ev]}get keyboardEventsController(){return this._keyboardEventsController=this._keyboardEventsController||new Qx(this)}get manualTriggerController(){return this._manualTriggerController=this._manualTriggerController||new Zx(this)}get pointerEventsController(){return this._pointerEventsController=this._pointerEventsController||new Jx(this)}get hoveredEventsController(){return this._hoveredEventsController=this._hoveredEventsController||new Kx(this)}tick(){var e,t,n;(e=this._manualTriggerController)==null||e.runTriggers(),(t=this._pointerEventsController)==null||t.runTriggers(),(n=this._keyboardEventsController)==null||n.runTriggers(),this.hoveredEventsController.runTriggers(),this._runOnEventTick()}runOnEventSceneReset(){this.scene.threejsScene().traverse(this._onEventSceneResetBound)}runOnEventScenePlay(){this.scene.threejsScene().traverse(this._onEventScenePlayBound),this._makeRequiredObjectAttributesReactive()}runOnEventScenePause(){this.scene.threejsScene().traverse(this._onEventScenePauseBound)}_runOnEventTick(){this.scene.threejsScene().traverse(this._onEventTickBound)}_onEventTick(e){this._triggerEventNodes(e,jt.ON_TICK)}_onEventSceneReset(e){this._triggerEventNodes(e,jt.ON_SCENE_RESET)}_onEventScenePlay(e){this._triggerEventNodes(e,jt.ON_SCENE_PLAY_STATE,0)}_onEventScenePause(e){this._triggerEventNodes(e,jt.ON_SCENE_PLAY_STATE,1)}_triggerEventNodes(e,t,n=0){let s=this.objectActorNodeIds(e);if(!!s)for(let i of s){let o=this.scene.graph.nodeFromId(i);if(o){let a=o.nodesByType(t);for(let c of a)c.runTrigger({Object3D:e},n)}}}_makeRequiredObjectAttributesReactive(){this.scene.threejsScene().traverse(e=>{let t=()=>{let a=this.objectActorNodeIds(e);if(!a)return;let l=a.map(h=>this.scene.graph.nodeFromId(h)).filter(h=>h).map(h=>h.nodesByType(jt.ON_OBJECT_ATTRIBUTE_UPDATE)).flat();return je.groupBy(l,h=>h.attributeName())},n=()=>{let a=e.parent;if(!a)return;let c=a.userData[ev];if(!c)return;let u=c.map(d=>this.scene.graph.nodeFromId(d)).filter(d=>d).map(d=>d.nodesByType(jt.ON_CHILD_ATTRIBUTE_UPDATE)).flat();return je.groupBy(u,d=>d.attributeName())},s=t(),i=n();if(!(s||i))return;let o=new Set;s==null||s.forEach((a,c)=>{o.add(c)}),i==null||i.forEach((a,c)=>{o.add(c)}),o.forEach(a=>{let c=s==null?void 0:s.get(a),l=i==null?void 0:i.get(a);De.makeAttribReactive(e,a,u=>{let h={Object3D:e};if(c)for(let d of c)d.runTrigger(h);if(l){let d=e.parent;if(d){let p={Object3D:d};for(let _ of l)_.runTrigger(p)}}})})})}parentActorBuilderNode(e){return e.parentController.findParent(t=>t.childrenControllerContext()==se.ACTOR)}};var nv=class{constructor(e){this.scene=e,this._cameraObjectsRecentlyUpdated=[],this._coreGraphNode=new Rt(this.scene,"SceneCamerasController")}coreGraphNode(){return this._coreGraphNode}updateFromChangeInObject(e){this._cameraObjects(e,this._cameraObjectsRecentlyUpdated),this._cameraObjectsRecentlyUpdated.length>0&&this._coreGraphNode.setDirty(),this._onCameraObjectsUpdated&&this._onCameraObjectsUpdated()}cameraObjects(){let e=[];return this._cameraObjects(this.scene.threejsScene(),e),e}_cameraObjects(e,t){t.splice(0,t.length),e.traverse(n=>{ie.camerasRegister.objectRegistered(n)&&t.push(n)})}cameraObjectsRecentlyUpdated(){return this._cameraObjectsRecentlyUpdated}setMainCamera(e){this.scene.root().mainCameraController.setCamera(e)}setMainCameraPath(e){this.scene.root().mainCameraController.setCameraPath(e)}mainCameraPath(){return this.scene.root().mainCameraController.rawCameraPath()}async mainCamera(e){let t=!0;(e==null?void 0:e.printCameraNotFoundError)!=null&&(t=e.printCameraNotFoundError);let n=e==null?void 0:e.cameraMaskOverride;n!=null&&this.scene.root().mainCameraController.setCameraPath(n);let s=await this.scene.root().mainCameraController.camera();if(s)return s;let i=!0;(e==null?void 0:e.findAnyCamera)!=null&&(i=e.findAnyCamera);let a=`No camera found at path '${await this.scene.root().mainCameraController.cameraPath()}'. Make sure to set the root parameter 'mainCameraPath' to match a camera (from the top menu Windows->Root Node Params)`;if(i){let c=this._findAnyCameraObject();if(c)return t&&console.error(a),c}return t&&console.error(a),null}_findAnyCameraObject(){return this.cameraObjects()[0]}async createMainViewer(e){let t=await this.mainCamera({cameraMaskOverride:e==null?void 0:e.cameraMaskOverride});if(!!t)return ie.camerasRegister.createViewer({...e,camera:t,scene:this.scene})}onCameraObjectsUpdated(e){this._onCameraObjectsUpdated=e}};var rv=class{constructor(e){this._scene=e,this._queue=new Map,this._blockLevel=0,this._blockLevel=0}block(){this._blockLevel+=1}unblock(){this._blockLevel-=1,this._blockLevel<0&&(this._blockLevel=0),this._processQueue()}blocked(){return this._blockLevel>0}enqueue(e,t){this._queue.set(e.graphNodeId(),t)}_processQueue(){if(this.blocked())return;let e=[],t=[];this._queue.forEach((n,s)=>{e.push(n),t.push(s)}),this._queue.clear();for(let n=0;n<e.length;n++){let s=e[n],i=t[n];this._processItem(s,i)}}_processItem(e,t){let n=this._scene.graph.nodeFromId(t);n&&n.dirtyController.runPostDirtyHooks(e)}};var sv=class{constructor(){this._cooking_nodes_by_id=new Map,this._resolves=[]}addNode(e){this._cooking_nodes_by_id.set(e.graphNodeId(),e)}removeNode(e){this._cooking_nodes_by_id.delete(e.graphNodeId()),this._cooking_nodes_by_id.size==0&&this.flush()}cookingNodes(){let e=[];return this._cooking_nodes_by_id.forEach((t,n)=>{e.push(t)}),e}flush(){let e;for(;e=this._resolves.pop();)e()}async waitForCooksCompleted(){if(this._cooking_nodes_by_id.size!=0)return new Promise((e,t)=>{this._resolves.push(e)})}};var iv=class{constructor(){this._next_id=0,this._successors=new Map,this._predecessors=new Map,this._nodes_by_id=new Map,this._nodesCount=0,this._debugging=!1,this._addedNodesDuringDebugging=new Map,this._boundPredecessorIds=this.predecessorIds.bind(this),this._boundSuccessorIds=this.successorIds.bind(this)}startDebugging(){this._debugging=!0}stopDebugging(){this._debugging=!1}printDebug(){this._addedNodesDuringDebugging.forEach((e,t)=>{console.log(t,e,e.graphPredecessors(),e.graphSuccessors())})}setScene(e){this._scene=e}scene(){return this._scene}nextId(){return this._next_id+=1,this._next_id}nodesFromIds(e){let t=[];for(let n of e){let s=this.nodeFromId(n);s&&t.push(s)}return t}nodeFromId(e){return this._nodes_by_id.get(e)}hasNode(e){return this._nodes_by_id.get(e.graphNodeId())!=null}addNode(e){this._nodes_by_id.set(e.graphNodeId(),e),this._nodesCount+=1,this._debugging&&this._addedNodesDuringDebugging.set(e.graphNodeId(),e)}removeNode(e){this._nodes_by_id.delete(e.graphNodeId()),this._successors.delete(e.graphNodeId()),this._predecessors.delete(e.graphNodeId()),this._nodesCount-=1,this._debugging&&this._addedNodesDuringDebugging.delete(e.graphNodeId())}nodesCount(){return this._nodesCount}connect(e,t,n=!0){let s=e.graphNodeId(),i=t.graphNodeId();if(this.hasNode(e)&&this.hasNode(t)){n&&(n=!(this._scene?this._scene.loadingController.isLoading():!0));let o=!1;return n&&(o=this._hasPredecessor(s,i)),o?!1:(this._createConnection(s,i),e.dirtyController.clearSuccessorsCacheWithPredecessors(),!0)}else return console.warn(`attempt to connect non existing node ${s} or ${i}`),!1}disconnect(e,t){this._remove_connection(e.graphNodeId(),t.graphNodeId()),e.dirtyController.clearSuccessorsCacheWithPredecessors()}disconnectPredecessors(e){let t=this.predecessors(e);for(let n of t)this.disconnect(n,e)}disconnectSuccessors(e){let t=this.successors(e);for(let n of t)this.disconnect(e,n)}predecessorIds(e){let t=this._predecessors.get(e);if(t){let n=[];return t.forEach((s,i)=>{n.push(i)}),n}return[]}predecessors(e){let t=this.predecessorIds(e.graphNodeId());return this.nodesFromIds(t)}successorIds(e){let t=this._successors.get(e);if(t){let n=[];return t.forEach((s,i)=>{n.push(i)}),n}return[]}successors(e){let t=this.successorIds(e.graphNodeId())||[];return this.nodesFromIds(t)}allPredecessorIds(e){let t=this._boundPredecessorIds,n=new Set,s=t(e.graphNodeId());for(;s.length>0;){let i=[];for(let o of s){n.add(o);for(let a of t(o))i.push(a)}s=i}return Wn.toArray(n)}allSuccessorIds(e){let t=this._boundSuccessorIds,n=[],s=t(e.graphNodeId());for(;s.length>0;){let i=[];for(let o of s){let a=this.nodeFromId(o);if(a&&!a.dirtyController.isForbiddenTriggerNodeId(e.graphNodeId())){let c=n.indexOf(o);c>=0&&n.splice(c,1),n.push(o);for(let l of t(o))i.push(l)}}s=i}return n}allPredecessors(e){let t=this.allPredecessorIds(e);return this.nodesFromIds(t)}allSuccessors(e){let t=this.allSuccessorIds(e);return this.nodesFromIds(t)}_createConnection(e,t){let n=this._successors.get(e);if(n||(n=new Set,this._successors.set(e,n)),n.has(t))return;n.add(t);let s=this._predecessors.get(t);s||(s=new Set,this._predecessors.set(t,s)),s.add(e)}_remove_connection(e,t){let n=this._successors.get(e);n&&(n.delete(t),n.size==0&&this._successors.delete(e));let s=this._predecessors.get(t);s&&(s.delete(e),s.size==0&&this._predecessors.delete(t))}_hasPredecessor(e,t){let n=this.predecessorIds(e);if(n){if(n.includes(t))return!0;for(let s of n)return this._hasPredecessor(s,t)}return!1}};var ov=class{constructor(e){this._node=e,this._cooks_count=0,this._total_cook_time=0,this._total_inputs_time=0,this._total_params_time=0}update_cook_data(e){this._cooks_count+=1,this._total_cook_time+=e.cookTime,this._total_inputs_time+=e.inputsTime,this._total_params_time+=e.paramsTime}total_time(){return this._total_cook_time+this._total_inputs_time+this._total_params_time}total_cook_time(){return this._total_cook_time}cook_time_per_iteration(){return this._cooks_count>0?this._total_cook_time/this._cooks_count:0}total_inputs_time(){return this._total_inputs_time}inputs_time_per_iteration(){return this._cooks_count>0?this._total_inputs_time/this._cooks_count:0}total_params_time2(){return this._total_params_time}params_time_per_iteration2(){return this._cooks_count>0?this._total_params_time/this._cooks_count:0}cooks_count(){return this._cooks_count}print_object(){return{fullPath:this._node.path(),cooks_count:this.cooks_count(),total_time:this.total_time(),total_cook_time:this.total_cook_time(),cook_time_per_iteration:this.cook_time_per_iteration(),inputs_time_per_iteration:this.inputs_time_per_iteration(),params_time_per_iteration:this.params_time_per_iteration2()}}};var av=class{constructor(){this._started=!1,this._start_time=0,this._previous_timestamp=0,this._nodes_cook_data={},this._durations_by_name={},this._durations_count_by_name={}}profile(e,t){let n=ie.performance.performanceManager(),s=n.now();t();let i=n.now()-s;console.log(`${e}: ${i}`)}start(){if(!this._started){this.reset(),this._started=!0;let e=ie.performance.performanceManager();this._start_time=e.now(),this._nodes_cook_data={},this._previous_timestamp=this._start_time}}stop(){this.reset()}reset(){this._started=!1,this._start_time=null,this._durations_by_name={},this._durations_count_by_name={},this._nodes_cook_data={}}started(){return this._started}recordNodeCookData(e,t){let n=e.graphNodeId();this._nodes_cook_data[n]==null&&(this._nodes_cook_data[n]=new ov(e)),this._nodes_cook_data[n].update_cook_data(t)}record(e){this.started()||this.start();let t=performance.now();return this._durations_by_name[e]==null&&(this._durations_by_name[e]=0),this._durations_by_name[e]+=t-this._previous_timestamp,this._durations_count_by_name[e]==null&&(this._durations_count_by_name[e]=0),this._durations_count_by_name[e]+=1,this._previous_timestamp=t}print(){this.print_node_cook_data(),this.print_recordings()}print_node_cook_data(){let e=Object.values(this._nodes_cook_data);e=Ce.sortBy(e,i=>i.total_cook_time());let t=e.map(i=>i.print_object());console.log("--------------- NODES COOK TIME -----------");let n=[],s=Ce.sortBy(t,i=>-i.total_cook_time);for(let i of s)n.push(i);return console.table(n),t}print_recordings(){let e=pn.clone(this._durations_by_name),t=pn.clone(this._durations_count_by_name),n=[],s={};for(let a of Object.keys(e)){let c=e[a];n.push(c),s[c]==null&&(s[c]=[]),s[c].push(a)}n.sort((a,c)=>a-c);let i=Ce.uniq(n);console.log("--------------- PERF RECORDINGS -----------");let o=[];for(let a of i){let c=s[a];for(let l of c){let u=t[l],h=a/u,d={duration:a,name:l,count:u,duration_per_iteration:h};o.push(d)}}return console.table(o),o}};var cv=class{constructor(e){this.scene=e}setListener(e){this._eventsListener?console.warn("scene already has a listener"):(this._eventsListener=e,this._runOnAddListenerCallbacks())}onAddListener(e){this._eventsListener?e():(this._onAddListenerCallbacks=this._onAddListenerCallbacks||[],this._onAddListenerCallbacks.push(e))}_runOnAddListenerCallbacks(){if(this._onAddListenerCallbacks){let e;for(;e=this._onAddListenerCallbacks.pop();)e();this._onAddListenerCallbacks=void 0}}dispatch(e,t,n){var s;(s=this._eventsListener)==null||s.process_events(e,t,n)}emitAllowed(){return this._eventsListener!=null&&this.scene.loadingController.loaded()&&this.scene.loadingController.autoUpdating()}};var lv=class{constructor(){this._params_by_id=new Map}registerParam(e){this._params_by_id.set(e.graphNodeId(),e)}deregisterParam(e){this._params_by_id.delete(e.graphNodeId())}regenerateReferringExpressions(e){e.nameController.graphNode().setSuccessorsDirty(e)}};var uv=class{constructor(e){this.scene=e,this._lifecycleOnAfterCreatedAllowed=!0}onAfterCreatedCallbackAllowed(){return this.scene.loadingController.loaded()&&this._lifecycleOnAfterCreatedAllowed}onAfterCreatedPrevent(e){this._lifecycleOnAfterCreatedAllowed=!1,e(),this._lifecycleOnAfterCreatedAllowed=!0}};var hv=class{constructor(e){this.scene=e,this._loadingState=!1,this._autoUpdating=!0}markAsLoading(){this._setLoadingState(!0)}markAsLoaded(){this.scene.missingExpressionReferencesController.resolveMissingReferences(),this._setLoadingState(!1),this._triggerLoadedEvent()}_triggerLoadedEvent(){globalThis.Event&&this.scene.eventsDispatcher.sceneEventsController.dispatch(kC)}_setLoadingState(e){this._loadingState=e,this.setAutoUpdate(!this._loadingState)}isLoading(){return this._loadingState}loaded(){return!this._loadingState}autoUpdating(){return this._autoUpdating}setAutoUpdate(e){if(this._autoUpdating!==e&&(this._autoUpdating=e,this._autoUpdating)){let t=this.scene.root();t&&t.processQueue()}}};var dv=class{constructor(e,t){this.param=e,this.path=t}absolutePath(){return Qe.makeAbsolutePath(this.param.node,this.path)}matchesPath(e){return this.absolutePath()==e}resolveMissingDependencies(){let e=this.param.rawInputSerialized();this.param.set(this.param.defaultValue()),this.param.set(e)}};var pv=class{constructor(e){this.scene=e,this.references=new Map}register(e,t){let n=new dv(e,t);return je.addToSetAtEntry(this.references,e.graphNodeId(),n),n}deregisterParam(e){this.references.delete(e.graphNodeId())}resolveMissingReferences(){let e=[];this.references.forEach(t=>{for(let n of t)this._isReferenceResolvable(n)&&e.push(n)});for(let t of e)t.resolveMissingDependencies()}_isReferenceResolvable(e){let t=e.absolutePath();if(t){if(this.scene.node(t))return!0;{let s=Qe.splitParentChild(t);if(s.child){let i=this.scene.node(s.parent);if(i&&i.params.get(s.child))return!0}}}}checkForMissingNodeReferences(e){if(!!e.scene().loadingController.loaded()){this._checkForMissingReferencesForNode(e);for(let t of e.params.all)this._checkForMissingReferencesForParam(t)}}checkForMissingParamReferences(e){!e.scene().loadingController.loaded()||this._checkForMissingReferencesForParam(e)}_checkForMissingReferencesForNode(e){let t=e.graphNodeId(),n=je.arrayFromValues(this.references);for(let s of n){let i=!1,o=Wn.toArray(s);for(let a of o)a.matchesPath(e.path())&&(i=!0,a.resolveMissingDependencies());i&&this.references.delete(t)}}_checkForMissingReferencesForParam(e){let t=e.graphNodeId(),n=je.arrayFromValues(this.references);for(let s of n){let i=!1,o=Wn.toArray(s);for(let a of o)a.matchesPath(e.path())&&(i=!0,a.resolveMissingDependencies());i&&this.references.delete(t)}}};var fv=class extends Gt{static context(){return se.MANAGER}};var bn=class{constructor(e,t,n){this.type=e,this.init_value=t,this.options=n}},W=class{static BUTTON(e,t){return new bn(U.BUTTON,e,t)}static BOOLEAN(e,t){return new bn(U.BOOLEAN,e,t)}static COLOR(e,t){return e instanceof ae&&(e=e.toArray()),new bn(U.COLOR,e,t)}static FLOAT(e,t){return new bn(U.FLOAT,e,t)}static FOLDER(e=null,t){return new bn(U.FOLDER,e,t)}static INTEGER(e,t){return new bn(U.INTEGER,e,t)}static RAMP(e=cr.DEFAULT_VALUE,t){return new bn(U.RAMP,e,t)}static STRING(e="",t){return new bn(U.STRING,e,t)}static VECTOR2(e,t){return e instanceof G&&(e=e.toArray()),new bn(U.VECTOR2,e,t)}static VECTOR3(e,t){return e instanceof A&&(e=e.toArray()),new bn(U.VECTOR3,e,t)}static VECTOR4(e,t){return e instanceof Se&&(e=e.toArray()),new bn(U.VECTOR4,e,t)}static NODE_PATH(e,t){return new bn(U.NODE_PATH,e,t)}static PARAM_PATH(e,t){return new bn(U.PARAM_PATH,e,t)}},Ye=class{};var UU="/",Ghe=/\/+/g,mv=class{constructor(e){this.scene=e}findObjectByMask(e){return this.findObjectByMaskInObject(e,this.scene.threejsScene())}findObjectByMaskInObject(e,t,n=""){for(let s of t.children){let i=this._sanitizePath(s.name),o=this._sanitizePath(`${n}/${i}`);if(Ae.matchMask(o,e))return s;let a=this.findObjectByMaskInObject(e,s,o);if(a)return a}}objectsByMask(e){let t=[];return this.traverseObjectsWithMask(e,n=>{t.push(n)}),t}objectsByMaskInObject(e,t,n=[],s=""){return this.traverseObjectsWithMask(e,i=>{n.push(i)}),n}traverseObjectsWithMask(e,t,n=!1){this.traverseObjectsWithMaskInObject(e,this.scene.threejsScene(),t,n)}traverseObjectsWithMaskInObject(e,t,n,s,i=""){for(let o of t.children){let a=this._sanitizePath(o.name),c=this._sanitizePath(`${i}/${a}`),l=Ae.matchMask(c,e);s&&(l=!l),l&&n(o),this.traverseObjectsWithMaskInObject(e,o,n,s,c)}}objectPath(e){let t=e.parent;if(t){let n=this.objectPath(t);return this._sanitizePath(`${n}/${e.name}`)}else return e.name}_sanitizePath(e){return e.replace(Ghe,"/")}};var _v={computeOnDirty:!1,callback:r=>{ef.update(r)}};function zU(r){return class extends r{constructor(){super(...arguments);this.displayAudioIcon=W.BOOLEAN(0,{..._v,separatorBefore:!0}),this.audioIconColor=W.COLOR([0,0,0],{..._v,visibleIf:{displayAudioIcon:1}}),this.audioIconStyle=W.STRING("position: absolute; top: 10px; right: 10px; width: 24px; height: 24px; cursor: pointer",{..._v,visibleIf:{displayAudioIcon:1}})}}}var ef=class{constructor(e){this.node=e,this._callbacksByName=new Map}async toggleSound(){this.audioListeners().forEach(e=>{e.toggleSound()}),this.update(),this._runOnToggleSoundCallbacks()}soundOn(){let e=this.audioListeners()[0];return e&&e.pv.soundOn||!1}update(){this._updateViewers()}audioListeners(){return this.node.nodesByType("audioListener")}_updateViewers(){this.node.scene().viewersRegister.traverseViewers(e=>{e.audioController().update()})}static update(e){e.audioController.update()}onToggleSound(e,t){if(this._callbacksByName.get(e)){console.warn(`callback already registered ith name '${e}'`);return}this._callbacksByName.set(e,t)}_runOnToggleSoundCallbacks(){let e=this.soundOn();this._callbacksByName.forEach(t=>{t(e)})}};var Hhe={computeOnDirty:!1,callback:r=>{tf.update(r)}};function VU(r){return class extends r{constructor(){super(...arguments);this.autoUpdate=W.BOOLEAN(1,{...Hhe,separatorBefore:!0})}}}var tf=class{constructor(e){this.node=e}async update(){let e=this.node.object,t=this.node.pv;t.autoUpdate!=e.autoUpdate&&(e.autoUpdate=t.autoUpdate)}static async update(e){e.sceneAutoUpdateController.update()}};var Cc=["none","color","texture"],gv={callback:r=>{nf.update(r)}};function qU(r){return class extends r{constructor(){super(...arguments);this.backgroundMode=W.INTEGER(Cc.indexOf("color"),{menu:{entries:Cc.map((t,n)=>({name:t,value:n}))},...gv,separatorBefore:!0}),this.bgColor=W.COLOR([.4,.4,.4],{visibleIf:{backgroundMode:Cc.indexOf("color")},...gv,conversion:Ls.SRGB_TO_LINEAR}),this.bgTexture=W.NODE_PATH("",{visibleIf:{backgroundMode:Cc.indexOf("texture")},nodeSelection:{context:se.COP},dependentOnFoundNode:!1,...gv})}}}var nf=class{constructor(e){this.node=e}setMode(e){this.node.p.backgroundMode.set(Cc.indexOf(e))}backgroundMode(){return Cc[this.node.pv.backgroundMode]}async update(){let e=this.backgroundMode();switch(e){case"none":return this._setBackgroundNone();case"color":return await this._setBackgroundColor();case"texture":return await this._setBackgroundTexture()}Bn.unreachable(e)}_setBackgroundNone(){let e=this.node.object;e.background=null}async _setBackgroundColor(){let e=this.node.object,t=this.node.pv;await this.node.p.bgColor.compute(),e.background&&e.background instanceof ae?e.background.copy(t.bgColor):e.background=t.bgColor}async _setBackgroundTexture(){let e=this.node.object,n=this.node.pv.bgTexture.nodeWithContext(se.COP);if(n){let s=await n.compute();e.background=s.texture()}else this.node.states.error.set("bgTexture node not found")}static update(e){e.sceneBackgroundController.update()}};var GU={computeOnDirty:!1,callback:r=>{rf.update(r)}};function HU(r){return class extends r{constructor(){super(...arguments);this.useEnvironment=W.BOOLEAN(0,{...GU,separatorBefore:!0}),this.environment=W.NODE_PATH("",{visibleIf:{useEnvironment:1},nodeSelection:{context:se.COP},dependentOnFoundNode:!1,...GU})}}}var rf=class{constructor(e){this.node=e}async update(){let e=this.node.object,t=this.node.pv;if(t.useEnvironment){let n=t.environment.nodeWithContext(se.COP);n?n.compute().then(s=>{e.environment=s.texture()}):this.node.states.error.set("bgTexture node not found")}else e.environment=null}static async update(e){e.sceneEnvController.update()}};var Sc={computeOnDirty:!1,callback:r=>{sf.update(r)}};var Ac=["linear","exponential"];function yv(r){return class extends r{constructor(){super(...arguments);this.useFog=W.BOOLEAN(0,{...Sc,separatorBefore:!0}),this.fogType=W.INTEGER(Ac.indexOf("exponential"),{visibleIf:{useFog:1},menu:{entries:Ac.map((t,n)=>({name:t,value:n}))},...Sc}),this.fogColor=W.COLOR([1,1,1],{visibleIf:{useFog:1},...Sc}),this.fogNear=W.FLOAT(1,{range:[0,100],rangeLocked:[!0,!1],visibleIf:{useFog:1,fogType:Ac.indexOf("linear")},...Sc}),this.fogFar=W.FLOAT(100,{range:[0,100],rangeLocked:[!0,!1],visibleIf:{useFog:1,fogType:Ac.indexOf("linear")},...Sc}),this.fogDensity=W.FLOAT(25e-5,{visibleIf:{useFog:1,fogType:Ac.indexOf("exponential")},...Sc})}}}var Whe=class extends yv(Ye){},sf=class{constructor(e){this.node=e}async update(){let e=this.node.object,t=this.node.pv;if(t.useFog)if(t.fogType==Ac.indexOf("linear")){let n=this.fog2(t);e.fog=n,n.color=t.fogColor,n.near=t.fogNear,n.far=t.fogFar}else{let n=this.fogExp2(t);e.fog=this.fogExp2(t),n.color=t.fogColor,n.density=t.fogDensity}else e.fog&&(e.fog=null)}fog2(e){return this._fog=this._fog||new va(16777215,e.fogNear,e.fogFar)}fogExp2(e){return this._fogExp2=this._fogExp2||new xa(16777215,e.fogDensity)}static async update(e){e.sceneFogController.update()}};var xv=class{constructor(e){this.nodes=e,this.totalCount=e.length,this._processed=new Set,this._remaining=Wn.fromArray(e)}markNodeAsProcessed(e){this._processed.add(e),this._remaining.delete(e)}isNodeProcessed(e){return this._processed.has(e)}processedCount(){return this._processed.size}};function WU(r){return class extends r{constructor(){super(...arguments);this.nodesMask=W.STRING("*/image* */envMap*",{cook:!1,separatorBefore:!0}),this.printNodes=W.BUTTON(null,{cook:!1,callback:t=>{of.PARAM_CALLBACK_printResolve(t)}})}}}var of=class{constructor(e){this.node=e}static async PARAM_CALLBACK_printResolve(e){let t=await e.loadProgress.resolvedNodes();console.log(t);let n=t.map(s=>s.path()).sort();console.log(n)}async resolvedNodes(){let e=this.node.p.nodesMask;e.isDirty()&&await e.compute();let t=e.value,s=this.node.scene().nodesController.nodesFromMask(t||"");return Ce.uniq(s.concat(await this._loadDisplayNodes()))}async _loadDisplayNodes(){let e=this.node.scene(),n=ie.camerasRegister.registeredNodeTypes().map(a=>e.nodesByType(a)).flat(),s=this._displayNodes(),i=n.concat(s),o=await this.cameraCreatorNode();return o&&i.push(o),Ce.uniq(i)}_displayNodes(){let e=this._objectNodesWithDisplayNodeController();return Ce.compact(e.map(n=>n.displayNodeController.displayNode()))}_objectNodesWithDisplayNodeController(){return this.node.scene().root().children().filter(n=>n.displayNodeController!=null).filter(n=>{var s,i;return(i=(s=n.flags)==null?void 0:s.display)==null?void 0:i.active()})}cameraCreatorNode(){return this.node.mainCameraController.cameraCreatorNode()}_runCallback(e,t){!(this._onProgressUpdateCallback&&this._toCook&&this._sopGroupToUpdate)||this._onProgressUpdateCallback(e,{scene:this.node.scene(),triggerNode:void 0,groups:{cook:this._toCook,sopGroup:this._sopGroupToUpdate}})}_updateProgressAndRunCallback(e){if(!(this._onProgressUpdateCallback&&this._toCook&&this._sopGroupToUpdate))return;let t=this._toCook.totalCount+this._sopGroupToUpdate.totalCount,s=(this._toCook.processedCount()+this._sopGroupToUpdate.processedCount())/t;this._runCallback(s,e)}async watchNodesProgress(e){this._onProgressUpdateCallback=e;let t=(await this.resolvedNodes()).filter(i=>i.isDirty());this._toCook=new xv(t);let n=this._objectNodesWithDisplayNodeController().filter(i=>{var o;let a=i.displayNodeController.displayNode();return a!=null&&!((o=a.flags.bypass)==null?void 0:o.active())}).filter(i=>i.isDirty());if(this._sopGroupToUpdate=new xv(n),this._toCook.totalCount+this._sopGroupToUpdate.totalCount==0){this._runCallback(1);return}this._watchNodesWithSopGroup(),this._watchNodesToCook()}async _watchNodesToCook(){let e=this._toCook;if(!e)return;let t="RootLoadProgressController",n=s=>{e.isNodeProcessed(s)||(e.markNodeAsProcessed(s),this._updateProgressAndRunCallback(s),s.cookController.deregisterOnCookEnd(t))};for(let s of e.nodes)s.cookController.registerOnCookEnd(t,()=>{n(s)}),s.compute()}_watchNodesWithSopGroup(){let e=this._sopGroupToUpdate;if(!e)return;let t="RootLoadProgressController",n=s=>{e.isNodeProcessed(s)||(e.markNodeAsProcessed(s),this._updateProgressAndRunCallback(s),s.childrenDisplayController.deregisterOnSopGroupUpdated(t))};for(let s of e.nodes)s.childrenDisplayController.registerOnSopGroupUpdated(t,()=>{n(s)})}};var jU={computeOnDirty:!1,callback:r=>{af.update(r)}};function $U(r){return class extends r{constructor(){super(...arguments);this.useOverrideMaterial=W.BOOLEAN(0,{...jU,separatorBefore:!0}),this.overrideMaterial=W.NODE_PATH("",{visibleIf:{useOverrideMaterial:1},nodeSelection:{context:se.MAT},dependentOnFoundNode:!1,...jU})}}}var af=class{constructor(e){this.node=e}async update(){let e=this.node.object,t=this.node.pv;if(t.useOverrideMaterial){let n=t.overrideMaterial.nodeWithContext(se.MAT);if(n){let s=await n.compute();e.overrideMaterial=s.material()}else e.overrideMaterial=null,this.node.states.error.set("overrideMaterial node not found")}else e.overrideMaterial=null}static async update(e){e.sceneMaterialOverrideController.update()}};function XU(r){return class extends r{constructor(){super(...arguments);this.mainCameraPath=W.STRING("",{cook:!1,separatorBefore:!0,objectMask:!0})}}}var vv=class{constructor(e){this.node=e}setCamera(e){let t=this.node.scene().objectsController.objectPath(e);this.setCameraPath(t)}setCameraPath(e){this.node.p.mainCameraPath.set(e)}rawCameraPath(){return this.node.p.mainCameraPath.rawInput()}async cameraPath(){let e=this.node.p.mainCameraPath;return e.isDirty()&&await e.compute(),e.value}async camera(){let e=await this.cameraPath();return this.node.scene().objectsController.findObjectByMask(e)}async cameraCreatorNode(){let t=(await this.cameraPath()).split(Qe.SEPARATOR),n=t[1],s=this.node.node(n);return t.length!=2&&s.displayNodeController&&s.displayNodeController.displayNode()||s}};var cf="RootNode",YU=class extends WU(zU($U(HU(yv(XU(qU(VU(Ye)))))))){},jhe=new YU,bv=class extends fv{constructor(){super(...arguments);this.paramsConfig=jhe,this._object=this._createScene(),this._queuedNodesById=new Map,this.audioController=new ef(this),this.sceneAutoUpdateController=new tf(this),this.sceneBackgroundController=new nf(this),this.sceneEnvController=new rf(this),this.sceneFogController=new sf(this),this.loadProgress=new of(this),this.sceneMaterialOverrideController=new af(this),this.mainCameraController=new vv(this),this._childrenControllerContext=se.OBJ}static type(){return"root"}cook(){this.cookController.endCook()}initializeNode(){this._object.matrixAutoUpdate=!1,this.lifecycle.onChildAdd(this._onChildAdd.bind(this)),this.lifecycle.onChildRemove(this._onChildRemove.bind(this))}_createScene(){let e=new ms;return e.name=UU,e.matrixAutoUpdate=!1,e}get object(){return this._object}createNode(e,t){return super.createNode(e,t)}children(){return super.children()}nodesByType(e){return super.nodesByType(e)}_updateScene(){this.sceneAutoUpdateController.update(),this.sceneBackgroundController.update(),this.sceneEnvController.update(),this.sceneFogController.update(),this.sceneMaterialOverrideController.update()}_addToQueue(e){let t=e.graphNodeId();return this._queuedNodesById.has(t)||this._queuedNodesById.set(t,e),e}processQueue(){this._updateScene();let e=new Map,t=[];this._queuedNodesById.forEach((n,s)=>{let i=`_____${n.renderOrder}__${n.path()}`;t.push(i),e.set(i,n)}),this._queuedNodesById.clear();for(let n of t){let s=e.get(n);s&&(e.delete(n),this._addToScene(s))}}_updateObject(e){return this.scene().loadingController.autoUpdating()?(e.isDisplayed()&&!e.cookController.isCooking()&&e.compute(),this._addToScene(e)):this._addToQueue(e)}getParentForNode(e){if(e.attachableToHierarchy()){let t=e.io.inputs.input(0);return t?t.childrenGroup():this._object}else return null}_addToScene(e){var t;if(e.attachableToHierarchy()){let n=this.getParentForNode(e);n&&(e.usedInScene()?((t=e.childrenDisplayController)==null||t.requestDisplayNodeContainer(),e.addObjectToParent(n)):e.removeObjectFromParent())}}_removeFromScene(e){e.removeObjectFromParent()}areChildrenCooking(){let e=this.children();for(let t of e)if(t.cookController.isCooking()||t.isDisplayNodeCooking())return!0;return!1}addToParentTransform(e){this._updateObject(e)}removeFromParentTransform(e){this._updateObject(e)}_onChildAdd(e){e&&this._updateObject(e)}_onChildRemove(e){e&&this._removeFromScene(e)}};var wv=class{constructor(e){this.scene=e,this._nodeContextSignatures={},this._instanciatedNodesByContextAndType=new Map}createRoot(e){this._root=new bv(this.scene,cf,e),this._root.initializeBaseAndNode(),this._root.params.init()}root(){return this._root}_traverseNode(e,t){let n=e.children();if(!(!n||n.length==0))for(let s of n)t(s),s.childrenController&&this._traverseNode(s,t)}traverseNodes(e){this._traverseNode(this._root,e)}clear(){var e;let t=this.root().children();for(let n of t)(e=this.root().childrenController)==null||e.removeNode(n)}node(e){return e==="/"?this.root():this.root().node(e)}allNodes(){let e=[this.root()],t=[this.root()],n=0;for(;t.length>0&&n<10;){let s=t.map(i=>i.childrenAllowed()?i.children():[]).flat();e=e.concat(s),t=s,n+=1}return e.flat()}nodesFromMask(e){let t=this.allNodes(),n=[];for(let s of t){let i=s.path();Ae.matchMask(i,e)&&n.push(s)}return n}resetNodeContextSignatures(){this._nodeContextSignatures={}}registerNodeContextSignature(e){e.childrenAllowed()&&e.childrenController&&(this._nodeContextSignatures[e.childrenController.nodeContextSignature()]=!0)}nodeContextSignatures(){return Object.keys(this._nodeContextSignatures).sort().map(e=>e.toLowerCase())}addToInstanciatedNode(e){let t=e.context(),n=e.type(),s=this._instanciatedNodesByContextAndType.get(t);s||(s=new Map,this._instanciatedNodesByContextAndType.set(t,s));let i=s.get(n);i||(i=new Map,s.set(n,i)),i.set(e.graphNodeId(),e)}removeFromInstanciatedNode(e){let t=e.context(),n=e.type(),s=this._instanciatedNodesByContextAndType.get(t);if(!s)return;let i=s.get(n);!i||i.delete(e.graphNodeId())}nodesByType(e){let t=[];return this._traverseNode(this.scene.root(),n=>{n.type()==e&&t.push(n)}),t}nodesByContextAndType(e,t){let n=[],s=this._instanciatedNodesByContextAndType.get(e);if(s){let i=s.get(t);i&&i.forEach(o=>{n.push(o)})}return n}};var Ev=class{constructor(e){this.scene=e}toJSON(e=!1){let t={},n={};for(let s of this.scene.nodesController.allNodes()){let i=new du(s);t[s.graphNodeId()]=i.toJSON(e);let o=s.params.all;for(let a of o)n[a.graphNodeId()]=a.toJSON()}return{nodes_by_graph_node_id:t,params_by_graph_node_id:n}}};var lr=class{constructor(e){this.dispatcher=e,this._activeEventDatas=[],this._activeEventDataTypes=new Set,this._eventNodes=new Set,this._requireCanvasEventListeners=!1,this._actorEventNodes=new Set,this._actorNodesByEventNames=new Map}registerEventNode(e){this._eventNodes.add(e),this.updateViewerEventListeners()}unregisterEventNode(e){this._eventNodes.delete(e),this.updateViewerEventListeners()}registerActorNode(e){this._actorEventNodes.add(e),this._updateActorCache(),this.updateViewerEventListeners()}unregisterActorNode(e){this._actorEventNodes.delete(e),this._updateActorCache(),this.updateViewerEventListeners()}_updateActorCache(){this._actorNodesByEventNames.clear(),this._actorEventNodes.forEach(e=>{let t=e.userInputEventNames(),n=e.eventEmitter();for(let s of t){let i=this._actorNodesByEventNames.get(s);i||(i=new Map,this._actorNodesByEventNames.set(s,i)),je.addToSetAtEntry(i,n,e)}})}processEvent(e){var t;if(this._activeEventDatas.length==0)return;let n=(t=e.event)==null?void 0:t.type;n&&!this._activeEventDataTypes.has(n)||this._eventNodes.forEach(s=>{s.processEvent(e)})}updateViewerEventListeners(){this._updateActiveEventTypes(),this._requireCanvasEventListeners&&this.dispatcher.scene.viewersRegister.traverseViewers(e=>{e.eventsController().updateEvents(this)})}activeEventDatas(){return this._activeEventDatas}_updateActiveEventTypes(){let e=o=>{this._activeEventDatas.push(o),this._activeEventDataTypes.add(o.type)},t=()=>{this._activeEventDatas.splice(0,this._activeEventDatas.length),this._activeEventDataTypes.clear()},n=()=>{let o=[];return this._actorNodesByEventNames.forEach((a,c)=>{a.forEach((l,u)=>{l.forEach(h=>{let d={type:c,emitter:u};o.push(d)})})}),o},s=()=>{let o=n();if(o)for(let a of o)e(a)},i=()=>{let o=new Set;this._eventNodes.forEach(a=>{if(a.parent()){let c=a.activeEventDatas();for(let l of c)o.add(l)}}),o.forEach((a,c)=>{e(c)})};t(),s(),i()}};var $he=["dragover"],Cv=class extends lr{constructor(){super(...arguments);this._requireCanvasEventListeners=!0}type(){return"drag"}acceptedEventTypes(){return new Set($he.map(e=>`${e}`))}};var lf=["keydown","keypress","keyup"];var Sv=class extends lr{constructor(){super(...arguments);this._requireCanvasEventListeners=!0}type(){return"keyboard"}acceptedEventTypes(){return new Set(lf.map(e=>`${e}`))}currentEvent(){return this._currentEvent}processEvent(e){super.processEvent(e);let t=e.emitter;if(!t)return;let{viewer:n,event:s}=e;if(!(s&&n))return;let i=s.type,o=this._actorNodesByEventNames.get(i);if(!o)return;let a=o.get(t);!a||(this._currentEvent=e.event,this.dispatcher.scene.actorsManager.keyboardEventsController.setTriggeredNodes(a))}};var Xhe=["auxclick","click","contextmenu","dblclick","mousedown","mouseenter","mouseleave","mousemove","mouseover","mouseout","mouseup","pointerlockchange","pointerlockerror","select","wheel"],Av=class extends lr{constructor(){super(...arguments);this._requireCanvasEventListeners=!0}type(){return"mouse"}acceptedEventTypes(){return new Set(Xhe.map(e=>`${e}`))}};var Tv=class{static isVector2Valid(e){return!isNaN(e.x)&&!isNaN(e.y)&&isFinite(e.x)&&isFinite(e.y)}};var uf=class{constructor(){this._rectByCanvas=new Map,this._resetCacheBound=this._resetCache.bind(this),window.addEventListener("resize",this._resetCacheBound),document.addEventListener("scroll",this._resetCacheBound)}static instance(){return this._instance=this._instance||new uf}setEventOffset(e,t,n){let s=this._rectByCanvas.get(t);s||(s=t.getBoundingClientRect(),this._rectByCanvas.set(t,s)),n.offsetX=e.clientX-s.left,n.offsetY=e.clientY-s.top}_resetCache(){this._rectByCanvas.clear()}},ZU=uf.instance(),Tc={offsetX:0,offsetY:0},Mv=class{setCursorForCPU(e,t){this.setCursor(e,t),t.x=t.x*2-1,t.y=-t.y*2+1}setCursorForGPU(e,t){this.setCursor(e,t),t.y=1-t.y}setCursor(e,t){var n;let s=(n=e.viewer)==null?void 0:n.canvas();if(!s)return;let i=e.event;if((i instanceof PointerEvent||i instanceof MouseEvent||i instanceof DragEvent)&&ZU.setEventOffset(i,s,Tc),window.TouchEvent&&i instanceof TouchEvent){let o=i.touches[0];ZU.setEventOffset(o,s,Tc)}this._updateFromCursor(s,t)}_updateFromCursor(e,t){if(e.offsetWidth<=0||e.offsetHeight<=0?t.set(0,0):(t.x=Tc.offsetX/e.offsetWidth,t.y=Tc.offsetY/e.offsetHeight),!Tv.isVector2Valid(t)){console.warn("invalid number detected"),console.warn(t.toArray(),Tc.offsetX,Tc.offsetY,e.offsetWidth,e.offsetHeight);return}}};var JU=["pointerdown","pointermove","pointerup"];var Pv=class extends lr{constructor(){super(...arguments);this._requireCanvasEventListeners=!0,this._cursorHelper=new Mv,this._cursor=new G,this._raycaster=new _l}type(){return"pointer"}acceptedEventTypes(){return new Set(JU.map(e=>`${e}`))}setRaycaster(e){this._raycaster=e}processEvent(e){super.processEvent(e);let t=e.emitter;if(!t)return;let{viewer:n,event:s}=e;if(!(s&&n))return;let i=s.type,o=this._actorNodesByEventNames.get(i);if(!o)return;let a=o.get(t);!a||(this._camera=n.camera(),this._cursorHelper.setCursorForCPU(e,this._cursor),this._camera&&(n.raycaster.setFromCamera(this._cursor,this._camera),this._raycaster=n.raycaster),this.dispatcher.scene.actorsManager.pointerEventsController.setTriggeredNodes(a))}raycaster(){return this._raycaster}cursor(){return this._cursor}updateRaycast(e){if(!this._raycaster)return;let t=this._raycaster.params.Points;t&&(t.threshold=e.pointsThreshold);let n=this._raycaster.params.Line;n&&(n.threshold=e.lineThreshold)}};var Yhe=["resize"],Nv=class extends lr{constructor(){super(...arguments);this._requireCanvasEventListeners=!0}type(){return"window"}acceptedEventTypes(){return new Set(Yhe.map(e=>`${e}`))}};var Zhe=["touchstart","touchmove","touchend"],Rv=class extends lr{constructor(){super(...arguments);this._requireCanvasEventListeners=!0}type(){return"touch"}acceptedEventTypes(){return new Set(Zhe.map(e=>`${e}`))}};var Ov=class{constructor(){this._dispatchedConnections=new Set}dispatchTrigger(e){var t;(t=e._eventDispatcher())==null||t.dispatchEvent(OU),this._dispatchedConnections.add(e)}};var xi=(r=>(r.DRAG="drag",r.KEYBOARD="keyboard",r.MOUSE="mouse",r.POINTER="pointer",r.TOUCH="touch",r.WINDOW="window",r))(xi||{});var Iv=class{constructor(e){this.scene=e,this.sceneEventsController=new L_,this._controllers=[]}registerActorNode(e){let t=this._findOrCreateControllerForActorNode(e);t&&t.registerActorNode(e)}unregisterActorNode(e){let t=this._findOrCreateControllerForActorNode(e);t&&t.unregisterActorNode(e)}registerEventNode(e){let t=this._findOrCreateControllerForEventNode(e);t&&t.registerEventNode(e)}unregisterEventNode(e){let t=this._findOrCreateControllerForEventNode(e);t&&t.unregisterEventNode(e)}updateViewerEventListeners(e){let t=this._findOrCreateControllerForEventNode(e);t&&t.updateViewerEventListeners()}traverseControllers(e){for(let t of this._controllers)e(t)}setRaycaster(e){this.pointerEventsController.setRaycaster(e)}_findOrCreateControllerForEventNode(e){switch(e.type()){case xi.KEYBOARD:return this.keyboardEventsController;case xi.MOUSE:return this.mouseEventsController;case xi.DRAG:return this.dragEventsController;case xi.POINTER:return this.pointerEventsController;case xi.TOUCH:return this.touchEventsController;case xi.WINDOW:return this.windowEventsController}}_findOrCreateControllerForActorNode(e){switch(e.type()){case jt.CURSOR:case jt.ON_OBJECT_CLICK:case jt.ON_OBJECT_HOVER:case jt.ON_OBJECT_POINTERDOWN:case jt.ON_OBJECT_POINTERUP:case jt.ON_POINTERDOWN:case jt.ON_POINTERUP:case jt.RAY_FROM_CURSOR:return this.pointerEventsController;case jt.ON_KEYDOWN:case jt.ON_KEYPRESS:case jt.ON_KEYUP:return this.keyboardEventsController}console.warn("no event controller defined for node",e)}get keyboardEventsController(){return this._keyboardEventsController=this._keyboardEventsController||this._createController(Sv)}get mouseEventsController(){return this._mouseEventsController=this._mouseEventsController||this._createController(Av)}get dragEventsController(){return this._dragEventsController=this._dragEventsController||this._createController(Cv)}get pointerEventsController(){return this._pointerEventsController=this._pointerEventsController||this._createController(Pv)}get windowEventsController(){return this._windowEventsController=this._windowEventsController||this._createController(Nv)}get touchEventsController(){return this._touchEventsController=this._touchEventsController||this._createController(Rv)}_createController(e){let t=new e(this);return this._controllers.includes(t)||this._controllers.push(t),t}get connectionTriggerDispatcher(){return this._connectionTriggerDispatcher=this._connectionTriggerDispatcher||new Ov}};var Dv=class{constructor(e){this.scene=e,this._referenced_nodes_by_src_param_id=new Map,this._referencing_params_by_referenced_node_id=new Map,this._referencing_params_by_all_named_node_ids=new Map}setReferenceFromParam(e,t){this._referenced_nodes_by_src_param_id.set(e.graphNodeId(),t),je.pushOnArrayAtEntry(this._referencing_params_by_referenced_node_id,t.graphNodeId(),e)}setNamedNodesFromParam(e){let t=e.decomposedPath.named_nodes();for(let n of t)je.pushOnArrayAtEntry(this._referencing_params_by_all_named_node_ids,n.graphNodeId(),e)}resetReferenceFromParam(e){let t=this._referenced_nodes_by_src_param_id.get(e.graphNodeId());if(t){je.popFromArrayAtEntry(this._referencing_params_by_referenced_node_id,t.graphNodeId(),e);let n=e.decomposedPath.named_nodes();for(let s of n)je.popFromArrayAtEntry(this._referencing_params_by_all_named_node_ids,s.graphNodeId(),e);this._referenced_nodes_by_src_param_id.delete(e.graphNodeId())}}referencing_params(e){return this._referencing_params_by_referenced_node_id.get(e.graphNodeId())}referencing_nodes(e){let t=this._referencing_params_by_referenced_node_id.get(e.graphNodeId());if(t){let n=new Map;for(let i of t){let o=i.node;n.set(o.graphNodeId(),o)}let s=[];return n.forEach(i=>{s.push(i)}),s}}nodes_referenced_by(e){let t=new Set([U.NODE_PATH]),n=[];for(let a of e.params.all)t.has(a.type())&&n.push(a);let s=new Map,i=[];for(let a of n)this._check_param(a,s,i);for(let a of i)s.set(a.node.graphNodeId(),a.node);let o=[];return s.forEach(a=>{o.push(a)}),o}_check_param(e,t,n){if(e instanceof _o){let s=e.value.node();s&&t.set(s.graphNodeId(),s);return}}notifyNameUpdated(e){let t=this._referencing_params_by_all_named_node_ids.get(e.graphNodeId());if(t){let n=Ce.shallowClone(t);for(let s of n)s.notifyPathRebuildRequired(e)}}notifyParamsUpdated(e){let t=this._referencing_params_by_all_named_node_ids.get(e.graphNodeId());if(t){let n=Ce.shallowClone(t);for(let s of n)s.options.isSelectingParam()&&s.notifyTargetParamOwnerParamsUpdated(e)}}};var KU={resolution:{value:new G(1e3,1e3)}},Lv=class{constructor(e){this.scene=e}addUniforms(e,t){let{paramConfigs:n,additionalTextureUniforms:s,timeDependent:i,resolutionDependent:o}=t;for(let c of n)e[c.uniformName()]=c.uniform();let a=Object.keys(s);for(let c of a){let l=s[c];e[c]=l}i?this.addTimeUniform(e):this.removeTimeUniform(e),o?this.addResolutionUniforms(e):this.removeResolutionUniform(e)}addTimeUniform(e){e.time=this.scene.timeController.timeUniform()}removeTimeUniform(e){delete e.time}timeUniformValue(){return this.scene.timeController.timeUniform().value}addResolutionUniforms(e){e.resolution=KU.resolution}removeResolutionUniform(e){delete e.resolution}updateResolution(e){KU.resolution.value.copy(e)}};var Bv=class{constructor(e){this.scene=e,this._viewersById=new Map}registerViewer(e){this._viewersById.set(e.id(),e),this._updateCache()}unregisterViewer(e){this._viewersById.delete(e.id()),this._updateCache()}traverseViewers(e){this._viewersById.forEach(e)}viewer(e){let t={camera:e.camera,canvas:e.canvas,scene:this.scene};return ie.camerasRegister.createViewer(t)}firstViewer(){return this._firstViewer}_updateCache(){this._firstViewer=void 0,this._viewersById.forEach(e=>{this._firstViewer=this._firstViewer||e})}};var kv=class{constructor(){this._require_webgl2=!1}require_webgl2(){return this._require_webgl2}set_require_webgl2(){this._require_webgl2||(this._require_webgl2=!0,ie.renderersController.setRequireWebGL2())}};var Fv=class{constructor(e){this._scene=e,this._onWindowResizeBound=this._onWindowResize.bind(this)}graphNode(){return this._coreGraphNode=this._coreGraphNode||this._createGraphNode()}_createGraphNode(){let e=new Rt(this._scene,"SceneWindowController");return window.addEventListener("resize",this._onWindowResizeBound),e}_onWindowResize(){this.graphNode().setSuccessorsDirty()}dispose(){window.removeEventListener("resize",this._onWindowResizeBound)}};var Uv=class{constructor(){this._params_by_id=new Map,this._assetsRoot=null}register_param(e){this._params_by_id.set(e.graphNodeId(),e)}deregister_param(e){this._params_by_id.delete(e.graphNodeId())}traverse_params(e){this._params_by_id.forEach((t,n)=>{e(t)})}root(){return this._assetsRoot}setRoot(e){e==""&&(e=null),this._assetsRoot=e}};var zv=class{constructor(e){this.scene=e,this._renderersById=new Map,this._registerTimeByRenderer=new Map,this._resolves=[]}registerRenderer(e,t){let n=!0;(t==null?void 0:t.assignId)==!1&&(n=!1),n&&ie.renderersController.assignIdToRenderer(e);let s=ie.renderersController.rendererId(e);s!=null&&(this._renderersById.set(s,e),this._registerTimeByRenderer.set(e,performance.now()),this._updateCache(),this._renderersById.size==1&&this._flushCallbacksWithRenderer(e))}deregisterRenderer(e){let t=ie.renderersController.rendererId(e);t!=null&&(this._renderersById.delete(t),e.dispose(),this._updateCache())}lastRegisteredRenderer(){return this._lastRegisteredRenderer}renderers(){let e=[];return this._renderersById.forEach(t=>{e.push(t)}),e}_updateCache(){this._lastRegisteredRenderer=void 0,this._registerTimeByRenderer.forEach((e,t)=>{if(this._lastRegisteredRenderer==null)this._lastRegisteredRenderer=t;else{let n=this._registerTimeByRenderer.get(this._lastRegisteredRenderer);n!=null&&e>n&&(this._lastRegisteredRenderer=t)}})}_flushCallbacksWithRenderer(e){let t=[];for(let n of this._resolves)t.push(n);this._resolves=[];for(let n of t)n(e)}async waitForRenderer(){return this._lastRegisteredRenderer?this._lastRegisteredRenderer:new Promise((e,t)=>{this._resolves.push(e)})}};var Vv=class{constructor(e){this._cooker=new rv(this),this.cookController=new sv,this._graph=new iv,this._missing_expression_references_controller=new pv(this),this._expressions_controller=new lv,this._nodesController=new wv(this),this.renderersRegister=new zv(this),this._objectsController=new mv(this),this._references_controller=new Dv(this),this._time_controller=new qi(this),this._readOnly=!1,this._graph.setScene(this),this.nodesController.createRoot(e==null?void 0:e.root),ie.scenesRegister.registerScene(this)}threejsScene(){return this.root().object}setUuid(e){return this._uuid=e}get uuid(){return this._uuid}setName(e){return e=Ae.sanitizeName(e),this._name=e}name(){return this._name}get camerasController(){return this._camerasController=this._camerasController||new nv(this)}mainCamera(){return this.camerasController.mainCamera()}get cooker(){return this._cooker}get actorsManager(){return this._actorsManager=this._actorsManager||new tv(this)}get assets(){return this._assets_controller=this._assets_controller||new Uv}async waitForCooksCompleted(){return await this.cookController.waitForCooksCompleted()}get dispatchController(){return this._dispatch_controller=this._dispatch_controller||new cv(this)}get eventsDispatcher(){return this._events_dispatcher=this._events_dispatcher||new Iv(this)}setRaycaster(e){this.eventsDispatcher.setRaycaster(e)}get graph(){return this._graph}get lifecycleController(){return this._lifecycleController=this._lifecycleController||new uv(this)}get loadingController(){return this._loading_controller=this._loading_controller||new hv(this)}get missingExpressionReferencesController(){return this._missing_expression_references_controller}get expressionsController(){return this._expressions_controller}get nodesController(){return this._nodesController}createNode(e,t){return this.root().createNode(e,t)}nodesByType(e){return this.nodesController.nodesByType(e)}get objectsController(){return this._objectsController}findObjectByMask(e){return this._objectsController.findObjectByMask(e)}objectsByMask(e){return this._objectsController.objectsByMask(e)}get referencesController(){return this._references_controller}get performance(){return this._performance=this._performance||new av}get viewersRegister(){return this._viewers_register=this._viewers_register||new Bv(this)}get timeController(){return this._time_controller}setFrame(e){this.timeController.setFrame(e)}setFrameToStart(){this.timeController.setFrameToStart()}frame(){return this.timeController.frame()}time(){return this.timeController.time()}maxFrame(){return this.timeController.maxFrame()}play(){this.timeController.play()}pause(){this.timeController.pause()}incrementTime(e){this.timeController.incrementTime(e)}incrementTimeIfPlaying(e){this.timeController.incrementTimeIfPlaying(e)}registerRenderer(e,t){return this.renderersRegister.registerRenderer(e,t)}get serializer(){return this._serializer=this._serializer||new Ev(this)}toJSON(){return this.serializer.toJSON()}markAsReadOnly(e){this._readOnly||(this._readOnlyRequester=e,this._readOnly=!0)}readOnly(){return this._readOnly}readOnlyRequester(){return this._readOnlyRequester}get uniformsController(){return this._uniformsController=this._uniformsController||new Lv(this)}get webgl_controller(){return this._webgl_controller=this._webgl_controller||new kv}get windowController(){return this._windowController=this._windowController||new Fv(this)}dispose(){var e;(e=this._windowController)==null||e.dispose(),ie.scenesRegister.deregisterScene(this)}async batchUpdates(e){this._cooker.block(),await e(),this._cooker.unblock()}node(e){return this.nodesController.node(e)}root(){return this.nodesController.root()}traverseNodes(e){this._nodesController.traverseNodes(e)}registerOnBeforeTick(e,t){this.timeController.registerOnBeforeTick(e,t)}unRegisterOnBeforeTick(e){this.timeController.unRegisterOnBeforeTick(e)}registeredBeforeTickCallbacks(){return this.timeController.registeredBeforeTickCallbacks()}registerOnAfterTick(e,t){this.timeController.registerOnAfterTick(e,t)}unRegisterOnAfterTick(e){this.timeController.unRegisterOnAfterTick(e)}registeredAfterTickCallbacks(){return this.timeController.registeredAfterTickCallbacks()}};var Jhe=["overriden_options","type"],xu=class{constructor(e,t,n){this._node=e,this.dispatcher=t,this.nodesImporter=n}process_data(e,t){if(this.set_connection_points(t.connection_points),this._node.childrenAllowed()&&this.create_nodes(e,t.nodes),this.set_selection(t.selection),this._node.io.inputs.overrideClonedStateAllowed()){let n=t.cloned_state_overriden;n&&this._node.io.inputs.overrideClonedState(n)}this.set_flags(t),this.set_params(t),t.persisted_config&&this.set_persisted_config(t.persisted_config),this.from_data_custom(t)}process_inputs_data(e){let t=e.maxInputsCount;if(t!=null){let n=this._node.io.inputs.minCount();this._node.io.inputs.setCount(n,t)}this.setInputs(e.inputs)}process_ui_data(e,t){if(!t||ie.playerMode())return;let n=this._node.uiData,s=t.pos;if(s){let o=new G().fromArray(s);n.setPosition(o)}let i=t.comment;i&&n.setComment(i),this._node.childrenAllowed()&&this.processNodesUiData(e,t.nodes)}create_nodes(e,t){!t||this.nodesImporter.process_data(e,t)}set_selection(e){if(this._node.childrenAllowed()&&this._node.childrenController&&e&&e.length>0){let t=[];e.forEach(n=>{let s=this._node.node(n);s&&t.push(s)}),this._node.childrenController.selection.set(t)}}set_flags(e){var t,n,s,i,o,a;let c=e.flags;if(c){let l=c.bypass;l!=null&&((n=(t=this._node.flags)==null?void 0:t.bypass)==null||n.set(l));let u=c.display;u!=null&&((i=(s=this._node.flags)==null?void 0:s.display)==null||i.set(u));let h=c.optimize;h!=null&&((a=(o=this._node.flags)==null?void 0:o.optimize)==null||a.set(h))}}set_connection_points(e){!e||(e.in&&this._node.io.saved_connection_points_data.set_in(e.in),e.out&&this._node.io.saved_connection_points_data.set_out(e.out),this._node.io.has_connection_points_controller&&this._node.io.connection_points.update_signature_if_required())}setInputs(e){if(!e)return;let t;for(let n=0;n<e.length;n++)if(t=e[n],t&&this._node.parent())if(q.isString(t)){let s=t,i=this._node.nodeSibling(s);this._node.setInput(n,i)}else{let s=this._node.nodeSibling(t.node),i=t.index;this._node.setInput(i,s,t.output)}}processNodesUiData(e,t){if(!t||ie.playerMode())return;let n=Object.keys(t);for(let s of n){let i=this._node.node(s);if(i){let o=t[s];this.dispatcher.dispatchNode(i).process_ui_data(e,o)}}}set_params(e){let t=e.params;if(!t)return;let n=Object.keys(t),s={};for(let a of n){let c=t[a];if(c!=null){let l=c.options,u=c.type;u=="operator_path"&&(u=U.NODE_PATH);let h=this._node.params.has_param(a),d=!1,p;h&&(p=this._node.params.get(a),(p&&p.type()==u||u==null)&&(d=!0)),d?this._is_param_data_complex(c)?this._process_param_data_complex(a,c):this._process_param_data_simple(a,c):(s.namesToDelete=s.namesToDelete||[],s.namesToDelete.push(a),s.toAdd=s.toAdd||[],s.toAdd.push({name:a,type:u,initValue:c.default_value,rawInput:c.raw_input,options:l}))}}let i=s.namesToDelete&&s.namesToDelete.length>0,o=s.toAdd&&s.toAdd.length>0;if(i||o){this._node.params.updateParams(s);for(let a of this._node.params.spare){let c=t[a.name()];!a.parentParam()&&c&&(this._is_param_data_complex(c)?this._process_param_data_complex(a.name(),c):this._process_param_data_simple(a.name(),c))}}this._node.params.runOnSceneLoadHooks()}_process_param_data_simple(e,t){var n;(n=this._node.params.get(e))==null||n.set(t)}_process_param_data_complex(e,t){let n=this._node.params.get(e);n&&this.dispatcher.dispatchParam(n).process_data(t)}_is_param_data_complex(e){if(q.isString(e)||q.isNumber(e)||q.isArray(e)||q.isBoolean(e))return!1;if(q.isObject(e)){let t=Object.keys(e);for(let n of Jhe)if(t.includes(n))return!0}return!1}set_persisted_config(e){this._node.persisted_config&&this._node.persisted_config.load(e)}from_data_custom(e){}};var zn=class{constructor(e){this._param=e}process_data(e){let t=e.raw_input;t!==void 0&&this._param.set(t),this.add_main(e)}add_main(e){}static spare_params_data(e){return this.params_data(!0,e)}static non_spare_params_data_value(e){return this.params_data_value(!1,e)}static params_data(e,t){let n;if(t){n={};let s=Object.keys(t),i;for(let o of s)i=t[o],i&&(n[o]=t)}return n}static params_data_value(e,t){let n;if(t){n={};let s=Object.keys(t),i;for(let o of s)if(i=t[o],i!=null){let a=i.options,c=i.overriden_options;if(a||c){let l=i;a&&a.spare==e?l.raw_input!=null&&(n[o]={complex_data:l}):c&&(n[o]={complex_data:l})}else{let l=i;(c||l!=null)&&(n[o]={simple_data:l})}}}return n}};var qv=class extends zn{add_main(e){}};var Khe=/\\n+/g,Gv=class extends zn{add_main(e){let t=e.raw_input;t!==void 0&&(t=t.replace(Khe,`
`),this._param.set(t))}};var Hv=class extends zn{add_main(e){let t=e.raw_input;t&&this._param.set(t)}};var Wv=class extends xu{create_nodes(e,t){let s=this._node.polyNodeController;s&&s.createChildNodesFromDefinition()}};var es=class{constructor(e){this._node=e,this._nodes=[],this._optimized_root_node_names=new Set,this._operation_containers_by_name=new Map,this._node_inputs=[]}nodes(){return this._nodes}process_data(e,t){var n,s,i;if(!t||!(this._node.childrenAllowed()&&this._node.childrenController))return;let{optimized_names:o}=es.child_names_by_optimized_state(t);this._nodes=[],this._optimized_root_node_names=new Set;for(let a of o)es.is_optimized_root_node(t,a)&&this._optimized_root_node_names.add(a);for(let a of this._optimized_root_node_names){let c=t[a],l={nodeName:a},u=this._node.createNode(lU,l);if(u){this._nodes.push(u),((n=c.flags)==null?void 0:n.display)&&((i=(s=u.flags)==null?void 0:s.display)==null||i.set(!0));let h=this._createOperationContainer(e,u,c,u.name());u.setOutputOperationContainer(h)}}for(let a of this._nodes){let c=a.outputOperationContainer();if(c){this._node_inputs=[],this._add_optimized_node_inputs(e,a,t,a.name(),c),a.io.inputs.setCount(this._node_inputs.length);for(let l=0;l<this._node_inputs.length;l++)a.setInput(l,this._node_inputs[l])}}}_add_optimized_node_inputs(e,t,n,s,i){var o;let a=n[s],c=a.inputs;if(!!c){for(let l of c)if(q.isString(l)){let u=n[l];if(u)if(es.is_node_optimized(u)&&!this._optimized_root_node_names.has(l)){let h=this._operation_containers_by_name.get(l);h||(h=this._createOperationContainer(e,t,u,l),h&&this._add_optimized_node_inputs(e,t,n,l,h)),i.addInput(h)}else{let h=(o=t.parent())==null?void 0:o.node(l);if(h){this._node_inputs.push(h);let d=this._node_inputs.length-1;t.addInputConfig(i,{operation_input_index:i.currentInputIndex(),node_input_index:d}),i.incrementInputIndex()}}}a.cloned_state_overriden==!0&&i.overrideInputCloneState(a.cloned_state_overriden)}}static child_names_by_optimized_state(e){let t=Object.keys(e),n=[],s=[];for(let i of t){let o=e[i];ie.playerMode()&&this.is_node_optimized(o)?n.push(i):s.push(i)}return{optimized_names:n,non_optimized_names:s}}static is_optimized_root_node_generic(e){return e.outputs_count==0||e.non_optimized_count>0}static is_optimized_root_node(e,t){let n=this.node_outputs(e,t),s=0;return n.forEach(i=>{let o=e[i];this.is_node_optimized(o)||s++}),this.is_optimized_root_node_generic({outputs_count:n.size,non_optimized_count:s})}static is_optimized_root_node_from_node(e){var t,n,s,i;if(!((n=(t=e.flags)==null?void 0:t.optimize)==null?void 0:n.active()))return!1;let o=e.io.connections.outputConnections().map(c=>c.node_dest),a=0;for(let c of o)((i=(s=c.flags)==null?void 0:s.optimize)==null?void 0:i.active())||a++;return this.is_optimized_root_node_generic({outputs_count:o.length,non_optimized_count:a})}static node_outputs(e,t){let n=Object.keys(e),s=new Set;for(let i of n)if(i!=t){let a=e[i].inputs;if(a)for(let c of a)q.isString(c)&&c==t&&s.add(i)}return s}_createOperationContainer(e,t,n,s){let i=zn.non_spare_params_data_value(n.params),o=es.operation_type(n),a={paramsInitValueOverrides:i},c=this._node.createOperationContainer(o,s,a);return c&&(this._operation_containers_by_name.set(s,c),c.pathParamResolveRequired()&&(t.addOperationContainerWithPathParamResolveRequired(c),e.add_operations_composer_node_with_path_param_resolve_required(t))),c}static operation_type(e){return es.is_node_bypassed(e)?"null":e.type}static is_node_optimized(e){let t=e.flags;return!!(t&&t.optimize)}static is_node_bypassed(e){let t=e.flags;return!!(t&&t.bypass)}};var vu=(r=>(r.GIF="gif",r.JPG="jpg",r.JPEG="jpeg",r.PNG="png",r.EXR="exr",r.KTX2="ktx2",r.HDR="hdr",r))(vu||{});var gr=(r=>(r.DRC="drc",r.FBX="fbx",r.GLTF="gltf",r.GLB="glb",r.JSON="json",r.MPD="mpd",r.OBJ="obj",r.PDB="pdb",r.PLY="ply",r.STL="stl",r.SVG="svg",r))(gr||{});function Qhe(r){let e=ie.assetUrls.remapedUrl(r);if(e)return e;let t=ie.blobs.blobUrl(r);return t||r}function ede(){let r=new nd;return r.setURLModifier(Qhe),r}var QU=ede(),ez=class{constructor(r,e,t={}){this._url=r,this._node=e,this.blobOptions=t,this.loadingManager=QU}static extension(r){let e=null;try{e=new URL(r).searchParams.get("ext")}catch{}if(!e){let n=r.split("?")[0].split(".");e=n[n.length-1].toLowerCase()}return e}extension(){return ez.extension(this._url)}async _urlToLoad(){let r=this._url;if(this._node){let t=this._node.scene().assets.root();r.startsWith("http")||(r=t?`${t}/${r}`:r),await ie.blobs.fetchBlobForNode({fullUrl:r,node:this._node,multiAssetsForNode:this.blobOptions.multiAssetsForNode})}return ie.blobs.blobUrl(r)||r}static async _loadMultipleBlobGlobal(r){let e=[];for(let n of r.files){let s=n.fullUrl;e.push(ie.blobs.fetchBlobGlobal(s))}let t=await Promise.all(e);if(r.node)for(let n of t)n.error&&r.node.states.error.set(r.error)}static onAssetLoaded(r){this._onAssetLoadedCallbacks=this._onAssetLoadedCallbacks||[],this._onAssetLoadedCallbacks.push(r)}static _runOnAssetLoadedCallbacks(r,e){if(!!this._onAssetLoadedCallbacks)for(let t of this._onAssetLoadedCallbacks)t(r,e)}},hf=ez;hf.loadingManager=QU;var bu=(r=>(r.IMAGE="image",r.IMAGE_EXR="imageEXR",r.IMAGE_HDR="imageHDR",r.IMAGE_KTX2="imageKTX2",r))(bu||{});var jv=(r=>(r.COPY="copy",r.PARTICLES_SYSTEM_GPU="particlesSystemGpu",r.SHEAR="shear",r.TRANSFORM="transform",r.UV_LAYOUT="uvLayout",r.UV_TRANSFORM="uvTransform",r.UV_UNWRAP="uvUnwrap",r))(jv||{}),yr=(r=>(r.FILE_DRC="fileDRC",r.FILE_FBX="fileFBX",r.FILE_GLTF="fileGLTF",r.FILE_JSON="fileJSON",r.FILE_MPD="fileMPD",r.FILE_OBJ="fileOBJ",r.FILE_PDB="filePDB",r.FILE_PLY="filePLY",r.FILE_STL="fileSTL",r.FILE_SVG="fileSVG",r))(yr||{}),$v=(r=>(r.FILE_DRC="fileMultiDRC",r.FILE_FBX="fileMultiFBX",r.FILE_GLTF="fileMultiGLTF",r.FILE_JSON="fileMultiJSON",r.FILE_MPD="fileMultiMPD",r.FILE_OBJ="fileMultiOBJ",r.FILE_PDB="fileMultiPDB",r.FILE_PLY="fileMultiPLY",r.FILE_STL="fileMultiSTL",r.FILE_SVG="fileMultiSVG",r))($v||{});var tde={onEventChildAttributeUpdated:"OnChildAttributeUpdate",onEventManualTrigger:"OnManualTrigger",onEventObjectAttributeUpdated:"OnObjectAttributeUpdate",onEventObjectClicked:"OnObjectClick",onEventObjectHovered:"OnObjectHover",onEventTick:"OnTick",OnObjectPointerDown:"OnObjectPointerdown",OnObjectPointerUp:"OnObjectPointerup",OnPointerDown:"OnPointerdown",OnPointerUp:"OnPointerup"};function nde(r){var e;let t=r.type;if(t=="imageSequence")return"video";if(t=="image"){let n=(e=r.params)==null?void 0:e.url;if(n){let s=function(o){switch(o){case vu.EXR:return bu.IMAGE_EXR;case vu.HDR:return bu.IMAGE_HDR;case vu.KTX2:return bu.IMAGE_KTX2}},i=hf.extension(n);return s(i)}}}var rde={substract:"subtract"};function sde(r){var e;switch(r.type){case"file":{let n=(e=r.params)==null?void 0:e.url;if(n){let s=function(o){switch(o){case gr.DRC:return yr.FILE_DRC;case gr.FBX:return yr.FILE_FBX;case gr.GLB:case gr.GLTF:return yr.FILE_GLTF;case gr.JSON:return yr.FILE_JSON;case gr.MPD:return yr.FILE_MPD;case gr.OBJ:return yr.FILE_OBJ;case gr.PDB:return yr.FILE_PDB;case gr.PLY:return yr.FILE_PLY;case gr.STL:return yr.FILE_STL}},i=hf.extension(n);return s(i)}}case"fileMulti":return $v.FILE_OBJ;case"svg":return yr.FILE_SVG}}var ide={RGBShift:"chromaticAberration",image:"texture",film:"noise",FXAA:"antialiasing",horizontalBlur:"blur",triangleBlur:"blur",unrealBloom:"bloom",verticalBlur:"blur"},Xv=class{static migrateNodeType(e,t){let n=t.type;switch(e.childrenControllerContext()){case se.ACTOR:return tde[n]||n;case se.COP:return nde(t)||n;case se.GL:return rde[n]||n;case se.SOP:return sde(t)||n;case se.POST:return ide[n]||n}return n}};var df=class{constructor(e,t){this._node=e,this.dispatcher=t}process_data(e,t){var n;if(!t||!(this._node.childrenAllowed()&&this._node.childrenController))return;let{optimized_names:s,non_optimized_names:i}=es.child_names_by_optimized_state(t),o=[];for(let c of i){let l=t[c],u=Xv.migrateNodeType(this._node,l),d={paramsInitValueOverrides:zn.non_spare_params_data_value(l.params),nodeName:c},p=(f,m)=>{try{let g=this._node.createNode(f,m);if(g)return g}catch{}},_=p(u,d);if(!_){let f=Ae.camelCase(u);_=p(f,d)}if(!_){let f=`${u}Network`;_=p(f,d)}if(_)o.push(_);else{let f=`failed to create node with type '${u}'`;e.report.addWarning(f),ie.warn(f)}}if(s.length>0){let c=new es(this._node);if(c.process_data(e,t),this._node.childrenController.context==se.SOP){let l=Object.keys(t),u;for(let h of l)((n=t[h].flags)==null?void 0:n.display)&&(u=h);if(u){let h=o.map(p=>p.name()),d=c.nodes();for(let p of d)h.push(p.name());if(!h.includes(u)){let f=`node '${`${this._node.path()}/${u}`}' with display flag has been optimized and does not exist in player mode`;console.error(f)}}}}let a=new Map;for(let c of o)if(t[c.name()]){let u=this.dispatcher.dispatchNode(c);a.set(c.name(),u),u.process_data(e,t[c.name()])}else ie.warn(`possible import error for node ${c.name()}`),ie.log("available names are",Object.keys(t).sort(),t);for(let c of o){let l=a.get(c.name());l&&l.process_inputs_data(t[c.name()])}}};var wu=class{dispatchNode(e){return e.polyNodeController?this._dispatchPolyNode(e):this.dispatchNonPolyNode(e)}_dispatchPolyNode(e){let t=new df(e,this);return new Wv(e,this,t)}dispatchNonPolyNode(e){let t=new df(e,this);return new xu(e,this,t)}dispatchParam(e){return e instanceof kr?new qv(e):e instanceof go?new Gv(e):e instanceof cr?new Hv(e):new zn(e)}};var Yv=class{constructor(e){this._warnings=[]}warnings(){return this._warnings}reset(){this._warnings=[]}addWarning(e){this._warnings.push(e)}};var vo=class{constructor(e,t){this._data=e,this._options=t,this.report=new Yv(this)}static async loadData(e,t){return await new vo(e,t).scene()}scene(){let e=this._data.root,n={paramsInitValueOverrides:zn.non_spare_params_data_value(e.params),nodeName:cf},s=new Vv({root:n});this._options&&(this._options.sceneName&&s.setName(this._options.sceneName),this._options.measurePerformanceOnLoad==!0&&s.performance.start()),s.loadingController.markAsLoading();let i=this._data.properties;if(i){let l=i.maxFrame||600;s.timeController.setMaxFrame(l);let u=i.maxFrameLocked;u&&s.timeController.setMaxFrameLocked(u);let h=i.realtimeState;h!=null&&s.timeController.setRealtimeState(h),s.setFrame(i.frame||qi.START_FRAME);let d=i.mainCameraNodePath||i.mainCameraPath;d&&s.camerasController.setMainCameraPath(d)}s.cooker.block(),this._base_operations_composer_nodes_with_resolve_required=void 0;let a=new wu().dispatchNode(s.root());e&&a.process_data(this,e);let c=this._data.ui;return c&&a.process_ui_data(this,c),this._resolve_operation_containers_with_path_param_resolve(),this._options&&(this._options.nodeCookWatcher&&this._options.nodeCookWatcher(s),this._options.configureScene&&this._options.configureScene(s)),s.loadingController.markAsLoaded(),s.cooker.unblock(),s}add_operations_composer_node_with_path_param_resolve_required(e){this._base_operations_composer_nodes_with_resolve_required||(this._base_operations_composer_nodes_with_resolve_required=[]),this._base_operations_composer_nodes_with_resolve_required.push(e)}_resolve_operation_containers_with_path_param_resolve(){if(!!this._base_operations_composer_nodes_with_resolve_required)for(let e of this._base_operations_composer_nodes_with_resolve_required)e.resolveOperationContainersPathParams()}};var Eu=class{constructor(e){this.options=e,this._onLoadCompleteCalled=!1,this._progress=0,this._viewerMarkedAsReady=!1,this._sceneMarkedAsReady=!1}static async loadSceneData(e){let t=new Eu(e),n=await t.loadScene(),s=t._viewer;return{scene:n,viewer:s}}async _onLoadComplete(e){this._onLoadCompleteCalled!=!0&&(this._onLoadCompleteCalled=!0,this._viewer&&this._markViewerAsReady(this._viewer),await this._markSceneAsReady(e))}_markViewerAsReady(e){this._viewerMarkedAsReady||(this._viewerMarkedAsReady=!0,e.markAsReady(),this._dispatchEvent(Fc.VIEWER_READY))}async _markSceneAsReady(e){this._sceneMarkedAsReady||(this._sceneMarkedAsReady=!0,await e.cookController.waitForCooksCompleted(),e.setFrame(qi.START_FRAME),this.options.autoPlay!=!1&&e.play(),this._dispatchEvent(Fc.SCENE_READY))}_onNodesCookProgress(e,t){let n=D1.nodes;((i,o)=>{var a;let c=n.start+n.mult*i;this._progress=c,this.options.onProgress&&this.options.onProgress(c,o),I1.dispatchProgressEvent(c,(a=this._scene)==null?void 0:a.name())})(e,t),e>=1&&this._onLoadComplete(t.scene)}async _watchNodesProgress(e){e.root().loadProgress.watchNodesProgress((t,n)=>{this._onNodesCookProgress(t,n)})}async loadScene(){let e=()=>new Promise(async s=>{let i=this.options.configureScene,a=new vo(this.options.sceneData,{sceneName:this.options.sceneName,configureScene:i,nodeCookWatcher:c=>{this._watchNodesProgress(c)}}).scene();this._scene=a,this._dispatchEvent(Fc.SCENE_CREATED),this.options.renderer&&a.renderersRegister.registerRenderer(this.options.renderer),this._onCameraCreatorNodeLoadedResolve=()=>s(a),a.camerasController.onCameraObjectsUpdated(async()=>{await a.camerasController.mainCamera({findAnyCamera:!1,printCameraNotFoundError:this._progress>=1,cameraMaskOverride:this.options.cameraMaskOverride})&&this._onCameraCreatorNodeLoadedResolve&&this._onCameraCreatorNodeLoadedResolve()})});this._scene=await e();let t=this._scene;return await(async()=>{let s=this._domElement(),i=!1;this.options.createViewer!=null&&(i=this.options.createViewer),(s||i)&&(this._viewer=await t.camerasController.createMainViewer({autoRender:!1,renderer:this.options.renderer,cameraMaskOverride:this.options.cameraMaskOverride}),this._viewer&&(s&&this._viewer.mount(s),this._sceneMarkedAsReady==!0&&this._markViewerAsReady(this._viewer),this._dispatchEvent(Fc.VIEWER_MOUNTED)))})(),t}_domElement(){let e=this.options.domElement;if(e)if(q.isString(e)){let t=document.getElementById(e);if(t)return t}else return e}_dispatchEvent(e){let t=[this._domElement(),document];if(!this._scene){console.warn("no event emitted as no scene preset");return}let n={scene:this._scene,viewer:this._viewer},s=i=>new CustomEvent(i,{detail:n});for(let i of t)i&&(i.dispatchEvent(s(e)),this._scene&&i.dispatchEvent(s(`${e}-${this._scene.name()}`)))}};function vi(r){return r=r.replace(/'/g,"'"),r=Ae.escapeLineBreaks(r),r}var Cu=class{constructor(e,t){this._node=e,this.dispatcher=t}data(e={}){var t,n,s,i,o,a,c;this.is_root()||this._node.scene().nodesController.registerNodeContextSignature(this._node),this._data={type:this._node.type()};let l=this.nodes_data(e);Object.keys(l).length>0&&(this._data.nodes=l);let u=this.params_data();if(Object.keys(u).length>0&&(this._data.params=u),!this.is_root()){this._node.io.inputs.maxInputsCountOverriden()&&(this._data.maxInputsCount=this._node.io.inputs.maxInputsCount());let h=this.inputs_data();h.length>0&&(this._data.inputs=h);let d=this.connection_points_data();d&&(this._data.connection_points=d)}if(this._node.flags){let h={};(this._node.flags.hasBypass()||this._node.flags.hasDisplay()||this._node.flags.hasOptimize())&&(this._node.flags.hasBypass()&&((t=this._node.flags.bypass)==null?void 0:t.active())&&(h.bypass=this._node.flags.bypass.active()),this._node.flags.hasDisplay()&&(((n=this._node.flags.display)==null?void 0:n.active())||!((s=this._node.parent())==null?void 0:s.displayNodeController))&&(h.display=(i=this._node.flags.display)==null?void 0:i.active()),this._node.flags.hasOptimize()&&((o=this._node.flags.optimize)==null?void 0:o.active())&&(h.optimize=(a=this._node.flags.optimize)==null?void 0:a.active())),Object.keys(h).length>0&&(this._data.flags=h)}if(this._node.childrenAllowed()){let h=(c=this._node.childrenController)==null?void 0:c.selection;if(h&&this._node.children().length>0){let d=[],p={};for(let f of h.nodes())p[f.graphNodeId()]=!0;for(let f of this._node.children())f.graphNodeId()in p&&d.push(f);let _=d.map(f=>f.name());_.length>0&&(this._data.selection=_)}}if(this._node.io.inputs.overrideClonedStateAllowed()){let h=this._node.io.inputs.clonedStateOverriden();h&&(this._data.cloned_state_overriden=h)}if(this._node.persisted_config){let h=this._node.persisted_config.toJSON();h&&(this._data.persisted_config=h)}return this.add_custom(),this._data}uiData(e={}){let t=this.ui_data_without_children(),n=this._node.children();return n.length>0&&(t.nodes={},n.forEach(s=>{let i=this.dispatcher.dispatchNode(s);t.nodes[s.name()]=i.uiData(e)})),t}ui_data_without_children(){let e={};if(!this.is_root()){let t=this._node.uiData;e.pos=t.position().toArray();let n=t.comment();n&&(e.comment=vi(n))}return e}is_root(){return this._node.parent()===null&&this._node.graphNodeId()==this._node.root().graphNodeId()}inputs_data(){let e=[];return this._node.io.inputs.inputs().forEach((t,n)=>{var s;if(t){let i=this._node.io.connections.inputConnection(n);if(this._node.io.inputs.hasNamedInputs()){let o=i.output_index,a=(s=t.io.outputs.namedOutputConnectionPoints()[o])==null?void 0:s.name();a&&(e[n]={index:n,node:t.name(),output:a})}else e[n]=t.name()}}),e}connection_points_data(){if(!!this._node.io.has_connection_points_controller&&!!this._node.io.connection_points.initialized()&&(this._node.io.inputs.hasNamedInputs()||this._node.io.outputs.hasNamedOutputs())){let e={};if(this._node.io.inputs.hasNamedInputs()){e.in=[];for(let t of this._node.io.inputs.namedInputConnectionPoints())t&&e.in.push(t.toJSON())}if(this._node.io.outputs.hasNamedOutputs()){e.out=[];for(let t of this._node.io.outputs.namedOutputConnectionPoints())t&&e.out.push(t.toJSON())}return e}}params_data(){let e={};for(let t of this._node.params.names){let n=this._node.params.get(t);if(n&&!n.parentParam()){let s=this.dispatcher.dispatchParam(n);if(s.required()){let i=s.data();e[n.name()]=i}}}return e}nodes_data(e={}){let t={};for(let n of this._node.children()){let s=this.dispatcher.dispatchNode(n);t[n.name()]=s.data(e)}return t}add_custom(){}};var ur=class{constructor(e){this._param=e,this._complex_data={}}required(){let e=this._param.options.isSpare()&&!this._param.parentParam(),t=!this._param.isDefault();return e||t||this._param.options.hasOptionsOverridden()}data(){if(this._param.parentParam())throw console.warn("no component should be saved"),"no component should be saved";return this._require_data_complex()?this._data_complex():this._data_simple()}_data_simple(){return this._param.rawInputSerialized()}_data_complex(){if(this._complex_data={},this._param.options.isSpare()&&!this._param.parentParam()&&(this._complex_data.type=this._param.type(),this._complex_data.default_value=this._param.defaultValueSerialized(),this._complex_data.options=this._param.options.current()),this._param.isDefault()||(this._complex_data.raw_input=this._param.rawInputSerialized()),this._param.options.hasOptionsOverridden()){let e={},t=this._param.options.overriddenOptions();for(let n of Object.keys(t)){let s=t[n];q.isString(s)||q.isNumber(s)?e[n]=s:e[n]=JSON.stringify(s)}this._complex_data.overriden_options=e}return this._complex_data}_require_data_complex(){return!!(this._param.options.isSpare()||this._param.options.hasOptionsOverridden())}add_main(){}};var Zv=class extends ur{add_main(){if(this._require_data_complex())this._complex_data.raw_input=this._param.rawInputSerialized();else return this._param.rawInputSerialized()}};var Jv=class extends ur{add_main(){let e=this._param.rawInput();if(e=vi(e),this._require_data_complex())this._complex_data.raw_input=e;else return e}};var Kv=class extends ur{add_main(){let e=this._param.rawInput();if(e=vi(e),this._require_data_complex())this._complex_data.raw_input=e;else return e}};var Qv=class extends ur{add_main(){let e=this._param.rawInput();if(e=vi(e),this._require_data_complex())this._complex_data.raw_input=e;else return e}};var eb=class extends ur{add_main(){if(this._require_data_complex())this._complex_data.raw_input=this._param.rawInputSerialized();else return this._param.rawInputSerialized()}};var tb=class extends Cu{nodes_data(e={}){return e.showPolyNodesData?super.nodes_data(e):{}}uiData(e={}){return e.showPolyNodesData?super.uiData(e):this.ui_data_without_children()}};var nb=class{dispatchNode(e){return e.polyNodeController?new tb(e,this):new Cu(e,this)}dispatchParam(e){return e instanceof Ds?new Zv(e):e instanceof _o?new Jv(e):e instanceof yu?new Kv(e):e instanceof go?new Qv(e):e instanceof cr?new eb(e):new ur(e)}};var ode={dependsOnDisplayNode:!0},bo=class{constructor(e,t,n=ode){this.node=e,this.options=n,this._initialized=!1,this._display_node=void 0,this._graph_node=new Rt(e.scene(),"DisplayNodeController"),this._graph_node.node=e,this._onDisplayNodeRemoveCallback=t.onDisplayNodeRemove,this._onDisplayNodeSetCallback=t.onDisplayNodeSet,this._onDisplayNodeUpdateCallback=t.onDisplayNodeUpdate}dispose(){this._graph_node.dispose()}displayNode(){return this._display_node}initializeNode(){if(this._initialized){console.error("display node controller already initialed",this.node);return}this._initialized=!0,this.node.lifecycle.onChildAdd(e=>{var t,n;this._display_node||(n=(t=e.flags)==null?void 0:t.display)==null||n.set(!0)}),this.node.lifecycle.onChildRemove(e=>{var t,n,s;if(e.graphNodeId()==((t=this._display_node)==null?void 0:t.graphNodeId())){let i=this.node.children(),o=i[i.length-1];o?(s=(n=o.flags)==null?void 0:n.display)==null||s.set(!0):this.setDisplayNode(void 0)}}),this._graph_node.dirtyController.addPostDirtyHook("_requestDisplayNodeContainer",()=>{this._onDisplayNodeUpdateCallback&&this._onDisplayNodeUpdateCallback()})}async setDisplayNode(e){if(this._initialized||console.error("display node controller not initialized",this.node),this._display_node!=e){let t=this._display_node;t&&(t.flags.display.set(!1),this.options.dependsOnDisplayNode&&this._graph_node.removeGraphInput(t),this._onDisplayNodeRemoveCallback&&this._onDisplayNodeRemoveCallback()),this._display_node=e,this._display_node&&(this.options.dependsOnDisplayNode&&this._graph_node.addGraphInput(this._display_node),this._onDisplayNodeSetCallback&&this._onDisplayNodeSetCallback())}}};var pf="input geometry",ade=[pf,pf,pf,pf],cn=class extends Gt{constructor(){super(...arguments);this.flags=new q_(this)}static context(){return se.SOP}static displayedInputNames(){return ade}initializeBaseNode(){this.flags.display.set(!1),this.flags.display.onUpdate(()=>{if(this.flags.display.active()){let e=this.parent();e&&e.displayNodeController&&e.displayNodeController.setDisplayNode(this)}}),this.io.outputs.setHasOneOutput()}setCoreGroup(e){this._setContainer(e,"from set_core_group")}setObject(e){this._setContainerObjects([e],"from set_object")}setObjects(e){this._setContainerObjects(e,"from set_objects")}setGeometry(e,t=kn.MESH){let n=this.createObject(e,t);this._setContainerObjects([n],"from set_geometry")}setGeometries(e,t=kn.MESH){let n=[],s;for(let i of e)s=this.createObject(i,t),n.push(s);this._setContainerObjects(n,"from set_geometries")}_setContainerObjects(e,t){let n=this.containerController.container().coreContent()||new Os;n.setObjects(e),n.touch(),this._setContainer(n)}static createObject(e,t,n){return zt.createObject(e,t,n)}createObject(e,t,n){return cn.createObject(e,t,n)}static createIndexIfNone(e){zt.createIndexIfNone(e)}_createIndexIfNone(e){cn.createIndexIfNone(e)}};var tz=class extends Ye{},cde=new tz,rb=class extends cn{constructor(){super(...arguments);this.paramsConfig=cde}static type(){return Nn.OUTPUT}initializeNode(){this.io.inputs.setCount(1),this.io.outputs.setHasNoOutput(),this.io.inputs.initInputsClonedState(Tt.NEVER)}cook(e){this.setCoreGroup(e[0])}};var sb=class extends cn{constructor(){super(...arguments);this.childrenDisplayController=new nz(this),this.displayNodeController=new bo(this,this.childrenDisplayController.displayNodeControllerCallbacks()),this._childrenControllerContext=se.SOP}initializeBaseNode(){super.initializeBaseNode(),this.childrenDisplayController.initializeNode(),this.cookController.disallowInputsEvaluation()}createNode(e,t){return super.createNode(e,t)}children(){return super.children()}nodesByType(e){return super.nodesByType(e)}async cook(e){let t=this.childrenDisplayController.outputNode();if(t){let s=(await t.compute()).coreContent();s?this.setCoreGroup(s):t.states.error.active()?this.states.error.set(t.states.error.message()):this.setObjects([])}else this.states.error.set("no output node found inside subnet")}},lde={dependsOnDisplayNode:!0},nz=class{constructor(e,t=lde){this.node=e,this.options=t,this._outputNodeNeedsUpdate=!0}dispose(){var e;(e=this._graphNode)==null||e.dispose()}displayNodeControllerCallbacks(){return{onDisplayNodeRemove:()=>{this.node.setDirty()},onDisplayNodeSet:()=>{this.node.setDirty()},onDisplayNodeUpdate:()=>{this.node.setDirty()}}}outputNode(){return this._outputNodeNeedsUpdate&&this._updateOutputNode(),this._outputNode}initializeNode(){var e;let t=(e=this.node.flags)==null?void 0:e.display;t&&t.onUpdate(()=>{t.active()&&this.node.setDirty()}),this.node.lifecycle.onChildAdd(()=>{this._outputNodeNeedsUpdate=!0,this.node.setDirty()}),this.node.lifecycle.onChildRemove(()=>{this._outputNodeNeedsUpdate=!0,this.node.setDirty()})}_updateOutputNode(){let e=this.node.nodesByType(rb.type())[0];(this._outputNode==null||e==null||this._outputNode.graphNodeId()!=e.graphNodeId())&&(this._graphNode&&this._outputNode&&this._graphNode.removeGraphInput(this._outputNode),this._outputNode=e,this._outputNode&&this.options.dependsOnDisplayNode&&(this._graphNode=this._graphNode||this._createGraphNode(),this._graphNode.addGraphInput(this._outputNode)))}_createGraphNode(){let e=new Rt(this.node.scene(),"subnetChildrenDisplayController");return e.addPostDirtyHook("subnetChildrenDisplayController",()=>{this.node.setDirty()}),e}};var ks=class{static ParamsConfig(e,t=new Ye){if(e.params)for(let n of e.params){let s=n.name,i=n.type,o=n.initValue,a=n.options;t[s]=new bn(i,o,a)}return t}};function rz(r,e,t){let n=ks.ParamsConfig(e);class s extends sb{constructor(){super(...arguments);this.paramsConfig=n,this.polyNodeController=new t(this,e)}static type(){return r}}return s}var ff="parent object",ude=[ff,ff,ff,ff];var wo=class extends Gt{constructor(){super(...arguments);this.renderOrder=0,this._children_group=this._create_children_group(),this._attachableToHierarchy=!0,this._used_in_scene=!0}static context(){return se.OBJ}static displayedInputNames(){return ude}_create_children_group(){let e=new Wt;return e.matrixAutoUpdate=!1,e}attachableToHierarchy(){return this._attachableToHierarchy}usedInScene(){return this._used_in_scene}addObjectToParent(e){this.attachableToHierarchy()&&e.add(this.object)}removeObjectFromParent(){if(this.attachableToHierarchy()){let e=this.object.parent;e&&e.remove(this.object)}}dispose(){var e;super.dispose(),(e=this.childrenDisplayController)==null||e.dispose()}initializeBaseNode(){this._object=this._create_object_with_attributes(),this.nameController.add_post_set_fullPath_hook(this.set_object_name.bind(this)),this.set_object_name()}childrenGroup(){return this._children_group}get object(){return this._object}_create_object_with_attributes(){let e=this.createObject();return e.node=this,e.add(this._children_group),e}set_object_name(){this._object&&(this._object.name=this.path(),this._children_group.name=`${this.path()}:parentedOutputs`)}createObject(){let e=new nt;return e.matrixAutoUpdate=!1,e}isDisplayNodeCooking(){var e,t,n;if((t=(e=this.flags)==null?void 0:e.display)==null?void 0:t.active()){let s=(n=this.displayNodeController)==null?void 0:n.displayNode();if(s)return s.cookController.isCooking()}return!1}isDisplayed(){var e,t;return((t=(e=this.flags)==null?void 0:e.display)==null?void 0:t.active())||!1}};var Su=(r=>(r.OBJECTS="objects",r.GEOMETRIES="geometries",r))(Su||{}),Mc=["geometries","objects"],ib=(r=>(r.XYZ="XYZ",r.XZY="XZY",r.YXZ="YXZ",r.YZX="YZX",r.ZYX="ZYX",r.ZXY="ZXY",r))(ib||{}),mf=["XYZ","XZY","YXZ","YZX","ZXY","ZYX"];var sz=[0,0,0],An=class{constructor(){this._translation_matrix=new pe,this._translation_matrix_q=new dt,this._translation_matrix_s=new A(1,1,1),this._matrix=new pe().identity(),this._matrix_q=new dt,this._matrix_euler=new rr,this._matrix_s=new A,this._m=new pe,this._q=new dt,this._rotateDirOrigin=new A,this._rotateDirDest=new A}static setParamsFromMatrix(e,t,n={}){let s=n.scale;s==null&&(s=!0),e.decompose(this.set_params_from_matrix_position,this.set_params_from_matrix_quaternion,this.set_params_from_matrix_scale),this.set_params_from_matrix_euler.setFromQuaternion(this.set_params_from_matrix_quaternion),this.set_params_from_matrix_euler.toArray(sz),this.set_params_from_matrix_rotation.fromArray(sz),this.set_params_from_matrix_rotation.divideScalar(Math.PI/180),this.set_params_from_matrix_position.toArray(this.set_params_from_matrix_t),this.set_params_from_matrix_rotation.toArray(this.set_params_from_matrix_r),this.set_params_from_matrix_scale.toArray(this.set_params_from_matrix_s),t.scene().batchUpdates(()=>{t.params.set_vector3("t",this.set_params_from_matrix_t),t.params.set_vector3("r",this.set_params_from_matrix_r),t.params.set_vector3("s",this.set_params_from_matrix_s),s&&t.params.set_float("scale",1)})}static setParamsFromObject(e,t){e.position.toArray(this.set_params_from_object_position_array),e.rotation.toArray(this.set_params_from_object_rotation_array),this.set_params_from_object_rotation_deg.fromArray(this.set_params_from_object_rotation_array),this.set_params_from_object_rotation_deg.multiplyScalar(180/Math.PI),this.set_params_from_object_rotation_deg.toArray(this.set_params_from_object_rotation_array),t.scene().batchUpdates(()=>{t.params.set_vector3("t",this.set_params_from_object_position_array),t.params.set_vector3("r",this.set_params_from_object_rotation_array)})}translationMatrix(e){return this._translation_matrix.compose(e,this._translation_matrix_q,this._translation_matrix_s),this._translation_matrix}matrix(e,t,n,s,i){return this._matrix_euler.set(dn.degToRad(t.x),dn.degToRad(t.y),dn.degToRad(t.z),i),this._matrix_q.setFromEuler(this._matrix_euler),this._matrix_s.copy(n).multiplyScalar(s),this._matrix.compose(e,this._matrix_q,this._matrix_s),this._matrix}rotateGeometry(e,t,n){this._rotateDirDest.copy(n).normalize(),this._rotateDirOrigin.copy(t).normalize(),this._q.setFromUnitVectors(this._rotateDirOrigin,this._rotateDirDest),this._m.makeRotationFromQuaternion(this._q),e.applyMatrix4(this._m)}rotateObject(e,t,n){this._rotateDirDest.copy(n).normalize(),this._rotateDirOrigin.copy(t).normalize(),this._q.setFromUnitVectors(this._rotateDirOrigin,this._rotateDirDest),this._m.makeRotationFromQuaternion(this._q),e.matrix.multiply(this._m),e.matrix.decompose(e.position,e.quaternion,e.scale)}static decomposeMatrix(e){e.matrix.decompose(e.position,e.quaternion,e.scale)}};An.set_params_from_matrix_position=new A;An.set_params_from_matrix_quaternion=new dt;An.set_params_from_matrix_scale=new A;An.set_params_from_matrix_euler=new rr;An.set_params_from_matrix_rotation=new A;An.set_params_from_matrix_t=[0,0,0];An.set_params_from_matrix_r=[0,0,0];An.set_params_from_matrix_s=[0,0,0];An.set_params_from_object_position_array=[0,0,0];An.set_params_from_object_rotation_deg=new A;An.set_params_from_object_rotation_array=[0,0,0];function ob(r,e){let t=(e==null?void 0:e.matrixAutoUpdate)||!1;return class extends r{constructor(){super(...arguments);this.transform=W.FOLDER(),this.keepPosWhenParenting=W.BOOLEAN(0),this.rotationOrder=W.INTEGER(mf.indexOf(ib.XYZ),{menu:{entries:mf.map((s,i)=>({name:s,value:i}))}}),this.t=W.VECTOR3([0,0,0]),this.r=W.VECTOR3([0,0,0]),this.s=W.VECTOR3([1,1,1]),this.scale=W.FLOAT(1),this.matrixAutoUpdate=W.BOOLEAN(t?1:0),this.updateTransformFromObject=W.BUTTON(null,{callback:s=>{Pc.PARAM_CALLBACK_update_transform_from_object(s)}})}}}var hde=class extends ob(Ye){};var iz="_cook_main_without_inputs_when_dirty",Pc=class{constructor(e){this.node=e,this._cook_main_without_inputs_when_dirty_bound=this._cook_main_without_inputs_when_dirty.bind(this),this._core_transform=new An,this._keep_pos_when_parenting_m_object=new pe,this._keep_pos_when_parenting_m_new_parent_inv=new pe}initializeNode(){this.node.dirtyController.hasHook(iz)||this.node.dirtyController.addPostDirtyHook(iz,this._cook_main_without_inputs_when_dirty_bound)}async _cook_main_without_inputs_when_dirty(){await this.node.cookController.cookMainWithoutInputs()}update(){this.update_transform_with_matrix();let e=this.node.object;e.matrixAutoUpdate=this.node.pv.matrixAutoUpdate}update_transform_with_matrix(e){let t=this.node.object;e!=null&&!e.equals(t.matrix)?(t.matrix.copy(e),t.dispatchEvent({type:"change"})):this._update_matrix_from_params_with_core_transform()}_update_matrix_from_params_with_core_transform(){let e=this.node.object,t=e.matrixAutoUpdate;t&&(e.matrixAutoUpdate=!1);let n=this._core_transform.matrix(this.node.pv.t,this.node.pv.r,this.node.pv.s,this.node.pv.scale,mf[this.node.pv.rotationOrder]);e.matrix.identity(),e.applyMatrix4(n),this._apply_look_at(),e.updateMatrix(),t&&(e.matrixAutoUpdate=!0),e.dispatchEvent({type:"change"})}_apply_look_at(){}set_params_from_matrix(e,t={}){An.setParamsFromMatrix(e,this.node,t)}static update_node_transform_params_if_required(e,t){e.transformController.update_node_transform_params_if_required(t)}update_node_transform_params_if_required(e){if(!this.node.pv.keepPosWhenParenting||!this.node.scene().loadingController.loaded()||e==this.node.object.parent)return;let t=this.node.object;t.updateMatrixWorld(!0),e.updateMatrixWorld(!0),this._keep_pos_when_parenting_m_object.copy(t.matrixWorld),this._keep_pos_when_parenting_m_new_parent_inv.copy(e.matrixWorld),this._keep_pos_when_parenting_m_new_parent_inv.invert(),this._keep_pos_when_parenting_m_object.premultiply(this._keep_pos_when_parenting_m_new_parent_inv),An.setParamsFromMatrix(this._keep_pos_when_parenting_m_object,this.node,{scale:!0})}update_node_transform_params_from_object(e=!1){let t=this.node.object;e&&t.updateMatrix(),An.setParamsFromMatrix(t.matrix,this.node,{scale:!0})}static PARAM_CALLBACK_update_transform_from_object(e){e.transformController.update_node_transform_params_from_object()}};var Eo=class{constructor(e){this.node=e}initializeNode(){this.node.io.inputs.setCount(0,1),this.node.io.inputs.setDependsOnInputs(!1),this.node.io.outputs.setHasOneOutput(),this.node.io.inputs.add_on_set_input_hook("on_input_updated:update_parent",()=>{this.on_input_updated()})}static on_input_updated(e){let t=e.root().getParentForNode(e);e.transformController&&t&&Pc.update_node_transform_params_if_required(e,t),e.io.inputs.input(0)!=null?e.root().addToParentTransform(e):e.root().removeFromParentTransform(e)}on_input_updated(){Eo.on_input_updated(this.node)}};var oz="display",Au=class{constructor(e){this.node=e,this._childrenUuids=new Set,this._sopGroup=this._createSopGroup()}_createSopGroup(){let e=new Wt;return e.matrixAutoUpdate=!1,e}sopGroup(){return this._sopGroup}setSopGroupName(){this._sopGroup.name=`${this.node.name()}:sopGroup`}dispose(){this._clearHooks()}displayNodeControllerCallbacks(){return{onDisplayNodeRemove:()=>{this.removeChildren()},onDisplayNodeSet:()=>{setTimeout(()=>{this.requestDisplayNodeContainer()},0)},onDisplayNodeUpdate:()=>{this.requestDisplayNodeContainer()}}}initializeNode(){var e;this.node.object.add(this.sopGroup()),this.node.nameController.add_post_set_fullPath_hook(this.setSopGroupName.bind(this)),this._createSopGroup();let t=(e=this.node.flags)==null?void 0:e.display;t&&t.onUpdate(()=>{this._updateSopGroupHierarchy(),t.active()&&this.requestDisplayNodeContainer()})}_updateSopGroupHierarchy(){var e;if((e=this.node.flags)==null?void 0:e.display){let n=this.sopGroup();this.usedInScene()?(n.visible=!0,this.node.object.add(n),n.updateMatrix()):(n.visible=!1,this.node.object.remove(n))}}usedInScene(){var e,t;let n=this.node.params.has(oz),s=this.node.params.boolean(oz),i=this.node.usedInScene(),o=((t=(e=this.node.flags)==null?void 0:e.display)==null?void 0:t.active())||!1;return i&&o&&(!n||s)}async requestDisplayNodeContainer(){!this.node.scene().loadingController.loaded()||this.usedInScene()&&await this._setContentUnderSopGroup()}removeChildren(){if(this._sopGroup.children.length==0)return;let e;for(;e=this._sopGroup.children[0];)this._sopGroup.remove(e);this._childrenUuids.clear(),this._notifyCamerasController()}async _setContentUnderSopGroup(){var e;let t=this.node.displayNodeController.displayNode();if(t&&((e=t.parent())==null?void 0:e.graphNodeId())==this.node.graphNodeId()){let s=(await t.compute()).coreContent();if(s){let i=s.objects(),o=i.length!=this._childrenUuids.size;if(!o)for(let a of i)this._childrenUuids.has(a.uuid)||(o=!0);if(o){this.removeChildren();for(let a of i)this._sopGroup.add(a),a.updateMatrix(),this._childrenUuids.add(a.uuid)}this._notifyCamerasController(),this._runOnSopGroupUpdatedHooks();return}}this.removeChildren(),this._runOnSopGroupUpdatedHooks()}_notifyCamerasController(){this.node.scene().camerasController.updateFromChangeInObject(this._sopGroup)}registerOnSopGroupUpdated(e,t){this._onSopGroupUpdatedHookNames=this._onSopGroupUpdatedHookNames||[],this._onSopGroupUpdatedHooks=this._onSopGroupUpdatedHooks||[],this._onSopGroupUpdatedHookNames.push(e),this._onSopGroupUpdatedHooks.push(t)}_clearHooks(){if(!(!this._onSopGroupUpdatedHookNames||!this._onSopGroupUpdatedHooks))for(let e of this._onSopGroupUpdatedHookNames)this.deregisterOnSopGroupUpdated(e)}deregisterOnSopGroupUpdated(e){var t;if(!this._onSopGroupUpdatedHookNames||!this._onSopGroupUpdatedHooks)return;let n=(t=this._onSopGroupUpdatedHookNames)==null?void 0:t.indexOf(e);this._onSopGroupUpdatedHookNames.splice(n,1),this._onSopGroupUpdatedHooks.splice(n,1),this._onSopGroupUpdatedHookNames.length==0&&(this._onSopGroupUpdatedHookNames=void 0),this._onSopGroupUpdatedHooks.length==0&&(this._onSopGroupUpdatedHooks=void 0)}_runOnSopGroupUpdatedHooks(){if(this._onSopGroupUpdatedHooks){let e=[...this._onSopGroupUpdatedHooks];for(let t of e)t()}}onSopGroupUpdatedCallbackNames(){return this._onSopGroupUpdatedHookNames}};function az(r,e,t){let n=ks.ParamsConfig(e);class s extends wo{constructor(){super(...arguments);this.paramsConfig=n,this.hierarchyController=new Eo(this),this.flags=new Ta(this),this.childrenDisplayController=new Au(this),this.displayNodeController=new bo(this,this.childrenDisplayController.displayNodeControllerCallbacks()),this._childrenControllerContext=se.SOP,this.polyNodeController=new t(this,e)}static type(){return r}createObject(){let o=new Wt;return o.matrixAutoUpdate=!1,o}initializeNode(){this.hierarchyController.initializeNode(),this.childrenDisplayController.initializeNode()}createNode(o,a){return super.createNode(o,a)}children(){return super.children()}nodesByType(o){return super.nodesByType(o)}cook(){this.cookController.endCook()}}return s}var _f="input animation clip",dde=[_f,_f,_f,_f],Tu=class extends Gt{constructor(){super(...arguments);this.flags=new V_(this)}static context(){return se.ANIM}static displayedInputNames(){return dde}initializeBaseNode(){this.io.outputs.setHasOneOutput()}setTimelineBuilder(e){this._setContainer(e)}};var cz=class extends Ye{},pde=new cz,ab=class extends Tu{constructor(){super(...arguments);this.paramsConfig=pde,this._setParentDirtyBound=this._setParentDirty.bind(this)}static type(){return Nn.OUTPUT}initializeNode(){this.io.inputs.setCount(1),this.io.outputs.setHasNoOutput(),this.lifecycle.onAfterAdded(this._setParentDirtyBound),this.addPostDirtyHook("makeParentDirty",this._setParentDirtyBound)}dispose(){super.dispose(),this._setParentDirty()}cook(e){let t=e[0];this.setTimelineBuilder(t)}_setParentDirty(){var e;(e=this.parent())==null||e.setDirty()}};var lz=class extends Ye{},tze=new lz,cb=class extends Tu{constructor(){super(...arguments);this._childrenControllerContext=se.ANIM}initializeNode(){this.io.inputs.setCount(0,4)}createNode(e,t){return super.createNode(e,t)}children(){return super.children()}nodesByType(e){return super.nodesByType(e)}async cook(e){let t=this.nodesByType(ab.type())[0];if(!t)return this.states.error.set("no output node found inside subnet"),this.cookController.endCook();let s=(await t.compute()).coreContent();if(!s)return this.states.error.set("invalid subnetOutput"),this.cookController.endCook();this.setTimelineBuilder(s)}};function uz(r,e,t){let n=ks.ParamsConfig(e);class s extends cb{constructor(){super(...arguments);this.paramsConfig=n,this.polyNodeController=new t(this,e)}static type(){return r}}return s}var lb=(r=>(r.ATTRIBUTE="attribute",r.GLOBALS="globals",r.OUTPUT="output",r.PARAM="param",r.SDF_CONTEXT="SDFContext",r.SDF_MATERIAL="SDFMaterial",r.VARYING_WRITE="varyingWrite",r))(lb||{});var fze={[kt.BOOL]:void 0,[kt.INT]:void 0,[kt.FLOAT]:void 0,[kt.VEC2]:["x","y"],[kt.VEC3]:["x","y","z"],[kt.VEC4]:["x","y","z","w"],[kt.SAMPLER_2D]:void 0,[kt.SAMPLER_CUBE]:void 0,[kt.SSS_MODEL]:void 0,[kt.SDF_CONTEXT]:void 0,[kt.SDF_MATERIAL]:void 0},bi=class{static glType(e,t){switch(e){case kt.BOOL:return this.bool(t);case kt.INT:return this.integer(t);case kt.FLOAT:return this.float(t);case kt.VEC2:return this.vector2(t);case kt.VEC3:return this.vector3(t);case kt.VEC4:return this.vector4(t)}return`no matching implementation for glType '${e}' in ThreeToGl.glType`}static any(e){return q.isString(e)?e:q.isBoolean(e)?`${e}`:q.isNumber(e)?`${Ae.ensureFloat(e)}`:q.isArray(e)?this.numeric_array(e):e instanceof G||e instanceof A||e instanceof Se||e instanceof ae?this.numeric_array(e.toArray()):`ThreeToGl error: unknown value type '${e}'`}static numeric_array(e){let t=new Array(e.length);for(let s=0;s<e.length;s++)t[s]=`${Ae.ensureFloat(e[s])}`;return`${`vec${e.length}`}(${t.join(", ")})`}static vector4(e){return q.isString(e)?e:`vec4(${e.toArray().map(n=>`${Ae.ensureFloat(n)}`).join(", ")})`}static vector3(e){return q.isString(e)?e:`vec3(${e.toArray().map(n=>`${Ae.ensureFloat(n)}`).join(", ")})`}static vector2(e){return q.isString(e)?e:`vec2(${e.toArray().map(n=>`${Ae.ensureFloat(n)}`).join(", ")})`}static vector3_float(e,t){return q.isNumber(t)&&(t=Ae.ensureFloat(t)),`vec4(${this.vector3(e)}, ${t})`}static float4(e,t,n,s){return q.isNumber(e)&&(e=Ae.ensureFloat(e)),q.isNumber(t)&&(t=Ae.ensureFloat(t)),q.isNumber(n)&&(n=Ae.ensureFloat(n)),q.isNumber(s)&&(s=Ae.ensureFloat(s)),`vec4(${e}, ${t}, ${n}, ${s})`}static float3(e,t,n){return q.isNumber(e)&&(e=Ae.ensureFloat(e)),q.isNumber(t)&&(t=Ae.ensureFloat(t)),q.isNumber(n)&&(n=Ae.ensureFloat(n)),`vec3(${e}, ${t}, ${n})`}static float2(e,t){return q.isNumber(e)&&(e=Ae.ensureFloat(e)),q.isNumber(t)&&(t=Ae.ensureFloat(t)),`vec2(${e}, ${t})`}static float(e){if(q.isNumber(e))return Ae.ensureFloat(e);{let t=parseFloat(e);return q.isNaN(t)?e:Ae.ensureFloat(t)}}static integer(e){if(q.isNumber(e))return Ae.ensureInteger(e);{let t=parseInt(e);return q.isNaN(t)?e:Ae.ensureInteger(t)}}static bool(e){return q.isBoolean(e)?`${e}`:e}};var ub=class{constructor(e){this.node=e,this._initialized=!1,this._checkParamsEditableStateBound=this._checkParamsEditableState.bind(this)}initializeNode(){if(this._initialized){console.warn("already initialized",this.node);return}this._initialized=!0,this.node.io.inputs.add_on_set_input_hook("_checkParamsEditableStateBound",this._checkParamsEditableStateBound)}initialized(){return this._initialized}_checkParamsEditableState(){this._paramsMatchEditableState()||this.updateParamsEditableStateIfNeeded()}_paramsMatchEditableState(){let e=0,t=this.node.params;for(let n of this.node.io.inputs.namedInputConnectionPoints()){if(n){let s=this.node.io.inputs.input(e)!=null,i=n==null?void 0:n.name();if(t.has(i)){let a=t.get(i);if(a){let c=!s,l=a.options.editable();if(c!=l)return!1}}}e++}return!0}updateParamsEditableStateIfNeeded(){let e=0,t=this.node.params;for(let n of this.node.io.inputs.namedInputConnectionPoints()){if(n){let s=this.node.io.inputs.input(e)!=null,i=n==null?void 0:n.name();if(t.has(i)){let o=t.get(i);if(o){let a=!s;o.options.setEditableState(a)}}}e++}}};var fde=/\/+/g,Mu=class extends Gt{constructor(){super(...arguments);this._paramsEditableStatesController=new ub(this)}static context(){return se.GL}initializeBaseNode(){this.uiData.setLayoutHorizontal(),this.io.connections.initInputs(),this.io.connection_points.spare_params.initializeNode(),this._paramsEditableStatesController.initializeNode()}cook(){console.warn("gl node cooking")}_setMatToRecompile(){var e,t;(t=(e=this.materialNode())==null?void 0:e.assemblerController())==null||t.set_compilation_required_and_dirty(this)}materialNode(){let e=this.parent();if(e)return e.context()==se.GL?e==null?void 0:e.materialNode():e}glVarName(e){return`v_POLY_${this.path(this.materialNode()).replace(fde,"_")}_${e}`}variableForInputParam(e){return this.variableForInput(e.name())}variableForInput(e){var t;let n=this.io.inputs.getInputIndex(e),s=this.io.connections.inputConnection(n);if(s){let i=s.node_src,o=i.io.outputs.namedOutputConnectionPoints()[s.output_index];if(o){let a=o.name();return i.glVarName(a)}else throw console.warn(`no output called '${e}' for gl node ${i.path()}`),"variable_for_input ERROR"}else{if(this.params.has(e))return bi.any((t=this.params.get(e))==null?void 0:t.value);{let i=this.io.inputs.namedInputConnectionPoints()[n];return bi.any(i.init_value)}}}setLines(e){}reset_code(){var e;(e=this._param_configs_controller)==null||e.reset()}setParamConfigs(){}param_configs(){var e;return(e=this._param_configs_controller)==null?void 0:e.list()}paramsGenerating(){return!1}paramDefaultValue(e){return null}};var hz=class extends Ye{},wze=new hz;var dz=class extends Ye{},mde=new dz,hb=class extends Mu{constructor(){super(...arguments);this.paramsConfig=mde}static type(){return Nn.OUTPUT}initializeNode(){this.io.connection_points.set_input_name_function(this._expected_input_name.bind(this)),this.io.connection_points.set_expected_output_types_function(()=>[]),this.io.connection_points.set_expected_input_types_function(this._expected_input_types.bind(this)),this.io.connection_points.set_create_spare_params_from_inputs(!1),this.addPostDirtyHook("setParentDirty",()=>{var e;(e=this.parent())==null||e.setDirty(this)})}parent(){return super.parent()}_expected_input_name(e){let t=this.parent();return(t==null?void 0:t.childExpectedOutputConnectionPointName(e))||`in${e}`}_expected_input_types(){let e=this.parent();return(e==null?void 0:e.childExpectedOutputConnectionPointTypes())||[]}setLines(e){let t=this.parent();return(t==null?void 0:t.setSubnetOutputLines(e,this))||[]}};var Co=(r=>(r.VERTEX="vertex",r.FRAGMENT="fragment",r.LEAVES_FROM_NODES_SHADER="leaves_from_nodes_shader",r))(Co||{});var db=class{constructor(e,t,n,s){this._parent_node=e,this._shader_names=t,this._input_names_for_shader_name_method=n,this._options=s,this._leaves_graph_id=new Map,this._graph_ids_by_shader_name=new Map,this._outputs_by_graph_id=new Map,this._depth_by_graph_id=new Map,this._graph_id_by_depth=new Map,this._graph=this._parent_node.scene().graph}_traverseChildren(){var e;return((e=this._options)==null?void 0:e.traverseChildren)||!1}reset(){this._leaves_graph_id.clear(),this._graph_ids_by_shader_name.clear(),this._outputs_by_graph_id.clear(),this._depth_by_graph_id.clear(),this._graph_id_by_depth.clear(),this._shader_names.forEach(e=>{this._graph_ids_by_shader_name.set(e,new Map)})}shaderNames(){return this._shader_names}input_names_for_shader_name(e,t){return this._input_names_for_shader_name_method(e,t)}traverse(e){this.reset();for(let t of this.shaderNames())this._leaves_graph_id.set(t,new Map);for(let t of this.shaderNames()){this._shader_name=t;for(let n of e)this._findLeavesFromRootNode(n),this._setNodesDepth()}this._depth_by_graph_id.forEach((t,n)=>{t!=null&&je.pushOnArrayAtEntry(this._graph_id_by_depth,t,n)})}leavesFromNodes(e){var t;this._shader_name=Co.LEAVES_FROM_NODES_SHADER,this._graph_ids_by_shader_name.set(this._shader_name,new Map),this._leaves_graph_id.set(this._shader_name,new Map);for(let s of e)this._findLeaves(s);let n=[];return(t=this._leaves_graph_id.get(this._shader_name))==null||t.forEach((s,i)=>{n.push(i)}),this._graph.nodesFromIds(n)}nodesForShaderName(e){let t=[];this._graph_id_by_depth.forEach((i,o)=>{t.push(o)}),t.sort((i,o)=>i-o);let n=[],s=new Map;return t.forEach(i=>{let o=this._graph_id_by_depth.get(i);o&&o.forEach(a=>{var c;if((c=this._graph_ids_by_shader_name.get(e))==null?void 0:c.get(a)){let u=this._graph.nodeFromId(a);this._addNodesWithChildren(u,s,n,e)}})}),n}sortedNodes(){let e=[];this._graph_id_by_depth.forEach((s,i)=>{e.push(i)}),e.sort((s,i)=>s-i);let t=[],n=new Map;return e.forEach(s=>{let i=this._graph_id_by_depth.get(s);if(i)for(let o of i){let a=this._graph.nodeFromId(o);a&&this._addNodesWithChildren(a,n,t)}}),t}_addNodesWithChildren(e,t,n,s){t.get(e.graphNodeId())||(n.push(e),t.set(e.graphNodeId(),!0))}_findLeavesFromRootNode(e){var t;(t=this._graph_ids_by_shader_name.get(this._shader_name))==null||t.set(e.graphNodeId(),!0);let n=this.input_names_for_shader_name(e,this._shader_name);if(n)for(let s of n){let i=e.io.inputs.named_input(s);i&&(je.pushOnArrayAtEntry(this._outputs_by_graph_id,i.graphNodeId(),e.graphNodeId()),this._findLeaves(i))}this._outputs_by_graph_id.forEach((s,i)=>{this._outputs_by_graph_id.set(i,Ce.uniq(s))})}setBlockedInputNames(e,t){this._blockedInputNames=this._blockedInputNames||new Map,this._blockedInputNames.set(e,t)}_findLeaves(e){var t;(t=this._graph_ids_by_shader_name.get(this._shader_name))==null||t.set(e.graphNodeId(),!0);let n=this._findInputs(e),s=Ce.compact(n),o=Ce.uniq(s.map(a=>a.graphNodeId())).map(a=>this._graph.nodeFromId(a));if(o.length>0)for(let a of o)je.pushOnArrayAtEntry(this._outputs_by_graph_id,a.graphNodeId(),e.graphNodeId()),this._findLeaves(a);else this._leaves_graph_id.get(this._shader_name).set(e.graphNodeId(),!0)}getNodeInputs(e){if(this._blockedInputNames==null||!this._blockedInputNames.has(e.type()))return e.io.inputs.inputs();{let t=this._blockedInputNames.get(e.type()),s=e.io.inputs.namedInputConnectionPoints().map(a=>a.name());return Ce.difference(s,t).map(a=>{let c=e.io.inputs.getNamedInputIndex(a);return e.io.inputs.input(c)})}}_findInputs(e){var t;if(this._traverseChildren())if(e.type()==Nn.INPUT){let n=e.parent();return n?this.getNodeInputs(n):[]}else return e.childrenAllowed()?[(t=e.childrenController)==null?void 0:t.outputNode()]:this.getNodeInputs(e);else return this.getNodeInputs(e)}_setNodesDepth(){this._leaves_graph_id.forEach((e,t)=>{e.forEach((n,s)=>{this._setNodeDepth(s)})})}_setNodeDepth(e,t=0){let n=this._depth_by_graph_id.get(e);n!=null?this._depth_by_graph_id.set(e,Math.max(n,t)):this._depth_by_graph_id.set(e,t);let s=this._outputs_by_graph_id.get(e);s&&s.forEach(i=>{this._setNodeDepth(i,t+1)})}};var Pu=class{constructor(e=[]){this._definitions=e,this._errored=!1}get errored(){return this._errored}get error_message(){return this._error_message}uniq(){let e=new Map,t=[];for(let s of this._definitions)if(!this._errored){let i=s.name(),o=e.get(i);o?o.data_type!=s.data_type&&(this._errored=!0,this._error_message=`attempt to create '${s.name()}' with types '${s.data_type}' by node '${s.node.path()}', when there is already an existing with type ${o.data_type} from node '${o.node.path()}'`,console.warn("emitting error message:",this._error_message)):(e.set(i,s),t.push(i))}let n=[];for(let s of t){let i=e.get(s);i&&n.push(i)}return n}};var Nc=(r=>(r.ATTRIBUTE="attribute",r.FUNCTION="function",r.UNIFORM="uniform",r.VARYING="varying",r))(Nc||{}),pz=class{constructor(e,t,n,s){this._definition_type=e,this._data_type=t,this._node=n,this._name=s}get definition_type(){return this._definition_type}get data_type(){return this._data_type}get node(){return this._node}name(){return this._name}collection_instance(){return new Pu}};var pb=class extends pz{constructor(e,t){super("function",kt.FLOAT,e,t);this._node=e,this._name=t}get line(){return this.name()}};var fb=class{constructor(){this._param_configs=[]}reset(){this._param_configs=[]}push(e){this._param_configs.push(e)}list(){return this._param_configs}};var mb=class{constructor(e){this._shader_name=e,this._definitionsByNodeId=new Map,this._bodyLinesByNodeId=new Map}get shader_name(){return this._shader_name}addDefinitions(e,t){this._addDefinitionsForNodeId(e.graphNodeId(),t)}_addDefinitionsForNodeId(e,t){for(let n of t)je.pushOnArrayAtEntry(this._definitionsByNodeId,e,n)}definitions(e){return this._definitionsByNodeId.get(e.graphNodeId())}traverseDefinitions(e){this._definitionsByNodeId.forEach(t=>{for(let n of t)e(n)})}addBodyLines(e,t,n){this._addBodyLinesForNodeId(e.graphNodeId(),t)}_addBodyLinesForNodeId(e,t,n){let s=!0;n&&n.makeUniq!=null&&(s=n.makeUniq);let i=[];if(s){let o=this._bodyLinesByNodeId.get(e);for(let a of t)o&&o.includes(a)||i.push(a)}else for(let o of t)i.push(o);for(let o of i)je.pushOnArrayAtEntry(this._bodyLinesByNodeId,e,o)}bodyLines(e){return this._bodyLinesByNodeId.get(e.graphNodeId())}};var _b=class{constructor(e,t,n){this._shaderNames=e,this._currentShaderName=t,this._assembler=n,this._linesControllerByShaderName=new Map;for(let s of this._shaderNames)this._linesControllerByShaderName.set(s,new mb(s))}assembler(){return this._assembler}linesController(e){return this._linesControllerByShaderName.get(e)}shaderNames(){return this._shaderNames}setCurrentShaderName(e){this._currentShaderName=e}currentShaderName(){return this._currentShaderName}addDefinitions(e,t,n){if(t.length==0)return;n=n||this._currentShaderName;let s=this._linesControllerByShaderName.get(n);s&&s.addDefinitions(e,t)}definitions(e,t){let n=this._linesControllerByShaderName.get(e);if(n)return n.definitions(t)}traverseDefinitions(e,t){let n=this._linesControllerByShaderName.get(e);n&&n.traverseDefinitions(t)}addBodyLines(e,t,n,s){if(t.length==0)return;n=n||this._currentShaderName;let i=this._linesControllerByShaderName.get(n);i&&i.addBodyLines(e,t,s)}bodyLines(e,t){let n=this._linesControllerByShaderName.get(e);if(n)return n.bodyLines(t)}};var Kt=(r=>(r.FUNCTION_DECLARATION="function_declaration",r.DEFINE="define",r.BODY="body",r))(Kt||{});var _de={[Kt.FUNCTION_DECLARATION]:"",[Kt.DEFINE]:";",[Kt.BODY]:";"},fz={[Kt.FUNCTION_DECLARATION]:"",[Kt.DEFINE]:"",[Kt.BODY]:"	"},gde="{",yde="}",ts=class{static node_comment(e,t){let n=`// ${e.path()}`,s=fz[t];if(t==Kt.BODY){let i=this.nodeDistanceToMaterial(e);e.type()==Nn.OUTPUT&&(i+=1),s=s.repeat(i)}return t==Kt.BODY&&(n=`${s}${n}`),n}static line_wrap(e,t,n){let s=!0;(t.indexOf("#if")==0||t.indexOf("#endif")==0)&&(s=!1);let i=fz[n];if(n==Kt.BODY&&(i=i.repeat(this.nodeDistanceToMaterial(e))),t=`${i}${t}`,s){let o=t[t.length-1],a=_de[n],c=t.trim().length==0,l=t.trim().startsWith("//");o!=a&&o!=gde&&o!=yde&&!c&&!l&&(t+=a)}return t}static post_line_separator(e){return e==Kt.BODY?"	":""}static nodeDistanceToMaterial(e){let t=e.parent();return t?t.context()!=e.context()?1:1+this.nodeDistanceToMaterial(t):0}};var gb=class{constructor(e,t,n){this._nodeTraverser=e,this._root_nodes_for_shader_method=t,this._assembler=n,this._param_configs_controller=new fb,this._param_configs_set_allowed=!0,this._lines=new Map}nodeTraverser(){return this._nodeTraverser}shaderNames(){return this._nodeTraverser.shaderNames()}buildFromNodes(e,t,n){this._nodeTraverser.traverse(e);let s=new Map;for(let a of this.shaderNames()){let c=this._nodeTraverser.nodesForShaderName(a);s.set(a,c)}let i=this._nodeTraverser.sortedNodes();for(let a of this.shaderNames()){let c=this._root_nodes_for_shader_method(a,e);for(let l of c)je.pushOnArrayAtEntry(s,a,l)}let o=new Map;for(let a of i)o.set(a.graphNodeId(),!0);for(let a of e)o.get(a.graphNodeId())||(i.push(a),o.set(a.graphNodeId(),!0));for(let a of i)a.reset_code();for(let a of t)a.reset_code();this._shadersCollectionController=new _b(this.shaderNames(),this.shaderNames()[0],this._assembler),this.reset();for(let a of this.shaderNames()){let c=s.get(a)||[];if(c=Ce.uniq(c),this._shadersCollectionController.setCurrentShaderName(a),c)for(let l of c)l.setLines(this._shadersCollectionController)}if(this._param_configs_set_allowed){for(let a of t)try{a.states.error.clear(),a.setParamConfigs()}catch(c){let l=c.message||"failed to create spare param";throw a.states.error.set(l),new Error(`${a.name()} cannot create spare parameter`)}this.setParamConfigs(t)}this._setCodeLines(i,n)}shadersCollectionController(){return this._shadersCollectionController}disallow_new_param_configs(){this._param_configs_set_allowed=!1}allow_new_param_configs(){this._param_configs_set_allowed=!0}reset(){for(let e of this.shaderNames()){let t=new Map;this._lines.set(e,t)}}param_configs(){return this._param_configs_controller.list()||[]}lines(e,t){var n;return((n=this._lines.get(e))==null?void 0:n.get(t))||[]}all_lines(){return this._lines}setParamConfigs(e){this._param_configs_controller.reset();for(let t of e){let n=t.param_configs();if(n)for(let s of n)this._param_configs_controller.push(s)}}_setCodeLines(e,t){let n;if(this._shadersCollectionController&&t&&t.otherShadersCollectionController)for(let s of t.otherShadersCollectionController.shaderNames())t.otherShadersCollectionController.traverseDefinitions(s,i=>{n=n||[],n.push(i)});for(let s of this.shaderNames())this._addCodeLines(e,s,n)}_addCodeLines(e,t,n){this.addDefinitions(e,t,Nc.FUNCTION,Kt.FUNCTION_DECLARATION,n),this.addDefinitions(e,t,Nc.UNIFORM,Kt.DEFINE,n),this.addDefinitions(e,t,Nc.VARYING,Kt.DEFINE,n),this.addDefinitions(e,t,Nc.ATTRIBUTE,Kt.DEFINE,n),this.add_code_line_for_nodes_and_line_type(e,t,Kt.BODY)}addDefinitions(e,t,n,s,i){if(!this._shadersCollectionController)return;let o=[];for(let a of e){let c=this._shadersCollectionController.definitions(t,a);if(c){c=c.filter(l=>l.definition_type==n);for(let l of c)o.push(l)}}if(i){let a=i.filter(c=>c.definition_type==n);for(let c of a)o.push(c)}if(o.length>0){let a=new Pu(o),c=a.uniq();if(a.errored)throw`code builder error: ${a.error_message}`;let l=new Map,u=new Map;for(let d of c){let p=d.node.graphNodeId();u.has(p)||u.set(p,!0),je.pushOnArrayAtEntry(l,p,d)}let h=this._lines.get(t);u.forEach((d,p)=>{let _=l.get(p);if(_){let f=_[0];if(f){let m=ts.node_comment(f.node,s);je.pushOnArrayAtEntry(h,s,m);for(let x of _){let b=ts.line_wrap(f.node,x.line,s);je.pushOnArrayAtEntry(h,s,b)}let g=ts.post_line_separator(s);je.pushOnArrayAtEntry(h,s,g)}}})}}add_code_line_for_nodes_and_line_type(e,t,n){e=e.filter(i=>{if(this._shadersCollectionController){let o=this._shadersCollectionController.bodyLines(t,i);return o&&o.length>0}});var s=e.length;for(let i=0;i<s;i++){let o=i==e.length-1;this.add_code_line_for_node_and_line_type(e[i],t,n,o)}}add_code_line_for_node_and_line_type(e,t,n,s){if(!this._shadersCollectionController)return;let i=this._shadersCollectionController.bodyLines(t,e);if(i&&i.length>0){let o=this._lines.get(t),a=ts.node_comment(e,n);if(je.pushOnArrayAtEntry(o,n,a),i.forEach(c=>{c=ts.line_wrap(e,c,n),je.pushOnArrayAtEntry(o,n,c)}),!(n==Kt.BODY&&s)){let c=ts.post_line_separator(n);je.pushOnArrayAtEntry(o,n,c)}}}};var xde={makeUniq:!1};function mz(r){return{visibleIf:Ce.range(r+1,10).map(e=>({inputsCount:e}))}}function ns(r){return W.INTEGER(zx.indexOf(kt.FLOAT),{menu:{entries:zx.map((e,t)=>({name:e,value:t}))},separatorBefore:!0,...mz(r)})}function rs(r){return W.STRING(`input${r}`,{...mz(r)})}function gf(r){return class extends r{constructor(){super(...arguments);this.inputs=W.FOLDER(),this.inputsCount=W.INTEGER(1,{range:[0,10],rangeLocked:[!0,!0]}),this.inputType0=ns(0),this.inputName0=rs(0),this.inputType1=ns(1),this.inputName1=rs(1),this.inputType2=ns(2),this.inputName2=rs(2),this.inputType3=ns(3),this.inputName3=rs(3),this.inputType4=ns(4),this.inputName4=rs(4),this.inputType5=ns(5),this.inputName5=rs(5),this.inputType6=ns(6),this.inputName6=rs(6),this.inputType7=ns(7),this.inputName7=rs(7),this.inputType8=ns(8),this.inputName8=rs(8),this.inputType9=ns(9),this.inputName9=rs(9),this.spare=W.FOLDER()}}}var vde=class extends gf(Ye){},yb=class extends Mu{constructor(){super(...arguments);this._childrenControllerContext=se.GL}initializeNode(){var e;(e=this.childrenController)==null||e.setOutputNodeFindMethod(()=>this.nodesByType(hb.type())[0]),this.io.connection_points.set_input_name_function(this._expectedInputName.bind(this)),this.io.connection_points.set_expected_input_types_function(this._expectedInputTypes.bind(this)),this.io.connection_points.set_expected_output_types_function(this._expectedOutputTypes.bind(this)),this.io.connection_points.set_output_name_function(this._expectedOutputName.bind(this))}_expectedInputTypes(){return[]}_expectedInputName(e){return"default"}_expectedOutputTypes(){return this._expectedInputTypes()}_expectedOutputName(e){return this._expectedInputName(e)}childExpectedInputConnectionPointTypes(){return this._expectedInputTypes()}childExpectedOutputConnectionPointTypes(){return this._expectedOutputTypes()}childExpectedInputConnectionPointName(e){return this._expectedInputName(e)}childExpectedOutputConnectionPointName(e){return this._expectedOutputName(e)}createNode(e,t){return super.createNode(e,t)}children(){return super.children()}nodesByType(e){return super.nodesByType(e)}_setLinesPreBlock(e){let t=[],n=this.io.inputs.namedInputConnectionPoints();for(let s=0;s<n.length;s++){let i=n[s],o=i.type(),a=this.glVarName(i.name()),c=bi.any(this.variableForInput(i.name())),l=`${o} ${a} = ${c}`;t.push(l)}e.addBodyLines(this,t)}setLinesBlockStart(e){e.addBodyLines(this,["if(true){"])}setSubnetInputLines(e,t){let n=this.io.connections.inputConnections();if(!n)return;let s=[];for(let i of n)if(i){let o=i.dest_connection_point(),a=bi.any(this.variableForInput(o.name())),c=o.type(),l=t.glVarName(o.name()),u=`	${c} ${l} = ${a}`;s.push(u)}e.addBodyLines(t,s)}setSubnetOutputLines(e,t){let n=t.io.connections.inputConnections();if(!n)return;let s=[];for(let i of n)if(i){let o=i.dest_connection_point(),a=bi.any(t.variableForInput(o.name())),l=`	${this.glVarName(o.name())} = ${a}`;s.push(l)}e.addBodyLines(t,s)}setLines(e){let t=this._runCodeBuilder(e);if(!t)return;let n=e.currentShaderName(),s=t.lines(n,Kt.BODY);this._setLinesPreBlock(e),this.setLinesBlockStart(e),e.addBodyLines(this,this._sanitizeBodyLines(s),void 0,xde),e.addBodyLines(this,["}"])}_runCodeBuilder(e){let t=this.nodesByType(Nn.OUTPUT),n=this.materialNode();if(!n)return;t.length==0&&n.states.error.set(`${this.path()}:one output node is required`),t.length>1&&n.states.error.set(`${this.path()}:only one output node allowed`);let i=t[0].io.inputs.namedInputConnectionPoints().map(u=>u.name()),o=e.assembler(),a=new db(this,e.shaderNames(),(u,h)=>i),c=new gb(a,(u,h)=>o.rootNodesByShaderName(u,h),o),l=[];return c.buildFromNodes(t,l),this._addCodeBuilderDefinition(c,e),c}_addCodeBuilderDefinition(e,t){let n=e.shadersCollectionController();if(!n)return;let s=t.currentShaderName();n.setCurrentShaderName(s);let i=t.shaderNames();for(let o of i){let a=[];n.traverseDefinitions(o,c=>{let l=!(c instanceof pb),u=o==s;(l||u)&&a.push(c)}),t.addDefinitions(this,a,o)}if(s!=Co.VERTEX){let o=this.nodesByType(lb.ATTRIBUTE),a=[];for(let c of o){let l=n.bodyLines(Co.VERTEX,c);l&&a.push(...l)}t.addBodyLines(this,a,Co.VERTEX)}}_sanitizeBodyLines(e){let t=ts.nodeDistanceToMaterial(this),n="	".repeat(t);return e.map(s=>{let i=s.trim();return i.length==0?"":`${n}${i}`})}};var _z=class extends gf(Ye){},g4e=new _z;function gz(r,e,t){class n extends gf(Ye){}let s=ks.ParamsConfig(e,n);class i extends yb{constructor(){super(...arguments);this.paramsConfig=s,this.polyNodeController=new t(this,e)}static type(){return r}_expectedInputTypes(){var a,c;return((c=(a=e.inputs)==null?void 0:a.typed)==null?void 0:c.types.map(l=>l.type))||[]}_expectedInputName(a){var c,l;return(((l=(c=e.inputs)==null?void 0:c.typed)==null?void 0:l.types.map(h=>h.name))||[])[a]}_expectedOutputTypes(){return this._expectedInputTypes()}_expectedOutputName(a){return this._expectedInputName(a)}}return i}var Nu=class{constructor(r,e){this.node=r,this._definition=e}initializeNode(){this._initInputs(),this.node.lifecycle.onAfterCreated(()=>{this.createChildNodesFromDefinition()})}_initInputs(){let r=this._definition.inputs;if(!r)return;let e=r.simple;e&&this.node.io.inputs.setCount(e.min,e.max)}static setupParamsConfig(r,e){if(!!e.params)for(let t of e.params){let n=t.name,s=t.type,i=t.initValue,o=t.options;r[n]=new bn(s,i,o)}}createChildNodesFromDefinition(){let r=this._definition.nodes;if(!r)return;let e=this.node.scene().loadingController.loaded();e&&this.node.scene().loadingController.markAsLoading();let t=new vo({}),s=new wu().dispatchNonPolyNode(this.node);s.create_nodes(t,r);let i=this._definition.ui;i&&s.processNodesUiData(t,i),e&&this.node.scene().loadingController.markAsLoaded()}static inputsData(r){if(r.io.inputs.hasNamedInputs()){let e=r.io.inputs;return{typed:{types:Ce.compact(e.namedInputConnectionPoints()).map(n=>({name:n.name(),type:n.type()}))}}}else return{simple:{min:r.io.inputs.minCount(),max:r.io.inputs.maxInputsCount()}}}static polyNodeData(r,e){let n=new nb().dispatchNode(r),s=n.data({showPolyNodesData:!0}),i=n.uiData({showPolyNodesData:!0}),o=e||this.inputsData(r);return{metadata:{version:{polyNode:1,polygonjs:1},createdAt:1},nodeContext:r.context(),inputs:o,params:r.params.non_spare.filter(c=>c.parentParam()==null).map(c=>({name:c.name(),type:c.type(),initValue:c.defaultValueSerialized(),rawInput:c.rawInputSerialized(),options:c.options.current()})),nodes:s.nodes,ui:i.nodes}}static _createNodeClass(r,e,t){switch(r){case se.ANIM:return uz(e,t,Nu);case se.GL:return gz(e,t,Nu);case se.OBJ:return az(e,t,Nu);case se.SOP:return rz(e,t,Nu)}}static createNodeClassAndRegister(r){let{context:e,type:t,data:n}=r,s=this._createNodeClass(e,t,n);if(s){let i=this._definitionRegister.get(e);i||(i=new Map,this._definitionRegister.set(e,i)),i.set(t,n),ie.registerNode(s,"polyNodes",{polyNode:!0})}}static definition(r,e){var t;return(t=this._definitionRegister.get(r))==null?void 0:t.get(e)}},xb=Nu;xb._definitionRegister=new Map;var Fe=class{constructor(e){this.param=e,this._requireDependency=!1}requireDependency(){return this._requireDependency}node(){return this._node=this._node||this.param.node}static requiredArguments(){return console.warn("Expression.Method._Base.required_arguments virtual method call. Please override"),[]}static optionalArguments(){return[]}static minAllowedArgumentsCount(){return this.requiredArguments().length}static maxAllowedArgumentsCount(){return this.minAllowedArgumentsCount()+this.optionalArguments().length}static allowedArgumentsCount(e){return e>=this.minAllowedArgumentsCount()&&e<=this.maxAllowedArgumentsCount()}processArguments(e){throw"Expression.Method._Base.process_arguments virtual method call. Please override"}async getReferencedNodeContainer(e){let t=this.getReferencedNode(e);if(t){let n;if(t.isDirty()?n=await t.compute():n=t.containerController.container(),n&&n.coreContent())return n;throw`referenced node invalid: ${t.path()}`}else throw`invalid input (${e})`}getReferencedParam(e,t){let n=this.node();return n?Qe.findParam(n,e,t):null}findReferencedGraphNode(e,t){if(q.isNumber(e)){let s=e,i=this.node();if(i)return i.io.inputs.inputGraphNode(s)}else{let s=e;return this.getReferencedNode(s,t)}return null}getReferencedNode(e,t){let n=null,s=this.node();if(q.isString(e)){if(s){let i=e;n=Qe.findNode(s,i,t)}}else if(s){let i=e;n=s.io.inputs.input(i)}return n||null}findDependency(e){return null}createDependencyFromIndexOrPath(e){let t=new mo,n=this.findReferencedGraphNode(e,t);return n?this.createDependency(n,e,t):(ie.warn("node not found for path",e),null)}createDependency(e,t,n){return ho.create(this.param,t,e,n)}};var vb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","arguments list"],["number","index"]]}processArguments(e){return new Promise((t,n)=>{if(e.length==2){let s=e[0],i=e[1],o=s.split(" ")[i];t(o)}else t(0)})}};var bb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","arguments list"]]}processArguments(e){return new Promise((t,n)=>{if(e.length==1){let i=e[0].split(" ").length;t(i)}else t(0)})}};var bde=["min","max","size","center"],wde=["x","y","z"],wb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","path to node"],["string","vector name, min, max, size or center"],["string","component_name, x,y or z"]]}findDependency(e){return this.createDependencyFromIndexOrPath(e)}processArguments(e){let t=0;return new Promise(async(n,s)=>{if(e.length>=1){let i=e[0],o=e[1],a=e[2],c=null;try{c=await this.getReferencedNodeContainer(i)}catch(l){s(l)}c&&(t=this._get_value_from_container(c,o,a),n(t))}else n(0)})}_get_value_from_container(e,t,n){let s=e.boundingBox();if(!t)return s;if(bde.indexOf(t)>=0){let i=new A;switch(t){case"size":s.getSize(i);break;case"center":s.getCenter(i);break;default:i=s[t]}return n?wde.indexOf(n)>=0?i[n]:-1:i}else return-1}};var Eb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","path to node"],["string","component_name, x,y or z"]]}findDependency(e){return this.createDependencyFromIndexOrPath(e)}processArguments(e){return new Promise(async(t,n)=>{if(e.length>=1){let s=e[0],i=e[1],o=null;try{o=await this.getReferencedNodeContainer(s)}catch(a){n(a)}if(o){let a=o.boundingBox(),c=a.min.clone().add(a.max).multiplyScalar(.5);if(i){let l=c[i];l!=null?t(l):t(0)}else t(c)}}else t(0)})}};var Cb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","path to param"]]}findDependency(e){let t=new mo,n=this.getReferencedParam(e,t);return n?(this._referencedParam=n,this.createDependency(n,e,t)):null}async processArguments(e){return new Promise(async(t,n)=>{let s=0;if(e.length==1){let i=e[0],o=this._referencedParam||this.getReferencedParam(i);if(o){o.isDirty()&&await o.compute();let a=o.value;a!=null&&(s=a,t(s))}else n(0)}})}};var Sb=(r=>(r.COPY="copy",r))(Sb||{});function yz(r){return r&&r.type()==jv.COPY&&r.type()==Sb.COPY}var Ab=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","path to copy"],["integer","default value"]]}static optionalArguments(){return[["string","attribute name (optional)"]]}findDependency(e){let t=this.findReferencedGraphNode(e);if(yz(t)){let n=t.stampNode();return this.createDependency(n,e)}return null}processArguments(e){return new Promise((t,n)=>{if(e.length>=1){let s=e[0],i=e[1]||0,o=e[2],a=this.node(),c=a?Qe.findNode(a,s):null,l;yz(c)&&(l=c.stampValue(o)),l==null&&(l=i),t(l)}else t(0)})}};var Tb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0,this._resolution=new G}static requiredArguments(){return[["string","path to node"],["string","component_name: x or y"]]}findDependency(e){return this.createDependencyFromIndexOrPath(e)}async processArguments(e){if(e.length==1||e.length==2){let t=e[0],n=e[1],s=await this.getReferencedNodeContainer(t);if(s){let i=s.resolution();if(n){if([0,"0","x"].includes(n))return i[0];if([1,"1","y"].includes(n))return i[1]}else return this._resolution.set(i[0],i[1]),this._resolution}}return-1}};var So=class{static isChrome(){return navigator&&navigator.userAgent!=null&&navigator.userAgent.indexOf("Chrome")!=-1}static isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}static isiOS(){return/(iPad|iPhone|iPod)/g.test(navigator.userAgent)}static isAndroid(){return/(Android)/g.test(navigator.userAgent)}static isTouchDevice(){var e=document.createElement("div");return e.setAttribute("ongesturestart","return;"),typeof e.ongesturestart=="function"}};var Mb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[]}async processArguments(e){return new Promise(async(t,n)=>{t(So.isMobile())})}};var Pb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[]}async processArguments(e){return new Promise(async(t,n)=>{t(So.isTouchDevice())})}};var Nb=class extends Fe{static requiredArguments(){return[["string","javascript expression"]]}async processArguments(e){let t=0;if(e.length==1){let n=e[0];if(this._function=this._function||this._create_function(n),this._function)try{t=this._function(this.param.scene(),this.param.node,this.param)}catch(s){console.warn("expression error"),console.warn(s)}}return t}_create_function(e){return new Function("scene","node","param",`return ${e}`)}};var xz=3,Rb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","path to node"],["string","attribute name"],["index","object index"]]}findDependency(e){return this.createDependencyFromIndexOrPath(e)}processArguments(e){return new Promise(async(t,n)=>{if(e.length==xz){let s=e[0],i=e[1],o=e[2],a=null;try{a=await this.getReferencedNodeContainer(s)}catch(c){n(c)}if(a){let c=this._get_value_from_container(a,i,o);t(c)}}else console.warn(`${e.length} given when expected ${xz}`),t(0)})}_get_value_from_container(e,t,n){let s=e.coreContent();if(s){let i=s.coreObjects()[n];return i?i.attribValue(t):0}else return null}};var Ob=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","path to node"]]}findDependency(e){return this.createDependencyFromIndexOrPath(e)}processArguments(e){return new Promise(async(t,n)=>{if(e.length==1){let s=e[0],i;try{i=await this.getReferencedNodeContainer(s)}catch(o){n(o);return}if(i){let o=i.objectsCount();t(o)}}else t(0)})}};var Ib=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","path to node"]]}findDependency(e){let t=this.findReferencedGraphNode(e);if(t){let n=t;if(n.nameController){let s=n.nameController.graphNode();return this.createDependency(s,e)}}return null}processArguments(e){return new Promise((t,n)=>{if(e.length==1){let s=e[0],i=this.getReferencedNode(s);if(i){let o=i.name(),a=Ae.tailDigits(o);t(a)}else t(0)}else t(0)})}};var Db=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","path to node"]]}findDependency(e){let t=this.findReferencedGraphNode(e);if(t){let n=t;if(n.nameController){let s=n.nameController.graphNode();return this.createDependency(s,e)}}return null}processArguments(e){return new Promise((t,n)=>{if(e.length==1){let s=e[0],i=this.getReferencedNode(s);if(i){let o=i.name();t(o)}else t(0)}else t(0)})}};var Lb=class extends Fe{static requiredArguments(){return[["string","number"]]}processArguments(e){return new Promise(t=>{let n=e[0]||2,o=`${e[1]||0}`.padStart(n,"0");t(o)})}};var Bb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[]}async processArguments(e){return ie.playerMode()}};var vz=3,kb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","path to node"],["string","attribute name"],["index","point index"]]}findDependency(e){return this.createDependencyFromIndexOrPath(e)}processArguments(e){return new Promise(async(t,n)=>{if(e.length==vz){let s=e[0],i=e[1],o=e[2],a=null;try{a=await this.getReferencedNodeContainer(s)}catch(c){n(c)}if(a){let c=this._get_value_from_container(a,i,o);t(c)}}else console.warn(`${e.length} given when expected ${vz}`),t(0)})}_get_value_from_container(e,t,n){let s=e.coreContent();if(s){let i=s.points()[n];return i?i.attribValue(t):0}else return null}};var Fb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0}static requiredArguments(){return[["string","path to node"]]}findDependency(e){return this.createDependencyFromIndexOrPath(e)}processArguments(e){return new Promise(async(t,n)=>{if(e.length==1){let s=e[0],i;try{i=await this.getReferencedNodeContainer(s)}catch(o){n(o);return}if(i){let o=i.pointsCount();t(o)}}else t(0)})}};var Ub=class extends Fe{static requiredArguments(){return[["string","string to count characters of"]]}async processArguments(e){let t=0;return e.length==1&&(t=e[0].length),t}};var zb=class extends Fe{static requiredArguments(){return[]}async processArguments(e){let t="";for(let n of e)n==null&&(n=""),t+=`${n}`;return t}};var Vb=class extends Fe{static requiredArguments(){return[["string","string to get index from"],["string","char to find index of"]]}async processArguments(e){let t=-1;if(e.length==2){let n=e[0],s=e[1];t=n.indexOf(s)}return t}};function Ede(r){return r==null?"":q.isString(r)?r:`${r}`}function bz(r,e){return r==null?e:q.isNumber(r)?r:parseInt(r)}var qb=class extends Fe{static requiredArguments(){return[["string","string to get range from"],["integer","range start"],["integer","range size"]]}async processArguments(e){let t="",n=Ede(e[0]),s=bz(e[1],0),i=bz(e[2],1);return n&&(t=n.substring(s,s+i)),t}};var Gb=class extends Fe{constructor(){super(...arguments);this._requireDependency=!0,this._windowSize=new G}static requiredArguments(){return[[]]}findDependency(e){return this.param.addGraphInput(this.param.scene().windowController.graphNode()),null}processArguments(e){return new Promise(t=>{this._windowSize.set(window.innerWidth,window.innerHeight),t(this._windowSize)})}};var Hb=class{static run(e){e.expressionsRegister.register(vb,"arg"),e.expressionsRegister.register(bb,"argc"),e.expressionsRegister.register(wb,"bbox"),e.expressionsRegister.register(Eb,"centroid"),e.expressionsRegister.register(Cb,"ch"),e.expressionsRegister.register(Ab,"copy"),e.expressionsRegister.register(Tb,"copRes"),e.expressionsRegister.register(Mb,"isDeviceMobile"),e.expressionsRegister.register(Pb,"isDeviceTouch"),e.expressionsRegister.register(Nb,"js"),e.expressionsRegister.register(Rb,"object"),e.expressionsRegister.register(Ob,"objectsCount"),e.expressionsRegister.register(Ib,"opdigits"),e.expressionsRegister.register(Db,"opname"),e.expressionsRegister.register(Lb,"padzero"),e.expressionsRegister.register(Bb,"playerMode"),e.expressionsRegister.register(kb,"point"),e.expressionsRegister.register(Fb,"pointsCount"),e.expressionsRegister.register(Ub,"strCharsCount"),e.expressionsRegister.register(zb,"strConcat"),e.expressionsRegister.register(Vb,"strIndex"),e.expressionsRegister.register(qb,"strSub"),e.expressionsRegister.register(Gb,"windowSize")}};var Wb=class extends Gt{constructor(){super(...arguments);this._cookWithoutInputsBound=this._cookWithoutInputs.bind(this)}static context(){return se.EVENT}initializeBaseNode(){this.uiData.setLayoutHorizontal(),this.addPostDirtyHook("cookWithoutInputsOnDirty",this._cookWithoutInputsBound),this.io.inputs.setDependsOnInputs(!1),this.io.connections.initInputs(),this.io.connection_points.spare_params.initializeNode()}_cookWithoutInputs(){this.cookController.cookMainWithoutInputs()}cook(){this.cookController.endCook()}processEventViaConnectionPoint(e,t){t.event_listener?t.event_listener(e):this.processEvent(e)}processEvent(e){}async dispatchEventToOutput(e,t){this.run_on_dispatch_hook(e,t);let n=this.io.outputs.getOutputIndex(e);if(n>=0){let s=this.io.connections.outputConnectionsByOutputIndex(n);if(s){let i;if(!ie.playerMode()){let o=this.scene().eventsDispatcher.connectionTriggerDispatcher;s.forEach(a=>{o.dispatchTrigger(a)})}s.forEach(o=>{i=o.node_dest;let a=i.io.inputs.namedInputConnectionPoints()[o.input_index];i.processEventViaConnectionPoint(t,a)})}}else console.warn(`requested output '${e}' does not exist on node '${this.path()}'`)}onDispatch(e,t){this._on_dispatch_hooks_by_output_name=this._on_dispatch_hooks_by_output_name||new Map,je.pushOnArrayAtEntry(this._on_dispatch_hooks_by_output_name,e,t)}run_on_dispatch_hook(e,t){if(this._on_dispatch_hooks_by_output_name){let n=this._on_dispatch_hooks_by_output_name.get(e);if(n)for(let s of n)s(t)}}};var jb=class extends Wb{constructor(){super(...arguments);this._controls_by_viewer=new Map}async applyControls(e,t){let n=t.canvas();if(!n)return;let s=await this.createControlsInstance(e,n),i=this._controls_by_viewer.get(t);i&&i.dispose(),this._controls_by_viewer.set(t,s);let a=ie.performance.performanceManager().now();return s.name=`${this.path()}:${e.name}:${a}:${this.controls_id()}`,await this.params.evalAll(),this.setupControls(s),s}controls_id(){return JSON.stringify(this.params.all.map(e=>e.valueSerialized()))}cook(){this._controls_by_viewer.forEach(e=>{this.setupControls(e)}),this.cookController.endCook()}};var wz={type:"change"},$b={type:"start"},Xb={type:"end"},Yb=class extends pr{constructor(e,t){super();t===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),t===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new A,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keyMode="pan",this.keyRotateSpeedVertical=1,this.keyRotateSpeedHorizontal=1,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Di.ROTATE,MIDDLE:Di.DOLLY,RIGHT:Di.PAN},this.touches={ONE:Li.ROTATE,TWO:Li.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(O){O.addEventListener("keydown",ft),this._domElementKeyEvents=O},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(wz),n.update(),i=s.NONE},this.update=function(){let O=new A,ce=new dt().setFromUnitVectors(e.up,new A(0,1,0)),Ne=ce.clone().invert(),ge=new A,k=new dt,me=2*Math.PI,de=!1;return function(){let we=n.object.position;if(O.copy(we).sub(n.target),O.applyQuaternion(ce),a.setFromVector3(O),n.autoRotate&&i===s.NONE&&R(C()),n.enableDamping){let qe=c.theta*n.dampingFactor,wt=c.phi*n.dampingFactor;qe<o&&wt<o?de||(n.dispatchEvent(Xb),de=!0):de=!1,a.theta+=qe,a.phi+=wt}else a.theta+=c.theta,a.phi+=c.phi;let Re=n.minAzimuthAngle,ue=n.maxAzimuthAngle;return isFinite(Re)&&isFinite(ue)&&(Re<-Math.PI?Re+=me:Re>Math.PI&&(Re-=me),ue<-Math.PI?ue+=me:ue>Math.PI&&(ue-=me),Re<ue?a.theta=Math.max(Re,Math.min(ue,a.theta)):a.theta=a.theta>(Re+ue)/2?Math.max(Re,a.theta):Math.min(ue,a.theta)),a.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=l,a.radius=Math.max(n.minDistance,Math.min(n.maxDistance,a.radius)),n.enableDamping===!0?n.target.addScaledVector(u,n.dampingFactor):n.target.add(u),O.setFromSpherical(a),O.applyQuaternion(Ne),we.copy(n.target).add(O),n.object.lookAt(n.target),n.enableDamping===!0?(c.theta*=1-n.dampingFactor,c.phi*=1-n.dampingFactor,u.multiplyScalar(1-n.dampingFactor)):(c.set(0,0,0),u.set(0,0,0)),l=1,h||ge.distanceToSquared(n.object.position)>o||8*(1-k.dot(n.object.quaternion))>o?(n.dispatchEvent(wz),ge.copy(n.object.position),k.copy(n.object.quaternion),h=!1,!0):!1}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Y),n.domElement.removeEventListener("pointerdown",he),n.domElement.removeEventListener("pointercancel",We),n.domElement.removeEventListener("wheel",Nt),n.domElement.ownerDocument.removeEventListener("pointermove",Ee),n.domElement.ownerDocument.removeEventListener("pointerup",ve),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",ft)};let n=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},i=s.NONE,o=1e-6,a=new ad,c=new ad,l=1,u=new A,h=!1,d=new G,p=new G,_=new G,f=new G,m=new G,g=new G,x=new G,b=new G,v=new G,y=[],E={};function C(){return 2*Math.PI/60/60*n.autoRotateSpeed}function M(){return Math.pow(.95,n.zoomSpeed)}function R(O){c.theta-=O}function N(O){c.phi-=O}let w=function(){let O=new A;return function(Ne,ge){O.setFromMatrixColumn(ge,0),O.multiplyScalar(-Ne),u.add(O)}}(),T=function(){let O=new A;return function(Ne,ge){n.screenSpacePanning===!0?O.setFromMatrixColumn(ge,1):(O.setFromMatrixColumn(ge,0),O.crossVectors(n.object.up,O)),O.multiplyScalar(Ne),u.add(O)}}(),F=function(){let O=new A;return function(Ne,ge){let k=n.domElement;if(n.object.isPerspectiveCamera){let me=n.object.position;O.copy(me).sub(n.target);let de=O.length();de*=Math.tan(n.object.fov/2*Math.PI/180),w(2*Ne*de/k.clientHeight,n.object.matrix),T(2*ge*de/k.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(w(Ne*(n.object.right-n.object.left)/n.object.zoom/k.clientWidth,n.object.matrix),T(ge*(n.object.top-n.object.bottom)/n.object.zoom/k.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function L(O){n.object.isPerspectiveCamera?l/=O:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*O)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function V(O){n.object.isPerspectiveCamera?l*=O:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/O)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function B(O){d.set(O.clientX,O.clientY)}function H(O){x.set(O.clientX,O.clientY)}function z(O){f.set(O.clientX,O.clientY)}function X(O){p.set(O.clientX,O.clientY),_.subVectors(p,d).multiplyScalar(n.rotateSpeed);var ce=n.domElement;R(2*Math.PI*_.x/ce.clientHeight),N(2*Math.PI*_.y/ce.clientHeight),d.copy(p),n.update()}function ee(O){b.set(O.clientX,O.clientY),v.subVectors(b,x),v.y>0?L(M()):v.y<0&&V(M()),x.copy(b),n.update()}function le(O){m.set(O.clientX,O.clientY),g.subVectors(m,f).multiplyScalar(n.panSpeed),F(g.x,g.y),f.copy(m),n.update()}function re(O){O.deltaY<0?V(M()):O.deltaY>0&&L(M()),n.update()}function Pe(O){let ce=!1;if(n.keyMode=="pan")switch(O.code){case n.keys.UP:F(0,n.keyPanSpeed),ce=!0;break;case n.keys.BOTTOM:F(0,-n.keyPanSpeed),ce=!0;break;case n.keys.LEFT:F(n.keyPanSpeed,0),ce=!0;break;case n.keys.RIGHT:F(-n.keyPanSpeed,0),ce=!0;break}else switch(O.code){case n.keys.UP:N(n.keyRotateSpeedVertical),ce=!0;break;case n.keys.BOTTOM:N(-n.keyRotateSpeedVertical),ce=!0;break;case n.keys.LEFT:R(n.keyRotateSpeedHorizontal),ce=!0;break;case n.keys.RIGHT:R(-n.keyRotateSpeedHorizontal),ce=!0;break}ce&&(O.preventDefault(),n.update())}function He(){if(y.length===1)d.set(y[0].pageX,y[0].pageY);else{let O=.5*(y[0].pageX+y[1].pageX),ce=.5*(y[0].pageY+y[1].pageY);d.set(O,ce)}}function ke(){if(y.length===1)f.set(y[0].pageX,y[0].pageY);else{let O=.5*(y[0].pageX+y[1].pageX),ce=.5*(y[0].pageY+y[1].pageY);f.set(O,ce)}}function Q(){let O=y[0].pageX-y[1].pageX,ce=y[0].pageY-y[1].pageY,Ne=Math.sqrt(O*O+ce*ce);x.set(0,Ne)}function ut(){n.enableZoom&&Q(),n.enablePan&&ke()}function Ze(){n.enableZoom&&Q(),n.enableRotate&&He()}function Xe(O){if(y.length==1)p.set(O.pageX,O.pageY);else{let Ne=Ie(O),ge=.5*(O.pageX+Ne.x),k=.5*(O.pageY+Ne.y);p.set(ge,k)}_.subVectors(p,d).multiplyScalar(n.rotateSpeed);let ce=n.domElement;R(2*Math.PI*_.x/ce.clientHeight),N(2*Math.PI*_.y/ce.clientHeight),d.copy(p)}function fe(O){if(y.length===1)m.set(O.pageX,O.pageY);else{let ce=Ie(O),Ne=.5*(O.pageX+ce.x),ge=.5*(O.pageY+ce.y);m.set(Ne,ge)}g.subVectors(m,f).multiplyScalar(n.panSpeed),F(g.x,g.y),f.copy(m)}function et(O){let ce=Ie(O),Ne=O.pageX-ce.x,ge=O.pageY-ce.y,k=Math.sqrt(Ne*Ne+ge*ge);b.set(0,k),v.set(0,Math.pow(b.y/x.y,n.zoomSpeed)),L(v.y),x.copy(b)}function K(O){n.enableZoom&&et(O),n.enablePan&&fe(O)}function te(O){n.enableZoom&&et(O),n.enableRotate&&Xe(O)}function he(O){n.enabled!==!1&&(y.length===0&&(n.domElement.setPointerCapture(O.pointerId),n.domElement.ownerDocument.addEventListener("pointermove",Ee),n.domElement.ownerDocument.addEventListener("pointerup",ve)),oe(O),O.pointerType==="touch"?D(O):Le(O))}function Ee(O){n.enabled!==!1&&(O.pointerType==="touch"?P(O):Oe(O))}function ve(O){xe(O),y.length===0&&(n.domElement.releasePointerCapture(O.pointerId),n.domElement.ownerDocument.removeEventListener("pointermove",Ee),n.domElement.ownerDocument.removeEventListener("pointerup",ve)),n.dispatchEvent(Xb),i=s.NONE}function We(O){xe(O)}function Le(O){let ce;switch(O.button){case 0:ce=n.mouseButtons.LEFT;break;case 1:ce=n.mouseButtons.MIDDLE;break;case 2:ce=n.mouseButtons.RIGHT;break;default:ce=-1}switch(ce){case Di.DOLLY:if(n.enableZoom===!1)return;H(O),i=s.DOLLY;break;case Di.ROTATE:if(O.ctrlKey||O.metaKey||O.shiftKey){if(n.enablePan===!1)return;z(O),i=s.PAN}else{if(n.enableRotate===!1)return;B(O),i=s.ROTATE}break;case Di.PAN:if(O.ctrlKey||O.metaKey||O.shiftKey){if(n.enableRotate===!1)return;B(O),i=s.ROTATE}else{if(n.enablePan===!1)return;z(O),i=s.PAN}break;default:i=s.NONE}i!==s.NONE&&n.dispatchEvent($b)}function Oe(O){if(n.enabled!==!1)switch(i){case s.ROTATE:if(n.enableRotate===!1)return;X(O);break;case s.DOLLY:if(n.enableZoom===!1)return;ee(O);break;case s.PAN:if(n.enablePan===!1)return;le(O);break}}function Nt(O){n.enabled===!1||n.enableZoom===!1||i!==s.NONE||(O.preventDefault(),n.dispatchEvent($b),re(O),n.dispatchEvent(Xb))}function ft(O){n.enabled===!1||n.enablePan===!1||Pe(O)}function D(O){switch(be(O),y.length){case 1:switch(n.touches.ONE){case Li.ROTATE:if(n.enableRotate===!1)return;He(),i=s.TOUCH_ROTATE;break;case Li.PAN:if(n.enablePan===!1)return;ke(),i=s.TOUCH_PAN;break;default:i=s.NONE}break;case 2:switch(n.touches.TWO){case Li.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;ut(),i=s.TOUCH_DOLLY_PAN;break;case Li.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Ze(),i=s.TOUCH_DOLLY_ROTATE;break;default:i=s.NONE}break;default:i=s.NONE}i!==s.NONE&&n.dispatchEvent($b)}function P(O){switch(be(O),i){case s.TOUCH_ROTATE:if(n.enableRotate===!1)return;Xe(O),n.update();break;case s.TOUCH_PAN:if(n.enablePan===!1)return;fe(O),n.update();break;case s.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;K(O),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;te(O),n.update();break;default:i=s.NONE}}function Y(O){n.enabled!==!1&&O.preventDefault()}function oe(O){y.push(O)}function xe(O){delete E[O.pointerId];for(let ce=0;ce<y.length;ce++)if(y[ce].pointerId==O.pointerId){y.splice(ce,1);return}}function be(O){let ce=E[O.pointerId];ce===void 0&&(ce=new G,E[O.pointerId]=ce),ce.set(O.pageX,O.pageY)}function Ie(O){let ce=O.pointerId===y[0].pointerId?y[1]:y[0];return E[ce.pointerId]}n.domElement.addEventListener("contextmenu",Y),n.domElement.addEventListener("pointerdown",he),n.domElement.addEventListener("pointercancel",We),n.domElement.addEventListener("wheel",Nt,{passive:!1}),this.update()}};var Ez="start",Cz="change",Sz="end";var Rc=["pan","rotate"],Az=class extends Ye{constructor(){super(...arguments);this.enabled=W.BOOLEAN(1),this.allowPan=W.BOOLEAN(1),this.allowRotate=W.BOOLEAN(1),this.allowZoom=W.BOOLEAN(1),this.tdamping=W.BOOLEAN(1),this.damping=W.FLOAT(.1,{visibleIf:{tdamping:!0}}),this.screenSpacePanning=W.BOOLEAN(1),this.rotateSpeed=W.FLOAT(.5),this.minDistance=W.FLOAT(.1,{range:[.1,100],rangeLocked:[!0,!1]}),this.maxDistance=W.FLOAT(50,{range:[0,100],rangeLocked:[!0,!1]}),this.limitAzimuthAngle=W.BOOLEAN(0),this.azimuthAngleRange=W.VECTOR2(["-2*$PI","2*$PI"],{visibleIf:{limitAzimuthAngle:1}}),this.polarAngleRange=W.VECTOR2([0,"$PI"]),this.target=W.VECTOR3([0,0,0],{cook:!1,computeOnDirty:!0,callback:e=>{yf.PARAM_CALLBACK_update_target(e)}}),this.enableKeys=W.BOOLEAN(0),this.keysMode=W.INTEGER(Rc.indexOf("pan"),{visibleIf:{enableKeys:1},menu:{entries:Rc.map((e,t)=>({name:e,value:t}))}}),this.keysPanSpeed=W.FLOAT(7,{range:[0,10],rangeLocked:[!1,!1],visibleIf:{enableKeys:1,keysMode:Rc.indexOf("pan")}}),this.keysRotateSpeedVertical=W.FLOAT(1,{range:[0,1],rangeLocked:[!1,!1],visibleIf:{enableKeys:1,keysMode:Rc.indexOf("rotate")}}),this.keysRotateSpeedHorizontal=W.FLOAT(1,{range:[0,1],rangeLocked:[!1,!1],visibleIf:{enableKeys:1,keysMode:Rc.indexOf("rotate")}})}},Cde=new Az,yf=class extends jb{constructor(){super(...arguments);this.paramsConfig=Cde,this._controls_by_element_id=new Map,this._target_array=[0,0,0]}static type(){return eg.ORBIT}endEventName(){return"end"}initializeNode(){this.io.outputs.setNamedOutputConnectionPoints([new xo(Ez,yo.BASE),new xo(Cz,yo.BASE),new xo(Sz,yo.BASE)])}async createControlsInstance(e,t){let n=new Yb(e,t);return n.addEventListener("end",()=>{this._on_controls_end(n)}),this._controls_by_element_id.set(t.id,n),this._bind_listeners_to_controls_instance(n),n}_bind_listeners_to_controls_instance(e){e.addEventListener("start",()=>{this.dispatchEventToOutput(Ez,{})}),e.addEventListener("change",()=>{this.dispatchEventToOutput(Cz,{})}),e.addEventListener("end",()=>{this.dispatchEventToOutput(Sz,{})})}setupControls(e){e.enabled=this.pv.enabled,e.enablePan=this.pv.allowPan,e.enableRotate=this.pv.allowRotate,e.enableZoom=this.pv.allowZoom,e.enableDamping=this.pv.tdamping,e.dampingFactor=this.pv.damping,e.rotateSpeed=this.pv.rotateSpeed,e.screenSpacePanning=this.pv.screenSpacePanning,e.minDistance=this.pv.minDistance,e.maxDistance=this.pv.maxDistance,this._set_azimuth_angle(e),e.minPolarAngle=this.pv.polarAngleRange.x,e.maxPolarAngle=this.pv.polarAngleRange.y,e.target.copy(this.pv.target),e.enabled&&e.update(),e.enableKeys=this.pv.enableKeys,e.enableKeys&&(e.keyMode=Rc[this.pv.keysMode],e.keyRotateSpeedVertical=this.pv.keysRotateSpeedVertical,e.keyRotateSpeedHorizontal=this.pv.keysRotateSpeedHorizontal,e.keyPanSpeed=this.pv.keysPanSpeed)}_set_azimuth_angle(e){this.pv.limitAzimuthAngle?(e.minAzimuthAngle=this.pv.azimuthAngleRange.x,e.maxAzimuthAngle=this.pv.azimuthAngleRange.y):(e.minAzimuthAngle=1/0,e.maxAzimuthAngle=1/0)}updateRequired(){return this.pv.tdamping}_on_controls_end(e){!this.pv.allowPan||(e.target.toArray(this._target_array),this.p.target.set(this._target_array))}static PARAM_CALLBACK_update_target(e){e._update_target()}_update_target(){let e=this.pv.target;this._controls_by_element_id.forEach((t,n)=>{let s=t.target;s.equals(e)||(s.copy(e),t.update())})}disposeControlsForHtmlElementId(e){this._controls_by_element_id.get(e)&&this._controls_by_element_id.delete(e)}};var Ru=(r=>(r.GEO="geo",r.CUBE_CAMERA="cubeCamera",r.AUDIO_LISTENER="audioListener",r.POSITIONAL_AUDIO="positionalAudio",r.SCENE="scene",r))(Ru||{});var Tz=class extends ob(Ye){constructor(){super(...arguments);this.display=W.BOOLEAN(1),this.renderOrder=W.INTEGER(0,{range:[0,10],rangeLocked:[!0,!1]})}},Sde=new Tz,Zb=class extends wo{constructor(){super(...arguments);this.paramsConfig=Sde,this.hierarchyController=new Eo(this),this.transformController=new Pc(this),this.flags=new Ta(this),this.childrenDisplayController=new Au(this),this.displayNodeController=new bo(this,this.childrenDisplayController.displayNodeControllerCallbacks()),this._childrenControllerContext=se.SOP,this._onChildAddBound=this._onChildAdd.bind(this)}static type(){return Ru.GEO}createObject(){let e=new Wt;return e.matrixAutoUpdate=!1,e}initializeNode(){this.lifecycle.onChildAdd(this._onChildAddBound),this.hierarchyController.initializeNode(),this.transformController.initializeNode(),this.childrenDisplayController.initializeNode()}createNode(e,t){return super.createNode(e,t)}children(){return super.children()}nodesByType(e){return super.nodesByType(e)}_onChildAdd(e){var t,n;this.scene().loadingController.loaded()&&this.children().length==1&&((n=(t=e.flags)==null?void 0:t.display)==null||n.set(!0))}cook(){this.transformController.update(),this.object.visible=this.pv.display,this.object.renderOrder=this.pv.renderOrder,this.cookController.endCook()}};var Jb={near:.1,far:100},mn=(r=>(r.NODE_ID="_Camera_nodeGeneratorId__",r.CONTROLS_NODE_ID="_Camera_controlsNodeId",r.CSS_RENDERER_NODE_ID="_Camera_CSSRendererNodeId",r.FRAME_MODE="_Camera_frameMode",r.FRAME_MODE_EXPECTED_ASPECT_RATIO="_Camera_frameModeExpectedAspectRatio",r.POST_PROCESS_NODE_ID="_Camera_postProcessNodeId",r.RENDER_SCENE_NODE_ID="_Camera_renderSceneNodeId",r.RENDERER_NODE_ID="_Camera_rendererNodeId",r))(mn||{});var Ou=(r=>(r.FOV="_PerspectiveCamera_fov",r))(Ou||{});var Mz=class extends zt{static type(){return ji.CONTROLS}cook(r,e){let t=r[0].objects();return this._node&&Mz.updateObject({objects:t,params:e,node:this._node,active:!0}),this.createCoreGroupFromObjects(t)}static updateObject(r){let{objects:e,params:t,node:n,active:s}=r,i=t.node.path(),o=n.node(i);if(o&&s){let a=o.graphNodeId();for(let c of e)De.addAttribute(c,mn.CONTROLS_NODE_ID,a)}else for(let a of e)De.deleteAttribute(a,mn.CONTROLS_NODE_ID)}},Iu=Mz;Iu.DEFAULT_PARAMS={node:new Rr("")};Iu.INPUT_CLONED_STATE=Tt.FROM_NODE;var Pz=class extends Ye{constructor(){super(...arguments);this.node=W.NODE_PATH("",{nodeSelection:{context:se.EVENT},dependentOnFoundNode:!0})}},Ade=new Pz,Kb=class extends cn{constructor(){super(...arguments);this.paramsConfig=Ade,this._childrenControllerContext=se.EVENT}static type(){return ji.CONTROLS}initializeNode(){this.io.inputs.setCount(1),this.io.inputs.initInputsClonedState(Iu.INPUT_CLONED_STATE)}cook(e){this._operation=this._operation||new Iu(this._scene,this.states,this);let t=this._operation.cook(e,this.pv);this.setCoreGroup(t)}createNode(e,t){return super.createNode(e,t)}children(){return super.children()}nodesByType(e){return super.nodesByType(e)}};function Rz(r,e=!1){let t=r[0].index!==null,n=new Set(Object.keys(r[0].attributes)),s=new Set(Object.keys(r[0].morphAttributes)),i={},o={},a=r[0].morphTargetsRelative,c=new st,l=0;for(let u=0;u<r.length;++u){let h=r[u],d=0;if(t!==(h.index!==null))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them."),null;for(let p in h.attributes){if(!n.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+'. All geometries must have compatible attributes; make sure "'+p+'" attribute exists among all geometries, or in none of them.'),null;i[p]===void 0&&(i[p]=[]),i[p].push(h.attributes[p]),d++}if(d!==n.size)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". Make sure all geometries have the same number of attributes."),null;if(a!==h.morphTargetsRelative)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". .morphTargetsRelative must be consistent throughout all geometries."),null;for(let p in h.morphAttributes){if(!s.has(p))return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+".  .morphAttributes must be consistent throughout all geometries."),null;o[p]===void 0&&(o[p]=[]),o[p].push(h.morphAttributes[p])}if(c.userData.mergedUserData=c.userData.mergedUserData||[],c.userData.mergedUserData.push(h.userData),e){let p;if(t)p=h.index.count;else if(h.attributes.position!==void 0)p=h.attributes.position.count;else return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed with geometry at index "+u+". The geometry must have either an index or a position attribute"),null;c.addGroup(l,p,u),l+=p}}if(t){let u=0,h=[];for(let d=0;d<r.length;++d){let p=r[d].index;for(let _=0;_<p.count;++_)h.push(p.getX(_)+u);u+=r[d].attributes.position.count}c.setIndex(h)}for(let u in i){let h=Nz(i[u]);if(!h)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" attribute."),null;c.setAttribute(u,h)}for(let u in o){let h=o[u][0].length;if(h===0)break;c.morphAttributes=c.morphAttributes||{},c.morphAttributes[u]=[];for(let d=0;d<h;++d){let p=[];for(let f=0;f<o[u].length;++f)p.push(o[u][f][d]);let _=Nz(p);if(!_)return console.error("THREE.BufferGeometryUtils: .mergeBufferGeometries() failed while trying to merge the "+u+" morphAttribute."),null;c.morphAttributes[u].push(_)}}return c}function Nz(r){let e,t,n,s=0;for(let a=0;a<r.length;++a){let c=r[a];if(c.isInterleavedBufferAttribute)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. InterleavedBufferAttributes are not supported."),null;if(e===void 0&&(e=c.array.constructor),e!==c.array.constructor)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes."),null;if(t===void 0&&(t=c.itemSize),t!==c.itemSize)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes."),null;if(n===void 0&&(n=c.normalized),n!==c.normalized)return console.error("THREE.BufferGeometryUtils: .mergeBufferAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes."),null;s+=c.array.length}let i=new e(s),o=0;for(let a=0;a<r.length;++a)i.set(r[a].array,o),o+=r[a].array.length;return new xt(i,t,n)}var Qb=class{static merge(e){if(e.length===0)return;for(let a of e)hu.createIndexIfNone(a);let t=e.map(a=>new Yt(a)),n=t[0].indexedAttributeNames(),s={};for(let a of n){let c={},l=[];for(let h of t){let d=h.points();for(let p of d){l.push(p);let _=p.indexedAttribValue(a);c[_]!=null?c[_]:c[_]=Object.keys(c).length}}let u=Object.keys(c);for(let h of l){let d=h.indexedAttribValue(a),p=c[d];h.setAttribIndex(a,p)}s[a]=u}let i=Rz(e),o=new Yt(i);return Object.keys(s).forEach(a=>{let c=s[a];o.setIndexedAttributeValues(a,c)}),i&&delete i.userData.mergedUserData,i}};var Ao=class extends zt{static type(){return"merge"}cook(e,t){let n=[];for(let s of e)if(s){let i=s.objects();if(t.compact)for(let o of i)o.traverse(a=>{n.push(a)});else for(let o of s.objects())n.push(o)}return t.compact&&(n=this._makeCompact(n)),this.createCoreGroupFromObjects(n)}_makeCompact(e){let t=new Map,n=new Map,s=[];for(let o of e)o.traverse(a=>{if(a instanceof Wt)return;let c=a;if(c.geometry){let l=pd(c.constructor);l&&(s.includes(l)||s.push(l),l&&(t.get(l)||t.set(l,c.material),je.pushOnArrayAtEntry(n,l,c)))}});let i=[];return s.forEach(o=>{var a,c;let l=n.get(o);if(l){let u=[];for(let h of l){let d=h.geometry;d.applyMatrix4(h.matrix),u.push(d)}try{let h=Qb.merge(u);if(h){let d=t.get(o),p=this.createObject(h,o,d);p.matrixAutoUpdate=!1,i.push(p)}else(a=this.states)==null||a.error.set("merge failed, check that input geometries have the same attributes")}catch(h){(c=this.states)==null||c.error.set(h.message)}}}),i}};Ao.DEFAULT_PARAMS={compact:!1,keepHierarchy:!1};Ao.INPUT_CLONED_STATE=Tt.FROM_NODE;var xf="geometry to merge",Tde=Ao.DEFAULT_PARAMS,Oz=4,Iz=class extends Ye{constructor(){super(...arguments);this.compact=W.BOOLEAN(Tde.compact),this.inputsCount=W.INTEGER(Oz,{range:[1,32],rangeLocked:[!0,!1],callback:e=>{vf.PARAM_CALLBACK_setInputsCount(e)}})}},Mde=new Iz,vf=class extends cn{constructor(){super(...arguments);this.paramsConfig=Mde}static type(){return"merge"}static displayedInputNames(){return[xf,xf,xf,xf]}setCompactMode(e){this.p.compact.set(e)}initializeNode(){this.io.inputs.setCount(1,Oz),this.io.inputs.initInputsClonedState(Ao.INPUT_CLONED_STATE),this.scene().dispatchController.onAddListener(()=>{this.params.addOnSceneLoadHook("update inputs",()=>{this._callbackUpdateInputsCount()})})}cook(e){this._operation=this._operation||new Ao(this.scene(),this.states);let t=this._operation.cook(e,this.pv);this.setCoreGroup(t)}_callbackUpdateInputsCount(){this.io.inputs.setCount(1,this.pv.inputsCount),this.emit(pt.INPUTS_UPDATED)}static PARAM_CALLBACK_setInputsCount(e){e._callbackUpdateInputsCount()}};var e1=class{constructor(e){this._viewer=e,this._size=new G(100,100),this._aspect=1}camera(){return this._viewer.camera()}get size(){return this._size}get aspect(){return this._aspect}computeSizeAndAspect(){this._updateSize(),this._viewer.scene().uniformsController.updateResolution(this._size),this._aspect=this._getAspect()}_updateSize(){var e,t;this._size.x=((e=this._viewer.domElement())==null?void 0:e.offsetWidth)||0,this._size.y=((t=this._viewer.domElement())==null?void 0:t.offsetHeight)||0}_getAspect(){return this._size.x/this._size.y}updateCameraAspect(){this._viewer.updateCameraAspect(this._aspect)}async prepareCurrentCamera(){await this._updateFromCameraContainer()}async _updateFromCameraContainer(){this.updateCameraAspect()}};var t1=class{constructor(e){this.viewer=e,this._active=!1,this._unmounted=!1}controls(){return this._controls}mount(){this._unmounted=!1;let e=this.viewer.controlsNode(),t=this.viewer.camera();!(e&&t)||e.applyControls(t,this.viewer).then(n=>{this._controls=n,this._updateControlsFunc=n?s=>n.update(s):void 0,this._unmounted&&this._disposeControls()})}unmount(){this._unmounted=!0,this._disposeControls()}_disposeControls(){this._controls&&this._controls.dispose(),this._updateControlsFunc=void 0}update(e){this._updateControlsFunc&&this._updateControlsFunc(e)}};var n1=(r=>(r.CANVAS="canvas",r.DOCUMENT="document",r))(n1||{}),r1=["canvas","document"],UGe={menu:{entries:r1.map((r,e)=>({name:r,value:e}))}};function Dz(r){r.setAttribute("tabindex","0")}function Pde(r,e){return r==n1.CANVAS?e:document}function bf(r,e){return r.type=="resize"?window:Pde(r.emitter,e)}var s1=class{constructor(e){this.viewer=e,this._bound_listener_map_by_event_controller_type=new Map}updateEvents(e){let t=this.canvas();if(!t){console.warn("no canvas found");return}let n=e.type(),s=this._bound_listener_map_by_event_controller_type.get(n);s||(s=new Map,this._bound_listener_map_by_event_controller_type.set(n,s)),s.forEach((i,o)=>{for(let a of r1)bf({emitter:a,type:o},t).removeEventListener(o,i.listener)}),s.clear();for(let i of e.activeEventDatas()){let o=bf(i,t),a=i.type,c=(u,h)=>{let d={viewer:this.viewer,event:u,emitter:i.emitter};h.processEvent(d)},l=u=>{c(u,e)};o.addEventListener(a,l),o!=document&&lf.includes(i.type)&&Dz(o),s.set(i.type,{listener:l,data:i})}}camera(){return this.viewer.camera()}canvas(){return this.viewer.canvas()}init(){if(!this.canvas()){console.warn("no canvas found for eventsController");return}this.viewer.scene().eventsDispatcher.traverseControllers(e=>{this.updateEvents(e)})}registeredEventTypes(){let e=[];return this._bound_listener_map_by_event_controller_type.forEach(t=>{t.forEach((n,s)=>{e.push(s)})}),e}dispose(){let e=this.canvas();this._bound_listener_map_by_event_controller_type.forEach(t=>{e&&t.forEach((n,s)=>{bf(n.data,e).removeEventListener(s,n.listener)})})}};var i1=class{constructor(e){this.viewer=e}init(){let e=this.viewer.canvas();e&&(e.onwebglcontextlost=this._on_webglcontextlost.bind(this),e.onwebglcontextrestored=this._on_webglcontextrestored.bind(this))}_on_webglcontextlost(){console.warn("context lost at frame",this.viewer.scene().frame()),this.request_animation_frame_id?cancelAnimationFrame(this.request_animation_frame_id):console.warn("request_animation_frame_id not initialized"),console.warn("not canceled",this.request_animation_frame_id)}_on_webglcontextrestored(){console.log("context restored")}};var Lz={ON:`<svg xmlns="http://www.w3.org/2000/svg" class="soundOn h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
	<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" />
  </svg>`,OFF:`<svg xmlns="http://www.w3.org/2000/svg" class="soundOff h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
	<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z" clip-rule="evenodd" />
	<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2" />
  </svg>`},o1=class{constructor(e){this._viewer=e}update(){let e=this._viewer.scene().root();e.pv.displayAudioIcon?(this._showIcon(),this._updateIcon(e)):this._hideIcon()}unmount(){var e;this.__iconContainer&&((e=this.__iconContainer.parentElement)==null||e.removeChild(this.__iconContainer),this.__iconContainer=void 0),this._onIcon=void 0,this._offIcon=void 0}_showIcon(){let e=this._iconContainer();e&&(e.style.display="block")}_hideIcon(){this.__iconContainer&&(this.__iconContainer.style.display="none")}_iconContainer(){let e=()=>{let t=this._createIconContainer(),n=this._viewer.domElement();if(!!n)return n.append(t),t};return this.__iconContainer=this.__iconContainer||e()}_createIconContainer(){let e=document.createElement("div");return e.addEventListener("pointerdown",t=>(this._toggleSound(),t.preventDefault(),t.stopPropagation(),!1)),e}_setIconContainerStyle(e,t){let n=t.pv.audioIconStyle;e.setAttribute("style",n),e.style.color=t.pv.audioIconColor.getStyle()}offIcon(){function e(){let t=document.createElement("div");return t.innerHTML=Lz.OFF,t.children[0]}return this._offIcon=this._offIcon||e()}onIcon(){function e(){let t=document.createElement("div");return t.innerHTML=Lz.ON,t.children[0]}return this._onIcon=this._onIcon||e()}_toggleSound(){let e=this._viewer.scene().root();e.audioController.toggleSound(),this._updateIcon(e)}_updateIcon(e){var t,n;let s=this._iconContainer();if(!s)return;this._setIconContainerStyle(s,e);let i=this.onIcon(),o=this.offIcon();this._viewer.scene().root().audioController.soundOn()?(s.appendChild(i),(t=o.parentElement)==null||t.removeChild(o)):(s.appendChild(o),(n=i.parentElement)==null||n.removeChild(i))}};var Bz="hovered",Du=class{constructor(r){this._active=!1,this._doRender=!0,this.raycaster=this.createRaycaster(),this._mounted=!1,this._controlsController=new t1(this),this._onBeforeTickCallbacks=[],this._onAfterTickCallbacks=[],this._onBeforeRenderCallbacks=[],this._onAfterRenderCallbacks=[],this._id=Du._nextId(),this._camera=r.camera,this._scene=r.scene,this._canvas=r.canvas,r.autoRender!=null&&(this._doRender=r.autoRender),this.updateCameraAspect=r.updateCameraAspect,this.scene().viewersRegister.registerViewer(this)}static _nextId(){return`${Du._nextViewerId++}`}mount(r){this._domElement=r,this._domElement.viewer=this,this._domElement.scene=this._scene,this._domElement.Poly=ie,this.controlsController().mount(),this._mounted=!0}unmount(){var r;!this._domElement||((r=this._audioController)==null||r.unmount(),this._domElement.removeChild(this.canvas()),this.controlsController().unmount(),this._mounted=!1)}static _canvasIdPrefix(){return"TypedViewer"}static createCanvas(r){r=r||Du._nextId();let e=document.createElement("canvas");return e.id=`${this._canvasIdPrefix()}_${r}`,e.style.display="block",e.style.outline="none",e.style.width="100%",e.style.height="100%",e}controlsNode(){return this._controlsNode}canvas(){return this._canvas=this._canvas||Du.createCanvas(this._id)}setRenderObjectOverride(r){r?this._renderObjectOverride=r:this._renderObjectOverride=void 0}active(){return this._active}activate(){this._active=!0}deactivate(){this._active=!1}camerasController(){return this._camerasController=this._camerasController||new e1(this)}controlsController(){return this._controlsController}eventsController(){return this._eventsController=this._eventsController||new s1(this)}webglController(){return this._webGLController=this._webGLController||new i1(this)}audioController(){return this._audioController=this._audioController||new o1(this)}domElement(){return this._domElement}scene(){return this._scene}createRaycaster(){let r=new _l;return r.firstHitOnly=!0,r}camera(){return this._camera}id(){return this._id}dispose(){if(this._scene.viewersRegister.unregisterViewer(this),this.eventsController().dispose(),this.controlsController().unmount(),!this._domElement)return;let r;for(;r=this._domElement.children[0];)this._domElement.removeChild(r)}resetContainerClass(){var r;(r=this.domElement())==null||r.classList.remove(Bz)}setContainerClassHovered(){var r;(r=this.domElement())==null||r.classList.add(Bz)}markAsReady(){}setAutoRender(r=!0){this._doRender=r}autoRenderState(){return this._doRender}registerOnBeforeTick(r,e,t={}){this._registerCallback(r,e,this.registeredBeforeTickCallbacks(),t)}unRegisterOnBeforeTick(r){this._unregisterCallback(r,this._onBeforeTickCallbacksMap)}registeredBeforeTickCallbacks(){return this._onBeforeTickCallbacksMap=this._onBeforeTickCallbacksMap||new Map}registerOnAfterTick(r,e,t={}){this._registerCallback(r,e,this.registeredAfterTickCallbacks(),t)}unRegisterOnAfterTick(r){this._unregisterCallback(r,this._onAfterTickCallbacksMap)}registeredAfterTickCallbacks(){return this._onAfterTickCallbacksMap=this._onAfterTickCallbacksMap||new Map}registerOnBeforeRender(r,e,t={}){this._registerCallback(r,e,this.registeredBeforeRenderCallbacks(),t)}unRegisterOnBeforeRender(r){this._unregisterCallback(r,this._onBeforeRenderCallbacksMap)}registeredBeforeRenderCallbacks(){return this._onBeforeRenderCallbacksMap=this._onBeforeRenderCallbacksMap||new Map}registerOnAfterRender(r,e,t={}){this._registerCallback(r,e,this.registeredAfterRenderCallbacks(),t)}unRegisterOnAfterRender(r){this._unregisterCallback(r,this._onAfterRenderCallbacksMap)}registeredAfterRenderCallbacks(){return this._onAfterRenderCallbacksMap=this._onAfterRenderCallbacksMap||new Map}_registerCallback(r,e,t,n={}){if(t.has(r)){console.warn(`callback ${r} already registered`);return}t.set(r,{callback:e,options:n}),this._updateCallbacks()}_unregisterCallback(r,e){if(!e)return;let t=e.get(r);!t||t.options.persistent==!0||(e.delete(r),this._updateCallbacks())}_updateCallbacks(){var r,e,t,n;this._onBeforeTickCallbacks=[],(r=this._onBeforeTickCallbacksMap)==null||r.forEach(s=>{this._onBeforeTickCallbacks.push(s.callback)}),this._onAfterTickCallbacks=[],(e=this._onAfterTickCallbacksMap)==null||e.forEach(s=>{this._onAfterTickCallbacks.push(s.callback)}),this._onBeforeRenderCallbacks=[],(t=this._onBeforeRenderCallbacksMap)==null||t.forEach(s=>{this._onBeforeRenderCallbacks.push(s.callback)}),this._onAfterRenderCallbacks=[],(n=this._onAfterRenderCallbacksMap)==null||n.forEach(s=>{this._onAfterRenderCallbacks.push(s.callback)})}_runTickCallbacks(r,e){for(let t of r)t(e)}_runRenderCallbacks(r,e,t){for(let n of r)n(e,t)}_runOnBeforeTickCallbacks(r){this._runTickCallbacks(this._onBeforeTickCallbacks,r)}_runOnAfterTickCallbacks(r){this._runTickCallbacks(this._onAfterTickCallbacks,r)}_runOnBeforeRenderCallbacks(r,e){this._runRenderCallbacks(this._onBeforeRenderCallbacks,r,e)}_runOnAfterRenderCallbacks(r,e){this._runRenderCallbacks(this._onAfterRenderCallbacks,r,e)}},a1=Du;a1._nextViewerId=0;var wf=.5,Ef=32,Oc=10,c1=class{constructor(e){this._viewer=e,this._scene=this._createScene(),this._camera=this._createCamera(),this._iconHovered=!1;let t=this._viewer.canvas();this._setupRenderer(),this._setupEvents(t)}_createScene(){let e=ie.logo.datauri()||"",t=new Xt;t.wrapS=ua,t.wrapT=ua,t.center.set(.5,.5),t.repeat.set(1,1);let n=document.createElement("img");t.image=n,t.encoding=Et,n.onload=()=>{t.needsUpdate=!0},n.src=e;let s=new pl(.5,128);s.rotateZ(Math.PI*.5),s.rotateZ(Math.PI*-.5);let i=new Bi({map:t}),o=new St(s,i);o.matrixAutoUpdate=!1;let a=new ms;return a.matrixAutoUpdate=!1,a.add(o),a}_createCamera(){let e=new ga(-wf,wf,wf,-wf,1,10);return e.position.set(0,0,5),e.updateMatrix(),e.matrixAutoUpdate=!1,e}_setupRenderer(){let e=new Se;this._viewer.registerOnAfterRender("logo",(t,n)=>{let s=n.autoClear;n.getCurrentViewport(e),n.autoClear=!1,n.setViewport(Oc,Oc,Ef,Ef),n.render(this._scene,this._camera),n.autoClear=s,n.setViewport(e.divideScalar(n.getPixelRatio()))},{persistent:!0})}_setupEvents(e){let t=new G;e.addEventListener("mousemove",n=>{let s=e.getBoundingClientRect().height;t.set(n.offsetX,s-n.offsetY),t.x>=Oc&&t.x<=Oc+Ef&&t.y>=Oc&&t.y<=Oc+Ef?this.updateIconHoveredState(!0,e):this.updateIconHoveredState(!1,e)}),e.addEventListener("pointerup",n=>{this._iconHovered&&setTimeout(()=>{this._openPolygonjsPage()},10)})}updateIconHoveredState(e,t){e!=this._iconHovered&&(this._iconHovered=e,this._iconHovered?t.style.cursor="pointer":t.style.removeProperty("cursor"))}_openPolygonjsPage(){let e=document.createElement("a");e.setAttribute("target","_blank");let t=ie.logo.redirectUrl();e.setAttribute("href",t),e.click()}};var To=(r=>(r.CSS2D="CSS2DRenderer",r.CSS3D="CSS3DRenderer",r.WEBGL="WebGLRenderer",r))(To||{});function l1(){return So.isMobile()?1:Math.max(2,window.devicePixelRatio)}var Cf=(r=>(r[r.Linear=Tr]="Linear",r[r.sRGB=Et]="sRGB",r))(Cf||{}),Nde=["Linear","sRGB"],Rde=[Cf.Linear,Cf.sRGB],u1=Cf.sRGB;var Mo=(r=>(r[r.No=Ar]="No",r[r.Linear=Lm]="Linear",r[r.Reinhard=Bm]="Reinhard",r[r.Cineon=km]="Cineon",r[r.ACESFilmic=Fm]="ACESFilmic",r))(Mo||{}),Ode=["No","Linear","Reinhard","Cineon","ACESFilmic"],Ide=[Mo.No,Mo.Linear,Mo.Reinhard,Mo.Cineon,Mo.ACESFilmic],h1=Mo.ACESFilmic,Dde=Ode.map((r,e)=>({name:r,value:Ide[e]}));var kz=["highp","mediump","lowp"];var Fz=["high-performance","low-power","default"];var Ic=(r=>(r[r.Basic=yE]="Basic",r[r.PCF=Oh]="PCF",r[r.PCFSoft=Dm]="PCFSoft",r[r.VSM=Mi]="VSM",r))(Ic||{}),Lde=["Basic","PCF","PCFSoft","VSM"],Bde=[Ic.Basic,Ic.PCF,Ic.PCFSoft,Ic.VSM];var d1=Ic.PCFSoft;var Uz=class extends Ye{constructor(){super(...arguments);this.tprecision=W.BOOLEAN(0),this.precision=W.INTEGER(kz.indexOf("highp"),{visibleIf:{tprecision:1},menu:{entries:kz.map((e,t)=>({value:t,name:e}))}}),this.tpowerPreference=W.BOOLEAN(0),this.powerPreference=W.INTEGER(Fz.indexOf("default"),{visibleIf:{tpowerPreference:1},menu:{entries:Fz.map((e,t)=>({value:t,name:e}))}}),this.alpha=W.BOOLEAN(1),this.premultipliedAlpha=W.BOOLEAN(1),this.antialias=W.BOOLEAN(1),this.stencil=W.BOOLEAN(1),this.depth=W.BOOLEAN(1),this.logarithmicDepthBuffer=W.BOOLEAN(0),this.toneMapping=W.INTEGER(h1,{menu:{entries:Dde}}),this.toneMappingExposure=W.FLOAT(1,{range:[0,2]}),this.outputEncoding=W.INTEGER(u1,{menu:{entries:Nde.map((e,t)=>({name:e,value:Rde[t]}))}}),this.physicallyCorrectLights=W.BOOLEAN(1),this.sortObjects=W.BOOLEAN(1),this.tpixelRatio=W.BOOLEAN(0),this.pixelRatio=W.INTEGER(2,{visibleIf:{tpixelRatio:!0},range:[1,4],rangeLocked:[!0,!1]}),this.tshadowMap=W.BOOLEAN(1),this.shadowMapAutoUpdate=W.BOOLEAN(1,{visibleIf:{tshadowMap:1}}),this.shadowMapNeedsUpdate=W.BOOLEAN(0,{visibleIf:{tshadowMap:1}}),this.shadowMapType=W.INTEGER(d1,{visibleIf:{tshadowMap:1},menu:{entries:Lde.map((e,t)=>({name:e,value:Bde[t]}))}})}},IHe=new Uz;var zz=class{static renderer(r){return this._renderersByCanvas.get(r)}static createRenderer(r){let{camera:e,canvas:t,scene:n}=r,s=ie.renderersController.getRenderingContext(t);if(!s){console.error("failed to create webgl context");return}let i,o=De.attribValue(e,mn.RENDERER_NODE_ID);if(o&&q.isNumber(o)){let a=n.graph.nodeFromId(o);a&&a instanceof Gt&&a.type()==To.WEBGL&&a.context()==se.ROP&&(i=a.createRenderer(e,t,s))}return i||(i=this._defaultRendererByContext.get(s),i||(i=zz.createDefaultRenderer(t,s),this._defaultRendererByContext.set(s,i))),n.renderersRegister.registerRenderer(i),this._renderersByCanvas.set(t,i),i}static setRendererSize(r,e){let t=this.renderer(r);t&&t.setSize(e.x,e.y,!1)}static createDefaultRenderer(r,e){let t={canvas:r,antialias:!1,context:e},n=ie.renderersController.createWebGLRenderer(t),s=l1();return n.setPixelRatio(s),n.shadowMap.enabled=!0,n.shadowMap.type=d1,n.physicallyCorrectLights=!0,n.toneMapping=h1,n.toneMappingExposure=1,n.outputEncoding=u1,ie.renderersController.printDebug()&&(ie.renderersController.printDebugMessage("create default renderer"),ie.renderersController.printDebugMessage({params:t,pixelRatio:s})),n}},Lu=zz;Lu._defaultRendererByContext=new Map;Lu._renderersByCanvas=new Map;var p1=class{static isPostProcessNetworkNode(e){return e.type()==vl.POST||e.context()==se.SOP&&e.type()==ji.POST_PROCESS}static createComposer(e){let{renderer:t,scene:n,renderScene:s,camera:i,viewer:o}=e,a,c=De.attribValue(i,mn.POST_PROCESS_NODE_ID);if(c&&q.isNumber(c)){let l=n.graph.nodeFromId(c);l&&l instanceof Gt&&this.isPostProcessNetworkNode(l)&&(a=l)}if(!!a)return a.effectsComposerController.createEffectsComposer({renderer:t,scene:s,camera:i,viewer:o})}};var f1=class{static isCSSRendererNode(e){return e.type()==To.CSS2D||e.type()==To.CSS3D}static cssRendererConfig(e){let{canvas:t,scene:n,camera:s}=e,i=De.attribValue(s,mn.CSS_RENDERER_NODE_ID);if(i==null||!q.isNumber(i))return;let o=n.graph.nodeFromId(i);if(!o||!this.isCSSRendererNode(o))return;let a=o;return{cssRenderer:a.renderer(t),cssRendererNode:a}}};var m1=class{static isCameraControlsNode(e){return HC.includes(e.type())}static controlsNode(e){let{scene:t,camera:n}=e,s,i=De.attribValue(n,mn.CONTROLS_NODE_ID);if(i&&q.isNumber(i)){let o=t.graph.nodeFromId(i);o&&o instanceof Gt&&this.isCameraControlsNode(o)&&(s=o)}return s}};var _1=class{static isRenderSceneNode(e){return e.type()==Ru.SCENE}static renderScene(e){let{scene:t,camera:n}=e,s,i=De.attribValue(n,mn.RENDER_SCENE_NODE_ID);if(i&&q.isNumber(i)){let o=t.graph.nodeFromId(i);if(o&&o instanceof Gt&&this.isRenderSceneNode(o))return s=o,s.object}}};var kde="CoreThreejsViewer",g1=class extends a1{constructor(e){super(e);this._animateMethod=this.animate.bind(this),this._onResizeBound=this.onResize.bind(this),this._setupFunctions(e)}static _canvasIdPrefix(){return"ThreejsViewer"}_setupFunctions(e){var t;let n=this.camera(),s=this.scene(),i=this.canvas(),o=s.threejsScene();this._renderer=e.renderer||Lu.createRenderer({camera:n,scene:s,canvas:i});let a=this._renderer;if(a){this._rendererScene=_1.renderScene({camera:n,scene:s});let c=this._rendererScene||o;this._effectComposer=p1.createComposer({camera:n,scene:s,renderScene:c,renderer:a,viewer:this}),this._cssRendererConfig=f1.cssRendererConfig({scene:s,camera:n,canvas:i}),this._controlsNode=m1.controlsNode({camera:n,scene:s});let l=(t=this._cssRendererConfig)==null?void 0:t.cssRenderer;this._renderCSSFunc=l?()=>l.render(c,n):void 0;let u=this._effectComposer;u?this._renderFunc=h=>u.render(h):this._renderFunc=()=>{a.render(c,n)}}}mount(e){var t,n,s;super.mount(e),(t=this._domElement)==null||t.appendChild(this.canvas()),(n=this._domElement)==null||n.classList.add(kde);let i=(s=this._cssRendererConfig)==null?void 0:s.cssRendererNode;i&&i.mountRenderer(this.canvas()),this._build(),this._setEvents(),this.onResize(),ie.logo.displayed()&&new c1(this)}_build(){this._initDisplay(),this.activate()}dispose(){var e;let t=(e=this._cssRendererConfig)==null?void 0:e.cssRendererNode;t&&t.unmountRenderer(this.canvas()),this._cssRendererConfig=void 0,this._effectComposer=void 0,this.setAutoRender(!1),this._cancelAnimate(),this._disposeEvents(),super.dispose()}_setEvents(){this.eventsController().init(),this.webglController().init(),this._disposeEvents(),window.addEventListener("resize",this._onResizeBound,!1)}_disposeEvents(){window.removeEventListener("resize",this._onResizeBound,!1)}onResize(){var e,t;let n=this._canvas;if(!n)return;this.camerasController().computeSizeAndAspect();let s=this.camerasController().size;Lu.setRendererSize(n,s),(e=this._cssRendererConfig)==null||e.cssRenderer.setSize(s.x,s.y),(t=this._effectComposer)==null||t.setSize(s.x,s.y),this.camerasController().updateCameraAspect()}_initDisplay(){if(!this._canvas){console.warn("no canvas found for viewer");return}this.camerasController().computeSizeAndAspect(),this.audioController().update(),this.animate()}setAutoRender(e=!0){super.setAutoRender(e),this._doRender&&this._requestAnimationFrameId==null&&this.animate(),this._doRender||this._cancelAnimate()}animate(){if(this._doRender){let e=this._scene.timeController.updateClockDelta();this._requestAnimationFrameId=requestAnimationFrame(this._animateMethod),this._runOnBeforeTickCallbacks(e),this._scene.timeController.incrementTimeIfPlaying(VC),this._runOnAfterTickCallbacks(e),this.render(e)}}_cancelAnimate(){this._doRender=!1,this._requestAnimationFrameId!=null&&(cancelAnimationFrame(this._requestAnimationFrameId),this._requestAnimationFrameId=void 0),this._canvas}render(e){if(this._canvas){let t=this._renderer;if(!t)return;this._runOnBeforeRenderCallbacks(e,t),this._renderFunc&&this._renderFunc(e),this._renderCSSFunc&&this._renderCSSFunc(),this.controlsController().update(e),this._runOnAfterRenderCallbacks(e,t)}else console.warn("no canvas to render onto")}renderer(){return this._renderer}effectComposer(){return this._effectComposer}preCompile(){!this._renderer||this._renderer.compile(this._scene.threejsScene(),this._camera)}markAsReady(){this.preCompile(),this.setAutoRender(!0)}};var Po=(r=>(r.DEFAULT="default",r.COVER="cover",r.CONTAIN="contain",r))(Po||{}),Vz=["default","cover","contain"];var Sf=class{static frameMode(e){return this._getFrameMode(e)||Po.DEFAULT}static expectedAspectRatio(e){return De.attribValue(e,mn.FRAME_MODE_EXPECTED_ASPECT_RATIO)}static _getFrameMode(e){let t=De.attribValue(e,mn.FRAME_MODE);if(!!t&&!!q.isNumber(t))return Vz[t]}};var y1=class{static updateCameraAspect(e,t){e.aspect=t;let n=Sf.frameMode(e),s=Sf.expectedAspectRatio(e),i=De.attribValue(e,Ou.FOV);i!=null&&s!=null&&this._update({mode:n,camera:e,fov:i,expectedAspectRatio:s}),e.updateProjectionMatrix()}static _update(e){let t=e.mode;switch(t){case Po.DEFAULT:return this._adjustFOVFromModeDefault(e);case Po.COVER:return this._adjustFOVFromModeCover(e);case Po.CONTAIN:return this._adjustFOVFromModeContain(e)}Bn.unreachable(t)}static _adjustFOVFromModeDefault(e){e.camera.fov=e.fov}static _adjustFOVFromModeCover(e){if(e.camera.aspect>e.expectedAspectRatio){let t=Math.tan(dn.degToRad(e.fov/2)),n=e.camera.aspect/e.expectedAspectRatio,s=t/n;e.camera.fov=dn.radToDeg(Math.atan(s))*2}else e.camera.fov=e.fov}static _adjustFOVFromModeContain(e){if(e.camera.aspect>e.expectedAspectRatio)e.camera.fov=e.fov;else{let t=Math.tan(dn.degToRad(e.fov/2)),n=e.camera.aspect/e.expectedAspectRatio,s=t/n;e.camera.fov=dn.radToDeg(Math.atan(s))*2}}};var Af={fov:50,fovRange:[.001,180]};var Tf=r=>{r.registerCameraNodeType(ys.PERSPECTIVE),r.registerCamera(hn,e=>new g1({...e,updateCameraAspect:n=>{y1.updateCameraAspect(e.camera,n)}}))};var Mf=new A,$t=new _a;function Fde(){let r=new st,e=new ae(16755200),t=new ae(16711680),n=new ae(43775),s=new ae(16777215),i=new ae(3355443),o=[],a=[],c={};function l(h,d,p){u(h,p),u(d,p)}function u(h,d){o.push(0,0,0),a.push(d.r,d.g,d.b),c[h]===void 0&&(c[h]=[]),c[h].push(o.length/3-1)}return l("n1","n2",e),l("n2","n4",e),l("n4","n3",e),l("n3","n1",e),l("f1","f2",e),l("f2","f4",e),l("f4","f3",e),l("f3","f1",e),l("n1","f1",e),l("n2","f2",e),l("n3","f3",e),l("n4","f4",e),l("p","n1",t),l("p","n2",t),l("p","n3",t),l("p","n4",t),l("u1","u2",n),l("u2","u3",n),l("u3","u1",n),l("c","t",s),l("p","c",i),l("cn1","cn2",i),l("cn3","cn4",i),l("cf1","cf2",i),l("cf3","cf4",i),r.setAttribute("position",new Je(o,3)),r.setAttribute("color",new Je(a,3)),{geometry:r,pointMap:c}}function Ude(){return new Ln({color:16777215,vertexColors:!0,toneMapped:!1})}var Bu=class extends sr{constructor(e){super();this._pointMap={},this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.name="CameraHelper",this.type="CameraHelper",this.matrixAutoUpdate=!1;let{geometry:t,pointMap:n}=Fde();this.geometry=t,this._pointMap=n,this.material=Ude()}clone(){return new Bu(this.camera)}update(){let e=this.geometry,t=this._pointMap,n=1,s=1;$t.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),Qt("c",t,e,$t,0,0,-1),Qt("t",t,e,$t,0,0,1),Qt("n1",t,e,$t,-n,-s,-1),Qt("n2",t,e,$t,n,-s,-1),Qt("n3",t,e,$t,-n,s,-1),Qt("n4",t,e,$t,n,s,-1),Qt("f1",t,e,$t,-n,-s,1),Qt("f2",t,e,$t,n,-s,1),Qt("f3",t,e,$t,-n,s,1),Qt("f4",t,e,$t,n,s,1),Qt("u1",t,e,$t,n*.7,s*1.1,-1),Qt("u2",t,e,$t,-n*.7,s*1.1,-1),Qt("u3",t,e,$t,0,s*2,-1),Qt("cf1",t,e,$t,-n,0,1),Qt("cf2",t,e,$t,n,0,1),Qt("cf3",t,e,$t,0,-s,1),Qt("cf4",t,e,$t,0,s,1),Qt("cn1",t,e,$t,-n,0,-1),Qt("cn2",t,e,$t,n,0,-1),Qt("cn3",t,e,$t,0,-s,-1),Qt("cn4",t,e,$t,0,s,-1),e.getAttribute("position").needsUpdate=!0}};function Qt(r,e,t,n,s,i,o){Mf.set(s,i,o).unproject(n);let a=e[r];if(a!==void 0){let c=t.getAttribute("position");for(let l=0,u=a.length;l<u;l++)c.setXYZ(a[l],Mf.x,Mf.y,Mf.z)}}var x1=class extends zt{static type(){return ys.PERSPECTIVE}cook(r,e){let t=x1.createCamera(e,this._node);t.name=e.name||ys.PERSPECTIVE,t.position.copy(e.position),t.rotation.set(dn.degToRad(e.rotation.x),dn.degToRad(e.rotation.y),dn.degToRad(e.rotation.z)),t.updateMatrix(),t.updateProjectionMatrix(),t.matrixAutoUpdate=e.matrixAutoUpdate,x1.setCameraAttributes(t,e);let n=[t];if(e.showHelper){let s=new Bu(t);s.update(),t.add(s)}return this.createCoreGroupFromObjects(n)}static createCamera(r,e){let t=new hn(r.fov,1,r.near,r.far);return e&&De.addAttribute(t,mn.NODE_ID,e.graphNodeId()),t}static setCameraAttributes(r,e){De.addAttribute(r,Ou.FOV,e.fov)}},Dc=x1;Dc.DEFAULT_PARAMS={fov:Af.fov,near:Jb.near,far:Jb.far,position:new A(0,0,0),rotation:new A(0,0,0),showHelper:!1,matrixAutoUpdate:!0,name:ys.PERSPECTIVE};Dc.INPUT_CLONED_STATE=Tt.NEVER;Dc.onRegister=Tf;async function qz(r){var e;let n=(e=(await r.compute()).coreContent())==null?void 0:e.objects();if(!n)return;let s=n[0];if(!s)return;let i=r.scene();if(s.parent){let o=i.objectsController.objectPath(s);i.camerasController.setMainCameraPath(o)}else alert("the camera object is not part of the scene yet. Make sure to set the display flag on before setting this as the main camera.")}var No=Dc.DEFAULT_PARAMS,Gz=class extends Ye{constructor(){super(...arguments);this.fov=W.FLOAT(No.fov,{range:Af.fovRange,rangeLocked:[!0,!1]}),this.near=W.FLOAT(No.near,{range:[0,100],rangeLocked:[!0,!1]}),this.far=W.FLOAT(No.far,{range:[0,100],rangeLocked:[!0,!1]}),this.position=W.VECTOR3(No.position),this.rotation=W.VECTOR3(No.rotation),this.showHelper=W.BOOLEAN(No.showHelper),this.matrixAutoUpdate=W.BOOLEAN(No.matrixAutoUpdate),this.name=W.STRING("`$OS`"),this.setMainCamera=W.BUTTON(null,{callback:e=>{qz(e)}})}},zde=new Gz,Pf=class extends cn{constructor(){super(...arguments);this.paramsConfig=zde}static type(){return ys.PERSPECTIVE}initializeNode(){this.io.inputs.setCount(0)}cook(e){this._operation=this._operation||new Dc(this._scene,this.states,this);let t=this._operation.cook(e,this.pv);this.setCoreGroup(t)}};Pf.onRegister=Tf;var Vde=new A(0,1,0),qde=new A(-1,0,0),v1=new pe,b1=new pe,w1=new pe,E1=new pe,Lc={t:new A,q:new dt,s:new A},Nf=class{static matrix(e,t){v1.identity(),b1.identity(),w1.identity(),E1.identity(),v1.makeTranslation(e.center.x,e.center.y,e.center.z),b1.makeRotationAxis(Vde,dn.degToRad(e.longitude)),w1.makeRotationAxis(qde,dn.degToRad(e.latitude)),E1.makeTranslation(0,0,e.depth),t.copy(v1).multiply(b1).multiply(w1).multiply(E1)}static applyMatrixToObject(e,t){t.decompose(Lc.t,Lc.q,Lc.s),e.position.copy(Lc.t),e.quaternion.copy(Lc.q),e.scale.copy(Lc.s),e.updateMatrix()}};var Ro=class extends zt{constructor(){super(...arguments);this._fullMatrix=new pe}static type(){return"polarTransform"}cook(e,t){let n=e[0].objects();return Nf.matrix(t,this._fullMatrix),this._applyTransform(n,t,this._fullMatrix),e[0]}_applyTransform(e,t,n){let s=Mc[t.applyOn];switch(s){case Su.GEOMETRIES:return this._applyMatrixToGeometries(e,n);case Su.OBJECTS:return this._applyMatrixToObjects(e,n)}Bn.unreachable(s)}_applyMatrixToGeometries(e,t){for(let n of e){let s=n.geometry;s&&s.applyMatrix4(t)}}_applyMatrixToObjects(e,t){for(let n of e)Nf.applyMatrixToObject(n,t)}};Ro.DEFAULT_PARAMS={applyOn:Mc.indexOf(Su.OBJECTS),center:new A(0,0,0),longitude:0,latitude:0,depth:1};Ro.INPUT_CLONED_STATE=Tt.FROM_NODE;var ku=Ro.DEFAULT_PARAMS,Hz=class extends Ye{constructor(){super(...arguments);this.applyOn=W.INTEGER(ku.applyOn,{menu:{entries:Mc.map((e,t)=>({name:e,value:t}))}}),this.center=W.VECTOR3(ku.center.toArray()),this.longitude=W.FLOAT(ku.longitude,{range:[-360,360]}),this.latitude=W.FLOAT(ku.latitude,{range:[-180,180]}),this.depth=W.FLOAT(ku.depth,{range:[0,10]})}},Gde=new Hz,C1=class extends cn{constructor(){super(...arguments);this.paramsConfig=Gde}static type(){return"polarTransform"}static displayedInputNames(){return["geometries or objects to transform"]}initializeNode(){this.io.inputs.setCount(1),this.io.inputs.initInputsClonedState(Ro.INPUT_CLONED_STATE)}cook(e){this._operation=this._operation||new Ro(this.scene(),this.states);let t=this._operation.cook(e,this.pv);this.setCoreGroup(t)}setApplyOn(e){this.p.applyOn.set(Mc.indexOf(e))}};var Rf=class{static create(e){let t=new st;t.type="SphereBuilder";let{radius:n,widthSegments:s,heightSegments:i,phiStart:o,phiLength:a,thetaStart:c,thetaLength:l,asLines:u,open:h}=e;o==null&&(o=0),a==null&&(a=Math.PI*2),c==null&&(c=0),l==null&&(l=Math.PI),h==null&&(h=!1),s=Math.max(3,Math.floor(s)),i=Math.max(2,Math.floor(i));let d=Math.min(c+l,Math.PI),p=0,_=[],f=new A,m=new A,g=[],x=[],b=[],v=[];for(let y=0;y<=i;y++){let E=[],C=y/i,M=0;y==0&&c==0?M=.5/s:y==i&&d==Math.PI&&(M=-.5/s);for(let R=0;R<=s;R++){let N=R/s;f.x=-n*Math.cos(o+N*a)*Math.sin(c+C*l),f.y=n*Math.cos(c+C*l),f.z=n*Math.sin(o+N*a)*Math.sin(c+C*l),x.push(f.x,f.y,f.z),m.copy(f).normalize(),b.push(m.x,m.y,m.z),v.push(N+M,1-C),E.push(p++)}_.push(E)}for(let y=0;y<i;y++)for(let E=0;E<s;E++){let C=_[y][E+1],M=_[y][E],R=_[y+1][E],N=_[y+1][E+1];u?((y!==0||c>0)&&g.push(C,M),g.push(M,R),h&&(E<s-1&&g.push(R,N),y<i-1&&g.push(C,N))):((y!==0||c>0)&&g.push(C,M,N),(y!==i-1||d<Math.PI)&&g.push(M,R,N))}if(h){let y=_[i][s-1],E=_[i][s];g.push(y,E);let C=_[i-1][s],M=_[i][s];g.push(C,M)}return t.setIndex(g),t.setAttribute("position",new Je(x,3)),t.setAttribute("normal",new Je(b,3)),t.setAttribute("uv",new Je(v,2)),t}};var xr={default:0,isocahedron:1},Wz=["default","isocahedron"],Oo=class extends zt{static type(){return"sphere"}cook(e,t){let n=e[0],s=n?this._cookWithInput(n,t):this._cookWithoutInput(t);return this._node&&(s.name=this._node.name()),this.createCoreGroupFromObjects([s])}_cookWithoutInput(e){let t=this._createRequiredGeometry(e);return t.translate(e.center.x,e.center.y,e.center.z),this._createSphereObject(t,e)}_cookWithInput(e,t){let n=e.boundingBox(),s=n.max.clone().sub(n.min),i=n.max.clone().add(n.min).multiplyScalar(.5),o=this._createRequiredGeometry(t);return o.scale(s.x,s.y,s.z),o.translate(t.center.x,t.center.y,t.center.z),o.translate(i.x,i.y,i.z),this._createSphereObject(o,t)}_createSphereObject(e,t){return zt.createObject(e,t.asLines?kn.LINE_SEGMENTS:kn.MESH)}_createRequiredGeometry(e){return e.type==xr.default?this._createDefaultSphere(e):this._createDefaultIsocahedron(e)}_createDefaultSphere(e){return e.open?Rf.create({radius:e.radius,widthSegments:e.resolution.x,heightSegments:e.resolution.y,phiStart:e.phiStart,phiLength:e.phiLength,thetaStart:e.thetaStart,thetaLength:e.thetaLength,asLines:e.asLines,open:!0}):Rf.create({radius:e.radius,widthSegments:e.resolution.x,heightSegments:e.resolution.y,asLines:e.asLines,open:!1})}_createDefaultIsocahedron(e){return new ml(e.radius,e.detail)}};Oo.DEFAULT_PARAMS={type:xr.default,radius:1,resolution:new G(30,30),open:!1,phiStart:0,phiLength:Math.PI*2,thetaStart:0,thetaLength:Math.PI,detail:1,center:new A(0,0,0),asLines:!1};Oo.INPUT_CLONED_STATE=Tt.FROM_NODE;var Fs=Oo.DEFAULT_PARAMS,Of=1e-5,jz=class extends Ye{constructor(){super(...arguments);this.type=W.INTEGER(Fs.type,{menu:{entries:Wz.map(e=>({name:e,value:xr[e]}))}}),this.radius=W.FLOAT(Fs.radius,{visibleIf:{type:xr.default}}),this.resolution=W.VECTOR2(Fs.resolution,{visibleIf:{type:xr.default}}),this.open=W.BOOLEAN(Fs.open,{visibleIf:{type:xr.default}}),this.phiStart=W.FLOAT(Fs.phiStart,{range:[0,Math.PI*2],visibleIf:{type:xr.default,open:!0},step:Of}),this.phiLength=W.FLOAT("$PI*2",{range:[0,Math.PI*2],visibleIf:{type:xr.default,open:!0},step:Of}),this.thetaStart=W.FLOAT(Fs.thetaStart,{range:[0,Math.PI],visibleIf:{type:xr.default,open:!0},step:Of}),this.thetaLength=W.FLOAT("$PI",{range:[0,Math.PI],visibleIf:{type:xr.default,open:!0},step:Of}),this.detail=W.INTEGER(Fs.detail,{range:[0,5],rangeLocked:[!0,!1],visibleIf:{type:xr.isocahedron}}),this.center=W.VECTOR3(Fs.center),this.asLines=W.BOOLEAN(Fs.asLines)}},Hde=new jz,S1=class extends cn{constructor(){super(...arguments);this.paramsConfig=Hde}static type(){return"sphere"}initializeNode(){this.io.inputs.setCount(0,1),this.io.inputs.initInputsClonedState(Oo.INPUT_CLONED_STATE)}cook(e){this._operation=this._operation||new Oo(this.scene(),this.states,this);let t=this._operation.cook(e,this.pv);this.setCoreGroup(t)}};var $z=`varying vec3 vNormal;
varying vec3 vWorldPosition;
varying vec3 vWorldOrigin;

void main(){
	// compute intensity
	vNormal		= normalize( normalMatrix * normal );

	vec4 worldPosition	= modelMatrix * vec4( position, 1.0 );
	vWorldPosition		= worldPosition.xyz;

	vec4 worldOrigin	= modelMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vWorldOrigin		= worldOrigin.xyz;

	// set gl_Position
	gl_Position	= projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`;var Xz=`varying vec3 vNormal;
varying vec3 vWorldPosition;
varying vec3 vWorldOrigin;

uniform vec3 lightColor;

// uniform vec3 spotPosition;

uniform float attenuation;
uniform float anglePower;

void main(){

	//////////////////////////////////////////////////////////
	// distance attenuation   //
	//////////////////////////////////////////////////////////
	float intensity = distance(vWorldPosition, vWorldOrigin) / attenuation;
	intensity = 1.0 - clamp(intensity, 0.0, 1.0);

	//////////////////////////////////////////////////////////
	// intensity on angle   //
	//////////////////////////////////////////////////////////
	vec3 normal = vec3(vNormal.x, vNormal.y, abs(vNormal.z));
	float angleIntensity = pow( dot(normal, vec3(0.0, 0.0, 1.0)), anglePower );
	intensity = intensity * angleIntensity;
	// 'gl_FragColor = vec4( lightColor, intensity );

	//////////////////////////////////////////////////////////
	// final color   //
	//////////////////////////////////////////////////////////

	// set the final color
	gl_FragColor = vec4( lightColor, intensity);
}`;var A1=class{constructor(r){this.container=r,this.object=new St,this._cone=new sr,this._lineMaterial=new Ln({fog:!1}),this.object.name=`CoreSpotLightHelper_${this.container.nodeName}`,this.object.matrixAutoUpdate=!1,this.createAndBuildObject({helperSize:1})}createAndBuildObject(r){this.buildHelper(),this.update(r)}buildHelper(){this._cone.geometry=A1._buildConeGeometry(),this._cone.material=this._lineMaterial,this._cone.matrixAutoUpdate=!1,this._cone.name=`CoreSpotLightHelperCone_${this.container.nodeName}`,this.object.add(this._cone)}update(r){let e=this.container.light();A1.transformObject(this._cone,{sizeMult:r.helperSize,distance:e.distance,angle:e.angle}),this._lineMaterial.color.copy(e.color)}static transformObject(r,e){let t=(e.distance?e.distance:1e3)*e.sizeMult,n=t*Math.tan(e.angle);this._matrixScale.set(n,n,t),r.matrix.identity(),r.matrix.makeRotationX(Math.PI*1),r.matrix.scale(this._matrixScale)}static _buildConeGeometry(){let r=new st,e=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let t=0,n=1,s=32;t<s;t++,n++){let i=t/s*Math.PI*2,o=n/s*Math.PI*2;e.push(Math.cos(i),Math.sin(i),1,Math.cos(o),Math.sin(o),1)}return r.setAttribute("position",new Je(e,3)),r}},Fu=A1;Fu._matrixScale=new A;var T1=class{constructor(e){this.container=e}update(e){let t=this.container.light();if(e.tvolumetric){let n=this.object();Fu.transformObject(n,{sizeMult:1,distance:t.distance,angle:t.angle});let s=n.material.uniforms;s.lightColor.value.copy(t.color),s.attenuation.value=e.volAttenuation,s.anglePower.value=e.volAnglePower,t.add(n)}else this._mesh&&t.remove(this._mesh)}object(){return this._mesh=this._mesh||this._createMesh()}_createMesh(){let i=new fl(1,1,128,32);i.applyMatrix4(new pe().makeTranslation(0,-.5*1,0)),i.applyMatrix4(new pe().makeRotationX(-Math.PI/2));let o=this._createMaterial(),a=new St(i,o);return a.matrixAutoUpdate=!1,a.name=`VolumetricSpotLight_${this.container.nodeName}`,o.uniforms.lightColor.value.set("white"),a}_createMaterial(){return new Gn({uniforms:{attenuation:{value:5},anglePower:{value:1.2},lightColor:{value:new ae("cyan")}},vertexShader:$z,fragmentShader:Xz,transparent:!0,depthWrite:!1})}};var M1={color:new ae(1,1,1),intensity:1,angle:45,penumbra:.1,decay:.1,distance:100,showHelper:!1,helperSize:1,name:"pointLight",castShadow:!1,shadowAutoUpdate:!0,shadowUpdateOnNextRender:!1,shadowRes:new G(1024,1024),shadowBias:1e-4,shadowNear:.1,shadowFar:100,shadowRadius:0,tvolumetric:!1,volAttenuation:5,volAnglePower:10},_n=M1;function Yz(r){return class extends r{constructor(){super(...arguments);this.light=W.FOLDER(),this.color=W.COLOR(_n.color.toArray(),{conversion:Ls.SRGB_TO_LINEAR}),this.intensity=W.FLOAT(_n.intensity,{range:[0,2],rangeLocked:[!0,!1]}),this.angle=W.FLOAT(_n.angle,{range:[0,180]}),this.penumbra=W.FLOAT(_n.penumbra),this.decay=W.FLOAT(_n.decay,{range:[0,1]}),this.distance=W.FLOAT(_n.distance,{range:[0,100]}),this.showHelper=W.BOOLEAN(_n.showHelper),this.helperSize=W.FLOAT(_n.helperSize,{visibleIf:{showHelper:1}}),this.name=W.STRING("`$OS`"),this.shadow=W.FOLDER(),this.castShadow=W.BOOLEAN(_n.castShadow),this.shadowAutoUpdate=W.BOOLEAN(_n.shadowAutoUpdate,{visibleIf:{castShadow:1}}),this.shadowUpdateOnNextRender=W.BOOLEAN(_n.shadowUpdateOnNextRender,{visibleIf:{castShadow:1,shadowAutoUpdate:0}}),this.shadowRes=W.VECTOR2(_n.shadowRes.toArray(),{visibleIf:{castShadow:1}}),this.shadowBias=W.FLOAT(_n.shadowBias,{visibleIf:{castShadow:1},range:[-.01,.01],rangeLocked:[!1,!1]}),this.shadowNear=W.FLOAT(_n.shadowNear,{visibleIf:{castShadow:1},range:[0,100],rangeLocked:[!0,!1]}),this.shadowFar=W.FLOAT(_n.shadowFar,{visibleIf:{castShadow:1},range:[0,100],rangeLocked:[!0,!1]}),this.shadowRadius=W.FLOAT(_n.shadowRadius,{visibleIf:{castShadow:1},range:[0,10],rangeLocked:[!0,!1]}),this.volumetric=W.FOLDER(),this.tvolumetric=W.BOOLEAN(_n.tvolumetric),this.volAttenuation=W.FLOAT(_n.volAttenuation,{range:[0,10],rangeLocked:[!0,!1]}),this.volAnglePower=W.FLOAT(_n.volAnglePower,{range:[0,20],rangeLocked:[!0,!1]})}}}var Uu=class extends Wt{constructor(e,t){super();this.nodeName=t,this._target=new nt,this.matrixAutoUpdate=!1,this.params={showHelper:!1,helperSize:1,tvolumetric:!1,volAnglePower:1,volAttenuation:1},e.showHelper!=null&&(this.params.showHelper=e.showHelper),e.tvolumetric!=null&&(this.params.tvolumetric=e.tvolumetric),e.volAnglePower!=null&&(this.params.volAnglePower=e.volAnglePower),e.volAttenuation!=null&&(this.params.volAttenuation=e.volAttenuation),this._light=new sd,this._target.copy(this._light.target,!1),this._light.target=this._target,this._light.position.set(0,0,.01),this._light.target.position.set(0,0,-1),this._light.updateMatrix(),this._target.updateMatrix(),this._light.matrixAutoUpdate=!1,this._target.matrixAutoUpdate=!1,this.name=`SpotLightContainer_${this.nodeName}`,this._light.name=`SpotLight_${this.nodeName}`,this._target.name=`SpotLightDefaultTarget_${this.nodeName}`,this.add(this._light),this.add(this._target),this.updateHelper()}updateParams(e){e.showHelper!=null&&(this.params.showHelper=e.showHelper),e.helperSize!=null&&(this.params.helperSize=e.helperSize),e.tvolumetric!=null&&(this.params.tvolumetric=e.tvolumetric),e.volAnglePower!=null&&(this.params.volAnglePower=e.volAnglePower),e.volAttenuation!=null&&(this.params.volAttenuation=e.volAttenuation)}light(){return this._light}copy(e,t){let n=e.light();return this._light.copy(n),super.copy(e,!1),this.updateParams(e.params),this.updateHelper(),this._light.target=this._target,t&&this.updateVolumetric(),this}clone(e){let t=new Uu(this.params,this.nodeName);return t.copy(this),t}updateHelper(){this.params.showHelper?(this.__helper__=this.__helper__||new Fu(this),this.add(this.__helper__.object),this.__helper__.update({helperSize:this.params.helperSize})):this.__helper__&&this.remove(this.__helper__.object)}updateVolumetric(){this.params.tvolumetric?(this.__volumetric__=this.__volumetric__||new T1(this),this.__volumetric__.update(this.params)):this.__volumetric__&&this.__volumetric__.update(this.params)}};var zu=class extends zt{static type(){return"spotLight"}cook(e,t){let n=this.createLight(t);return n.light().name=t.name,this.updateLightParams(n,t),this.updateShadowParams(n,t),n.updateParams(t),n.updateHelper(),n.updateVolumetric(),this.createCoreGroupFromObjects([n])}createLight(e){var t;let n=new Uu(e,((t=this._node)==null?void 0:t.name())||"_"),s=n.light();return s.matrixAutoUpdate=!1,s.castShadow=!0,s.shadow.bias=-.001,s.shadow.mapSize.x=1024,s.shadow.mapSize.y=1024,s.shadow.camera.near=.1,n}updateLightParams(e,t){let n=e.light();n.color=t.color,n.intensity=t.intensity,n.angle=t.angle*(Math.PI/180),n.penumbra=t.penumbra,n.decay=t.decay,n.distance=t.distance}updateShadowParams(e,t){let n=e.light();n.castShadow=t.castShadow,n.shadow.autoUpdate=t.shadowAutoUpdate,n.shadow.needsUpdate=t.shadowUpdateOnNextRender,n.shadow.mapSize.copy(t.shadowRes);let s=n.shadow.map;s&&s.setSize(t.shadowRes.x,t.shadowRes.y),n.shadow.bias=t.shadowBias,n.shadow.radius=t.shadowRadius,n.shadow.camera.near=t.shadowNear,n.shadow.camera.far=t.shadowFar,n.shadow.camera.updateProjectionMatrix(),e.updateHelper()}};zu.DEFAULT_PARAMS=M1;zu.INPUT_CLONED_STATE=Tt.NEVER;var P1=(r=>(r.AREA="areaLight",r.DIRECTIONAL="directionalLight",r.HEMISPHERE="hemisphereLight",r.POINT="pointLight",r.SPOT="spotLight",r))(P1||{});var Zz=class extends Yz(Ye){},Wde=new Zz,N1=class extends cn{constructor(){super(...arguments);this.paramsConfig=Wde}static type(){return P1.SPOT}initializeNode(){this.io.inputs.setCount(0)}cook(e){this._operation=this._operation||new zu(this._scene,this.states,this);let t=this._operation.cook(e,this.pv);this.setCoreGroup(t)}};var R1={nodes:[yf,Zb,Kb,vf,Pf,C1,S1,N1],operations:[]};var q8e=async function(r){let{domElement:e,sceneData:t,onProgress:n,autoPlay:s,createViewer:i,assetsRoot:o,libsRootPrefix:a,printWarnings:c,renderer:l,cameraMaskOverride:u}=r;if(r.runRegister!=null?r.runRegister:!0){for(let g of R1.nodes)ie.registerNode(g,void 0,{printWarnings:c});for(let g of R1.operations)ie.registerOperation(g,{printWarnings:c});let m=[];for(let g of m)xb.createNodeClassAndRegister(g);Hb.run(ie),ie}ie.libs.setRoot("./three/js/libs");function d(m){o&&m.assets.setRoot(o),a&&ie.libs.setRootPrefix(a)}let p="lavalamp_01",{scene:_,viewer:f}=await Eu.loadSceneData({domElement:e,sceneName:p,configureScene:d,sceneData:t,onProgress:n,autoPlay:s,createViewer:i,renderer:l,cameraMaskOverride:u});return{scene:_,viewer:f}};export{ie as Poly,q8e as loadSceneFromSceneData_lavalamp_01};
/**
 * @license
 * Copyright 2010-2022 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
