import{d as M,e as S}from"./chunk-VDLWCXQU.js";var O=(e=>(e.EXPORT_MANIFEST="scene/export_manifest.json",e.CODE_PREFIX="scene/code",e.PROPERTIES="scene/code/properties.json",e.EDITOR="scene/editor.json",e.ASSETS="scene/assets.json",e.POLYGONJS="js/all.js",e.SCENE_DATA_LOADER="js/sceneDataLoader.js",e.POLY_CONFIG="js/polyConfig.js",e.JS_FILES="scene/js_files.json",e.POSTER="images/poster.png",e))(O||{});var y=class{static async importSceneData(s){s.editorMode==null&&(s.editorMode=!1);let t=s.manifest,n=s.urlPrefix||O.CODE_PREFIX,a=Object.keys(t.nodes),c=[];for(let o of a){let r=t.nodes[o],l=`${n}/root/${o}.json?t=${r}`;c.push(l)}let i=`${n}/root.json?t=${t.root}`,p=`${n}/properties.json?t=${t.properties}`,m=[i,p];if(s.editorMode){let o=Date.now();m.push(`${n}/ui.json?t=${o}`)}for(let o of c)m.push(o);let g=0,j=m.length,R=o=>{let r=S.sceneData,l=r.start+r.mult*o;s.onProgress&&s.onProgress(l),M.dispatchProgressEvent(l,s.sceneName)},E=m.map(async o=>{let r=await fetch(o);return g++,R(g/j),r}),D=await Promise.all(E),u=[];for(let o of D)u.push(await o.json());let P={root:u[0],properties:u[1]},d=2;s.editorMode&&(P.ui=u[2],d+=1);let h={},_=Object.keys(t.nodes);for(let o=0;o<_.length;o++){let r=_[o],l=u[o+d];h[r]=l}return this.assemble(P,_,h)}static async assemble(s,t,n){let a={root:s.root,properties:s.properties,ui:s.ui};for(let c=0;c<t.length;c++){let i=t[c],p=n[i];this.insert_child_data(a.root,i,p)}return a}static insert_child_data(s,t,n){let a=t.split("/");if(a.length==1)s.nodes||(s.nodes={}),s.nodes[t]=n;else{let c=a.shift(),i=a.join("/"),p=s.nodes[c];this.insert_child_data(p,i,n)}}};var x={properties:"1660476688903",root:"1660476688903",nodes:{lavalamp:"1660476688903",cameras:"1660476688903","cameras/cameraControls1":"1660476688903",lights:"1660476688903"}},v=async(e={})=>{let s=e.sceneDataRoot||"./polygonjs/scenes";return await y.importSceneData({sceneName:"lavalamp_01",urlPrefix:s+"/lavalamp_01",manifest:x,onProgress:e.onProgress})};var J=async function(e={}){let{onProgress:s,domElement:t,configureSceneData:n,autoPlay:a,createViewer:c,sceneDataRoot:i,assetsRoot:p,libsRootPrefix:m,printWarnings:g,renderer:j,cameraMaskOverride:R}=e,E=e.runRegister!=null?e.runRegister:!0,u=(e.loadModules!=null?e.loadModules:!0)?[]:[],P=[import("./loadSceneFromSceneData-7OCUI6GX.js"),v({onProgress:s,sceneDataRoot:i})],d=await Promise.all(P),{Poly:h,loadSceneFromSceneData_lavalamp_01:_}=d[0],o=d[1];n&&n(o);let r=[];for(let f=2;f<d.length;f++)r.push(d[f]);let l=0;for(let f of u){let w=f+"Module";h.registerModule(r[l][w]),l++}return await _({onProgress:s,sceneData:o,domElement:t,runRegister:E,autoPlay:a,createViewer:c,assetsRoot:p,libsRootPrefix:m,printWarnings:g,renderer:j,cameraMaskOverride:R})};export{J as a};
